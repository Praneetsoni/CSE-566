cscope 15 /mnt/c/Study_resources/CSE 566/Project/Redundancy/rlcsa               0000333080
	@adaptive_samples.cpp

1 
	~<Æg‹ôhm
>

2 
	~<f°ªam
>

3 
	~<io°ªam
>

4 
	~<ve˘‹
>

6 
	~"ad≠tive_ßm∂es.h
"

7 
	~"misc/utûs.h
"

11 
«me•a˚
 
	gCSA


16 
	gAd≠tiveSam∂es
::
Ad≠tiveSam∂es
(c⁄° 
RLCSA
& 
æcß
, c⁄° 
°d
::
°rög
& 
ba£_«me
) :

17 
ödex
(
æcß
),

18 
ßm∂es
(0), 
size
(0), 
ôems
(0),

19 
ˇndid©e_ßm∂es
(0), 
c_ôems
(0),

20 
ªguœr_ßm∂es
(0),

21 
ãxt_°¨t
(0),

22 
¥omŸe_¥obabûôy
(0.0),

23 
pos
(0), 
sum
(0), 
wödow
(0),

24 
ok
(
Ál£
)

26 
P¨amëîs
 
	g∑ømëîs
;

27 
	g∑ømëîs
.
ªad
(
ba£_«me
 + 
PARAMETERS_EXTENSION
);

28 
	gthis
->
	gu£_ˇndid©es
 = 
∑ømëîs
.
gë
(
CANDIDATE_SAMPLES
);

29 
	gthis
->
	ghÆf_gªedy
 = 
∑ømëîs
.
gë
(
HALF_GREEDY_SAMPLES
);

30 
	gthis
->
	gwödow_size
 = 
∑ømëîs
.
gë
(
SAMPLE_WINDOW_SIZE
);

32 if(
	g∑ømëîs
.
gë
(
SAMPLE_PROMOTE_RATE
) > 0)

34 
	gthis
->
	g¥omŸe_¥obabûôy
 = 1.0 / 
∑ømëîs
.
gë
(
SAMPLE_PROMOTE_RATE
);

37 
	g°d
::
°rög
 
fûe_«me
 = 
ba£_«me
 + 
SA_SAMPLES_EXTENSION
;

38 
	g°d
::
if°ªam
 
ßm∂e_fûe
(
fûe_«me
.
c_°r
(), 
°d
::
ios_ba£
::
bö¨y
);

39 if(!
	gßm∂e_fûe
)

41 
	g°d
::
˚º
 << "Ad≠tiveSam∂es: C™nŸ o≥¿ßm∂êfûe!" << 
°d
::
ídl
;

46 
usöt
 
	gtŸÆ_ßm∂es
 = 0;

47 
usöt
 
	gßm∂e_øã
 = 
∑ømëîs
.
gë
(
SAMPLE_RATE
);

48 
	gßm∂e_fûe
.
ªad
((*)&(
tŸÆ_ßm∂es
), (total_samples));

49 
	gßm∂e_fûe
.
ªad
((*)&(
tŸÆ_ßm∂es
), (total_samples));

50 
	gthis
->
	gsize
 = (
this
->
hÆf_gªedy
 ? 
tŸÆ_ßm∂es
 / 2 :Åotal_samples);

51 if(
	gthis
->
	gu£_ˇndid©es
Ë{Åhis->
	gsize
 /= 2; }

54 
	gthis
->
	gßm∂es
 = 
√w
 
ßm∂e_ty≥
[
this
->
size
];

55 
key_ty≥
 
	gi
 = 0; i < 
	gthis
->
	gsize
; i++)

57 
	gthis
->
	gßm∂es
[
i
] = 
ßm∂e_ty≥
(
this
->
ödex
.
gëSize
(),Åhis->index.getSize());

59 if(
	gthis
->
	gu£_ˇndid©es
)

61 
	gthis
->
	gˇndid©e_ßm∂es
 = 
√w
 
ßm∂e_ty≥
[
this
->
size
];

62 
key_ty≥
 
	gi
 = 0; i < 
	gthis
->
	gsize
; i++Ë{Åhis->
	gˇndid©e_ßm∂es
[
i
] = 
this
->
ßm∂es
[i]; }

66 
∑ú_ty≥
 
	gbuf„r
;

67 
∑ú_ty≥
* 
	gªguœrs
 = 0;

68 
usöt
 
	gªg_ßm∂es
 = 0;

69 if(
	gthis
->
	ghÆf_gªedy
Ë{ 
	gªguœrs
 = 
√w
 
∑ú_ty≥
[
tŸÆ_ßm∂es
 / 2]; }

70 
usöt
 
	gi
 = 0; i < 
	gtŸÆ_ßm∂es
; i++)

72 
	gßm∂e_fûe
.
ªad
((*)&
buf„r
, (
∑ú_ty≥
));

73 if(
	gthis
->
	ghÆf_gªedy
 && 
	gbuf„r
.
	g£c⁄d
 % (2 * 
	gßm∂e_øã
) == 0)

75 
ªguœrs
[
ªg_ßm∂es
++] = 
buf„r
;

79 
	gthis
->
addSam∂e
(
ßm∂e_ty≥
(
buf„r
.
fú°
, buf„r.
£c⁄d
));

81 if(
	gbuf„r
.
	g£c⁄d
 =0Ë{ 
this
->
ãxt_°¨t
 = 
buf„r
.
fú°
; }

83 if(
	gthis
->
	ghÆf_gªedy
)

85 
	gthis
->
	gªguœr_ßm∂es
 = 
√w
 
SASam∂es
(
ªguœrs
, 
this
->
ödex
.
gëSize
(), 2 * 
ßm∂e_øã
, 1);

86 
	gdñëe
[] 
	gªguœrs
;Ñegulars = 0;

90 if(
	gthis
->
	g¥omŸe_¥obabûôy
 > 0.0)

92 
	gthis
->
	gwödow
 = 
√w
 
key_ty≥
[
this
->
wödow_size
];

93 
usöt
 
	gi
 = 0; i < 
	gthis
->
	gwödow_size
; i++Ë{Åhis->
	gwödow
[
i
] = 
ßm∂e_øã
 / 2; }

94 
	gthis
->
	gsum
 = 
this
->
wödow_size
 * 
ßm∂e_øã
 / 2;

97 
	gßm∂e_fûe
.
˛o£
();

98 
	gthis
->
	gok
 = 
åue
;

101 
	gAd≠tiveSam∂es
::~
Ad≠tiveSam∂es
()

103 
dñëe
[] 
ßm∂es
; 
	gßm∂es
 = 0;

104 
	gdñëe
[] 
	gˇndid©e_ßm∂es
; candidate_samples = 0;

105 
dñëe
 
	gªguœr_ßm∂es
;Ñegular_samples = 0;

106 
	gdñëe
[] 
	gwödow
; window = 0;

111 
usöt


112 
	gAd≠tiveSam∂es
::
gëNumbîOfSam∂es
() const

114 
usöt
 
ãmp
 = 
this
->
ôems
 +Åhis->
c_ôems
;

115 if(
	gthis
->
	ghÆf_gªedy
Ë{ 
	gãmp
 +
this
->
ªguœr_ßm∂es
->
gëNumbîOfSam∂es
(); }

116  
	gãmp
;

120 
	gAd≠tiveSam∂es
::
gëLﬂd
() const

122 
ãmp
 = 
this
->
ôems
 +Åhis->
c_ôems
;

123 
	gãmp
 /(
this
->
u£_ˇndid©es
 ? 2 *Åhis->
size
 :Åhis->size);

124  
	gãmp
;

128 
	gAd≠tiveSam∂es
::
gëPrim¨yLﬂd
() const

130  
this
->
ôems
 / ()—his->
size
);

134 
	gAd≠tiveSam∂es
::
gëC™did©eLﬂd
() const

136  
this
->
c_ôems
 / ()—his->
size
);

139 
usöt


140 
	gAd≠tiveSam∂es
::
ªp‹tSize
() const

142 
usöt
 
ãmp
 = (*
this
Ë+Åhis->
size
 * (
ßm∂e_ty≥
);

143 if(
	gthis
->
	gu£_ˇndid©es
Ë{ 
	gãmp
 +
this
->
size
 * (
ßm∂e_ty≥
); }

144 if(
	gthis
->
	ghÆf_gªedy
Ë{ 
	gãmp
 +
this
->
ªguœr_ßm∂es
->
ªp‹tSize
(); }

145 if(
	gthis
->
	g¥omŸe_¥obabûôy
 > 0.0Ë{ 
	gãmp
 +
this
->
wödow_size
 * (
key_ty≥
); }

146  
	gãmp
;

150 
	gAd≠tiveSam∂es
::
ªp‹t
() const

152 
°d
::
cout
 << "Ad≠tivêßm∂es:" << std::
ídl
;

153 
	g°d
::
cout
 << "Size: " << 
this
->
ªp‹tSize
(Ë/ ()
MEGABYTE
 << " MB" << 
°d
::
ídl
;

154 
	g°d
::
cout
 << "Lﬂd: " << 
this
->
gëLﬂd
(Ë<< " (" <<Åhis->
gëPrim¨yLﬂd
(Ë<< " / " <<Åhis->
gëC™did©eLﬂd
(Ë<< ")" << 
°d
::
ídl
;

156 
	g°d
::
cout
 << "Options: ";

157 if(
	gthis
->
	gu£_ˇndid©es
Ë{ 
	g°d
::
cout
 << " candidates"; }

158 if(
	gthis
->
	ghÆf_gªedy
Ë{ 
	g°d
::
cout
 << " half-greedy"; }

159 if(
	gthis
->
	g¥omŸe_¥obabûôy
 > 0.0)

161 
	g°d
::
cout
 << "Ñ™dom(" << 
this
->
¥omŸe_¥obabûôy
 << ", " <<Åhis->
wödow_size
 << ")";

163 
	g°d
::
cout
 << 
°d
::
ídl
;

165 
	g°d
::
cout
 << 
°d
::
ídl
;

170 
usöt


171 
	gAd≠tiveSam∂es
::
loˇã
(
usöt
 
i
, 
boﬁ
 
°ïs
)

173 if(
	gi
 >
this
->
ödex
.
gëSize
()Ë{  (
°ïs
 ? 0 :Åhis->index.getSize()); }

175 
usöt
 
	goff£t
 = 0;

176 
ßm∂e_ty≥
 
ßm∂e
(
i
, 0);

177 
	gthis
->
	gödex
.
c⁄vîtToBWTIndex
(
i
);

179 
	gåue
)

182 if(
	gthis
->
	gödex
.
hasIm∂icôSam∂e
(
i
))

184 
	gßm∂e
.
	g£c⁄d
 = 
this
->
ödex
.
gëIm∂icôSam∂e
(
i
Ë- 
off£t
;

187 
	gthis
->
	gödex
.
c⁄vîtToSAIndex
(
i
);

190 if(
	gthis
->
	ghÆf_gªedy
 &&Åhis->
	gªguœr_ßm∂es
->
isSam∂ed
(
i
))

192 
	gßm∂e
.
	g£c⁄d
 = 
this
->
ªguœr_ßm∂es
->
gëSam∂eAt
(
i
Ë- 
off£t
;

197 
key_ty≥
 
	gj
 = 
this
->
hash
(
i
);

198 if(
	gthis
->
	gßm∂es
[
j
].
	gfú°
 =
i
)

200 
ßm∂e
.
£c⁄d
 = 
this
->
ßm∂es
[
j
].£c⁄d - 
off£t
;

205 if(
	gthis
->
	gu£_ˇndid©es
)

207 
	gj
 = 
this
->
£c⁄d¨yHash
(
i
);

208 if(
	gthis
->
	gˇndid©e_ßm∂es
[
j
].
	gfú°
 =
i
)

210 
ßm∂e
.
£c⁄d
 = 
this
->
ˇndid©e_ßm∂es
[
j
].£c⁄d - 
off£t
;

211 
	gthis
->
addSam∂e
(
this
->
ˇndid©e_ßm∂es
[
j
]);

216 
	gi
 = 
this
->
ödex
.
psi
(
i
); 
	goff£t
++;

219 if(
	goff£t
 > 0Ë{ 
	gthis
->
åySam∂e
(
ßm∂e
, 
off£t
); }

222 if(
	gthis
->
	g¥omŸe_¥obabûôy
 > 0.0)

224 
	gthis
->
	gsum
 = 
this
->
sum
 + 
off£t
 -Åhis->
wödow
[this->
pos
];

225 
	gthis
->
	gwödow
[
this
->
pos
] = 
off£t
;Åhis->
	gpos
 = (this->po†+ 1Ë%Åhis->
wödow_size
;

228  (
	g°ïs
 ? 
	goff£t
 : 
ßm∂e
.
£c⁄d
);

231 
usöt
*

232 
	gAd≠tiveSam∂es
::
loˇã
(
∑ú_ty≥
 
ønge
, 
boﬁ
 
°ïs
)

234 if(
Àngth
(
ønge
) == 0) {  0; }

236 
usöt
* 
	gd©a
 = 
√w
 usöt[
Àngth
(
ønge
)];

237 
usöt
 
	gi
 = 0, 
	gj
 = 
ønge
.
fú°
; j <ønge.
£c⁄d
; i++, j++)

239 
	gd©a
[
i
] = 
this
->
loˇã
(
j
, 
°ïs
);

242  
	gd©a
;

246 
	gAd≠tiveSam∂es
::
di•œy
(
∑ú_ty≥
 
ønge
, 
uch¨
* 
d©a
)

248 if(!(
	gthis
->
suµ‹tsDi•œy
()Ë|| 
isEm±y
(
ønge
Ë|| 
	gønge
.
	g£c⁄d
 >
this
->
ödex
.
gëSize
(Ë|| 
d©a
 == 0) { ; }

250 
∑ú_ty≥
 
	gªs
 = 
this
->
ªguœr_ßm∂es
->
övî£SA
(
ønge
.
fú°
);

251 
usöt
 
	gi
 = 
ªs
.
fú°
, 
	gpos
 =Ñes.
£c⁄d
;

252 ; 
	gi
 < 
	gønge
.
	gfú°
; i++)

254 
	gpos
 = 
this
->
ödex
.
psi
(
pos
);

255 
	gthis
->
	gödex
.
c⁄vîtToSAIndex
(
pos
);

257 ; 
	gi
 <
ønge
.
£c⁄d
; i++)

259 
	gd©a
[
i
 - 
ønge
.
fú°
] = 
this
->
ödex
.
gëCh¨a˘î
(
pos
);

260 
	gpos
 = 
this
->
ödex
.
psi
(
pos
);

261 
	gthis
->
	gödex
.
c⁄vîtToSAIndex
(
pos
);

268 
	gAd≠tiveSam∂es
::
addSam∂e
(
ßm∂e_ty≥
 
ßm∂e
)

270 
key_ty≥
 
i
 = 
this
->
hash
(
ßm∂e
.
fú°
);

271 if(
	gthis
->
	gßm∂es
[
i
].
	gfú°
 >
this
->
ödex
.
gëSize
()Ë{Åhis->
ôems
++; }

272 if(
	gthis
->
	gu£_ˇndid©es
Ë{Åhis->
addC™did©e
(
this
->
ßm∂es
[
i
]); }

273 
	gthis
->
	gßm∂es
[
i
] = 
ßm∂e
;

277 
	gAd≠tiveSam∂es
::
addC™did©e
(
ßm∂e_ty≥
 
ßm∂e
)

279 
key_ty≥
 
i
 = 
this
->
£c⁄d¨yHash
(
ßm∂e
.
fú°
);

280 if(
	gthis
->
	gˇndid©e_ßm∂es
[
i
].
	gfú°
 >
this
->
ödex
.
gëSize
()Ë{Åhis->
c_ôems
++; }

281 
	gthis
->
	gˇndid©e_ßm∂es
[
i
] = 
ßm∂e
;

285 
	gAd≠tiveSam∂es
::
åySam∂e
(
ßm∂e_ty≥
 
ßm∂e
, 
usöt
 
off£t
)

287 if(
	gthis
->
	g¥omŸe_¥obabûôy
 > 0.0)

289 
	gãmp
 = (
this
->
¥omŸe_¥obabûôy
 *Åhis->
wödow_size
 * 
off£t
Ë/Åhis->
sum
;

290 if(
ønd
(Ë/ (
	gRAND_MAX
 + 1.0Ë>
ãmp
) { ; }

293 if(
	gthis
->
	gu£_ˇndid©es
Ë{Åhis->
addC™did©e
(
ßm∂e
); }

294 { 
	gthis
->
addSam∂e
(
ßm∂e
); }

297 
	gAd≠tiveSam∂es
::
key_ty≥


298 
Ad≠tiveSam∂es
::
hash
(
key_ty≥
 
key
)

300 
key
 = ~key + (key << 15);

301 
	gkey
 = 
key
 ^ (key >> 12);

302 
	gkey
 = 
key
 + (key << 2);

303 
	gkey
 = 
key
 ^ (key >> 4);

304 
	gkey
 = 
key
 * 2057;

305 
	gkey
 = 
key
 ^ (key >> 16);

306  
	gkey
 % 
	gthis
->
	gsize
;

309 
	gAd≠tiveSam∂es
::
key_ty≥


310 
Ad≠tiveSam∂es
::
£c⁄d¨yHash
(
key_ty≥
 
key
)

312 
key
 = (key + 0x7ed55d16) + (key << 12);

313 
	gkey
 = (
key
 ^ 0xc761c23c) ^ (key >> 19);

314 
	gkey
 = (
key
 + 0x165667b1) + (key << 5);

315 
	gkey
 = (
key
 + 0xd3a2646c) ^ (key << 9);

316 
	gkey
 = (
key
 + 0xfd7046c5) + (key << 3);

317 
	gkey
 = (
key
 ^ 0xb55a4f09) ^ (key >> 16);

318  
	gkey
 % 
	gthis
->
	gsize
;

	@adaptive_samples.h

1 #i‚de‡
ADAPTIVE_SAMPLES_H


2 
	#ADAPTIVE_SAMPLES_H


	)

5 
	~<f°ªam
>

7 
	~"æcß.h
"

8 
	~"misc/∑ømëîs.h
"

11 
«me•a˚
 
	gCSA


16 c⁄° 
∑ømëî_ty≥
 
	gCANDIDATE_SAMPLES
 =Öarameter_type("CANDIDATE_SAMPLES", 0);

17 c⁄° 
∑ømëî_ty≥
 
	gHALF_GREEDY_SAMPLES
 =Öarameter_type("HALF_GREEDY_SAMPLES", 0);

18 c⁄° 
∑ømëî_ty≥
 
	gSAMPLE_PROMOTE_RATE
 =Öarameter_type("SAMPLE_PROMOTE_RATE", 0);

19 c⁄° 
∑ømëî_ty≥
 
	gSAMPLE_WINDOW_SIZE
 =Öarameter_type("SAMPLE_WINDOW_SIZE", 65536);

30 ˛as†
	cAd≠tiveSam∂es


32 
	gpublic
:

33 
uöt
 
	tkey_ty≥
;

34 
	g°d
::
	t∑ú
<
	tkey_ty≥
, key_ty≥> 
	tßm∂e_ty≥
;

36 
Ad≠tiveSam∂es
(c⁄° 
RLCSA
& 
æcß
, c⁄° 
°d
::
°rög
& 
ba£_«me
);

37 ~
Ad≠tiveSam∂es
();

41 
ölöe
 
boﬁ
 
isOk
(Ëc⁄° {  
	gthis
->
	gok
; }

42 
ölöe
 
boﬁ
 
suµ‹tsLoˇã
(Ëc⁄° {  
	gåue
; }

43 
ölöe
 
boﬁ
 
suµ‹tsDi•œy
(Ëc⁄° {  
	gthis
->
	ghÆf_gªedy
; }

45 
usöt
 
gëNumbîOfSam∂es
() const;

46 
gëLﬂd
() const;

47 
gëPrim¨yLﬂd
() const;

48 
gëC™did©eLﬂd
() const;

50 
usöt
 
ªp‹tSize
() const;

51 
ªp‹t
() const;

55 
usöt
 
loˇã
(usöà
i
, 
boﬁ
 
°ïs
);

56 
usöt
* 
loˇã
(
∑ú_ty≥
 
ønge
, 
boﬁ
 
°ïs
);

57 
di•œy
(
∑ú_ty≥
 
ønge
, 
uch¨
* 
d©a
);

61 
	g¥iv©e
:

62 c⁄° 
RLCSA
& 
ödex
;

64 
ßm∂e_ty≥
* 
	gßm∂es
;

65 
usöt
 
	gsize
, 
	gôems
;

67 
ßm∂e_ty≥
* 
	gˇndid©e_ßm∂es
;

68 
usöt
 
	gc_ôems
;

70 
SASam∂es
* 
	gªguœr_ßm∂es
;

72 
key_ty≥
 
	gãxt_°¨t
;

74 
boﬁ
 
	gu£_ˇndid©es
, 
	ghÆf_gªedy
;

75 
	g¥omŸe_¥obabûôy
;

76 
usöt
 
	gwödow_size
, 
	gpos
, 
	gsum
;

77 
key_ty≥
* 
	gwödow
;

79 
boﬁ
 
	gok
;

81 
addSam∂e
(
ßm∂e_ty≥
 
ßm∂e
);

82 
addC™did©e
(
ßm∂e_ty≥
 
ßm∂e
);

83 
åySam∂e
(
ßm∂e_ty≥
 
ßm∂e
, 
usöt
 
off£ts
);

85 
key_ty≥
 
hash
(key_ty≥ 
key
);

86 
key_ty≥
 
£c⁄d¨yHash
(key_ty≥ 
key
);

89 
Ad≠tiveSam∂es
();

90 
Ad≠tiveSam∂es
(const AdaptiveSamples&);

91 
	gAd≠tiveSam∂es
& 
	g›î©‹
 = (c⁄° 
Ad≠tiveSam∂es
&);

	@alphabet.cpp

1 
	~<f°ªam
>

2 
	~<io°ªam
>

4 
	~"Æphabë.h
"

8 
«me•a˚
 
	gCSA


13 
	gAÕhabë
::
AÕhabë
(c⁄° 
usöt
* 
cou¡s
) :

14 
ok
(
Ál£
)

16 
this
->
öôülize
(
cou¡s
);

19 
	gAÕhabë
::
AÕhabë
(
°d
::
if°ªam
& 
fûe
) :

20 
ok
(
Ál£
)

22 
usöt
 
cou¡s
[
CHARS
];

23 
	gfûe
.
ªad
((*)
cou¡s
, 
CHARS
 * (
usöt
));

24 
	gthis
->
öôülize
(
cou¡s
);

27 
	gAÕhabë
::
AÕhabë
(
FILE
* 
fûe
) :

28 
ok
(
Ál£
)

30 if(
fûe
 == 0) { ; }

31 
usöt
 
	gcou¡s
[
CHARS
];

32 if(!
	g°d
::
‰ód
(
cou¡s
, 
CHARS
 * (
usöt
), 1, 
fûe
)) { ; }

33 
	gthis
->
öôülize
(
cou¡s
);

37 
	gAÕhabë
::
öôülize
(c⁄° 
usöt
* 
cou¡s
)

39 if(
cou¡s
 == 0) { ; }

41 
	gthis
->
	gsize
 = 0;Åhis->
	gch¨s
 = 0;

42 
usöt
 
	gc
 = 0; c < 
	gCHARS
; c++)

44 
	gthis
->
	gödex_ønges
[
c
] = ((
cou¡s
[c] > 0 || 
this
->
size
 > 0) ?

45 
∑ú_ty≥
(
this
->
size
,Åhis->sizê+ 
cou¡s
[
c
] - 1) :

46 
EMPTY_PAIR
);

47 if(
	gcou¡s
[
c
] > 0)

49 
	gthis
->
	gãxt_ch¨s
[
this
->
ch¨s
] = 
c
;

50 
	gthis
->
	gch¨s
++;

52 
	gsize
 +
cou¡s
[
c
];

55 
	gthis
->
	gödex_øã
 = 
°d
::
max
((
this
->
size
 + 
CHARS
 - 1Ë/ CHARS, (
usöt
)1);

56 
usöt
 
	gcuºít
 = 0;

58 
usöt
 
	gc
 = 0, 
	gi
 = 0; c < 
	gthis
->
	gch¨s
; c++)

60 
∑ú_ty≥
 
	gønge
 = 
this
->
ödex_ønges
[this->
ãxt_ch¨s
[
c
]];

61 
	gcuºít
 <
ønge
.
£c⁄d
)

63 
this
->
ödex_poöãrs
[
i
] = 
c
;

64 
	gcuºít
 +
this
->
ödex_øã
;

65 
	gi
++;

69 
	gthis
->
	gok
 = 
åue
;

73 
	gAÕhabë
::
wrôeTo
(
°d
::
of°ªam
& 
fûe
) const

75 
usöt
 
c
 = 0; 
	gc
 < 
	gCHARS
; c++)

77 
usöt
 
	gãmp
 = 
this
->
cou¡Of
(
c
);

78 
	gfûe
.
wrôe
((*)&
ãmp
, (temp));

83 
	gAÕhabë
::
wrôeTo
(
FILE
* 
fûe
) const

85 if(
fûe
 == 0) { ; }

86 
usöt
 
	gc
 = 0; c < 
	gCHARS
; c++)

88 
usöt
 
	gãmp
 = 
this
->
cou¡Of
(
c
);

89 
	g°d
::
fwrôe
(&
ãmp
, —emp), 1, 
fûe
);

93 
usöt


94 
	gAÕhabë
::
ªp‹tSize
() const

96  (*
this
);

	@alphabet.h

1 #i‚de‡
ALPHABET_H


2 
	#ALPHABET_H


	)

4 
	~<c°dio
>

5 
	~<f°ªam
>

7 
	~"misc/deföôi⁄s.h
"

10 
«me•a˚
 
	gCSA


14 ˛as†
	cAÕhabë


16 
	gpublic
:

17 
ex∂icô
 
AÕhabë
(c⁄° 
usöt
* 
cou¡s
);

18 
ex∂icô
 
AÕhabë
(
°d
::
if°ªam
& 
fûe
);

19 
ex∂icô
 
AÕhabë
(
FILE
* 
fûe
);

20 ~
AÕhabë
() {}

22 
wrôeTo
(
°d
::
of°ªam
& 
fûe
) const;

23 
wrôeTo
(
FILE
* 
fûe
) const;

24 
usöt
 
ªp‹tSize
() const;

25 
ölöe
 
boﬁ
 
isOk
(Ëc⁄° {  
	gthis
->
	gok
; }

27 
ölöe
 
boﬁ
 
hasCh¨
(
usöt
 
c
Ëc⁄° {  !
isEm±y
(
this
->
ödex_ønges
[c]); }

28 
ölöe
 
usöt
 
cou¡Of
(usöà
c
Ëc⁄° {  
Àngth
(
this
->
ödex_ønges
[c]); }

30 
ölöe
 
usöt
 
cumuœtive
(usöà
c
Ëc⁄° {  
	gthis
->
	gödex_ønges
[c].
	gfú°
; }

31 
ölöe
 
∑ú_ty≥
 
gëR™ge
(
usöt
 
c
Ëc⁄° {  
	gthis
->
	gödex_ønges
[c]; }

33 
ölöe
 
usöt
 
gëD©aSize
(Ëc⁄° {  
	gthis
->
	gsize
; }

34 
ölöe
 
usöt
 
gëAÕhabëSize
(Ëc⁄° {  
	gthis
->
	gch¨s
; }

36 
ölöe
 
usöt
 
gëFú°Ch¨
(Ëc⁄° {  
	gthis
->
	gãxt_ch¨s
[0]; }

37 
ölöe
 
usöt
 
gëTextCh¨
(usöà
i
Ëc⁄° {  
	gthis
->
	gãxt_ch¨s
[i]; }

39 
ölöe
 
usöt
 
ch¨At
(usöà
i
) const

41 c⁄° 
usöt
* 
	gcuº
 = &(
this
->
ãxt_ch¨s
[this->
ödex_poöãrs
[
i
 /Åhis->
ödex_øã
]]);

42 
	gi
 > 
	gthis
->
	gödex_ønges
[*
cuº
].
	g£c⁄d
Ë{ 
	gcuº
++; }

43  *
	gcuº
;

46 
	g¥iv©e
:

48 
∑ú_ty≥
 
ödex_ønges
[
CHARS
];

49 
usöt
 
	gsize
;

51 
usöt
 
	gãxt_ch¨s
[
CHARS
];

52 
usöt
 
	gch¨s
;

54 
usöt
 
	gödex_poöãrs
[
CHARS
];

55 
usöt
 
	gödex_øã
;

57 
boﬁ
 
	gok
;

59 
öôülize
(c⁄° 
usöt
* 
cou¡s
);

62 
AÕhabë
();

63 
AÕhabë
(const Alphabet&);

64 
	gAÕhabë
& 
	g›î©‹
 = (c⁄° 
AÕhabë
&);

	@bits/array.cpp

1 
	~<c°rög
>

2 
	~<c°dlib
>

4 
	~"¨øy.h
"

7 
«me•a˚
 
	gCSA


11 
	gAºay
::
Aºay
(
°d
::
if°ªam
& 
fûe
) :

12 
dñëe_¨øy
(
åue
), 
ôem_ödex
(0)

14 
	gfûe
.
ªad
((*)&(
this
->
ôems
), (this->items));

15 
	gfûe
.
ªad
((*)&(
this
->
numbî_of_blocks
), (this->number_of_blocks));

16 
	gfûe
.
ªad
((*)&(
this
->
block_size
), (this->block_size));

18 
	gthis
->
	g¨øy
 = 
√w
 
usöt
[
this
->
block_size
 *Åhis->
numbî_of_blocks
];

19 
	gfûe
.
ªad
((*)(
this
->
¨øy
),Åhis->
block_size
 *Åhis->
numbî_of_blocks
 * (
usöt
));

20 
	gthis
->
	gbuf„r
 = 
√w
 
RódBuf„r
(
this
->
¨øy
,Åhis->
block_size
);

22 
	gthis
->
	göãgî_bôs
 = 
Àngth
(
this
->
ôems
);

23 
	gthis
->
	gßm∂es
 = 
√w
 
RódBuf„r
(
fûe
, 
this
->
numbî_of_blocks
 + 1,Åhis->
öãgî_bôs
);

25 
	gthis
->
buûdIndex
();

28 
	gAºay
::
Aºay
(
FILE
* 
fûe
) :

29 
dñëe_¨øy
(
åue
), 
ôem_ödex
(0)

31 if(!
	g°d
::
‰ód
(&(
this
->
ôems
), —his->ôems), 1, 
fûe
)) { ; }

32 if(!
	g°d
::
‰ód
(&(
this
->
numbî_of_blocks
), —his->numbî_of_blocks), 1, 
fûe
)) { ; }

33 if(!
	g°d
::
‰ód
(&(
this
->
block_size
), —his->block_size), 1, 
fûe
)) { ; }

35 
	gthis
->
	g¨øy
 = 
√w
 
usöt
[
this
->
block_size
 *Åhis->
numbî_of_blocks
];

36 if(!
	g°d
::
‰ód
(
this
->
¨øy
,Åhis->
block_size
 * (
usöt
),Åhis->
numbî_of_blocks
, 
fûe
)) { ; }

37 
	gthis
->
	gbuf„r
 = 
√w
 
RódBuf„r
(
this
->
¨øy
,Åhis->
block_size
);

39 
	gthis
->
	göãgî_bôs
 = 
Àngth
(
this
->
ôems
);

40 
	gthis
->
	gßm∂es
 = 
√w
 
RódBuf„r
(
fûe
, 
this
->
numbî_of_blocks
 + 1,Åhis->
öãgî_bôs
);

42 
	gthis
->
buûdIndex
();

45 
	gAºay
::
Aºay
(
Encodî
& 
ícodî
) :

46 
ôems
(
ícodî
.items),

47 
dñëe_¨øy
(
åue
),

48 
block_size
(
ícodî
.block_size),

49 
numbî_of_blocks
(
ícodî
.
blocks
),

50 
ôem_ödex
(0)

52 
usöt
* 
	g¨øy_buf„r
 = 
√w
 usöt[
this
->
block_size
 *Åhis->
numbî_of_blocks
];

53 
	gthis
->
	g¨øy
 = 
¨øy_buf„r
;

54 
	gthis
->
	gbuf„r
 = 
√w
 
RódBuf„r
(
this
->
¨øy
,Åhis->
block_size
);

56 
	gthis
->
	göãgî_bôs
 = 
Àngth
(
this
->
ôems
);

57 
WrôeBuf„r
 
ßm∂e_buf„r
(
this
->
numbî_of_blocks
 + 1,Åhis->
öãgî_bôs
);

60 
usöt
 
	gpos
 = 0;

61 
	g°d
::
li°
<
usöt
*>::
ôî©‹
 
ôî
 = 
ícodî
.
¨øy_blocks
.
begö
(); 
	gôî
 !ícodî.¨øy_blocks.
íd
(); iter++)

63 
mem˝y
(
¨øy_buf„r
 + 
pos
, *
ôî
, 
ícodî
.
su≥rblock_byãs
);

64 
	gpos
 +
ícodî
.
block_size
 *Éncodî.
blocks_ö_su≥rblock
;

66 
mem˝y
(
¨øy_buf„r
 + 
pos
, 
ícodî
.
¨øy
,Éncodî.
cuºít_blocks
 *Éncodî.
block_size
 * (
usöt
));

69 
	g°d
::
li°
<
usöt
*>::
ôî©‹
 
ôî
 = 
ícodî
.
ßm∂e_blocks
.
begö
(); 
	gôî
 !ícodî.ßm∂e_blocks.
íd
(); iter++)

71 
usöt
* 
	gbuf
 = *
ôî
;

72 
usöt
 
	gi
 = 0; i < 
	gícodî
.
	gßm∂es_ö_su≥rblock
; i++)

74 
	gßm∂e_buf„r
.
wrôeIãm
(
buf
[
i
]);

77 
usöt
 
	gi
 = 0; i < 
	gícodî
.
	gcuºít_ßm∂es
; i++)

79 
	gßm∂e_buf„r
.
wrôeIãm
(
ícodî
.
ßm∂es
[
i
]);

81 
	gßm∂e_buf„r
.
wrôeIãm
(
this
->
ôems
);

83 
	gthis
->
	gßm∂es
 = 
ßm∂e_buf„r
.
gëRódBuf„r
();

85 
	gthis
->
buûdIndex
();

88 
	gAºay
::~
Aºay
()

90 if(
this
->
dñëe_¨øy
Ë{ 
dñëe
[]Åhis->
¨øy
; }

91 
dñëe
 
	gthis
->
	gbuf„r
;

92 
dñëe
 
	gthis
->
	gßm∂es
;

93 
dñëe
 
	gthis
->
	gôem_ödex
;

99 
	gAºay
::
wrôeTo
(
°d
::
of°ªam
& 
fûe
) const

101 
fûe
.
wrôe
((*)&(
this
->
ôems
), (this->items));

102 
	gfûe
.
wrôe
((*)&(
this
->
numbî_of_blocks
), (this->number_of_blocks));

103 
	gfûe
.
wrôe
((*)&(
this
->
block_size
), (this->block_size));

104 
	gfûe
.
wrôe
((*)(
this
->
¨øy
),Åhis->
block_size
 *Åhis->
numbî_of_blocks
 * (
usöt
));

105 
	gthis
->
	gßm∂es
->
wrôeBuf„r
(
fûe
);

109 
	gAºay
::
wrôeTo
(
FILE
* 
fûe
) const

111 if(
fûe
 == 0) { ; }

112 
	g°d
::
fwrôe
(&(
this
->
ôems
), —his->ôems), 1, 
fûe
);

113 
	g°d
::
fwrôe
(&(
this
->
numbî_of_blocks
), —his->numbî_of_blocks), 1, 
fûe
);

114 
	g°d
::
fwrôe
(&(
this
->
block_size
), —his->block_size), 1, 
fûe
);

115 
	g°d
::
fwrôe
(
this
->
¨øy
,Åhis->
block_size
 * (
usöt
),Åhis->
numbî_of_blocks
, 
fûe
);

116 
	gthis
->
	gßm∂es
->
wrôeTo
(
fûe
);

119 
usöt


120 
	gAºay
::
ªp‹tSize
() const

122 
usöt
 
byãs
 = (*
this
);

123 
	gbyãs
 +
this
->
buf„r
->
ªp‹tSize
();

124 
	gbyãs
 +
this
->
block_size
 *Åhis->
numbî_of_blocks
 * (
usöt
);

125 
	gbyãs
 +
this
->
ßm∂es
->
ªp‹tSize
();

126 
	gbyãs
 +
this
->
ôem_ödex
->
ªp‹tSize
();

127  
	gbyãs
;

133 
	gAºay
::
buûdIndex
()

135 
dñëe
 
this
->
ôem_ödex
;

137 
usöt
 
	gödex_ßm∂es
 = (
this
->
numbî_of_blocks
 + 
Aºay
::
INDEX_RATE
 - 1) / Array::INDEX_RATE;

138 
	gthis
->
	gödex_øã
 = (
this
->
ôems
 + 
ödex_ßm∂es
 - 1) / index_samples;

139 
	gödex_ßm∂es
 = (
this
->
ôems
 +Åhis->
ödex_øã
 - 1) /Åhis->index_rate + 1;

140 
WrôeBuf„r
 
ödex_buf„r
(
ödex_ßm∂es
, 
Àngth
(
this
->
numbî_of_blocks
 - 1));

142 
usöt
 
	gcuºít
 = 0, 
	gpoöãr
 = 0;

143 
	gthis
->
	gßm∂es
->
goToIãm
(1);

144 
	gthis
->
	gßm∂es
->
hasNextIãm
())

146 
usöt
 
	glimô
 = 
this
->
ßm∂es
->
ªadIãm
();

147 
	gcuºít
 < 
	glimô
)

149 
	gödex_buf„r
.
wrôeIãm
(
poöãr
);

150 
	gcuºít
 +
this
->
ödex_øã
;

152 
	gpoöãr
++;

154 
	gödex_buf„r
.
wrôeIãm
(
this
->
numbî_of_blocks
 - 1);

156 
	gthis
->
	gôem_ödex
 = 
ödex_buf„r
.
gëRódBuf„r
();

161 
	gAºay
::
Iãøt‹
::Iãøt‹(c⁄° 
Aºay
& 
∑r
) :

162 
∑ª¡
(
∑r
),

163 
buf„r
(*(
∑r
.buffer)),

164 
ßm∂es
(*(
∑r
.samples))

168 
	gAºay
::
Iãøt‹
::~Iterator()

172 
usöt


173 
Aºay
::
Iãøt‹
::
ªadIãm
(
usöt
 
ödex
)

175 if(
ödex
 >
this
->
∑ª¡
.
ôems
) {  0; }

176 
	gthis
->
gëSam∂e
(
this
->
ßm∂eF‹Index
(
ödex
));

178 
usöt
 
	gvÆue
 = 0;

179 
	gthis
->
	gßm∂e
 +Åhis->
	gcur
 <
ödex
)

181 
vÆue
 = 
this
->
buf„r
.
ªadDñèCode
();

182 
	gthis
->
	gcur
++;

185  
	gvÆue
;

188 
usöt


189 
	gAºay
::
Iãøt‹
::
√xtIãm
()

191 if(
this
->
cur
 >this->
block_ôems
)

193 
this
->
gëSam∂e
—his->
block
 + 1);

196 
	gthis
->
	gcur
++;

197  
	gthis
->
	gbuf„r
.
ªadDñèCode
();

200 
usöt


201 
	gAºay
::
Iãøt‹
::
ßm∂eF‹Index
(
usöt
 
ödex
)

203 
usöt
 
low
 = 
this
->
∑ª¡
.
ôem_ödex
->
ªadIãmC⁄°
(
ödex
 /Åhis->∑ª¡.
ödex_øã
);

204 
usöt
 
	ghigh
 = 
this
->
∑ª¡
.
numbî_of_blocks
 - 1;

206 
	gthis
->
	gßm∂es
.
goToIãm
(
low
 + 1);

207 ; 
	glow
 < 
	ghigh
;Üow++)

209 if(
	gthis
->
	gßm∂es
.
ªadIãm
(Ë> 
	gödex
Ë{  
	glow
; }

212  
	glow
;

217 
	gAºayEncodî
::
AºayEncodî
(
usöt
 
block_byãs
, usöà
su≥rblock_size
) :

218 
ôems
(0), 
blocks
(1),

219 
block_size
(
BYTES_TO_WORDS
(
block_byãs
)),

220 
su≥rblock_byãs
(
su≥rblock_size
)

222 
	gthis
->
	g¨øy
 = 
√w
 
usöt
[
this
->
su≥rblock_byãs
 / (usint)];

223 
mem£t
(
this
->
¨øy
, 0,Åhis->
su≥rblock_byãs
);

224 
	gthis
->
	gblocks_ö_su≥rblock
 = 
this
->
su≥rblock_byãs
 / ((
usöt
Ë*Åhis->
block_size
);

225 
	gthis
->
	gcuºít_blocks
 = 1;

227 
	gthis
->
	gßm∂es
 = 
√w
 
usöt
[
this
->
su≥rblock_byãs
 / (usint)];

228 
	gthis
->
	gßm∂es_ö_su≥rblock
 = 
this
->
su≥rblock_byãs
 / (
usöt
);

229 
	gthis
->
	gcuºít_ßm∂es
 = 1;

230 
	gthis
->
	gßm∂es
[0] = 0;

232 
	gthis
->
	gbuf„r
 = 
√w
 
WrôeBuf„r
(
this
->
¨øy
,Åhis->
block_size
);

235 
	gAºayEncodî
::~
AºayEncodî
()

237 
dñëe
[] 
this
->
¨øy
;

239 
dñëe
 
	gthis
->
	gbuf„r
;

240 
	g°d
::
li°
<
usöt
*>::
ôî©‹
 
ôî
 = 
this
->
¨øy_blocks
.
begö
(); 
	gôî
 !this->¨øy_blocks.
íd
(); iter++)

242 
	gdñëe
[] *
	gôî
;

245 
	gdñëe
[] 
	gthis
->
	gßm∂es
;

246 
	g°d
::
li°
<
usöt
*>::
ôî©‹
 
ôî
 = 
this
->
ßm∂e_blocks
.
begö
(); 
	gôî
 !this->ßm∂e_blocks.
íd
(); iter++)

248 
	gdñëe
[] *
	gôî
;

253 
	gAºayEncodî
::
wrôeIãm
(
usöt
 
vÆue
)

255 
this
->
ôems
++;

256 if(
	gthis
->
	gbuf„r
->
wrôeDñèCode
(
vÆue
)) { ; }

259 
	gthis
->
	gblocks
++;

260 
	gthis
->
	gcuºít_blocks
++;

261 
	gthis
->
	gcuºít_ßm∂es
++;

264 if(
	gthis
->
	gcuºít_blocks
 >Åhis->
	gblocks_ö_su≥rblock
)

266 
	gthis
->
	g¨øy_blocks
.
push_back
(
this
->
¨øy
);

267 
	gthis
->
	g¨øy
 = 
√w
 
usöt
[
this
->
su≥rblock_byãs
 / (usint)];

268 
mem£t
(
this
->
¨øy
, 0,Åhis->
su≥rblock_byãs
);

269 
	gthis
->
	gcuºít_blocks
 = 1;

271 
	gthis
->
	gbuf„r
->
moveBuf„r
(
this
->
¨øy
 + (this->
block_size
 * (this->
cuºít_blocks
 - 1)));

274 if(
	gthis
->
	gcuºít_ßm∂es
 >Åhis->
	gßm∂es_ö_su≥rblock
)

276 
	gthis
->
	gßm∂e_blocks
.
push_back
(
this
->
ßm∂es
);

277 
	gthis
->
	gßm∂es
 = 
√w
 
usöt
[
this
->
su≥rblock_byãs
 / (usint)];

278 
	gthis
->
	gcuºít_ßm∂es
 = 1;

280 
	gthis
->
	gßm∂es
[
this
->
cuºít_ßm∂es
 - 1] =Åhis->
ôems
 - 1;

283 
	gthis
->
	gbuf„r
->
wrôeDñèCode
(
vÆue
);

	@bits/array.h

1 #i‚de‡
_RLCSA_ARRAY_H


2 
	#_RLCSA_ARRAY_H


	)

4 
	~<c°dio
>

5 
	~<f°ªam
>

6 
	~<li°
>

8 
	~"../misc/deföôi⁄s.h
"

9 
	~"bôbuf„r.h
"

12 
«me•a˚
 
	gCSA


21 ˛as†
	cAºayEncodî


23 
	gpublic
:

24 c⁄° 
usöt
 
SUPERBLOCK_SIZE
 = 
MEGABYTE
;

27 
AºayEncodî
(
usöt
 
block_byãs
, usöà
su≥rblock_size
 = 
SUPERBLOCK_SIZE
);

28 ~
AºayEncodî
();

30 
wrôeIãm
(
usöt
 
vÆue
);

31 
ölöe
 
addIãm
(
usöt
 
vÆue
Ë{ 
	gthis
->
wrôeIãm
(value); }

33 
usöt
 
	gôems
, 
	gblocks
;

34 
usöt
 
	gblock_size
, 
	gsu≥rblock_byãs
;

36 
WrôeBuf„r
* 
	gbuf„r
;

38 
	g°d
::
li°
<
usöt
*> 
¨øy_blocks
;

39 
usöt
* 
	g¨øy
;

40 
usöt
 
	gblocks_ö_su≥rblock
, 
	gcuºít_blocks
;

42 
	g°d
::
li°
<
usöt
*> 
ßm∂e_blocks
;

43 
usöt
* 
	gßm∂es
;

44 
usöt
 
	gßm∂es_ö_su≥rblock
, 
	gcuºít_ßm∂es
;

46 
	g¥Ÿe˘ed
:

49 
AºayEncodî
();

50 
AºayEncodî
(const ArrayEncoder&);

51 
	gAºayEncodî
& 
	g›î©‹
 = (c⁄° 
AºayEncodî
&);

55 ˛as†
	cAºay


57 
	gpublic
:

58 c⁄° 
usöt
 
INDEX_RATE
 = 5;

59 
AºayEncodî
 
	tEncodî
;

61 
ex∂icô
 
Aºay
(
°d
::
if°ªam
& 
fûe
);

62 
ex∂icô
 
Aºay
(
FILE
* 
fûe
);

63 
ex∂icô
 
Aºay
(
Encodî
& 
ícodî
);

64 ~
Aºay
();

68 
wrôeTo
(
°d
::
of°ªam
& 
fûe
) const;

69 
wrôeTo
(
FILE
* 
fûe
) const;

71 
ölöe
 
usöt
 
gëSize
(Ëc⁄° {  
	gthis
->
	gôems
; }

72 
ölöe
 
usöt
 
gëBlockSize
(Ëc⁄° {  
	gthis
->
	gblock_size
; }

74 
usöt
 
ªp‹tSize
() const;

78 ˛as†
	cIãøt‹


80 
	gpublic
:

81 
Iãøt‹
(c⁄° 
Aºay
& 
∑r
);

82 ~
Iãøt‹
();

85 
usöt
 
ªadIãm
(usöà
ödex
);

86 
ölöe
 
usöt
 
gëIãm
(usöà
ödex
Ë{  
	gthis
->
ªadIãm
(index); }

87 
usöt
 
√xtIãm
();

89 
ölöe
 
boﬁ
 
hasNext
() const

91  (
	gthis
->
	gßm∂e
 +Åhis->
	gcur
 <Åhis->
	g∑ª¡
.
gëSize
());

94 
	g¥iv©e
:

95 c⁄° 
Aºay
& 
∑ª¡
;

97 
usöt
 
	gblock
, 
	gßm∂e
, 
	gcur
, 
	gblock_ôems
;

99 
RódBuf„r
 
	gbuf„r
, 
	gßm∂es
;

105 
usöt
 
ßm∂eF‹Index
(usöà
ödex
);

107 
ölöe
 
gëSam∂e
(
usöt
 
ßm∂e_numbî
)

109 
	gthis
->
	gblock
 = 
ßm∂e_numbî
;

110 
	gthis
->
	gßm∂e
 = 
this
->
ßm∂es
.
ªadIãm
(
ßm∂e_numbî
);

111 
	gthis
->
	gcur
 = 0;

112 
	gthis
->
	gblock_ôems
 = 
this
->
ßm∂es
.
ªadIãm
(Ë-Åhis->
ßm∂e
;

113 
	gthis
->
	gbuf„r
.
moveBuf„r
(
this
->
∑ª¡
.
¨øy
 + (this->
block
 *Åhis->∑ª¡.
block_size
));

117 
Iãøt‹
();

118 
Iãøt‹
(const Iterator&);

119 
	gIãøt‹
& 
	g›î©‹
 = (c⁄° 
Iãøt‹
&);

124 
	g¥Ÿe˘ed
:

125 
usöt
 
ôems
;

127 
RódBuf„r
* 
	gbuf„r
;

128 
usöt
* 
	g¨øy
;

129 
boﬁ
 
	gdñëe_¨øy
;

130 
usöt
 
	gblock_size
;

131 
usöt
 
	gnumbî_of_blocks
;

136 
RódBuf„r
* 
	gßm∂es
;

137 
usöt
 
	göãgî_bôs
;

139 
RódBuf„r
* 
	gôem_ödex
;

140 
usöt
 
	gödex_øã
;

147 
buûdIndex
();

150 
Aºay
();

151 
Aºay
(const Array&);

152 
	gAºay
& 
	g›î©‹
 = (c⁄° 
Aºay
&);

	@bits/bitbuffer.cpp

1 
	~<c°dlib
>

2 
	~<c°rög
>

4 
	~"bôbuf„r.h
"

7 
«me•a˚
 
	gCSA


12 
	gRódBuf„r
::
RódBuf„r
(
°d
::
if°ªam
& 
fûe
, 
usöt
 
w‹ds
) :

13 
size
(
w‹ds
),

14 
ôem_bôs
(1),

15 
ôems
(0),

16 
‰ì_buf„r
(
åue
)

18 
usöt
* 
	gbuf„r
 = 
√w
 usöt[
this
->
size
];

19 
mem£t
(
buf„r
, 0, 
this
->
size
 * (
usöt
));

20 
	gfûe
.
ªad
((*)
buf„r
, 
this
->
size
 * (
usöt
));

21 
	gthis
->
	gd©a
 = 
buf„r
;

22 
	gthis
->
ª£t
();

25 
	gRódBuf„r
::
RódBuf„r
(
FILE
* 
fûe
, 
usöt
 
w‹ds
) :

26 
size
(
w‹ds
),

27 
ôem_bôs
(1),

28 
ôems
(0),

29 
‰ì_buf„r
(
åue
)

31 
usöt
* 
	gbuf„r
 = 
√w
 usöt[
this
->
size
];

32 
mem£t
(
buf„r
, 0, 
this
->
size
 * (
usöt
));

33 if(
	gfûe
 != 0)

35 if(!
°d
::
‰ód
(
buf„r
, 
this
->
size
 * (
usöt
), 1, 
fûe
)) { ; }

37 
	gthis
->
	gd©a
 = 
buf„r
;

38 
	gthis
->
ª£t
();

41 
	gRódBuf„r
::
RódBuf„r
(
°d
::
if°ªam
& 
fûe
, 
usöt
 
_ôems
, usöà
ôem_size
) :

42 
ôem_bôs
(
ôem_size
),

43 
ôems
(
_ôems
),

44 
‰ì_buf„r
(
åue
)

46 
	gthis
->
	gsize
 = 
bôsToW‹ds
(
this
->
ôems
 *Åhis->
ôem_bôs
);

47 
usöt
* 
	gbuf„r
 = 
√w
 usöt[
this
->
size
];

48 
mem£t
(
buf„r
, 0, 
this
->
size
 * (
usöt
));

49 
	gfûe
.
ªad
((*)
buf„r
, 
this
->
size
 * (
usöt
));

50 
	gthis
->
	gd©a
 = 
buf„r
;

51 
	gthis
->
ª£t
();

54 
	gRódBuf„r
::
RódBuf„r
(
FILE
* 
fûe
, 
usöt
 
_ôems
, usöà
ôem_size
) :

55 
ôem_bôs
(
ôem_size
),

56 
ôems
(
_ôems
),

57 
‰ì_buf„r
(
åue
)

59 
	gthis
->
	gsize
 = 
bôsToW‹ds
(
this
->
ôems
 *Åhis->
ôem_bôs
);

60 
usöt
* 
	gbuf„r
 = 
√w
 usöt[
this
->
size
];

61 
mem£t
(
buf„r
, 0, 
this
->
size
 * (
usöt
));

62 if(
	gfûe
 != 0)

64 if(!
°d
::
‰ód
(
buf„r
, 
this
->
size
 * (
usöt
), 1, 
fûe
)) { ; }

66 
	gthis
->
	gd©a
 = 
buf„r
;

67 
	gthis
->
ª£t
();

70 
	gRódBuf„r
::
RódBuf„r
(c⁄° 
usöt
* 
buf„r
, usöà
w‹ds
) :

71 
size
(
w‹ds
),

72 
ôem_bôs
(1),

73 
ôems
(0),

74 
‰ì_buf„r
(
Ál£
)

76 
	gthis
->
	gd©a
 = 
buf„r
;

77 
	gthis
->
ª£t
();

80 
	gRódBuf„r
::
RódBuf„r
(c⁄° 
usöt
* 
buf„r
, usöà
_ôems
, usöà
ôem_size
) :

81 
ôem_bôs
(
ôem_size
),

82 
ôems
(
_ôems
),

83 
‰ì_buf„r
(
Ál£
)

85 
	gthis
->
	gsize
 = 
bôsToW‹ds
(
this
->
ôems
 *Åhis->
ôem_bôs
);

86 
	gthis
->
	gd©a
 = 
buf„r
;

87 
	gthis
->
ª£t
();

90 
	gRódBuf„r
::
RódBuf„r
(c⁄° RódBuf„r& 
‹igöÆ
) :

91 
d©a
(
‹igöÆ
.data),

92 
size
(
‹igöÆ
.size),

93 
ôem_bôs
(
‹igöÆ
.item_bits),

94 
ôems
(
‹igöÆ
.items),

95 
‰ì_buf„r
(
Ál£
)

97 
	gthis
->
ª£t
();

100 
	gRódBuf„r
::~
RódBuf„r
()

102 if(
this
->
‰ì_buf„r
)

104 
dñëe
[] 
this
->
d©a
;

111 
	gRódBuf„r
::
˛aimD©a
()

113 
this
->
‰ì_buf„r
 = 
åue
;

117 
	gRódBuf„r
::
wrôeTo
(
°d
::
of°ªam
& 
fûe
) const

119 
fûe
.
wrôe
((c⁄° *)
this
->
d©a
,Åhis->
size
 * (
usöt
));

123 
	gRódBuf„r
::
wrôeTo
(
FILE
* 
fûe
) const

125 if(
fûe
 == 0) { ; }

126 
	g°d
::
fwrôe
(
this
->
d©a
,Åhis->
size
 * (
usöt
), 1, 
fûe
);

130 
	gRódBuf„r
::
moveBuf„r
(c⁄° 
usöt
* 
buf„r
)

132 if(
this
->
‰ì_buf„r
)

134 
dñëe
[] 
this
->
d©a
;

136 
	gthis
->
	g‰ì_buf„r
 = 
Ál£
;

138 
	gthis
->
	gd©a
 = 
buf„r
;

139 
	gthis
->
ª£t
();

142 
usöt


143 
	gRódBuf„r
::
ªp‹tSize
() const

145 
usöt
 
byãs
 = (*
this
);

146 if(
	gthis
->
	g‰ì_buf„r
Ë{ 
	gbyãs
 +
this
->
size
 * (
usöt
); }

147  
	gbyãs
;

152 
	gWrôeBuf„r
::
WrôeBuf„r
(
usöt
 
w‹ds
) :

153 
size
(
w‹ds
),

154 
ôem_bôs
(1),

155 
ôems
(0),

156 
‰ì_buf„r
(
åue
)

158 
	gthis
->
	gd©a
 = 
√w
 
usöt
[
w‹ds
];

159 
mem£t
(
this
->
d©a
, 0,Åhis->
size
 * (
usöt
));

160 
	gthis
->
ª£t
();

163 
	gWrôeBuf„r
::
WrôeBuf„r
(
usöt
 
_ôems
, usöà
ôem_size
) :

164 
ôem_bôs
(
ôem_size
),

165 
ôems
(
_ôems
),

166 
‰ì_buf„r
(
åue
)

168 
	gthis
->
	gsize
 = 
bôsToW‹ds
(
this
->
ôems
 *Åhis->
ôem_bôs
);

169 
	gthis
->
	gd©a
 = 
√w
 
usöt
[
this
->
size
];

170 
mem£t
(
this
->
d©a
, 0,Åhis->
size
 * (
usöt
));

171 
	gthis
->
ª£t
();

174 
	gWrôeBuf„r
::
WrôeBuf„r
(
usöt
* 
buf„r
, usöà
w‹ds
) :

175 
size
(
w‹ds
),

176 
ôem_bôs
(1),

177 
ôems
(0),

178 
‰ì_buf„r
(
Ál£
)

180 
	gthis
->
	gd©a
 = 
buf„r
;

181 
	gthis
->
ª£t
();

184 
	gWrôeBuf„r
::
WrôeBuf„r
(
usöt
* 
buf„r
, usöà
_ôems
, usöà
ôem_size
) :

185 
ôem_bôs
(
ôem_size
),

186 
ôems
(
_ôems
),

187 
‰ì_buf„r
(
Ál£
)

189 
	gthis
->
	gsize
 = 
bôsToW‹ds
(
this
->
ôems
 *Åhis->
ôem_bôs
);

190 
	gthis
->
	gd©a
 = 
buf„r
;

191 
	gthis
->
ª£t
();

194 
	gWrôeBuf„r
::~
WrôeBuf„r
()

196 if(
this
->
‰ì_buf„r
)

198 
dñëe
[] 
this
->
d©a
;

204 
RódBuf„r
*

205 
	gWrôeBuf„r
::
gëRódBuf„r
()

207 
RódBuf„r
* 
buf„r
;

208 if(
	gthis
->
	gôems
 > 0)

210 
	gbuf„r
 = 
√w
 
RódBuf„r
(
this
->
d©a
,Åhis->
ôems
,Åhis->
ôem_bôs
);

214 
	gbuf„r
 = 
√w
 
RódBuf„r
(
this
->
d©a
,Åhis->
size
);

217 if(
	gthis
->
	g‰ì_buf„r
)

219 
	gbuf„r
->
˛aimD©a
();

220 
	gthis
->
	g‰ì_buf„r
 = 
Ál£
;

223  
	gbuf„r
;

227 
	gWrôeBuf„r
::
wrôeTo
(
°d
::
of°ªam
& 
fûe
) const

229 
fûe
.
wrôe
((*)
this
->
d©a
,Åhis->
size
 * (
usöt
));

233 
	gWrôeBuf„r
::
wrôeTo
(
FILE
* 
fûe
) const

235 if(
fûe
 == 0) { ; }

236 
	g°d
::
fwrôe
(
this
->
d©a
,Åhis->
size
 * (
usöt
), 1, 
fûe
);

240 
	gWrôeBuf„r
::
moveBuf„r
(
usöt
* 
buf„r
)

242 if(
this
->
‰ì_buf„r
)

244 
dñëe
[] 
this
->
d©a
;

246 
	gthis
->
	g‰ì_buf„r
 = 
Ál£
;

248 
	gthis
->
	gd©a
 = 
buf„r
;

249 
	gthis
->
ª£t
();

252 
usöt


253 
	gWrôeBuf„r
::
ªp‹tSize
() const

255 
usöt
 
byãs
 = (*
this
);

256 if(
	gthis
->
	g‰ì_buf„r
Ë{ 
	gbyãs
 +
this
->
size
 * (
usöt
); }

257  
	gbyãs
;

	@bits/bitbuffer.h

1 #i‚de‡
BITBUFFER_H


2 
	#BITBUFFER_H


	)

4 
	~<Æg‹ôhm
>

5 
	~<c°dio
>

6 
	~<f°ªam
>

7 
	~<io°ªam
>

9 
	~"../misc/deföôi⁄s.h
"

12 
«me•a˚
 
	gCSA


16 ˛as†
	cRódBuf„r


18 
	gpublic
:

19 
RódBuf„r
(
°d
::
if°ªam
& 
fûe
, 
usöt
 
w‹ds
);

20 
RódBuf„r
(
FILE
* 
fûe
, 
usöt
 
w‹ds
);

21 
RódBuf„r
(
°d
::
if°ªam
& 
fûe
, 
usöt
 
_ôems
, usöà
ôem_size
);

22 
RódBuf„r
(
FILE
* 
fûe
, 
usöt
 
_ôems
, usöà
ôem_size
);

25 
RódBuf„r
(c⁄° 
usöt
* 
buf„r
, usöà
w‹ds
);

26 
RódBuf„r
(c⁄° 
usöt
* 
buf„r
, usöà
_ôems
, usöà
ôem_size
);

27 
RódBuf„r
(c⁄° RódBuf„r& 
‹igöÆ
);

29 ~
RódBuf„r
();

33 
˛aimD©a
();

35 
wrôeTo
(
°d
::
of°ªam
& 
fûe
) const;

36 
ölöe
 
wrôeBuf„r
(
°d
::
of°ªam
& 
fûe
Ëc⁄° { 
this
->
wrôeTo
(file); }

37 
wrôeTo
(
FILE
* 
fûe
) const;

38 
ölöe
 
wrôeBuf„r
(
FILE
* 
fûe
Ëc⁄° { 
	gthis
->
wrôeTo
(file); }

41 
moveBuf„r
(c⁄° 
usöt
* 
buf„r
);

43 
usöt
 
ªp‹tSize
() const;

47 
ölöe
 
ª£t
()

49 
	gthis
->
	gpos
 = 0;

50 
	gthis
->
	gbôs
 = 
WORD_BITS
;

51 
	gthis
->
	gcuºít
 = 0;

54 
ölöe
 
skùBôs
(
usöt
 
cou¡
)

56 if(
	gcou¡
 < 
	gthis
->
	gbôs
)

58 
	gthis
->
	gbôs
 -
cou¡
;

62 
	gcou¡
 -
this
->
bôs
;

63 
	gthis
->
	gpos
 +1 + 
cou¡
 / 
WORD_BITS
;

64 
	gthis
->
	gbôs
 = 
WORD_BITS
 - 
cou¡
 % WORD_BITS;

69 
ölöe
 
usöt
 
bôsLe·
() const

71  
	gthis
->
	gbôs
 + 
	gWORD_BITS
 * (this->
	gsize
 -Åhis->
	gpos
 - 1);

75 
ölöe
 
usöt
 
isSë
(usöà
ödex
) const

77  
	gthis
->
	gd©a
[
ödex
 / 
WORD_BITS
] & ((
	gusöt
)1 << (
	gWORD_BITS
 - 
	gödex
 % WORD_BITS - 1));

81 
ölöe
 
usöt
 
ªadBô
()

83 
	gthis
->
	gbôs
--;

84 
usöt
 
	gbô
 = 
this
->
d©a
[this->
pos
] & ((usöt)1 <<Åhis->
bôs
);

86 if(
	gthis
->
	gbôs
 =0Ë{ 
this
->
pos
++;Åhis->bô†
WORD_BITS
; }

88  
	gbô
;

91 
ölöe
 
usöt
 
ªadBôs
(usöà
cou¡
)

93 
usöt
 
	gvÆue
 = 0;

95 if(
	gcou¡
 >
this
->
bôs
)

97 
cou¡
 -
this
->
bôs
;

98 
	gvÆue
 |
HIGHER
(
GET
(
this
->
d©a
[this->
pos
],Åhis->
bôs
), 
cou¡
);

99 
	gthis
->
	gpos
++;Åhis->
	gbôs
 = 
WORD_BITS
;

101 if(
	gcou¡
 > 0)

103 
	gthis
->
	gbôs
 -
cou¡
;

104 
	gvÆue
 |
GET
(
LOWER
(
this
->
d©a
[this->
pos
],Åhis->
bôs
), 
cou¡
);

107  
	gvÆue
;

117 
ölöe
 
usöt
 
ªadNibbÀ
()

119 
	gthis
->
	gbôs
 -= 4;

120 
usöt
 
	gvÆue
 = 
GET
(
LOWER
(
this
->
d©a
[this->
pos
],Åhis->
bôs
), 4);

122 if(
	gthis
->
	gbôs
 =0Ë{ 
this
->
pos
++;Åhis->bô†
WORD_BITS
; }

124  
	gvÆue
;

128 
ölöe
 
usöt
 
ªadNibbÀCode
()

130 
usöt
 
	gãmp
, 
	gvÆue
 = 0, 
	gshi·
 = 0;

133 
	gãmp
 = 
this
->
ªadNibbÀ
();

134 
	gvÆue
 |(
ãmp
 & 0x7Ë<< 
shi·
;

135 
	gshi·
 += 3;

137 (
	gãmp
 & 0x8) == 0);

139  
	gvÆue
 + 1;

143 
ölöe
 
usöt
 
ªadNibbÀCode
(usöà
limô
)

145 
usöt
 
	g_pos
 = 
this
->
pos
, 
	g_bôs
 =Åhis->
bôs
;

146 
usöt
 
	gvÆue
 = 
this
->
ªadNibbÀCode
();

147 if(
	gvÆue
 > 
	glimô
)

149 
	gthis
->
	gpos
 = 
_pos
;Åhis->
	gbôs
 = 
_bôs
;

152  
	gvÆue
;

162 
ölöe
 
usöt
 
gëIãmSize
() const

164  
	gthis
->
	gôem_bôs
;

167 
ölöe
 
usöt
 
gëNumbîOfIãms
() const

169  
	gthis
->
	gôems
;

172 
ölöe
 
goToIãm
(
usöt
 
ôem
)

174 
usöt
 
	gb
 = 
ôem
 * 
this
->
ôem_bôs
;

175 
	gthis
->
	gpos
 = 
b
 / 
WORD_BITS
;

176 
	gthis
->
	gbôs
 = 
WORD_BITS
 - 
b
 % WORD_BITS;

177 
	gthis
->
	gcuºít
 = 
ôem
;

180 
ölöe
 
usöt
 
√xtIãm
()

182 
	gthis
->
	gcuºít
++;

183  
	gthis
->
ªadBôs
(
this
->
ôem_bôs
);

186 
ölöe
 
usöt
 
ªadIãm
(Ë{  
	gthis
->
√xtIãm
(); }

188 
ölöe
 
usöt
 
ªadIãm
(usöà
ôem
)

190 
	gthis
->
goToIãm
(
ôem
);

191  
	gthis
->
√xtIãm
();

194 
ölöe
 
usöt
 
ªadFú°Iãm
()

196  
	gthis
->
ªadIãm
(0);

199 
ölöe
 
usöt
 
ªadIãmC⁄°
(usöà
ôem
) const

201 
usöt
 
	gb
 = 
ôem
 * 
this
->
ôem_bôs
;

202 
usöt
 
	gp
 = 
b
 / 
WORD_BITS
;

203 
	gb
 = 
WORD_BITS
 - 
b
 % WORD_BITS;

205 
usöt
 
	gc
 = 
this
->
ôem_bôs
;

206 
usöt
 
	gvÆue
 = 0;

208 if(
	gc
 >
b
)

210 
c
 -
b
;

211 
	gvÆue
 |
HIGHER
(
GET
(
this
->
d©a
[
p
], 
b
), 
c
);

212 
	gp
++; 
	gb
 = 
WORD_BITS
;

214 if(
	gc
 > 0)

216 
	gb
 -
c
;

217 
	gvÆue
 |
GET
(
LOWER
(
this
->
d©a
[
p
], 
b
), 
c
);

220  
	gvÆue
;

223 
ölöe
 
boﬁ
 
hasNextIãm
() const

225  (
	gthis
->
	gcuºít
 <Åhis->
	gôems
);

228 
ölöe
 
skùIãm
()

230 
	gthis
->
skùBôs
(
this
->
ôem_bôs
);

231 
	gthis
->
	gcuºít
++;

240 
ölöe
 
usöt
 
ªadDñèCode
()

242 
usöt
 
	gÀn
 = 0;

243 
	gthis
->
ªadBô
(Ë=0Ë{ 
Àn
++; }

245 
usöt
 
	gãmp
 = (((usöt)1 << 
Àn
Ë| 
this
->
ªadBôs
(len)) - 1;

246 
	gãmp
 = ((
usöt
)1 << 
ãmp
Ë| 
this
->
ªadBôs
(temp);

247  
	gãmp
;

251 
ölöe
 
usöt
 
ªadDñèCode
(usöà
limô
)

253 
usöt
 
	g_pos
 = 
this
->
pos
, 
	g_bôs
 =Åhis->
bôs
;

254 
usöt
 
	gvÆue
 = 
this
->
ªadDñèCode
();

255 if(
	gvÆue
 > 
	glimô
)

257 
	gthis
->
	gpos
 = 
_pos
;Åhis->
	gbôs
 = 
_bôs
;

260  
	gvÆue
;

265 
	g¥iv©e
:

266 c⁄° 
usöt
* 
d©a
;

267 
usöt
 
	gsize
, 
	gôem_bôs
, 
	gôems
;

268 
boﬁ
 
	g‰ì_buf„r
;

271 
usöt
 
	gpos
, 
	gbôs
, 
	gcuºít
;

273 
ölöe
 
usöt
 
bôsToW‹ds
(usöà
_bôs
Ë{  (
	g_bôs
 + 
	gWORD_BITS
 - 1) / WORD_BITS; }

276 
RódBuf„r
();

277 
	gRódBuf„r
& 
	g›î©‹
 = (c⁄° 
RódBuf„r
&);

284 ˛as†
	cWrôeBuf„r


286 
	gpublic
:

287 
ex∂icô
 
WrôeBuf„r
(
usöt
 
w‹ds
);

288 
WrôeBuf„r
(
usöt
 
_ôems
, usöà
ôem_size
);

291 
WrôeBuf„r
(
usöt
* 
buf„r
, usöà
w‹ds
);

292 
WrôeBuf„r
(
usöt
* 
buf„r
, usöà
_ôems
, usöà
ôem_size
);

294 ~
WrôeBuf„r
();

299 
RódBuf„r
* 
gëRódBuf„r
();

301 
wrôeTo
(
°d
::
of°ªam
& 
fûe
) const;

302 
ölöe
 
wrôeBuf„r
(
°d
::
of°ªam
& 
fûe
Ëc⁄° { 
this
->
wrôeTo
(file); }

303 
wrôeTo
(
FILE
* 
fûe
) const;

304 
ölöe
 
wrôeBuf„r
(
FILE
* 
fûe
Ëc⁄° { 
	gthis
->
wrôeTo
(file); }

307 
moveBuf„r
(
usöt
* 
buf„r
);

309 
usöt
 
ªp‹tSize
() const;

313 
ölöe
 
ª£t
()

315 
	gthis
->
	gpos
 = 0;

316 
	gthis
->
	gbôs
 = 
WORD_BITS
;

317 
	gthis
->
	gcuºít
 = 0;

320 
ölöe
 
skùBôs
(
usöt
 
cou¡
)

322 if(
	gcou¡
 < 
	gthis
->
	gbôs
)

324 
	gthis
->
	gbôs
 -
cou¡
;

328 
	gcou¡
 -
this
->
bôs
;

329 
	gthis
->
	gpos
 +1 + 
cou¡
 / 
WORD_BITS
;

330 
	gthis
->
	gbôs
 = 
WORD_BITS
 - 
cou¡
 % WORD_BITS;

335 
ölöe
 
usöt
 
bôsLe·
() const

337  
	gthis
->
	gbôs
 + 
	gWORD_BITS
 * (this->
	gsize
 -Åhis->
	gpos
 - 1);

340 
ölöe
 
wrôeBôs
(
usöt
 
vÆue
, usöà
cou¡
)

342 if(
	gcou¡
 >
this
->
bôs
)

344 
cou¡
 -
this
->
bôs
;

345 
	gthis
->
	gd©a
[
this
->
pos
] |
GET
(
LOWER
(
vÆue
, 
cou¡
),Åhis->
bôs
);

346 
	gthis
->
	gpos
++;Åhis->
	gbôs
 = 
WORD_BITS
;

348 if(
	gcou¡
 > 0)

350 
	gthis
->
	gbôs
 -
cou¡
;

351 
	gthis
->
	gd©a
[
this
->
pos
] |
HIGHER
(
GET
(
vÆue
, 
cou¡
),Åhis->
bôs
);

358 
ölöe
 
usöt
 
isSë
(usöà
ödex
) const

360  
	gthis
->
	gd©a
[
ödex
 / 
WORD_BITS
] & ((
	gusöt
)1 << (
	gWORD_BITS
 - 
	gödex
 % WORD_BITS - 1));

363 
ölöe
 
£tBô
(
usöt
 
ödex
)

365 
	gthis
->
	gd©a
[
ödex
 / 
WORD_BITS
] |(
usöt
)1 << (WORD_BITS - index % WORD_BITS - 1);

368 
ölöe
 
un£tBô
(
usöt
 
ödex
)

370 
	gthis
->
	gd©a
[
ödex
 / 
WORD_BITS
] &~((
usöt
)1 << (WORD_BITS - index % WORD_BITS - 1));

379 
ölöe
 
usöt
 
gëIãmSize
() const

381  
	gthis
->
	gôem_bôs
;

384 
ölöe
 
goToIãm
(
usöt
 
ôem
)

386 
usöt
 
	gb
 = 
ôem
 * 
this
->
ôem_bôs
;

387 
	gthis
->
	gpos
 = 
b
 / 
WORD_BITS
;

388 
	gthis
->
	gbôs
 = 
WORD_BITS
 - 
b
 % WORD_BITS;

389 
	gthis
->
	gcuºít
 = 
ôem
;

392 
ölöe
 
boﬁ
 
hasNextIãm
() const

394  (
	gthis
->
	gcuºít
 <Åhis->
	gôems
);

397 
ölöe
 
wrôeIãm
(
usöt
 
ôem
)

399 
	gthis
->
wrôeBôs
(
ôem
, 
this
->
ôem_bôs
);

400 
	gthis
->
	gcuºít
++;

403 
ölöe
 
skùIãm
()

405 
	gthis
->
skùBôs
(
this
->
ôem_bôs
);

406 
	gthis
->
	gcuºít
++;

415 
ölöe
 
usöt
 
nibbÀCodeLígth
(usöà
vÆue
) const

417 
usöt
 
	gb
 = 0;

418 
	gvÆue
--;

422 
	gb
 += 4;

423 
	gvÆue
 >>= 3;

425 
	gvÆue
 > 0);

427  
	gb
;

431 
ölöe
 
wrôeNibbÀ
(
usöt
 
vÆue
)

433 
	gthis
->
	gbôs
 -= 4;

434 
	gthis
->
	gd©a
[
this
->
pos
] |
HIGHER
(
vÆue
,Åhis->
bôs
);

435 if(
	gthis
->
	gbôs
 =0Ë{ 
this
->
pos
++;Åhis->bô†
WORD_BITS
; }

439 
ölöe
 
wrôeNibbÀCode
(
usöt
 
vÆue
)

441 
	gvÆue
--;

442 
	gvÆue
 > 0x7)

444 
	gthis
->
wrôeNibbÀ
(
vÆue
 & 0x7);

445 
	gvÆue
 >>= 3;

447 
	gthis
->
wrôeNibbÀ
(
vÆue
 | 0x8);

456 
ölöe
 
boﬁ
 
ˇnDñèCode
(
usöt
 
vÆue
) const

458  
	gthis
->
dñèCodeLígth
(
vÆue
Ë<
this
->
bôsLe·
();

461 
ölöe
 
usöt
 
dñèCodeLígth
(usöà
vÆue
) const

463 
usöt
 
	gÀn
 = 
Àngth
(
vÆue
);

464 
usöt
 
	gŒí
 = 
Àngth
(
Àn
);

465  (
	gÀn
 + 
	gŒí
 +Ülen - 2);

469 
ölöe
 
boﬁ
 
wrôeDñèCode
(
usöt
 
vÆue
)

471 
usöt
 
	gÀn
 = 
Àngth
(
vÆue
);

472 
usöt
 
	gŒí
 = 
Àngth
(
Àn
);

474 if(
	gÀn
 + 
	gŒí
 +ÜÀ¿- 2 > 
	gthis
->
bôsLe·
()Ë{  
	gÁl£
; }

477 
	gthis
->
wrôeBôs
(
Àn
, 
Œí
 +Ülen - 1);

478 
	gthis
->
wrôeBôs
(
vÆue
, 
Àn
 - 1);

479  
	gåue
;

483 
ölöe
 
wrôeDñèCodeDúe˘
(
usöt
 
vÆue
)

485 
usöt
 
	gÀn
 = 
Àngth
(
vÆue
);

486 
usöt
 
	gŒí
 = 
Àngth
(
Àn
);

489 
	gthis
->
wrôeBôs
(
Àn
, 
Œí
 +Ülen - 1);

490 
	gthis
->
wrôeBôs
(
vÆue
, 
Àn
 - 1);

496 
ölöe
 
wrôeDñèCodeFa°
(
usöt
 
vÆue
)

498 
usöt
 
	gÀn
 = 
Àngth
(
vÆue
);

500 
	gvÆue
 ^((
usöt
)1 << (
Àn
 - 1));

501 
	gthis
->
wrôeBôs
((
Àn
 << (À¿- 1)Ë| 
vÆue
,Üí + 2 * 
Àngth
(len) - 2);

506 
	g¥iv©e
:

507 
usöt
* 
d©a
;

508 
usöt
 
	gsize
, 
	gôem_bôs
, 
	gôems
;

509 
boﬁ
 
	g‰ì_buf„r
;

512 
usöt
 
	gpos
, 
	gbôs
, 
	gcuºít
;

514 
ölöe
 
usöt
 
bôsToW‹ds
(usöà
_bôs
Ë{  (
	g_bôs
 + 
	gWORD_BITS
 - 1) / WORD_BITS; }

517 
WrôeBuf„r
();

518 
WrôeBuf„r
(const WriteBuffer&);

519 
	gWrôeBuf„r
& 
	g›î©‹
 = (c⁄° 
WrôeBuf„r
&);

	@bits/bitvector.cpp

1 
	~<c°rög
>

2 
	~<c°dlib
>

4 
	~"bôve˘‹.h
"

7 
«me•a˚
 
	gCSA


11 
	gBôVe˘‹
::
BôVe˘‹
(
°d
::
if°ªam
& 
fûe
) :

12 
ønk_ödex
(0), 
£À˘_ödex
(0)

14 
	gthis
->
ªadHódî
(
fûe
);

15 
	gthis
->
ªadAºay
(
fûe
);

17 
	gthis
->
	göãgî_bôs
 = 
Àngth
(
this
->
size
);

18 
	gthis
->
	gßm∂es
 = 
√w
 
RódBuf„r
(
fûe
, 2 * (
this
->
numbî_of_blocks
 + 1),Åhis->
öãgî_bôs
);

20 
	gthis
->
ödexF‹R™k
();

21 
	gthis
->
ödexF‹Sñe˘
();

24 
	gBôVe˘‹
::
BôVe˘‹
(
FILE
* 
fûe
) :

25 
ønk_ödex
(0), 
£À˘_ödex
(0)

27 
	gthis
->
ªadHódî
(
fûe
);

28 
	gthis
->
ªadAºay
(
fûe
);

30 
	gthis
->
	göãgî_bôs
 = 
Àngth
(
this
->
size
);

31 
	gthis
->
	gßm∂es
 = 
√w
 
RódBuf„r
(
fûe
, 2 * (
this
->
numbî_of_blocks
 + 1),Åhis->
öãgî_bôs
);

33 
	gthis
->
ödexF‹R™k
();

34 
	gthis
->
ödexF‹Sñe˘
();

37 
	gBôVe˘‹
::
BôVe˘‹
(
Ve˘‹Encodî
& 
ícodî
, 
usöt
 
univî£_size
) :

38 
size
(
univî£_size
), 
ôems
(
ícodî
.items),

39 
block_size
(
ícodî
.block_size),

40 
numbî_of_blocks
(
ícodî
.
blocks
),

41 
ønk_ödex
(0), 
£À˘_ödex
(0)

43 if(
	gthis
->
	gôems
 == 0)

45 
°d
::
˚º
 << "BôVe˘‹: C™nŸ cª©ê®bô ve˘‹ wôhÇÿ1-bôs!" << std::
ídl
;

48 
	gthis
->
c›yAºay
(
ícodî
);

50 
	gthis
->
	göãgî_bôs
 = 
Àngth
(
this
->
size
);

51 
WrôeBuf„r
 
ßm∂e_buf„r
(2 * (
this
->
numbî_of_blocks
 + 1),Åhis->
öãgî_bôs
);

54 
	g°d
::
li°
<
usöt
*>::
ôî©‹
 
ôî
 = 
ícodî
.
ßm∂e_blocks
.
begö
(); 
	gôî
 !ícodî.ßm∂e_blocks.
íd
(); iter++)

56 
usöt
* 
	gbuf
 = *
ôî
;

57 
usöt
 
	gi
 = 0; i < 2 * 
	gícodî
.
	gßm∂es_ö_su≥rblock
; i++)

59 
	gßm∂e_buf„r
.
wrôeIãm
(
buf
[
i
]);

62 
usöt
 
	gi
 = 0; i < 2 * 
	gícodî
.
	gcuºít_ßm∂es
; i++)

64 
	gßm∂e_buf„r
.
wrôeIãm
(
ícodî
.
ßm∂es
[
i
]);

66 
	gßm∂e_buf„r
.
wrôeIãm
(
this
->
ôems
);

67 
	gßm∂e_buf„r
.
wrôeIãm
(
this
->
size
);

69 
	gthis
->
	gßm∂es
 = 
ßm∂e_buf„r
.
gëRódBuf„r
();

71 
	gthis
->
ödexF‹R™k
();

72 
	gthis
->
ödexF‹Sñe˘
();

75 
	gBôVe˘‹
::
BôVe˘‹
() :

76 
¨øy
(0), 
ßm∂es
(0), 
ønk_ödex
(0), 
£À˘_ödex
(0)

80 
	gBôVe˘‹
::~
BôVe˘‹
()

82 
dñëe
[] 
this
->
¨øy
;

83 
dñëe
 
	gthis
->
	gßm∂es
;

84 
dñëe
 
	gthis
->
	gønk_ödex
;

85 
dñëe
 
	gthis
->
	g£À˘_ödex
;

91 
	gBôVe˘‹
::
wrôeTo
(
°d
::
of°ªam
& 
fûe
) const

93 
this
->
wrôeHódî
(
fûe
);

94 
	gthis
->
wrôeAºay
(
fûe
);

95 
	gthis
->
	gßm∂es
->
wrôeBuf„r
(
fûe
);

99 
	gBôVe˘‹
::
wrôeTo
(
FILE
* 
fûe
) const

101 
this
->
wrôeHódî
(
fûe
);

102 
	gthis
->
wrôeAºay
(
fûe
);

103 
	gthis
->
	gßm∂es
->
wrôeBuf„r
(
fûe
);

107 
	gBôVe˘‹
::
wrôeHódî
(
°d
::
of°ªam
& 
fûe
) const

109 
fûe
.
wrôe
((*)&(
this
->
size
), (this->size));

110 
	gfûe
.
wrôe
((*)&(
this
->
ôems
), (this->items));

111 
	gfûe
.
wrôe
((*)&(
this
->
numbî_of_blocks
), (this->number_of_blocks));

112 
	gfûe
.
wrôe
((*)&(
this
->
block_size
), (this->block_size));

116 
	gBôVe˘‹
::
wrôeHódî
(
FILE
* 
fûe
) const

118 if(
fûe
 == 0) { ; }

119 
	g°d
::
fwrôe
(&(
this
->
size
), —his->size), 1, 
fûe
);

120 
	g°d
::
fwrôe
(&(
this
->
ôems
), —his->ôems), 1, 
fûe
);

121 
	g°d
::
fwrôe
(&(
this
->
numbî_of_blocks
), —his->numbî_of_blocks), 1, 
fûe
);

122 
	g°d
::
fwrôe
(&(
this
->
block_size
), —his->block_size), 1, 
fûe
);

126 
	gBôVe˘‹
::
wrôeAºay
(
°d
::
of°ªam
& 
fûe
) const

128 
fûe
.
wrôe
((*)(
this
->
¨øy
),Åhis->
block_size
 *Åhis->
numbî_of_blocks
 * (
usöt
));

132 
	gBôVe˘‹
::
wrôeAºay
(
FILE
* 
fûe
) const

134 if(
fûe
 == 0) { ; }

135 
	g°d
::
fwrôe
(
this
->
¨øy
,Åhis->
block_size
 * (
usöt
),Åhis->
numbî_of_blocks
, 
fûe
);

139 
	gBôVe˘‹
::
ªadHódî
(
°d
::
if°ªam
& 
fûe
)

141 
fûe
.
ªad
((*)&(
this
->
size
), (this->size));

142 
	gfûe
.
ªad
((*)&(
this
->
ôems
), (this->items));

143 
	gfûe
.
ªad
((*)&(
this
->
numbî_of_blocks
), (this->number_of_blocks));

144 
	gfûe
.
ªad
((*)&(
this
->
block_size
), (this->block_size));

148 
	gBôVe˘‹
::
ªadHódî
(
FILE
* 
fûe
)

150 if(
fûe
 == 0) { ; }

151 if(!
	g°d
::
‰ód
(&(
this
->
size
), —his->size), 1, 
fûe
)) { ; }

152 if(!
	g°d
::
‰ód
(&(
this
->
ôems
), —his->ôems), 1, 
fûe
)) { ; }

153 if(!
	g°d
::
‰ód
(&(
this
->
numbî_of_blocks
), —his->numbî_of_blocks), 1, 
fûe
)) { ; }

154 if(!
	g°d
::
‰ód
(&(
this
->
block_size
), —his->block_size), 1, 
fûe
)) { ; }

158 
	gBôVe˘‹
::
ªadAºay
(
°d
::
if°ªam
& 
fûe
)

160 
usöt
* 
¨øy_buf„r
 = 
√w
 usöt[
this
->
block_size
 *Åhis->
numbî_of_blocks
];

161 
	gfûe
.
ªad
((*)(
¨øy_buf„r
), 
this
->
block_size
 *Åhis->
numbî_of_blocks
 * (
usöt
));

162 
	gthis
->
	g¨øy
 = 
¨øy_buf„r
;

166 
	gBôVe˘‹
::
ªadAºay
(
FILE
* 
fûe
)

168 if(
fûe
 == 0) { ; }

169 
usöt
* 
	g¨øy_buf„r
 = 
√w
 usöt[
this
->
block_size
 *Åhis->
numbî_of_blocks
];

170 if(!
	g°d
::
‰ód
(
¨øy_buf„r
, 
this
->
block_size
 * (
usöt
),Åhis->
numbî_of_blocks
, 
fûe
)) { ; }

171 
	gthis
->
	g¨øy
 = 
¨øy_buf„r
;

177 
	gBôVe˘‹
::
c›yAºay
(
Ve˘‹Encodî
& 
ícodî
, 
boﬁ
 
u£_dúe˘ly
)

179 if(
	gu£_dúe˘ly
 && 
	gícodî
.
	g¨øy_blocks
.
size
() == 0)

181 
this
->
¨øy
 = 
ícodî
.¨øy; 
	gícodî
.
	g¨øy
 = 0;

185 
usöt
* 
	g¨øy_buf„r
 = 
√w
 usöt[
this
->
block_size
 *Åhis->
numbî_of_blocks
];

186 
usöt
 
	gpos
 = 0, 
	gtŸÆ_w‹ds
 = 
this
->
block_size
 *Åhis->
numbî_of_blocks
;

188 
	g°d
::
li°
<
usöt
*>::
ôî©‹
 
ôî
 = 
ícodî
.
¨øy_blocks
.
begö
(); 
	gôî
 !ícodî.¨øy_blocks.
íd
(); iter++)

190 
mem˝y
(
¨øy_buf„r
 + 
pos
, *
ôî
, 
ícodî
.
su≥rblock_byãs
);

191 
	gpos
 +
ícodî
.
su≥rblock_byãs
 / (
usöt
);

194 
usöt
 
	gªmaödî
 = 
°d
::
mö
(
tŸÆ_w‹ds
 - 
pos
, (usöt)(
ícodî
.
su≥rblock_byãs
 / (usint)));

195 
mem˝y
(
¨øy_buf„r
 + 
pos
, 
ícodî
.
¨øy
, 
ªmaödî
 * (
usöt
));

196 
	gpos
 +
ªmaödî
;

197 if(
	gpos
 < 
	gtŸÆ_w‹ds
Ë{ 
mem£t
(
¨øy_buf„r
 + 
pos
, 0, (
tŸÆ_w‹ds
 -ÖosË* (
usöt
)); }

199 
	gthis
->
	g¨øy
 = 
¨øy_buf„r
;

204 
usöt


205 
	gBôVe˘‹
::
ªp‹tSize
() const

208 
usöt
 
byãs
 = 
this
->
block_size
 *Åhis->
numbî_of_blocks
 * (usint);

209 if(
	gthis
->
	gßm∂es
 !0Ë{ 
byãs
 +
this
->
ßm∂es
->
ªp‹tSize
(); }

210 if(
	gthis
->
	gønk_ödex
 !0Ë{ 
byãs
 +
this
->
ønk_ödex
->
ªp‹tSize
(); }

211 if(
	gthis
->
	g£À˘_ödex
 !0Ë{ 
byãs
 +
this
->
£À˘_ödex
->
ªp‹tSize
(); }

212  
	gbyãs
;

215 
usöt


216 
	gBôVe˘‹
::
gëCom¥es£dSize
() const

218  
this
->
block_size
 *Åhis->
numbî_of_blocks
 * (
usöt
);

224 
	gBôVe˘‹
::
°rù
()

226 
dñëe
 
this
->
ønk_ödex
; 
	gthis
->
	gønk_ödex
 = 0;

232 
	gBôVe˘‹
::
ödexF‹R™k
()

234 
dñëe
 
this
->
ønk_ödex
;

236 
usöt
 
	gvÆue_ßm∂es
 = (
this
->
numbî_of_blocks
 + 
BôVe˘‹
::
INDEX_RATE
 - 1) / BitVector::INDEX_RATE;

237 
	gthis
->
	gønk_øã
 = (
this
->
size
 + 
vÆue_ßm∂es
 - 1) / value_samples;

238 
	gvÆue_ßm∂es
 = (
this
->
size
 +Åhis->
ønk_øã
 - 1) /Åhis->rank_rate + 1;

239 
WrôeBuf„r
 
ödex_buf„r
(
vÆue_ßm∂es
, 
Àngth
(
this
->
numbî_of_blocks
 - 1));

242 
usöt
 
	gcuºít
 = 0, 
	gpoöãr
 = 0;

243 
	gthis
->
	gßm∂es
->
goToIãm
(2);

244 
	gthis
->
	gßm∂es
->
hasNextIãm
())

246 
	gthis
->
	gßm∂es
->
skùIãm
();

247 
usöt
 
	glimô
 = 
this
->
ßm∂es
->
ªadIãm
();

248 
	gcuºít
 < 
	glimô
)

250 
	gödex_buf„r
.
wrôeIãm
(
poöãr
);

251 
	gcuºít
 +
this
->
ønk_øã
;

253 
	gpoöãr
++;

255 
	gödex_buf„r
.
wrôeIãm
(
this
->
numbî_of_blocks
 - 1);

257 
	gthis
->
	gønk_ödex
 = 
ödex_buf„r
.
gëRódBuf„r
();

261 
	gBôVe˘‹
::
ödexF‹Sñe˘
()

263 
dñëe
 
this
->
£À˘_ödex
;

265 
usöt
 
	gödex_ßm∂es
 = (
this
->
numbî_of_blocks
 + 
BôVe˘‹
::
INDEX_RATE
 - 1) / BitVector::INDEX_RATE;

266 
	gthis
->
	g£À˘_øã
 = (
this
->
ôems
 + 
ödex_ßm∂es
 - 1) / index_samples;

267 
	gödex_ßm∂es
 = (
this
->
ôems
 +Åhis->
£À˘_øã
 - 1) /Åhis->select_rate + 1;

268 
WrôeBuf„r
 
ödex_buf„r
(
ödex_ßm∂es
, 
Àngth
(
this
->
numbî_of_blocks
 - 1));

271 
usöt
 
	gcuºít
 = 0, 
	gpoöãr
 = 0;

272 
	gthis
->
	gßm∂es
->
goToIãm
(2);

273 
	gthis
->
	gßm∂es
->
hasNextIãm
())

275 
usöt
 
	glimô
 = 
this
->
ßm∂es
->
ªadIãm
();

276 
	gthis
->
	gßm∂es
->
skùIãm
();

277 
	gcuºít
 < 
	glimô
)

279 
	gödex_buf„r
.
wrôeIãm
(
poöãr
);

280 
	gcuºít
 +
this
->
£À˘_øã
;

282 
	gpoöãr
++;

284 
	gödex_buf„r
.
wrôeIãm
(
this
->
numbî_of_blocks
 - 1);

286 
	gthis
->
	g£À˘_ödex
 = 
ödex_buf„r
.
gëRódBuf„r
();

291 
	gBôVe˘‹
::
Iãøt‹
::Iãøt‹(c⁄° 
BôVe˘‹
& 
∑r
) :

292 
∑ª¡
(
∑r
),

293 
buf„r
(
∑r
.
¨øy
,Ö¨.
block_size
),

294 
ßm∂es
(*(
∑r
.samples))

298 
	gBôVe˘‹
::
Iãøt‹
::~Iterator()

302 
usöt


303 
BôVe˘‹
::
Iãøt‹
::
ßm∂eF‹Index
(
usöt
 
ödex
)

305 
usöt
 
low
 = 
this
->
∑ª¡
.
£À˘_ödex
->
ªadIãmC⁄°
(
ödex
 /Åhis->∑ª¡.
£À˘_øã
);

306 
usöt
 
	ghigh
 = 
this
->
∑ª¡
.
numbî_of_blocks
 - 1;

308 
	gthis
->
	gßm∂es
.
goToIãm
(2 * 
low
 + 2);

309 ; 
	glow
 < 
	ghigh
;Üow++)

311 if(
	gthis
->
	gßm∂es
.
ªadIãm
(Ë> 
	gödex
Ë{  
	glow
; }

312 
	gthis
->
	gßm∂es
.
skùIãm
();

315  
	glow
;

318 
usöt


319 
	gBôVe˘‹
::
Iãøt‹
::
ßm∂eF‹VÆue
(
usöt
 
vÆue
)

321 
usöt
 
low
 = 
this
->
∑ª¡
.
ønk_ödex
->
ªadIãmC⁄°
(
vÆue
 /Åhis->∑ª¡.
ønk_øã
);

322 
usöt
 
	ghigh
 = 
this
->
∑ª¡
.
numbî_of_blocks
 - 1;

324 
	gthis
->
	gßm∂es
.
goToIãm
(2 * 
low
 + 3);

325 ; 
	glow
 < 
	ghigh
;Üow++)

327 if(
	gthis
->
	gßm∂es
.
ªadIãm
(Ë> 
	gvÆue
Ë{  
	glow
; }

328 
	gthis
->
	gßm∂es
.
skùIãm
();

331  
	glow
;

336 
	gVe˘‹Encodî
::
Ve˘‹Encodî
(
usöt
 
block_byãs
, usöà
su≥rblock_size
, 
boﬁ
 
_u£_smÆl_blocks
) :

337 
size
(0), 
ôems
(0), 
blocks
(0),

338 
block_size
(
BYTES_TO_WORDS
(
block_byãs
)),

339 
su≥rblock_byãs
(
su≥rblock_size
),

340 
u£_smÆl_blocks
(
_u£_smÆl_blocks
),

341 
blocks_ö_su≥rblock
(1), 
cuºít_blocks
(0),

342 
ßm∂es
(0), 
ßm∂es_ö_su≥rblock
(0), 
cuºít_ßm∂es
(0)

344 
	gthis
->
	g¨øy
 = 
√w
 
usöt
[
this
->
su≥rblock_byãs
 / (usint)];

345 
mem£t
(
this
->
¨øy
, 0,Åhis->
su≥rblock_byãs
);

346 if(
	gu£_smÆl_blocks
)

348 
	gthis
->
	gblocks_ö_su≥rblock
 = 
this
->
su≥rblock_byãs
 / ((
usöt
Ë*Åhis->
block_size
);

349 
	gthis
->
	gbuf„r
 = 
√w
 
WrôeBuf„r
(
this
->
¨øy
,Åhis->
block_size
);

350 
	gthis
->
	gßm∂es
 = 
√w
 
usöt
[
this
->
su≥rblock_byãs
 / (usint)];

351 
	gthis
->
	gßm∂es_ö_su≥rblock
 = 
this
->
su≥rblock_byãs
 / (2 * (
usöt
));

355 
	gthis
->
	gbuf„r
 = 
√w
 
WrôeBuf„r
(
this
->
¨øy
, 
BYTES_TO_WORDS
—his->
su≥rblock_byãs
));

356 
	gthis
->
	gblocks
 = 
this
->
cuºít_blocks
 = 1;

360 
	gVe˘‹Encodî
::~
Ve˘‹Encodî
()

362 
dñëe
[] 
this
->
¨øy
;

364 
dñëe
 
	gthis
->
	gbuf„r
;

365 
	g°d
::
li°
<
usöt
*>::
ôî©‹
 
ôî
 = 
this
->
¨øy_blocks
.
begö
(); 
	gôî
 !this->¨øy_blocks.
íd
(); iter++)

367 
	gdñëe
[] *
	gôî
;

370 
	gdñëe
[] 
	gthis
->
	gßm∂es
;

371 
	g°d
::
li°
<
usöt
*>::
ôî©‹
 
ôî
 = 
this
->
ßm∂e_blocks
.
begö
(); 
	gôî
 !this->ßm∂e_blocks.
íd
(); iter++)

373 
	gdñëe
[] *
	gôî
;

378 
	gVe˘‹Encodî
::
addNewBlock
()

381 
this
->
blocks
++; 
	gthis
->
	gcuºít_blocks
++;

382 if(
	gthis
->
	gcuºít_blocks
 >Åhis->
	gblocks_ö_su≥rblock
)

384 
	gthis
->
	g¨øy_blocks
.
push_back
(
this
->
¨øy
);

385 
	gthis
->
	g¨øy
 = 
√w
 
usöt
[
this
->
su≥rblock_byãs
 / (usint)];

386 
mem£t
(
this
->
¨øy
, 0,Åhis->
su≥rblock_byãs
);

387 
	gthis
->
	gcuºít_blocks
 = 1;

389 
	gthis
->
	gbuf„r
->
moveBuf„r
(
this
->
¨øy
 + (this->
block_size
 * (this->
cuºít_blocks
 - 1)));

392 if(
	gthis
->
	gu£_smÆl_blocks
)

394 
	gthis
->
	gcuºít_ßm∂es
++;

395 if(
	gthis
->
	gcuºít_ßm∂es
 >Åhis->
	gßm∂es_ö_su≥rblock
)

397 
	gthis
->
	gßm∂e_blocks
.
push_back
(
this
->
ßm∂es
);

398 
	gthis
->
	gßm∂es
 = 
√w
 
usöt
[
this
->
su≥rblock_byãs
 / (usint)];

399 
	gthis
->
	gcuºít_ßm∂es
 = 1;

401 
	gthis
->
	gßm∂es
[2 * 
this
->
cuºít_ßm∂es
 - 2] =Åhis->
ôems
 - 1;

402 
	gthis
->
	gßm∂es
[2 * 
this
->
cuºít_ßm∂es
 - 1] =Åhis->
size
 - 1;

407 
	gVe˘‹Encodî
::
£tFú°Bô
(
usöt
 
vÆue
)

409 
this
->
ßm∂es
[0] = 0;

410 
	gthis
->
	gßm∂es
[1] = 
vÆue
;

412 
	gthis
->
	gsize
 = 
vÆue
 + 1;

413 
	gthis
->
	gôems
 = 1;

414 
	gthis
->
	gblocks
 = 1;

416 
	gthis
->
	gcuºít_blocks
 = 1;

417 
	gthis
->
	gcuºít_ßm∂es
 = 1;

	@bits/bitvector.h

1 #i‚de‡
BITVECTOR_H


2 
	#BITVECTOR_H


	)

4 
	~<c°dio
>

5 
	~<f°ªam
>

6 
	~<li°
>

8 
	~"bôbuf„r.h
"

11 
«me•a˚
 
	gCSA


19 ˛as†
	cVe˘‹Encodî


21 
	gpublic
:

22 c⁄° 
usöt
 
SUPERBLOCK_SIZE
 = 
MEGABYTE
;

25 
Ve˘‹Encodî
(
usöt
 
block_byãs
, usöà
su≥rblock_size
 = 
SUPERBLOCK_SIZE
, 
boﬁ
 
_u£_smÆl_blocks
 = 
åue
);

26 ~
Ve˘‹Encodî
();

43 
addNewBlock
();

44 
£tFú°Bô
(
usöt
 
vÆue
);

46 
usöt
 
	gsize
, 
	gôems
, 
	gblocks
;

47 
usöt
 
	gblock_size
, 
	gsu≥rblock_byãs
;

48 
boﬁ
 
	gu£_smÆl_blocks
;

50 
WrôeBuf„r
* 
	gbuf„r
;

52 
	g°d
::
li°
<
usöt
*> 
¨øy_blocks
;

53 
usöt
* 
	g¨øy
;

54 
usöt
 
	gblocks_ö_su≥rblock
, 
	gcuºít_blocks
;

56 
	g°d
::
li°
<
usöt
*> 
ßm∂e_blocks
;

57 
usöt
* 
	gßm∂es
;

58 
usöt
 
	gßm∂es_ö_su≥rblock
, 
	gcuºít_ßm∂es
;

60 
	g¥Ÿe˘ed
:

63 
Ve˘‹Encodî
();

64 
Ve˘‹Encodî
(const VectorEncoder&);

65 
	gVe˘‹Encodî
& 
	g›î©‹
 = (c⁄° 
Ve˘‹Encodî
&);

74 ˛as†
	cBôVe˘‹


76 
	gpublic
:

77 c⁄° 
usöt
 
INDEX_RATE
 = 5;

79 
ex∂icô
 
BôVe˘‹
(
°d
::
if°ªam
& 
fûe
);

80 
ex∂icô
 
BôVe˘‹
(
FILE
* 
fûe
);

81 
BôVe˘‹
(
Ve˘‹Encodî
& 
ícodî
, 
usöt
 
univî£_size
);

82 
ex∂icô
 
BôVe˘‹
(
WrôeBuf„r
& 
ve˘‹
);

83 ~
BôVe˘‹
();

87 
wrôeTo
(
°d
::
of°ªam
& 
fûe
) const;

88 
wrôeTo
(
FILE
* 
fûe
) const;

90 
ölöe
 
usöt
 
gëSize
(Ëc⁄° {  
	gthis
->
	gsize
; }

91 
ölöe
 
usöt
 
gëNumbîOfIãms
(Ëc⁄° {  
	gthis
->
	gôems
; }

92 
ölöe
 
usöt
 
gëBlockSize
(Ëc⁄° {  
	gthis
->
	gblock_size
; }

95 
usöt
 
ªp‹tSize
() const;

97 
usöt
 
gëCom¥es£dSize
() const;

100 
°rù
();

104 ˛as†
	cIãøt‹


106 
	gpublic
:

107 
ex∂icô
 
Iãøt‹
(c⁄° 
BôVe˘‹
& 
∑r
);

108 ~
Iãøt‹
();

110 
ölöe
 
boﬁ
 
hasNext
() const

112  (
	gthis
->
	gßm∂e
.
	gfú°
 +Åhis->
	gcur
 <Åhis->
	g∑ª¡
.
	gôems
 - 1);

115 
	g¥Ÿe˘ed
:

116 c⁄° 
BôVe˘‹
& 
∑ª¡
;

118 
usöt
 
	gblock
;

119 
∑ú_ty≥
 
	gßm∂e
;

120 
usöt
 
	gcur
, 
	gvÆ
, 
	grun
;

121 
usöt
 
	gblock_ôems
;

123 
RódBuf„r
 
	gbuf„r
, 
	gßm∂es
;

129 
usöt
 
ßm∂eF‹Index
(usöà
ödex
);

130 
usöt
 
ßm∂eF‹VÆue
(usöà
vÆue
);

132 
ölöe
 
usöt
 
gëSam∂edIndex
(usöà
ßm∂e_numbî
)

134  
	gthis
->
	gßm∂es
.
ªadIãm
(2 * 
ßm∂e_numbî
);

137 
ölöe
 
usöt
 
gëSam∂edVÆue
(usöà
ßm∂e_numbî
)

139  
	gthis
->
	gßm∂es
.
ªadIãm
(2 * 
ßm∂e_numbî
 + 1);

142 
ölöe
 
gëSam∂e
(
usöt
 
ßm∂e_numbî
)

144 
	gthis
->
	gblock
 = 
ßm∂e_numbî
;

145 
	gthis
->
	gßm∂es
.
goToIãm
(2 * 
ßm∂e_numbî
);

146 
	gthis
->
	gßm∂e
.
	gfú°
 = 
this
->
ßm∂es
.
ªadIãm
();

147 
	gthis
->
	gßm∂e
.
	g£c⁄d
 = 
this
->
ßm∂es
.
ªadIãm
();

148 
	gthis
->
	gcur
 = 0;

149 
	gthis
->
	gvÆ
 = 
this
->
ßm∂e
.
£c⁄d
;

150 
	gthis
->
	gblock_ôems
 = 
this
->
ßm∂es
.
ªadIãm
(Ë-Åhis->
ßm∂e
.
fú°
 - 1;

151 
	gthis
->
	gbuf„r
.
moveBuf„r
(
this
->
∑ª¡
.
¨øy
 + (this->
block
 *Åhis->∑ª¡.
block_size
));

155 
Iãøt‹
();

156 
Iãøt‹
(const Iterator&);

157 
	gIãøt‹
& 
	g›î©‹
 = (c⁄° 
Iãøt‹
&);

197 
	g¥Ÿe˘ed
:

198 
usöt
 
size
, 
	gôems
;

200 c⁄° 
usöt
* 
	g¨øy
;

201 
usöt
 
	gblock_size
;

202 
usöt
 
	gnumbî_of_blocks
;

208 
RódBuf„r
* 
	gßm∂es
;

209 
usöt
 
	göãgî_bôs
;

211 
RódBuf„r
* 
	gønk_ödex
;

212 
usöt
 
	gønk_øã
;

214 
RódBuf„r
* 
	g£À˘_ödex
;

215 
usöt
 
	g£À˘_øã
;

222 
ödexF‹R™k
();

223 
ödexF‹Sñe˘
();

226 
wrôeHódî
(
°d
::
of°ªam
& 
fûe
) const;

227 
wrôeHódî
(
FILE
* 
fûe
) const;

228 
wrôeAºay
(
°d
::
of°ªam
& 
fûe
) const;

229 
wrôeAºay
(
FILE
* 
fûe
) const;

230 
ªadHódî
(
°d
::
if°ªam
& 
fûe
);

231 
ªadHódî
(
FILE
* 
fûe
);

232 
ªadAºay
(
°d
::
if°ªam
& 
fûe
);

233 
ªadAºay
(
FILE
* 
fûe
);

235 
c›yAºay
(
Ve˘‹Encodî
& 
ícodî
, 
boﬁ
 
u£_dúe˘ly
 = 
Ál£
);

238 
BôVe˘‹
();

239 
BôVe˘‹
(const BitVector&);

240 
	gBôVe˘‹
& 
	g›î©‹
 = (c⁄° 
BôVe˘‹
&);

	@bits/deltavector.cpp

1 
	~<c°dlib
>

3 
	~"dñève˘‹.h
"

6 
«me•a˚
 
	gCSA


10 
	gDñèVe˘‹
::
DñèVe˘‹
(
°d
::
if°ªam
& 
fûe
) :

11 
BôVe˘‹
(
fûe
)

15 
DñèVe˘‹
::DñèVe˘‹(
FILE
* 
fûe
) :

16 
BôVe˘‹
(
fûe
)

20 
DñèVe˘‹
::DñèVe˘‹(
Encodî
& 
ícodî
, 
usöt
 
univî£_size
) :

21 
BôVe˘‹
(
ícodî
, 
univî£_size
)

25 
	gDñèVe˘‹
::~
DñèVe˘‹
()

31 
usöt


32 
DñèVe˘‹
::
ªp‹tSize
() const

34 
usöt
 
byãs
 = (*
this
);

35 
	gbyãs
 +
BôVe˘‹
::
ªp‹tSize
();

36  
	gbyãs
;

41 
	gDñèVe˘‹
::
Iãøt‹
::Iãøt‹(c⁄° 
DñèVe˘‹
& 
∑r
) :

42 
BôVe˘‹
::
Iãøt‹
(
∑r
)

46 
DñèVe˘‹
::
Iãøt‹
::~Iterator()

50 
usöt


51 
DñèVe˘‹
::
Iãøt‹
::
ønk
(
usöt
 
vÆue
, 
boﬁ
 
©_Àa°
)

53 c⁄° 
	gDñèVe˘‹
& 
	g∑r
 = (c⁄° 
DñèVe˘‹
&)(
this
->
∑ª¡
);

55 if(
	gvÆue
 >
∑r
.
size
Ë{ Ö¨.
ôems
; }

56 
	gthis
->
gëSam∂e
(
this
->
ßm∂eF‹VÆue
(
vÆue
));

58 
	gthis
->
	gcur
 <Åhis->
	gblock_ôems
 &&Åhis->
	gvÆ
 < 
	gvÆue
)

60 
	gthis
->
	gvÆ
 +
this
->
buf„r
.
ªadDñèCode
();

61 
	gthis
->
	gcur
++;

64 
usöt
 
	gidx
 = 
this
->
ßm∂e
.
fú°
 +Åhis->
cur
 + 1;

65 if(!
	g©_Àa°
 && 
	gthis
->
	gvÆ
 > 
	gvÆue
Ë{ 
	gidx
--; }

66 if(
	g©_Àa°
 && 
	gthis
->
	gvÆ
 < 
	gvÆue
)

68 
	gthis
->
gëSam∂e
(
this
->
block
 + 1);

69 
	gidx
 = 
this
->
ßm∂e
.
fú°
 +Åhis->
cur
 + 1;

71  
	gidx
;

74 
usöt


75 
	gDñèVe˘‹
::
Iãøt‹
::
£À˘
(
usöt
 
ödex
)

77 c⁄° 
DñèVe˘‹
& 
∑r
 = (c⁄° DñèVe˘‹&)(
this
->
∑ª¡
);

79 if(
	gödex
 >
∑r
.
ôems
Ë{ Ö¨.
size
; }

80 
	gthis
->
gëSam∂e
(
this
->
ßm∂eF‹Index
(
ödex
));

82 
usöt
 
	glim
 = 
ödex
 - 
this
->
ßm∂e
.
fú°
;

83 ; 
	gthis
->
	gcur
 < 
	glim
;Åhis->cur++)

85 
	gthis
->
	gvÆ
 +
this
->
buf„r
.
ªadDñèCode
();

88  
	gthis
->
	gvÆ
;

91 
usöt


92 
	gDñèVe˘‹
::
Iãøt‹
::
£À˘Next
()

94 if(
this
->
cur
 >this->
block_ôems
)

96 
this
->
gëSam∂e
—his->
block
 + 1);

97  
	gthis
->
	gvÆ
;

100 
	gthis
->
	gcur
++;

101 
	gthis
->
	gvÆ
 +
this
->
buf„r
.
ªadDñèCode
();

102  
	gthis
->
	gvÆ
;

105 
∑ú_ty≥


106 
	gDñèVe˘‹
::
Iãøt‹
::
vÆueBef‹e
(
usöt
 
vÆue
)

108 c⁄° 
DñèVe˘‹
& 
∑r
 = (c⁄° DñèVe˘‹&)(
this
->
∑ª¡
);

110 if(
	gvÆue
 >
∑r
.
size
Ë{  
∑ú_ty≥
’¨.size,Ö¨.
ôems
); }

112 
	gthis
->
gëSam∂e
(
this
->
ßm∂eF‹VÆue
(
vÆue
));

113 if(
	gthis
->
	gvÆ
 > 
	gvÆue
Ë{  
∑ú_ty≥
(
∑r
.
size
,Ö¨.
ôems
); }

115 
	gthis
->
	gcur
 <Åhis->
	gblock_ôems
 &&Åhis->
	gvÆ
 < 
	gvÆue
)

117 
usöt
 
	gãmp
 = 
this
->
buf„r
.
ªadDñèCode
(
vÆue
 -Åhis->
vÆ
);

118 if(
	gãmp
 == 0) { ; }

119 
	gthis
->
	gvÆ
 +
ãmp
;

120 
	gthis
->
	gcur
++;

123  
∑ú_ty≥
(
this
->
vÆ
,Åhis->
ßm∂e
.
fú°
 +Åhis->
cur
);

126 
∑ú_ty≥


127 
	gDñèVe˘‹
::
Iãøt‹
::
vÆueA·î
(
usöt
 
vÆue
)

129 c⁄° 
DñèVe˘‹
& 
∑r
 = (c⁄° DñèVe˘‹&)(
this
->
∑ª¡
);

131 if(
	gvÆue
 >
∑r
.
size
Ë{  
∑ú_ty≥
’¨.size,Ö¨.
ôems
); }

132 
	gthis
->
gëSam∂e
(
this
->
ßm∂eF‹VÆue
(
vÆue
));

134 
	gthis
->
	gcur
 <Åhis->
	gblock_ôems
 &&Åhis->
	gvÆ
 < 
	gvÆue
)

136 
	gthis
->
	gvÆ
 +
this
->
buf„r
.
ªadDñèCode
();

137 
	gthis
->
	gcur
++;

139 if(
	gthis
->
	gvÆ
 < 
	gvÆue
)

141 
	gthis
->
gëSam∂e
(
this
->
block
 + 1);

144  
∑ú_ty≥
(
this
->
vÆ
,Åhis->
ßm∂e
.
fú°
 +Åhis->
cur
);

147 
∑ú_ty≥


148 
	gDñèVe˘‹
::
Iãøt‹
::
√xtVÆue
()

150 if(
this
->
cur
 >this->
block_ôems
)

152 
this
->
gëSam∂e
—his->
block
 + 1);

153  
∑ú_ty≥
(
this
->
vÆ
,Åhis->
ßm∂e
.
fú°
);

156 
	gthis
->
	gcur
++;

157 
	gthis
->
	gvÆ
 +
this
->
buf„r
.
ªadDñèCode
();

158  
∑ú_ty≥
(
this
->
vÆ
,Åhis->
ßm∂e
.
fú°
 +Åhis->
cur
);

161 
∑ú_ty≥


162 
	gDñèVe˘‹
::
Iãøt‹
::
£À˘Run
(
usöt
 
ödex
, usöà
max_Àngth
)

164  
∑ú_ty≥
(
this
->
£À˘
(
ödex
), 0);

167 
∑ú_ty≥


168 
	gDñèVe˘‹
::
Iãøt‹
::
£À˘NextRun
(
usöt
 
max_Àngth
)

170  
∑ú_ty≥
(
this
->
£À˘Next
(), 0);

173 
boﬁ


174 
	gDñèVe˘‹
::
Iãøt‹
::
isSë
(
usöt
 
vÆue
)

176 c⁄° 
DñèVe˘‹
& 
∑r
 = (c⁄° DñèVe˘‹&)(
this
->
∑ª¡
);

178 if(
	gvÆue
 >
∑r
.
size
Ë{  
Ál£
; }

179 
	gthis
->
gëSam∂e
(
this
->
ßm∂eF‹VÆue
(
vÆue
));

181 
	gthis
->
	gcur
 <Åhis->
	gblock_ôems
 &&Åhis->
	gvÆ
 < 
	gvÆue
)

183 
	gthis
->
	gvÆ
 +
this
->
buf„r
.
ªadDñèCode
();

184 
	gthis
->
	gcur
++;

187  (
	gthis
->
	gvÆ
 =
vÆue
);

192 
	gDñèEncodî
::
DñèEncodî
(
usöt
 
block_byãs
, usöà
su≥rblock_size
) :

193 
Ve˘‹Encodî
(
block_byãs
, 
su≥rblock_size
)

197 
	gDñèEncodî
::~
DñèEncodî
()

202 
DñèEncodî
::
£tBô
(
usöt
 
vÆue
)

204 if(
this
->
ôems
 == 0)

206 
this
->
£tFú°Bô
(
vÆue
);

209 if(
	gvÆue
 < 
	gthis
->
	gsize
) { ; }

211 
usöt
 
	gdiff
 = 
vÆue
 + 1 - 
this
->
size
;

212 
	gthis
->
	gsize
 = 
vÆue
 + 1;

213 
	gthis
->
	gôems
++;

214 if(
	gthis
->
	gbuf„r
->
wrôeDñèCode
(
diff
)) { ; }

217 
	gthis
->
addNewBlock
();

221 
	gDñèEncodî
::
£tRun
(
usöt
 
°¨t
, usöà
Àn
)

223 
usöt
 
	gi
 = 
°¨t
; i < 
	g°¨t
 + 
	gÀn
; i++Ë{ 
	gthis
->
£tBô
(
i
); }

227 
	gDñèEncodî
::
addBô
(
usöt
 
vÆue
)

229 
this
->
£tBô
(
vÆue
);

233 
	gDñèEncodî
::
addRun
(
usöt
 
°¨t
, usöà
Àn
)

235 
	gthis
->
£tRun
(
°¨t
, 
Àn
);

239 
	gDñèEncodî
::
Êush
()

	@bits/deltavector.h

1 #i‚de‡
DELTAVECTOR_H


2 
	#DELTAVECTOR_H


	)

4 
	~"bôve˘‹.h
"

7 
«me•a˚
 
	gCSA


15 ˛as†
	cDñèEncodî
 : 
public
 
Ve˘‹Encodî


17 
public
:

18 
DñèEncodî
(
usöt
 
block_byãs
, usöà
su≥rblock_size
 = 
Ve˘‹Encodî
::
SUPERBLOCK_SIZE
);

19 ~
DñèEncodî
();

21 
£tBô
(
usöt
 
vÆue
);

22 
£tRun
(
usöt
 
°¨t
, usöà
Àn
);

24 
addBô
(
usöt
 
vÆue
);

25 
addRun
(
usöt
 
°¨t
, usöà
Àn
);

26 
Êush
();

28 
	g¥Ÿe˘ed
:

31 
DñèEncodî
();

32 
DñèEncodî
(const DeltaEncoder&);

33 
	gDñèEncodî
& 
	g›î©‹
 = (c⁄° 
DñèEncodî
&);

41 ˛as†
	cDñèVe˘‹
 : 
public
 
BôVe˘‹


43 
public
:

44 
DñèEncodî
 
	tEncodî
;

46 
ex∂icô
 
DñèVe˘‹
(
°d
::
if°ªam
& 
fûe
);

47 
ex∂icô
 
DñèVe˘‹
(
FILE
* 
fûe
);

48 
DñèVe˘‹
(
Encodî
& 
ícodî
, 
usöt
 
univî£_size
);

49 ~
DñèVe˘‹
();

53 
usöt
 
ªp‹tSize
() const;

57 ˛as†
	cIãøt‹
 : 
public
 
BôVe˘‹
::
Iãøt‹


59 
public
:

60 
ex∂icô
 
Iãøt‹
(c⁄° 
DñèVe˘‹
& 
∑r
);

61 ~
Iãøt‹
();

63 
usöt
 
ønk
(usöà
vÆue
, 
boﬁ
 
©_Àa°
 = 
Ál£
);

65 
usöt
 
£À˘
(usöà
ödex
);

66 
usöt
 
£À˘Next
();

68 
∑ú_ty≥
 
vÆueBef‹e
(
usöt
 
vÆue
);

69 
∑ú_ty≥
 
vÆueA·î
(
usöt
 
vÆue
);

70 
∑ú_ty≥
 
√xtVÆue
();

72 
∑ú_ty≥
 
£À˘Run
(
usöt
 
ödex
, usöà
max_Àngth
);

73 
∑ú_ty≥
 
£À˘NextRun
(
usöt
 
max_Àngth
);

75 
boﬁ
 
isSë
(
usöt
 
vÆue
);

77 
usöt
 
cou¡Runs
();

79 
	g¥Ÿe˘ed
:

82 
Iãøt‹
();

83 
Iãøt‹
(const Iterator&);

84 
	gIãøt‹
& 
	g›î©‹
 = (c⁄° 
Iãøt‹
&);

89 
	g¥Ÿe˘ed
:

92 
DñèVe˘‹
();

93 
DñèVe˘‹
(const DeltaVector&);

94 
	gDñèVe˘‹
& 
	g›î©‹
 = (c⁄° 
DñèVe˘‹
&);

	@bits/multiarray.cpp

1 
	~<c°dlib
>

3 
	~"mu…üºay.h
"

6 
«me•a˚
 
	gCSA


11 
Mu…iAºay
*

12 
	gMu…iAºay
::
¸óãFixed
(
usöt
 
ôems
, usöà
bôs
)

14  
√w
 
FixedMu…iAºay
(
ôems
, 
bôs
);

17 
Mu…iAºay
*

18 
	gMu…iAºay
::
¸óãDñè
(
usöt
 
block_size
)

20  
√w
 
DñèMu…iAºay
(
block_size
);

23 
Mu…iAºay
*

24 
	gMu…iAºay
::
ªadFrom
(
°d
::
if°ªam
& 
fûe
)

26 
usöt
 
Êags
 = 0;

27 
	gfûe
.
ªad
((*)&
Êags
, (flags));

28 if(
	gÊags
 & 
	gDELTA_FLAG
Ë{  
√w
 
DñèMu…iAºay
(
fûe
, 
Êags
); }

29 {  
√w
 
FixedMu…iAºay
(
fûe
, 
Êags
); }

32 
Mu…iAºay
*

33 
	gMu…iAºay
::
ªadFrom
(
FILE
* 
fûe
)

35 if(
fûe
 == 0) {  0; }

36 
usöt
 
	gÊags
 = 0;

37 if(!
	g°d
::
‰ód
(&
Êags
, (Êags), 1, 
fûe
)) {  0; }

38 if(
	gÊags
 & 
	gDELTA_FLAG
Ë{  
√w
 
DñèMu…iAºay
(
fûe
, 
Êags
); }

39 {  
√w
 
FixedMu…iAºay
(
fûe
, 
Êags
); }

42 
	gMu…iAºay
::~
Mu…iAºay
()

44 
dñëe
 
this
->
¨øy_ícodî
; 
	gthis
->
	g¨øy_ícodî
 = 0;

45 
dñëe
 
	gthis
->
	g¨øy_b‹dîs
;Åhis->array_borders = 0;

48 
	gMu…iAºay
::
Mu…iAºay
(
°d
::
if°ªam
& 
fûe
, 
usöt
 
Êags
) :

49 
°©us
(
îr‹
), 
ícodög
(
fixed_width
),

50 
ôems
(0), 
¨øys
(0), 
cuºít_¨øy_begö
(0),

51 
¨øy_ícodî
(0), 
¨øy_b‹dîs
(0)

53 if(
	gÊags
 & 
	gDELTA_FLAG
Ë{ 
	gthis
->
	gícodög
 = 
dñè_coded
; }

55 
	gthis
->
	g¨øy_b‹dîs
 = 
√w
 
Succö˘Ve˘‹
(
fûe
);

56 
	gthis
->
	gôems
 = 
this
->
¨øy_b‹dîs
->
gëSize
();

57 
	gthis
->
	g¨øys
 = 
this
->
¨øy_b‹dîs
->
gëNumbîOfIãms
();

60 
	gMu…iAºay
::
Mu…iAºay
(
FILE
* 
fûe
, 
usöt
 
Êags
) :

61 
°©us
(
îr‹
), 
ícodög
(
fixed_width
),

62 
ôems
(0), 
¨øys
(0), 
cuºít_¨øy_begö
(0),

63 
¨øy_ícodî
(0), 
¨øy_b‹dîs
(0)

65 if(
	gÊags
 & 
	gDELTA_FLAG
Ë{ 
	gthis
->
	gícodög
 = 
dñè_coded
; }

67 
	gthis
->
	g¨øy_b‹dîs
 = 
√w
 
Succö˘Ve˘‹
(
fûe
);

68 
	gthis
->
	gôems
 = 
this
->
¨øy_b‹dîs
->
gëSize
();

69 
	gthis
->
	g¨øys
 = 
this
->
¨øy_b‹dîs
->
gëNumbîOfIãms
();

72 
	gMu…iAºay
::
Mu…iAºay
(
usöt
 
_ôems
, usöà
_ôem_bôs
) :

73 
°©us
(
îr‹
), 
ícodög
(
fixed_width
), 
ôems
(0), 
¨øys
(1), 
cuºít_¨øy_begö
(0),

74 
¨øy_ícodî
(
√w
 
Succö˘Ve˘‹
::
Encodî
(
VECTOR_BLOCK_SIZE
)), 
¨øy_b‹dîs
(0)

76 
	gthis
->
	g¨øy_ícodî
->
£tBô
(0);

79 
	gMu…iAºay
::
Mu…iAºay
(
usöt
 
block_size
) :

80 
°©us
(
îr‹
), 
ícodög
(
dñè_coded
), 
ôems
(0), 
¨øys
(1), 
cuºít_¨øy_begö
(0),

81 
¨øy_ícodî
(
√w
 
Succö˘Ve˘‹
::
Encodî
(
VECTOR_BLOCK_SIZE
)), 
¨øy_b‹dîs
(0)

83 
	gthis
->
	g¨øy_ícodî
->
£tBô
(0);

86 
boﬁ


87 
	gMu…iAºay
::
wrôeTo
(
°d
::
of°ªam
& 
fûe
) const

89 if(!(
this
->
isOk
()))

91 
°d
::
˚º
 << "MultiArray::writeTo(): Cannot write MultiArray with status ";

92 if(
	gthis
->
	g°©us
 =
îr‹
Ë{ 
°d
::
˚º
 << "error"; }

93 if(
	gthis
->
	g°©us
 =
wrôabÀ
Ë{ 
°d
::
˚º
 << "writable"; }

94 
	g°d
::
˚º
 << "!" << 
°d
::
ídl
;

95  
	gÁl£
;

98 
usöt
 
	gÊags
 = 
this
->
gëFœgs
();

99 
	gfûe
.
wrôe
((*)&
Êags
, (flags));

100 
	gthis
->
	g¨øy_b‹dîs
->
wrôeTo
(
fûe
);

102  
	gåue
;

105 
boﬁ


106 
	gMu…iAºay
::
wrôeTo
(
FILE
* 
fûe
) const

108 if(!(
this
->
isOk
()))

110 
°d
::
˚º
 << "MultiArray::writeTo(): Cannot write MultiArray with status ";

111 if(
	gthis
->
	g°©us
 =
îr‹
Ë{ 
°d
::
˚º
 << "error"; }

112 if(
	gthis
->
	g°©us
 =
wrôabÀ
Ë{ 
°d
::
˚º
 << "writable"; }

113 
	g°d
::
˚º
 << "!" << 
°d
::
ídl
;

114  
	gÁl£
;

116 if(
	gfûe
 =0Ë{  
Ál£
; }

118 
usöt
 
	gÊags
 = 
this
->
gëFœgs
();

119 
	g°d
::
fwrôe
(&
Êags
, (Êags), 1, 
fûe
);

120 
	gthis
->
	g¨øy_b‹dîs
->
wrôeTo
(
fûe
);

122  
	gåue
;

125 
usöt


126 
	gMu…iAºay
::
ªp‹tSize
() const

128 
usöt
 
byãs
 = 0;

129 if(
	gthis
->
	g¨øy_b‹dîs
 !0Ë{ 
byãs
 +
this
->
¨øy_b‹dîs
->
ªp‹tSize
(); }

130  
	gbyãs
;

135 
boﬁ


136 
	gMu…iAºay
::
√xtAºay
()

138 if(
this
->
isFuŒ
(Ë||Åhis->
ôems
 <this->
cuºít_¨øy_begö
Ë{  
Ál£
; }

140 
	gthis
->
	g¨øy_ícodî
->
£tBô
(
this
->
ôems
);

141 
	gthis
->
	g¨øys
++;Åhis->
	gcuºít_¨øy_begö
 = 
this
->
ôems
;

142  
	gåue
;

145 
boﬁ


146 
	gMu…iAºay
::
föishWrôög
()

148 if(!(
this
->
isWrôabÀ
())Ë{  
Ál£
; }

149 if(
	gthis
->
	gôems
 <
this
->
cuºít_¨øy_begö
)

151 
°d
::
˚º
 << "Mu…iAºay::föishWrôög(): Buf„∏íd†wôhá¿em±yáºay!" << std::
ídl
;

152  
	gÁl£
;

155 
	gthis
->
	g¨øy_b‹dîs
 = 
√w
 
Succö˘Ve˘‹
(*(
this
->
¨øy_ícodî
),Åhis->
ôems
);

156 
dñëe
 
	gthis
->
	g¨øy_ícodî
;Åhis->array_encoder = 0;

158 
	gthis
->
ícodeIãms
();

159 
	gthis
->
	g°©us
 = 
ok
;

160  
	gåue
;

165 
	gFixedMu…iAºay
::
FixedMu…iAºay
(
°d
::
if°ªam
& 
fûe
, 
usöt
 
Êags
) :

166 
Mu…iAºay
(
fûe
, 
Êags
),

167 
fixed_buf„r
(0), 
fixed_ôems
(0)

169 
usöt
 
	gôem_bôs
 = (
Êags
 & 
ITEM_BITS_MASK
Ë>> 
ITEM_BITS_SHIFT
;

170 
	gthis
->
	gfixed_ôems
 = 
√w
 
RódBuf„r
(
fûe
, 
this
->
ôems
, 
ôem_bôs
);

171 
	gthis
->
	g°©us
 = 
ok
;

174 
	gFixedMu…iAºay
::
FixedMu…iAºay
(
FILE
* 
fûe
, 
usöt
 
Êags
) :

175 
Mu…iAºay
(
fûe
, 
Êags
),

176 
fixed_buf„r
(0), 
fixed_ôems
(0)

178 
usöt
 
	gôem_bôs
 = (
Êags
 & 
ITEM_BITS_MASK
Ë>> 
ITEM_BITS_SHIFT
;

179 
	gthis
->
	gfixed_ôems
 = 
√w
 
RódBuf„r
(
fûe
, 
this
->
ôems
, 
ôem_bôs
);

180 
	gthis
->
	g°©us
 = 
ok
;

183 
	gFixedMu…iAºay
::
FixedMu…iAºay
(
usöt
 
_ôems
, usöà
bôs
) :

184 
Mu…iAºay
(
ôems
, 
bôs
),

185 
fixed_buf„r
(
√w
 
WrôeBuf„r
(
_ôems
, 
bôs
)), 
fixed_ôems
(0)

187 
	gthis
->
	g°©us
 = 
wrôabÀ
;

190 
	gFixedMu…iAºay
::~
FixedMu…iAºay
()

192 
dñëe
 
this
->
fixed_buf„r
; 
	gthis
->
	gfixed_buf„r
 = 0;

193 
dñëe
 
	gthis
->
	gfixed_ôems
;Åhis->fixed_items = 0;

196 
boﬁ


197 
	gFixedMu…iAºay
::
wrôeTo
(
°d
::
of°ªam
& 
fûe
) const

199 if(!(
Mu…iAºay
::
wrôeTo
(
fûe
))Ë{  
Ál£
; }

200 
	gthis
->
	gfixed_ôems
->
wrôeBuf„r
(
fûe
);

201  
	gåue
;

204 
boﬁ


205 
	gFixedMu…iAºay
::
wrôeTo
(
FILE
* 
fûe
) const

207 if(!(
Mu…iAºay
::
wrôeTo
(
fûe
))Ë{  
Ál£
; }

208 
	gthis
->
	gfixed_ôems
->
wrôeBuf„r
(
fûe
);

209  
	gåue
;

212 
usöt


213 
	gFixedMu…iAºay
::
ªp‹tSize
() const

215 
usöt
 
byãs
 = (*
this
Ë+ 
Mu…iAºay
::
ªp‹tSize
();

216 if(
	gthis
->
	gfixed_ôems
 !0Ë{ 
byãs
 +
this
->
fixed_ôems
->
ªp‹tSize
(); }

217  
	gbyãs
;

220 
boﬁ


221 
	gFixedMu…iAºay
::
isFuŒ
() const

223 if(!(
this
->
isWrôabÀ
())Ë{  
åue
; }

224  !(
	gthis
->
	gfixed_buf„r
->
hasNextIãm
());

228 
	gFixedMu…iAºay
::
wrôeIãm
(
usöt
 
ôem
)

230 
this
->
fixed_buf„r
->
wrôeIãm
(
ôem
);

231 
	gthis
->
	gôems
++;

234 
usöt


235 
	gFixedMu…iAºay
::
gëFœgs
() const

237  
this
->
fixed_ôems
->
gëIãmSize
(Ë<< 
ITEM_BITS_SHIFT
;

241 
	gFixedMu…iAºay
::
ícodeIãms
()

243 
this
->
fixed_ôems
 =Åhis->
fixed_buf„r
->
gëRódBuf„r
();

244 
dñëe
 
	gthis
->
	gfixed_buf„r
;Åhis->fixed_buffer = 0;

249 
	gDñèMu…iAºay
::
DñèMu…iAºay
(
°d
::
if°ªam
& 
fûe
, 
usöt
 
Êags
) :

250 
Mu…iAºay
(
fûe
, 
Êags
),

251 
dñè_buf„r
(0), 
dñè_ôems
(
√w
 
Aºay
(
fûe
))

253 
	gthis
->
	g°©us
 = 
ok
;

256 
	gDñèMu…iAºay
::
DñèMu…iAºay
(
FILE
* 
fûe
, 
usöt
 
Êags
) :

257 
Mu…iAºay
(
fûe
, 
Êags
),

258 
dñè_buf„r
(0), 
dñè_ôems
(
√w
 
Aºay
(
fûe
))

260 
	gthis
->
	g°©us
 = 
ok
;

263 
	gDñèMu…iAºay
::
DñèMu…iAºay
(
usöt
 
block_size
) :

264 
Mu…iAºay
(
block_size
),

265 
dñè_buf„r
(
√w
 
Aºay
::
Encodî
(
block_size
)), 
dñè_ôems
(0)

267 
	gthis
->
	g°©us
 = 
wrôabÀ
;

270 
	gDñèMu…iAºay
::~
DñèMu…iAºay
()

272 
dñëe
 
this
->
dñè_buf„r
; 
	gthis
->
	gdñè_buf„r
 = 0;

273 
dñëe
 
	gthis
->
	gdñè_ôems
;Åhis->delta_items = 0;

276 
boﬁ


277 
	gDñèMu…iAºay
::
wrôeTo
(
°d
::
of°ªam
& 
fûe
) const

279 if(!(
Mu…iAºay
::
wrôeTo
(
fûe
))Ë{  
Ál£
; }

280 
	gthis
->
	gdñè_ôems
->
wrôeTo
(
fûe
);

281  
	gåue
;

284 
boﬁ


285 
	gDñèMu…iAºay
::
wrôeTo
(
FILE
* 
fûe
) const

287 if(!(
Mu…iAºay
::
wrôeTo
(
fûe
))Ë{  
Ál£
; }

288 
	gthis
->
	gdñè_ôems
->
wrôeTo
(
fûe
);

289  
	gåue
;

292 
usöt


293 
	gDñèMu…iAºay
::
ªp‹tSize
() const

295 
usöt
 
byãs
 = (*
this
Ë+ 
Mu…iAºay
::
ªp‹tSize
();

296 if(
	gthis
->
	gdñè_ôems
 !0Ë{ 
byãs
 +
this
->
dñè_ôems
->
ªp‹tSize
(); }

297  
	gbyãs
;

300 
boﬁ


301 
	gDñèMu…iAºay
::
isFuŒ
() const

303  !(
this
->
isWrôabÀ
());

307 
	gDñèMu…iAºay
::
wrôeIãm
(
usöt
 
ôem
)

309 
this
->
dñè_buf„r
->
wrôeIãm
(
ôem
);

310 
	gthis
->
	gôems
++;

313 
usöt


314 
	gDñèMu…iAºay
::
gëFœgs
() const

316  
DELTA_FLAG
;

320 
	gDñèMu…iAºay
::
ícodeIãms
()

322 
this
->
dñè_ôems
 = 
√w
 
Aºay
(*—his->
dñè_buf„r
));

323 
dñëe
 
	gthis
->
	gdñè_buf„r
;Åhis->delta_buffer = 0;

328 
	gMu…iAºay
::
Iãøt‹
::Iãøt‹(c⁄° 
Mu…iAºay
& 
∑r
) :

329 
∑ª¡
(
∑r
),

330 
¨øy_ôî
(*(
∑r
.
¨øy_b‹dîs
)),

331 
pos
(0), 
limô
(0)

335 
	gFixedMu…iAºay
::
Iãøt‹
::Iãøt‹(c⁄° 
FixedMu…iAºay
& 
∑r
) :

336 
Mu…iAºay
::
Iãøt‹
(
∑r
),

337 
fixed_ôî
(*(
∑r
.
fixed_ôems
))

341 
	gDñèMu…iAºay
::
Iãøt‹
::Iãøt‹(c⁄° 
DñèMu…iAºay
& 
∑r
) :

342 
Mu…iAºay
::
Iãøt‹
(
∑r
),

343 
dñè_ôî
(*(
∑r
.
dñè_ôems
)),

344 
buf„r
(
∑r
.
ôems
, 0)

348 
	gMu…iAºay
::
Iãøt‹
::~Iterator()

352 
FixedMu…iAºay
::
Iãøt‹
::~Iterator()

356 
DñèMu…iAºay
::
Iãøt‹
::~Iterator()

361 
FixedMu…iAºay
::
Iãøt‹
::
goToIãm
(
usöt
 
¨øy
, usöà
ödex
)

363 
	gthis
->
	gpos
 = 
°d
::
mö
(
this
->
¨øy_ôî
.
£À˘
(
¨øy
Ë+ 
ödex
,Åhis->
∑ª¡
.
gëSize
());

364 
	gthis
->
	gfixed_ôî
.
goToIãm
(
this
->
pos
);

368 
	gDñèMu…iAºay
::
Iãøt‹
::
goToIãm
(
usöt
 
¨øy
, usöà
ödex
)

370 
	gthis
->
	gpos
 = 
°d
::
mö
(
this
->
¨øy_ôî
.
£À˘
(
¨øy
Ë+ 
ödex
,Åhis->
∑ª¡
.
gëSize
());

371 
	gthis
->
	gbuf„r
 = 
∑ú_ty≥
(
this
->
pos
,Åhis->
dñè_ôî
.
ªadIãm
(this->pos));

374 
usöt


375 
	gFixedMu…iAºay
::
Iãøt‹
::
ªadIãm
(
usöt
 
¨øy
, usöà
ödex
)

377 
	gthis
->
goToIãm
(
¨øy
, 
ödex
);

378 
usöt
 
	gvÆue
 = 
this
->
fixed_ôî
.
ªadIãm
—his->
pos
); 
	gthis
->
	gpos
++;

379  
	gvÆue
;

382 
usöt


383 
	gDñèMu…iAºay
::
Iãøt‹
::
ªadIãm
(
usöt
 
¨øy
, usöà
ödex
)

385 
	gthis
->
goToIãm
(
¨øy
, 
ödex
);Åhis->
	gpos
++;

386  
	gthis
->
	gbuf„r
.
	g£c⁄d
;

389 
usöt


390 
	gFixedMu…iAºay
::
Iãøt‹
::
√xtIãm
()

392 
usöt
 
vÆue
 = 
this
->
fixed_ôî
.
ªadIãm
(); 
	gthis
->
	gpos
++;

393  
	gvÆue
;

396 
usöt


397 
	gDñèMu…iAºay
::
Iãøt‹
::
√xtIãm
()

399 
usöt
 
vÆue
 = (
this
->
buf„r
.
fú°
 =this->
pos
 ?Åhis->buf„r.
£c⁄d
 :Åhis->
dñè_ôî
.
√xtIãm
());

400 
	gthis
->
	gpos
++;

401  
	gvÆue
;

405 
	gMu…iAºay
::
Iãøt‹
::
£tEnd
(
usöt
 
¨øy
, usöà
ödex
)

407 
	gthis
->
	glimô
 = 
°d
::
mö
(
this
->
¨øy_ôî
.
£À˘
(
¨øy
Ë+ 
ödex
,Åhis->
∑ª¡
.
ôems
);

	@bits/multiarray.h

1 #i‚de‡
MULTIARRAY_H


2 
	#MULTIARRAY_H


	)

4 
	~<f°ªam
>

5 
	~<li°
>

7 
	~"¨øy.h
"

8 
	~"bôbuf„r.h
"

9 
	~"succö˘ve˘‹.h
"

12 
«me•a˚
 
	gCSA


21 ˛as†
	cMu…iAºay


23 
	gpublic
:

24 
Mu…iAºay
* 
¸óãFixed
(
usöt
 
ôems
, usöà
bôs
);

25 
Mu…iAºay
* 
¸óãDñè
(
usöt
 
block_size
);

26 
Mu…iAºay
* 
ªadFrom
(
°d
::
if°ªam
& 
fûe
);

27 
Mu…iAºay
* 
ªadFrom
(
FILE
* 
fûe
);

29 
	gvútuÆ
 ~
Mu…iAºay
();

31 
vútuÆ
 
boﬁ
 
wrôeTo
(
°d
::
of°ªam
& 
fûe
) const;

32 
vútuÆ
 
boﬁ
 
wrôeTo
(
FILE
* 
fûe
) const;

33 
vútuÆ
 
usöt
 
ªp‹tSize
() const;

37 
ölöe
 
boﬁ
 
isWrôabÀ
(Ëc⁄° {  (
	gthis
->
	g°©us
 =
wrôabÀ
); }

38 
ölöe
 
boﬁ
 
isOk
(Ëc⁄° {  (
	gthis
->
	g°©us
 =
ok
); }

40 
ölöe
 
usöt
 
gëSize
(Ëc⁄° {  
	gthis
->
	gôems
; }

41 
ölöe
 
usöt
 
gëNumbîOfAºays
(Ëc⁄° {  
	gthis
->
	g¨øys
; }

43 
	eícodög_ty≥
 { 
	gfixed_width
, 
	gdñè_coded
 };

44 
ölöe
 
ícodög_ty≥
 
gëEncodög
(Ëc⁄° {  
	gthis
->
	gícodög
; }

48 
vútuÆ
 
boﬁ
 
isFuŒ
() const = 0;

49 
vútuÆ
 
wrôeIãm
(
usöt
 
ôem
) = 0;

51 
boﬁ
 
√xtAºay
();

52 
boﬁ
 
föishWrôög
();

56 ˛as†
	cIãøt‹


58 
	gpublic
:

59 
vútuÆ
 ~
Iãøt‹
();

61 
vútuÆ
 
goToIãm
(
usöt
 
¨øy
, usöà
ödex
) = 0;

62 
vútuÆ
 
usöt
 
ªadIãm
(usöà
¨øy
, usöà
ödex
) = 0;

63 
vútuÆ
 
usöt
 
√xtIãm
() = 0;

64 
ölöe
 
boﬁ
 
hasNext
(Ëc⁄° {  (
	gthis
->
	gpos
 <Åhis->
	g∑ª¡
.
	gôems
); }

67 
£tEnd
(
usöt
 
¨øy
, usöà
ödex
);

68 
ölöe
 
boﬁ
 
©End
(Ëc⁄° {  (
	gthis
->
	gpos
 >
this
->
limô
); }

70 
	g¥Ÿe˘ed
:

71 c⁄° 
Mu…iAºay
& 
∑ª¡
;

73 
	gSuccö˘Ve˘‹
::
Iãøt‹
 
¨øy_ôî
;

75 
usöt
 
	gpos
, 
	glimô
;

77 
ex∂icô
 
Iãøt‹
(c⁄° 
Mu…iAºay
& 
∑r
);

80 
Iãøt‹
();

81 
Iãøt‹
(const Iterator&);

82 
	gIãøt‹
& 
	g›î©‹
 = (c⁄° 
Iãøt‹
&);

86 
vútuÆ
 
Iãøt‹
* 
gëIãøt‹
() const = 0;

90 
	g¥Ÿe˘ed
:

91 
	e°©us_ty≥
 { 
îr‹
, 
	gwrôabÀ
, 
	gok
 };

93 c⁄° 
usöt
 
	gDELTA_FLAG
 = 0x01;

94 c⁄° 
usöt
 
	gITEM_BITS_MASK
 = 0x00FF0000;

95 c⁄° 
usöt
 
	gITEM_BITS_SHIFT
 = 16;

97 c⁄° 
usöt
 
	gVECTOR_BLOCK_SIZE
 = 32;

99 
°©us_ty≥
 
	g°©us
;

100 
ícodög_ty≥
 
	gícodög
;

101 
usöt
 
	gôems
, 
	g¨øys
, 
	gcuºít_¨øy_begö
;

103 
	gSuccö˘Ve˘‹
::
Encodî
* 
¨øy_ícodî
;

104 
Succö˘Ve˘‹
* 
	g¨øy_b‹dîs
;

106 
Mu…iAºay
(
°d
::
if°ªam
& 
fûe
, 
usöt
 
Êags
);

107 
Mu…iAºay
(
FILE
* 
fûe
, 
usöt
 
Êags
);

108 
Mu…iAºay
(
usöt
 
_ôems
, usöà
_bôs
);

109 
ex∂icô
 
Mu…iAºay
(
usöt
 
block_size
);

111 
vútuÆ
 
usöt
 
gëFœgs
() const = 0;

113 
vútuÆ
 
ícodeIãms
() = 0;

116 
Mu…iAºay
();

117 
Mu…iAºay
(const MultiArray&);

118 
	gMu…iAºay
& 
	g›î©‹
 = (c⁄° 
Mu…iAºay
&);

123 ˛as†
	cFixedMu…iAºay
 : 
public
 
Mu…iAºay


125 
public
:

126 
FixedMu…iAºay
(
°d
::
if°ªam
& 
fûe
, 
usöt
 
Êags
);

127 
FixedMu…iAºay
(
FILE
* 
fûe
, 
usöt
 
Êags
);

128 
FixedMu…iAºay
(
usöt
 
_ôems
, usöà
bôs
);

129 
	gvútuÆ
 ~
FixedMu…iAºay
();

131 
vútuÆ
 
boﬁ
 
wrôeTo
(
°d
::
of°ªam
& 
fûe
) const;

132 
vútuÆ
 
boﬁ
 
wrôeTo
(
FILE
* 
fûe
) const;

133 
vútuÆ
 
usöt
 
ªp‹tSize
() const;

135 
vútuÆ
 
boﬁ
 
isFuŒ
() const;

136 
vútuÆ
 
wrôeIãm
(
usöt
 
ôem
);

138 ˛as†
	cIãøt‹
 : 
public
 
Mu…iAºay
::
Iãøt‹


140 
public
:

141 
ex∂icô
 
Iãøt‹
(c⁄° 
FixedMu…iAºay
& 
∑r
);

142 
	gvútuÆ
 ~
Iãøt‹
();

144 
vútuÆ
 
goToIãm
(
usöt
 
¨øy
, usöà
ödex
);

145 
vútuÆ
 
usöt
 
ªadIãm
(usöà
¨øy
, usöà
ödex
);

146 
vútuÆ
 
usöt
 
√xtIãm
();

148 
	g¥Ÿe˘ed
:

149 
RódBuf„r
 
fixed_ôî
;

152 
Iãøt‹
();

153 
Iãøt‹
(const Iterator&);

154 
	gIãøt‹
& 
	g›î©‹
 = (c⁄° 
Iãøt‹
&);

157 
vútuÆ
 
	gMu…iAºay
::
Iãøt‹
* 
gëIãøt‹
(Ëc⁄° {  
√w
 Iãøt‹(*
this
); }

159 
	g¥Ÿe˘ed
:

160 
vútuÆ
 
usöt
 
gëFœgs
() const;

161 
vútuÆ
 
ícodeIãms
();

163 
	g¥iv©e
:

164 
WrôeBuf„r
* 
fixed_buf„r
;

165 
RódBuf„r
* 
	gfixed_ôems
;

168 
FixedMu…iAºay
();

169 
FixedMu…iAºay
(const FixedMultiArray&);

170 
	gFixedMu…iAºay
& 
	g›î©‹
 = (c⁄° 
FixedMu…iAºay
&);

175 ˛as†
	cDñèMu…iAºay
 : 
public
 
Mu…iAºay


177 
public
:

178 
DñèMu…iAºay
(
°d
::
if°ªam
& 
fûe
, 
usöt
 
Êags
);

179 
DñèMu…iAºay
(
FILE
* 
fûe
, 
usöt
 
Êags
);

180 
ex∂icô
 
DñèMu…iAºay
(
usöt
 
block_size
);

181 
	gvútuÆ
 ~
DñèMu…iAºay
();

183 
vútuÆ
 
boﬁ
 
wrôeTo
(
°d
::
of°ªam
& 
fûe
) const;

184 
vútuÆ
 
boﬁ
 
wrôeTo
(
FILE
* 
fûe
) const;

185 
vútuÆ
 
usöt
 
ªp‹tSize
() const;

187 
vútuÆ
 
boﬁ
 
isFuŒ
() const;

188 
vútuÆ
 
wrôeIãm
(
usöt
 
ôem
);

190 ˛as†
	cIãøt‹
 : 
public
 
Mu…iAºay
::
Iãøt‹


192 
public
:

193 
ex∂icô
 
Iãøt‹
(c⁄° 
DñèMu…iAºay
& 
∑r
);

194 
	gvútuÆ
 ~
Iãøt‹
();

196 
vútuÆ
 
goToIãm
(
usöt
 
¨øy
, usöà
ödex
);

197 
vútuÆ
 
usöt
 
ªadIãm
(usöà
¨øy
, usöà
ödex
);

198 
vútuÆ
 
usöt
 
√xtIãm
();

200 
	g¥Ÿe˘ed
:

201 
Aºay
::
Iãøt‹
 
dñè_ôî
;

203 
∑ú_ty≥
 
	gbuf„r
;

206 
Iãøt‹
();

207 
Iãøt‹
(const Iterator&);

208 
	gIãøt‹
& 
	g›î©‹
 = (c⁄° 
Iãøt‹
&);

211 
vútuÆ
 
	gMu…iAºay
::
Iãøt‹
* 
gëIãøt‹
(Ëc⁄° {  
√w
 Iãøt‹(*
this
); }

213 
	g¥Ÿe˘ed
:

214 
vútuÆ
 
usöt
 
gëFœgs
() const;

215 
vútuÆ
 
ícodeIãms
();

217 
	g¥iv©e
:

218 
Aºay
::
Encodî
* 
dñè_buf„r
;

219 
Aºay
* 
	gdñè_ôems
;

222 
DñèMu…iAºay
();

223 
DñèMu…iAºay
(const DeltaMultiArray&);

224 
	gDñèMu…iAºay
& 
	g›î©‹
 = (c⁄° 
DñèMu…iAºay
&);

	@bits/nibblevector.cpp

1 
	~<c°dlib
>

3 
	~"nibbÀve˘‹.h
"

4 
	~"../misc/utûs.h
"

7 
«me•a˚
 
	gCSA


11 
	gNibbÀVe˘‹
::
NibbÀVe˘‹
(
°d
::
if°ªam
& 
fûe
) :

12 
BôVe˘‹
(
fûe
)

16 
NibbÀVe˘‹
::NibbÀVe˘‹(
FILE
* 
fûe
) :

17 
BôVe˘‹
(
fûe
)

21 
NibbÀVe˘‹
::NibbÀVe˘‹(
Encodî
& 
ícodî
, 
usöt
 
univî£_size
) :

22 
BôVe˘‹
(
ícodî
, 
univî£_size
)

26 
	gNibbÀVe˘‹
::~
NibbÀVe˘‹
()

32 
usöt


33 
NibbÀVe˘‹
::
ªp‹tSize
() const

35 
usöt
 
byãs
 = (*
this
);

36 
	gbyãs
 +
BôVe˘‹
::
ªp‹tSize
();

37  
	gbyãs
;

42 
	gNibbÀVe˘‹
::
Iãøt‹
::Iãøt‹(c⁄° 
NibbÀVe˘‹
& 
∑r
) :

43 
BôVe˘‹
::
Iãøt‹
(
∑r
),

44 
u£_æe
(
Ál£
)

48 
	gNibbÀVe˘‹
::
Iãøt‹
::~Iterator()

54 
usöt


55 
NibbÀVe˘‹
::
Iãøt‹
::
ønk
(
usöt
 
vÆue
, 
boﬁ
 
©_Àa°
)

57 c⁄° 
	gNibbÀVe˘‹
& 
	g∑r
 = (c⁄° 
NibbÀVe˘‹
&)(
this
->
∑ª¡
);

59 if(
	gvÆue
 >
∑r
.
size
Ë{ Ö¨.
ôems
; }

61 
	gthis
->
vÆueLo›
(
vÆue
);

63 
usöt
 
	gidx
 = 
this
->
ßm∂e
.
fú°
 +Åhis->
cur
 + 1;

64 if(!
	g©_Àa°
 && 
	gthis
->
	gvÆ
 > 
	gvÆue
)

66 
	gidx
--;

68 if(
	g©_Àa°
 && 
	gthis
->
	gvÆ
 < 
	gvÆue
)

70 
	gthis
->
gëSam∂e
(
this
->
block
 + 1);

71 
	gidx
 = 
this
->
ßm∂e
.
fú°
 +Åhis->
cur
 + 1;

73  
	gidx
;

76 
usöt


77 
	gNibbÀVe˘‹
::
Iãøt‹
::
£À˘
(
usöt
 
ödex
)

79 c⁄° 
NibbÀVe˘‹
& 
∑r
 = (c⁄° NibbÀVe˘‹&)(
this
->
∑ª¡
);

81 if(
	gödex
 >
∑r
.
ôems
Ë{ Ö¨.
size
; }

82 
	gthis
->
gëSam∂e
(
this
->
ßm∂eF‹Index
(
ödex
));

84 
usöt
 
	glim
 = 
ödex
 - 
this
->
ßm∂e
.
fú°
;

85 
	gthis
->
	gcur
 < 
	glim
)

87 
	gthis
->
	gvÆ
 +
this
->
buf„r
.
ªadNibbÀCode
();

88 
usöt
 
	gãmp
 = 
this
->
buf„r
.
ªadNibbÀCode
();

89 
	gthis
->
	gvÆ
 +
ãmp
 - 1;

90 
	gthis
->
	gcur
 +
ãmp
;

92 if(
	gthis
->
	gcur
 > 
	glim
)

94 
	gthis
->
	grun
 = 
this
->
cur
 - 
lim
;

95 
	gthis
->
	gcur
 -
this
->
run
;

96 
	gthis
->
	gvÆ
 -
this
->
run
;

99  
	gthis
->
	gvÆ
;

102 
usöt


103 
	gNibbÀVe˘‹
::
Iãøt‹
::
£À˘Next
()

105 if(
this
->
cur
 >this->
block_ôems
)

107 
this
->
gëSam∂e
—his->
block
 + 1);

108  
	gthis
->
	gvÆ
;

111 
	gthis
->
	gcur
++;

112 if(
	gthis
->
	grun
 > 0)

114 
	gthis
->
	gvÆ
++;

115 
	gthis
->
	grun
--;

119 
	gthis
->
	gvÆ
 +
this
->
buf„r
.
ªadNibbÀCode
();

120 
	gthis
->
	grun
 = 
this
->
buf„r
.
ªadNibbÀCode
() - 1;

123  
	gthis
->
	gvÆ
;

126 
∑ú_ty≥


127 
	gNibbÀVe˘‹
::
Iãøt‹
::
vÆueBef‹e
(
usöt
 
vÆue
)

129 c⁄° 
NibbÀVe˘‹
& 
∑r
 = (c⁄° NibbÀVe˘‹&)(
this
->
∑ª¡
);

131 if(
	gvÆue
 >
∑r
.
size
Ë{  
∑ú_ty≥
’¨.size,Ö¨.
ôems
); }

133 
	gthis
->
gëSam∂e
(
this
->
ßm∂eF‹VÆue
(
vÆue
));

134 if(
	gthis
->
	gvÆ
 > 
	gvÆue
Ë{  
∑ú_ty≥
(
∑r
.
size
,Ö¨.
ôems
); }

135 
	gthis
->
	grun
 = 0;

137 
	gthis
->
	gcur
 <Åhis->
	gblock_ôems
 &&Åhis->
	gvÆ
 < 
	gvÆue
)

139 
usöt
 
	gãmp
 = 
this
->
buf„r
.
ªadNibbÀCode
(
vÆue
 -Åhis->
vÆ
);

140 if(
	gãmp
 == 0) { ; }

141 
	gthis
->
	gvÆ
 +
ãmp
;

143 
	gãmp
 = 
this
->
buf„r
.
ªadNibbÀCode
();

144 
	gthis
->
	gcur
 +
ãmp
;

145 
	gthis
->
	gvÆ
 +
ãmp
 - 1;

147 if(
	gthis
->
	gvÆ
 > 
	gvÆue
)

149 
	gthis
->
	grun
 = 
this
->
vÆ
 - 
vÆue
;

150 
	gthis
->
	gvÆ
 = 
vÆue
;

151 
	gthis
->
	gcur
 -
this
->
run
;

154  
∑ú_ty≥
(
this
->
vÆ
,Åhis->
ßm∂e
.
fú°
 +Åhis->
cur
);

157 
∑ú_ty≥


158 
	gNibbÀVe˘‹
::
Iãøt‹
::
vÆueA·î
(
usöt
 
vÆue
)

160 c⁄° 
NibbÀVe˘‹
& 
∑r
 = (c⁄° NibbÀVe˘‹&)(
this
->
∑ª¡
);

162 if(
	gvÆue
 >
∑r
.
size
Ë{  
∑ú_ty≥
’¨.size,Ö¨.
ôems
); }

164 
	gthis
->
vÆueLo›
(
vÆue
);

166 if(
	gthis
->
	gvÆ
 < 
	gvÆue
)

168 
	gthis
->
gëSam∂e
(
this
->
block
 + 1);

171  
∑ú_ty≥
(
this
->
vÆ
,Åhis->
ßm∂e
.
fú°
 +Åhis->
cur
);

174 
∑ú_ty≥


175 
	gNibbÀVe˘‹
::
Iãøt‹
::
√xtVÆue
()

177 if(
this
->
cur
 >this->
block_ôems
)

179 
this
->
gëSam∂e
—his->
block
 + 1);

180  
∑ú_ty≥
(
this
->
vÆ
,Åhis->
ßm∂e
.
fú°
);

183 
	gthis
->
	gcur
++;

184 if(
	gthis
->
	grun
 > 0)

186 
	gthis
->
	gvÆ
++;

187 
	gthis
->
	grun
--;

191 
	gthis
->
	gvÆ
 +
this
->
buf„r
.
ªadNibbÀCode
();

192 
	gthis
->
	grun
 = 
this
->
buf„r
.
ªadNibbÀCode
() - 1;

195  
∑ú_ty≥
(
this
->
vÆ
,Åhis->
ßm∂e
.
fú°
 +Åhis->
cur
);

198 
∑ú_ty≥


199 
	gNibbÀVe˘‹
::
Iãøt‹
::
£À˘Run
(
usöt
 
ödex
, usöà
max_Àngth
)

201 
usöt
 
	gvÆue
 = 
this
->
£À˘
(
ödex
);

203 
usöt
 
	gÀn
 = 
°d
::
mö
(
max_Àngth
, 
this
->
run
);

204 
	gthis
->
	grun
 -
Àn
;Åhis->
	gcur
 +Àn;Åhis->
	gvÆ
 +=Üen;

206  
∑ú_ty≥
(
vÆue
, 
Àn
);

209 
∑ú_ty≥


210 
	gNibbÀVe˘‹
::
Iãøt‹
::
£À˘NextRun
(
usöt
 
max_Àngth
)

212 
usöt
 
vÆue
 = 
this
->
£À˘Next
();

214 
usöt
 
	gÀn
 = 
°d
::
mö
(
max_Àngth
, 
this
->
run
);

215 
	gthis
->
	grun
 -
Àn
;Åhis->
	gcur
 +Àn;Åhis->
	gvÆ
 +=Üen;

217  
∑ú_ty≥
(
vÆue
, 
Àn
);

220 
boﬁ


221 
	gNibbÀVe˘‹
::
Iãøt‹
::
isSë
(
usöt
 
vÆue
)

223 c⁄° 
NibbÀVe˘‹
& 
∑r
 = (c⁄° NibbÀVe˘‹&)(
this
->
∑ª¡
);

225 if(
	gvÆue
 >
∑r
.
size
Ë{  
Ál£
; }

227 
	gthis
->
vÆueLo›
(
vÆue
);

229  (
	gthis
->
	gvÆ
 =
vÆue
);

232 
usöt


233 
	gNibbÀVe˘‹
::
Iãøt‹
::
cou¡Runs
()

235 c⁄° 
NibbÀVe˘‹
& 
∑r
 = (c⁄° NibbÀVe˘‹&)(
this
->
∑ª¡
);

237 if(
	g∑r
.
	gôems
 == 0) {  0; }

239 
usöt
 
	gruns
 = 1;

240 
∑ú_ty≥
 
	gªs
 = 
this
->
£À˘Run
(0, 
∑r
.
ôems
);

241 
usöt
 
	gœ°
 = 
ªs
.
fú°
 +Ñes.
£c⁄d
;

243 
	gœ°
 < 
	g∑r
.
	gsize
)

245 
	gªs
 = 
this
->
£À˘NextRun
(
∑r
.
ôems
);

246 if(
	gªs
.
	gfú°
 < 
	g∑r
.
	gsize
 &&Ñes.fú° > 
	gœ°
 + 1Ë{ 
	gruns
++; }

247 
	gœ°
 = 
ªs
.
fú°
 +Ñes.
£c⁄d
;

250  
	gruns
;

255 
	gNibbÀVe˘‹
::
Iãøt‹
::
vÆueLo›
(
usöt
 
vÆue
)

257 
this
->
gëSam∂e
—his->
ßm∂eF‹VÆue
(
vÆue
));

259 if(
	gthis
->
	gvÆ
 >
vÆue
) { ; }

260 
	gthis
->
	gcur
 <Åhis->
	gblock_ôems
)

262 
	gthis
->
	gvÆ
 +
this
->
buf„r
.
ªadNibbÀCode
();

263 
	gthis
->
	gcur
++;

264 
	gthis
->
	grun
 = 
this
->
buf„r
.
ªadNibbÀCode
() - 1;

265 if(
	gthis
->
	gvÆ
 >
vÆue
) { ; }

267 
	gthis
->
	gcur
 +
this
->
run
;

268 
	gthis
->
	gvÆ
 +
this
->
run
;

269 if(
	gthis
->
	gvÆ
 >
vÆue
)

271 
this
->
run
 =Åhis->
vÆ
 - 
vÆue
;

272 
	gthis
->
	gvÆ
 = 
vÆue
;

273 
	gthis
->
	gcur
 -
this
->
run
;

276 
	gthis
->
	grun
 = 0;

282 
	gNibbÀEncodî
::
NibbÀEncodî
(
usöt
 
block_byãs
, usöà
su≥rblock_size
) :

283 
Ve˘‹Encodî
(
block_byãs
, 
su≥rblock_size
),

284 
run
(
EMPTY_PAIR
)

288 
	gNibbÀEncodî
::~
NibbÀEncodî
()

293 
NibbÀEncodî
::
£tBô
(
usöt
 
vÆue
)

295 
this
->
£tRun
(
vÆue
, 1);

300 
	gNibbÀEncodî
::
£tRun
(
usöt
 
°¨t
, usöà
Àn
)

302 if(
	gthis
->
	gôems
 == 0)

304 
this
->
£tFú°Bô
(
°¨t
);

305 if(
	gÀn
 > 1)

307 
	gthis
->
nibbÀEncode
(1, 
Àn
 - 1);

311 if(
	g°¨t
 < 
	gthis
->
	gsize
 || 
	gÀn
 == 0) { ; }

314 
usöt
 
	gdiff
 = 
°¨t
 + 1 - 
this
->
size
;

315 
usöt
 
	g‰ì_bôs
 = 
this
->
buf„r
->
bôsLe·
();

316 
usöt
 
	gcode_bôs
 = 
this
->
buf„r
->
nibbÀCodeLígth
(
diff
);

317 if(
	g‰ì_bôs
 >
code_bôs
 + 4)

319 
‰ì_bôs
 -
code_bôs
;

320 
usöt
 
	grun_bôs
 = 
this
->
buf„r
->
nibbÀCodeLígth
(
Àn
);

321 if(
	grun_bôs
 <
‰ì_bôs
)

323 
this
->
nibbÀEncode
(
diff
, 
Àn
);

328 
usöt
 
	gŒí
 = (usöt)1 << (3 * (
‰ì_bôs
 / 4));

329 
	gthis
->
nibbÀEncode
(
diff
, 
Œí
);

330 
	gÀn
 -
Œí
;

333 
	gthis
->
	gsize
++;

334 
	gthis
->
	gôems
++;

338 
	gthis
->
	gsize
 = 
°¨t
 + 1;

339 
	gthis
->
	gôems
++;

343 
	gthis
->
addNewBlock
();

344 if(
	gÀn
 > 1)

346 
	gthis
->
nibbÀEncode
(1, 
Àn
 - 1);

351 
	gNibbÀEncodî
::
addBô
(
usöt
 
vÆue
)

353 
this
->
addRun
(
vÆue
, 1);

357 
	gNibbÀEncodî
::
addRun
(
usöt
 
°¨t
, usöà
Àn
)

359 if(
	gthis
->
	grun
.
	g£c⁄d
 == 0)

361 
this
->
run
 = 
∑ú_ty≥
(
°¨t
, 
Àn
);

363 if(
	g°¨t
 =
this
->
run
.
fú°
 +Åhis->run.
£c⁄d
)

365 
this
->
run
.
£c⁄d
 +
Àn
;

369 
	gthis
->
£tRun
(
this
->
run
.
fú°
,Åhis->run.
£c⁄d
);

370 
	gthis
->
	grun
 = 
∑ú_ty≥
(
°¨t
, 
Àn
);

375 
	gNibbÀEncodî
::
Êush
()

377 
this
->
£tRun
—his->
run
.
fú°
,Åhis->run.
£c⁄d
);

378 
	gthis
->
	grun
.
	g£c⁄d
 = 0;

	@bits/nibblevector.h

1 #i‚de‡
NIBBLEVECTOR_H


2 
	#NIBBLEVECTOR_H


	)

4 
	~<f°ªam
>

6 
	~"bôve˘‹.h
"

9 
«me•a˚
 
	gCSA


17 ˛as†
	cNibbÀEncodî
 : 
public
 
Ve˘‹Encodî


19 
public
:

20 
NibbÀEncodî
(
usöt
 
block_byãs
, usöà
su≥rblock_size
 = 
Ve˘‹Encodî
::
SUPERBLOCK_SIZE
);

21 ~
NibbÀEncodî
();

23 
£tBô
(
usöt
 
vÆue
);

24 
£tRun
(
usöt
 
°¨t
, usöà
Àn
);

26 
addBô
(
usöt
 
vÆue
);

27 
addRun
(
usöt
 
°¨t
, usöà
Àn
);

28 
Êush
();

31 
ölöe
 
nibbÀEncode
(
usöt
 
diff
, usöà
Àn
)

33 
	gthis
->
	gsize
 +
diff
 + 
Àn
 - 1;

34 
	gthis
->
	gôems
 +
Àn
;

35 
	gthis
->
	gbuf„r
->
wrôeNibbÀCode
(
diff
);

36 
	gthis
->
	gbuf„r
->
wrôeNibbÀCode
(
Àn
);

39 
	g¥Ÿe˘ed
:

40 
∑ú_ty≥
 
run
;

43 
NibbÀEncodî
();

44 
NibbÀEncodî
(const NibbleEncoder&);

45 
	gNibbÀEncodî
& 
	g›î©‹
 = (c⁄° 
NibbÀEncodî
&);

56 ˛as†
	cNibbÀVe˘‹
 : 
public
 
BôVe˘‹


58 
public
:

59 
NibbÀEncodî
 
	tEncodî
;

61 
ex∂icô
 
NibbÀVe˘‹
(
°d
::
if°ªam
& 
fûe
);

62 
ex∂icô
 
NibbÀVe˘‹
(
FILE
* 
fûe
);

63 
NibbÀVe˘‹
(
Encodî
& 
ícodî
, 
usöt
 
univî£_size
);

64 ~
NibbÀVe˘‹
();

68 
usöt
 
ªp‹tSize
() const;

72 ˛as†
	cIãøt‹
 : 
public
 
BôVe˘‹
::
Iãøt‹


74 
public
:

75 
ex∂icô
 
Iãøt‹
(c⁄° 
NibbÀVe˘‹
& 
∑r
);

76 ~
Iãøt‹
();

78 
usöt
 
ønk
(usöà
vÆue
, 
boﬁ
 
©_Àa°
 = 
Ál£
);

80 
usöt
 
£À˘
(usöà
ödex
);

81 
usöt
 
£À˘Next
();

83 
∑ú_ty≥
 
vÆueBef‹e
(
usöt
 
vÆue
);

84 
∑ú_ty≥
 
vÆueA·î
(
usöt
 
vÆue
);

85 
∑ú_ty≥
 
√xtVÆue
();

87 
∑ú_ty≥
 
£À˘Run
(
usöt
 
ödex
, usöà
max_Àngth
);

88 
∑ú_ty≥
 
£À˘NextRun
(
usöt
 
max_Àngth
);

90 
boﬁ
 
isSë
(
usöt
 
vÆue
);

92 
usöt
 
cou¡Runs
();

94 c⁄° 
usöt
 
	gGAP_ENCODING
 = 0;

95 c⁄° 
usöt
 
	gRUN_LENGTH_ENCODING
 = 1;

97 
	g¥Ÿe˘ed
:

99 
vÆueLo›
(
usöt
 
vÆue
);

101 
ölöe
 
gëSam∂e
(
usöt
 
ßm∂e_numbî
)

103 
	gBôVe˘‹
::
Iãøt‹
::
gëSam∂e
(
ßm∂e_numbî
);

104 
	gthis
->
	grun
 = 0;

108 
boﬁ
 
	gu£_æe
;

111 
Iãøt‹
();

112 
Iãøt‹
(const Iterator&);

113 
	gIãøt‹
& 
	g›î©‹
 = (c⁄° 
Iãøt‹
&);

118 
	g¥Ÿe˘ed
:

121 
NibbÀVe˘‹
();

122 
NibbÀVe˘‹
(const NibbleVector&);

123 
	gNibbÀVe˘‹
& 
	g›î©‹
 = (c⁄° 
NibbÀVe˘‹
&);

	@bits/rlevector.cpp

1 
	~<c°dlib
>

3 
	~"æeve˘‹.h
"

4 
	~"../misc/utûs.h
"

7 
«me•a˚
 
	gCSA


11 
	gRLEVe˘‹
::
RLEVe˘‹
(
°d
::
if°ªam
& 
fûe
) :

12 
BôVe˘‹
(
fûe
)

16 
RLEVe˘‹
::RLEVe˘‹(
FILE
* 
fûe
) :

17 
BôVe˘‹
(
fûe
)

21 
RLEVe˘‹
::RLEVe˘‹(
Encodî
& 
ícodî
, 
usöt
 
univî£_size
) :

22 
BôVe˘‹
(
ícodî
, 
univî£_size
)

26 
	gRLEVe˘‹
::~
RLEVe˘‹
()

32 
usöt


33 
RLEVe˘‹
::
ªp‹tSize
() const

35 
usöt
 
byãs
 = (*
this
);

36 
	gbyãs
 +
BôVe˘‹
::
ªp‹tSize
();

37  
	gbyãs
;

42 
	gRLEVe˘‹
::
Iãøt‹
::Iãøt‹(c⁄° 
RLEVe˘‹
& 
∑r
) :

43 
BôVe˘‹
::
Iãøt‹
(
∑r
)

47 
RLEVe˘‹
::
Iãøt‹
::~Iterator()

51 
usöt


52 
RLEVe˘‹
::
Iãøt‹
::
ønk
(
usöt
 
vÆue
, 
boﬁ
 
©_Àa°
)

54 c⁄° 
	gRLEVe˘‹
& 
	g∑r
 = (c⁄° 
RLEVe˘‹
&)(
this
->
∑ª¡
);

56 if(
	gvÆue
 >
∑r
.
size
Ë{ Ö¨.
ôems
; }

58 
	gthis
->
vÆueLo›
(
vÆue
);

60 
usöt
 
	gidx
 = 
this
->
ßm∂e
.
fú°
 +Åhis->
cur
 + 1;

61 if(!
	g©_Àa°
 && 
	gthis
->
	gvÆ
 > 
	gvÆue
)

63 
	gidx
--;

65 if(
	g©_Àa°
 && 
	gthis
->
	gvÆ
 < 
	gvÆue
)

67 
	gthis
->
gëSam∂e
(
this
->
block
 + 1);

68 
	gthis
->
	grun
 = 0;

69 
	gidx
 = 
this
->
ßm∂e
.
fú°
 +Åhis->
cur
 + 1;

71  
	gidx
;

74 
usöt


75 
	gRLEVe˘‹
::
Iãøt‹
::
£À˘
(
usöt
 
ödex
)

77 c⁄° 
RLEVe˘‹
& 
∑r
 = (c⁄° RLEVe˘‹&)(
this
->
∑ª¡
);

79 if(
	gödex
 >
∑r
.
ôems
Ë{ Ö¨.
size
; }

80 
	gthis
->
gëSam∂e
(
this
->
ßm∂eF‹Index
(
ödex
));

81 
	gthis
->
	grun
 = 0;

83 
usöt
 
	glim
 = 
ödex
 - 
this
->
ßm∂e
.
fú°
;

84 
	gthis
->
	gcur
 < 
	glim
)

86 
	gthis
->
	gvÆ
 +
this
->
buf„r
.
ªadDñèCode
();

87 
usöt
 
	gãmp
 = 
this
->
buf„r
.
ªadDñèCode
();

88 
	gthis
->
	gvÆ
 +
ãmp
 - 1;

89 
	gthis
->
	gcur
 +
ãmp
;

91 if(
	gthis
->
	gcur
 > 
	glim
)

93 
	gthis
->
	grun
 = 
this
->
cur
 - 
lim
;

94 
	gthis
->
	gcur
 -
this
->
run
;

95 
	gthis
->
	gvÆ
 -
this
->
run
;

98  
	gthis
->
	gvÆ
;

101 
usöt


102 
	gRLEVe˘‹
::
Iãøt‹
::
£À˘Next
()

104 if(
this
->
cur
 >this->
block_ôems
)

106 
this
->
gëSam∂e
—his->
block
 + 1);

107 
	gthis
->
	grun
 = 0;

108  
	gthis
->
	gvÆ
;

111 
	gthis
->
	gcur
++;

112 if(
	gthis
->
	grun
 > 0)

114 
	gthis
->
	gvÆ
++;

115 
	gthis
->
	grun
--;

119 
	gthis
->
	gvÆ
 +
this
->
buf„r
.
ªadDñèCode
();

120 
	gthis
->
	grun
 = 
this
->
buf„r
.
ªadDñèCode
() - 1;

123  
	gthis
->
	gvÆ
;

126 
∑ú_ty≥


127 
	gRLEVe˘‹
::
Iãøt‹
::
vÆueBef‹e
(
usöt
 
vÆue
)

129 c⁄° 
RLEVe˘‹
& 
∑r
 = (c⁄° RLEVe˘‹&)(
this
->
∑ª¡
);

131 if(
	gvÆue
 >
∑r
.
size
Ë{  
∑ú_ty≥
’¨.size,Ö¨.
ôems
); }

133 
	gthis
->
gëSam∂e
(
this
->
ßm∂eF‹VÆue
(
vÆue
));

134 if(
	gthis
->
	gvÆ
 > 
	gvÆue
Ë{  
∑ú_ty≥
(
∑r
.
size
,Ö¨.
ôems
); }

135 
	gthis
->
	grun
 = 0;

137 
	gthis
->
	gcur
 <Åhis->
	gblock_ôems
 &&Åhis->
	gvÆ
 < 
	gvÆue
)

139 
usöt
 
	gãmp
 = 
this
->
buf„r
.
ªadDñèCode
(
vÆue
 -Åhis->
vÆ
);

140 if(
	gãmp
 == 0) { ; }

141 
	gthis
->
	gvÆ
 +
ãmp
;

143 
	gãmp
 = 
this
->
buf„r
.
ªadDñèCode
();

144 
	gthis
->
	gcur
 +
ãmp
;

145 
	gthis
->
	gvÆ
 +
ãmp
 - 1;

147 if(
	gthis
->
	gvÆ
 > 
	gvÆue
)

149 
	gthis
->
	grun
 = 
this
->
vÆ
 - 
vÆue
;

150 
	gthis
->
	gvÆ
 = 
vÆue
;

151 
	gthis
->
	gcur
 -
this
->
run
;

154  
∑ú_ty≥
(
this
->
vÆ
,Åhis->
ßm∂e
.
fú°
 +Åhis->
cur
);

157 
∑ú_ty≥


158 
	gRLEVe˘‹
::
Iãøt‹
::
vÆueA·î
(
usöt
 
vÆue
)

160 c⁄° 
RLEVe˘‹
& 
∑r
 = (c⁄° RLEVe˘‹&)(
this
->
∑ª¡
);

162 if(
	gvÆue
 >
∑r
.
size
Ë{  
∑ú_ty≥
’¨.size,Ö¨.
ôems
); }

164 
	gthis
->
vÆueLo›
(
vÆue
);

166 if(
	gthis
->
	gvÆ
 < 
	gvÆue
)

168 
	gthis
->
gëSam∂e
(
this
->
block
 + 1);

169 
	gthis
->
	grun
 = 0;

172  
∑ú_ty≥
(
this
->
vÆ
,Åhis->
ßm∂e
.
fú°
 +Åhis->
cur
);

175 
∑ú_ty≥


176 
	gRLEVe˘‹
::
Iãøt‹
::
√xtVÆue
()

178 if(
this
->
cur
 >this->
block_ôems
)

180 
this
->
gëSam∂e
—his->
block
 + 1);

181 
	gthis
->
	grun
 = 0;

182  
∑ú_ty≥
(
this
->
vÆ
,Åhis->
ßm∂e
.
fú°
);

185 
	gthis
->
	gcur
++;

186 if(
	gthis
->
	grun
 > 0)

188 
	gthis
->
	gvÆ
++;

189 
	gthis
->
	grun
--;

193 
	gthis
->
	gvÆ
 +
this
->
buf„r
.
ªadDñèCode
();

194 
	gthis
->
	grun
 = 
this
->
buf„r
.
ªadDñèCode
() - 1;

197  
∑ú_ty≥
(
this
->
vÆ
,Åhis->
ßm∂e
.
fú°
 +Åhis->
cur
);

200 
∑ú_ty≥


201 
	gRLEVe˘‹
::
Iãøt‹
::
£À˘Run
(
usöt
 
ödex
, usöà
max_Àngth
)

203 
usöt
 
	gvÆue
 = 
this
->
£À˘
(
ödex
);

205 
usöt
 
	gÀn
 = 
°d
::
mö
(
max_Àngth
, 
this
->
run
);

206 
	gthis
->
	grun
 -
Àn
;Åhis->
	gcur
 +Àn;Åhis->
	gvÆ
 +=Üen;

208  
∑ú_ty≥
(
vÆue
, 
Àn
);

211 
∑ú_ty≥


212 
	gRLEVe˘‹
::
Iãøt‹
::
£À˘NextRun
(
usöt
 
max_Àngth
)

214 
usöt
 
vÆue
 = 
this
->
£À˘Next
();

216 
usöt
 
	gÀn
 = 
°d
::
mö
(
max_Àngth
, 
this
->
run
);

217 
	gthis
->
	grun
 -
Àn
;Åhis->
	gcur
 +Àn;Åhis->
	gvÆ
 +=Üen;

219  
∑ú_ty≥
(
vÆue
, 
Àn
);

222 
boﬁ


223 
	gRLEVe˘‹
::
Iãøt‹
::
isSë
(
usöt
 
vÆue
)

225 c⁄° 
RLEVe˘‹
& 
∑r
 = (c⁄° RLEVe˘‹&)(
this
->
∑ª¡
);

227 if(
	gvÆue
 >
∑r
.
size
Ë{  
Ál£
; }

229 
	gthis
->
vÆueLo›
(
vÆue
);

231  (
	gthis
->
	gvÆ
 =
vÆue
);

234 
usöt


235 
	gRLEVe˘‹
::
Iãøt‹
::
cou¡Runs
()

237 c⁄° 
RLEVe˘‹
& 
∑r
 = (c⁄° RLEVe˘‹&)(
this
->
∑ª¡
);

239 if(
	g∑r
.
	gôems
 == 0) {  0; }

241 
usöt
 
	gruns
 = 1;

242 
∑ú_ty≥
 
	gªs
 = 
this
->
£À˘Run
(0, 
∑r
.
ôems
);

243 
usöt
 
	gœ°
 = 
ªs
.
fú°
 +Ñes.
£c⁄d
;

245 
	gœ°
 < 
	g∑r
.
	gsize
)

247 
	gªs
 = 
this
->
£À˘NextRun
(
∑r
.
ôems
);

248 if(
	gªs
.
	gfú°
 < 
	g∑r
.
	gsize
 &&Ñes.fú° > 
	gœ°
 + 1Ë{ 
	gruns
++; }

249 
	gœ°
 = 
ªs
.
fú°
 +Ñes.
£c⁄d
;

252  
	gruns
;

256 
	gRLEVe˘‹
::
Iãøt‹
::
vÆueLo›
(
usöt
 
vÆue
)

258 
this
->
gëSam∂e
—his->
ßm∂eF‹VÆue
(
vÆue
));

259 
	gthis
->
	grun
 = 0;

261 if(
	gthis
->
	gvÆ
 >
vÆue
) { ; }

262 
	gthis
->
	gcur
 <Åhis->
	gblock_ôems
)

264 
	gthis
->
	gvÆ
 +
this
->
buf„r
.
ªadDñèCode
();

265 
	gthis
->
	gcur
++;

266 
	gthis
->
	grun
 = 
this
->
buf„r
.
ªadDñèCode
() - 1;

267 if(
	gthis
->
	gvÆ
 >
vÆue
) { ; }

269 
	gthis
->
	gcur
 +
this
->
run
;

270 
	gthis
->
	gvÆ
 +
this
->
run
;

271 if(
	gthis
->
	gvÆ
 >
vÆue
)

273 
this
->
run
 =Åhis->
vÆ
 - 
vÆue
;

274 
	gthis
->
	gvÆ
 = 
vÆue
;

275 
	gthis
->
	gcur
 -
this
->
run
;

278 
	gthis
->
	grun
 = 0;

284 
	gRLEEncodî
::
RLEEncodî
(
usöt
 
block_byãs
, usöà
su≥rblock_size
) :

285 
Ve˘‹Encodî
(
block_byãs
, 
su≥rblock_size
),

286 
run
(
EMPTY_PAIR
)

290 
	gRLEEncodî
::~
RLEEncodî
()

295 
RLEEncodî
::
£tBô
(
usöt
 
vÆue
)

297 
this
->
£tRun
(
vÆue
, 1);

301 
	gRLEEncodî
::
£tRun
(
usöt
 
°¨t
, usöà
Àn
)

303 if(
	gthis
->
	gôems
 == 0)

305 
this
->
£tFú°Bô
(
°¨t
);

306 if(
	gÀn
 > 1)

308 
	gthis
->
RLEncode
(1, 
Àn
 - 1);

312 if(
	g°¨t
 < 
	gthis
->
	gsize
 || 
	gÀn
 == 0) { ; }

315 
usöt
 
	gdiff
 = 
°¨t
 + 1 - 
this
->
size
;

316 
usöt
 
	g‰ì_bôs
 = 
this
->
buf„r
->
bôsLe·
();

317 
usöt
 
	gcode_bôs
 = 
this
->
buf„r
->
dñèCodeLígth
(
diff
);

318 if(
	g‰ì_bôs
 > 
	gcode_bôs
)

320 
	g‰ì_bôs
 -
code_bôs
;

321 
usöt
 
	grun_bôs
 = 
this
->
buf„r
->
dñèCodeLígth
(
Àn
);

322 if(
	grun_bôs
 <
‰ì_bôs
)

324 
this
->
RLEncode
(
diff
, 
Àn
);

329 
usöt
 
	gŒí
 = 1;

330 
	gŒí
 + 2 * 
Àngth
(
Œí
 + 1Ë- 1 <
‰ì_bôs
) {Ülen++; }

331 
	gŒí
 = ((
usöt
)1 << 
Œí
) - 1;

333 
	gthis
->
RLEncode
(
diff
, 
Œí
);

334 
	gÀn
 -
Œí
;

337 
	gthis
->
	gsize
++;

338 
	gthis
->
	gôems
++;

342 
	gthis
->
	gsize
 = 
°¨t
 + 1;

343 
	gthis
->
	gôems
++;

347 
	gthis
->
addNewBlock
();

348 if(
	gÀn
 > 1)

350 
	gthis
->
RLEncode
(1, 
Àn
 - 1);

355 
	gRLEEncodî
::
addBô
(
usöt
 
vÆue
)

357 
this
->
addRun
(
vÆue
, 1);

361 
	gRLEEncodî
::
addRun
(
usöt
 
°¨t
, usöà
Àn
)

363 if(
	gthis
->
	grun
.
	g£c⁄d
 == 0)

365 
this
->
run
 = 
∑ú_ty≥
(
°¨t
, 
Àn
);

367 if(
	g°¨t
 =
this
->
run
.
fú°
 +Åhis->run.
£c⁄d
)

369 
this
->
run
.
£c⁄d
 +
Àn
;

373 
	gthis
->
£tRun
(
this
->
run
.
fú°
,Åhis->run.
£c⁄d
);

374 
	gthis
->
	grun
 = 
∑ú_ty≥
(
°¨t
, 
Àn
);

379 
	gRLEEncodî
::
Êush
()

381 
this
->
£tRun
—his->
run
.
fú°
,Åhis->run.
£c⁄d
);

382 
	gthis
->
	grun
.
	g£c⁄d
 = 0;

	@bits/rlevector.h

1 #i‚de‡
RLEVECTOR_H


2 
	#RLEVECTOR_H


	)

4 
	~<f°ªam
>

6 
	~"bôve˘‹.h
"

9 
«me•a˚
 
	gCSA


17 ˛as†
	cRLEEncodî
 : 
public
 
Ve˘‹Encodî


19 
public
:

20 
RLEEncodî
(
usöt
 
block_byãs
, usöà
su≥rblock_size
 = 
Ve˘‹Encodî
::
SUPERBLOCK_SIZE
);

21 ~
RLEEncodî
();

23 
£tBô
(
usöt
 
vÆue
);

24 
£tRun
(
usöt
 
°¨t
, usöà
Àn
);

27 
addBô
(
usöt
 
vÆue
);

28 
addRun
(
usöt
 
°¨t
, usöà
Àn
);

29 
Êush
();

31 
ölöe
 
RLEncode
(
usöt
 
diff
, usöà
Àn
)

33 
	gthis
->
	gsize
 +
diff
 + 
Àn
 - 1;

34 
	gthis
->
	gôems
 +
Àn
;

35 
	gthis
->
	gbuf„r
->
wrôeDñèCode
(
diff
);

36 
	gthis
->
	gbuf„r
->
wrôeDñèCode
(
Àn
);

39 
	g¥Ÿe˘ed
:

40 
∑ú_ty≥
 
run
;

43 
RLEEncodî
();

44 
RLEEncodî
(const RLEEncoder&);

45 
	gRLEEncodî
& 
	g›î©‹
 = (c⁄° 
RLEEncodî
&);

53 ˛as†
	cRLEVe˘‹
 : 
public
 
BôVe˘‹


55 
public
:

56 
RLEEncodî
 
	tEncodî
;

58 
ex∂icô
 
RLEVe˘‹
(
°d
::
if°ªam
& 
fûe
);

59 
ex∂icô
 
RLEVe˘‹
(
FILE
* 
fûe
);

60 
RLEVe˘‹
(
Encodî
& 
ícodî
, 
usöt
 
univî£_size
);

61 ~
RLEVe˘‹
();

65 
usöt
 
ªp‹tSize
() const;

69 ˛as†
	cIãøt‹
 : 
public
 
BôVe˘‹
::
Iãøt‹


71 
public
:

72 
ex∂icô
 
Iãøt‹
(c⁄° 
RLEVe˘‹
& 
∑r
);

73 ~
Iãøt‹
();

75 
usöt
 
ønk
(usöà
vÆue
, 
boﬁ
 
©_Àa°
 = 
Ál£
);

77 
usöt
 
£À˘
(usöà
ödex
);

78 
usöt
 
£À˘Next
();

80 
∑ú_ty≥
 
vÆueBef‹e
(
usöt
 
vÆue
);

81 
∑ú_ty≥
 
vÆueA·î
(
usöt
 
vÆue
);

82 
∑ú_ty≥
 
√xtVÆue
();

84 
∑ú_ty≥
 
£À˘Run
(
usöt
 
ödex
, usöà
max_Àngth
);

85 
∑ú_ty≥
 
£À˘NextRun
(
usöt
 
max_Àngth
);

87 
boﬁ
 
isSë
(
usöt
 
vÆue
);

89 
usöt
 
cou¡Runs
();

91 
	g¥Ÿe˘ed
:

93 
vÆueLo›
(
usöt
 
vÆue
);

96 
Iãøt‹
();

97 
Iãøt‹
(const Iterator&);

98 
	gIãøt‹
& 
	g›î©‹
 = (c⁄° 
Iãøt‹
&);

103 
	g¥Ÿe˘ed
:

106 
RLEVe˘‹
();

107 
RLEVe˘‹
(const RLEVector&);

108 
	gRLEVe˘‹
& 
	g›î©‹
 = (c⁄° 
RLEVe˘‹
&);

	@bits/succinctvector.cpp

1 
	~"succö˘ve˘‹.h
"

2 
	~"../misc/utûs.h
"

5 
«me•a˚
 
	gCSA


9 
	gSuccö˘Ve˘‹
::
Succö˘Ve˘‹
(
°d
::
if°ªam
& 
fûe
) :

10 
BôVe˘‹
()

12 
this
->
ªadHódî
(
fûe
);

13 
	gthis
->
ªadAºay
(
fûe
);

15 
	gthis
->
	göãgî_bôs
 = 
Àngth
(
this
->
size
);

16 
	gthis
->
ödexF‹R™k
();

17 
	gthis
->
ödexF‹Sñe˘
();

20 
	gSuccö˘Ve˘‹
::
Succö˘Ve˘‹
(
FILE
* 
fûe
) :

21 
BôVe˘‹
()

23 if(
fûe
 == 0) { ; }

25 
	gthis
->
ªadHódî
(
fûe
);

26 
	gthis
->
ªadAºay
(
fûe
);

28 
	gthis
->
	göãgî_bôs
 = 
Àngth
(
this
->
size
);

29 
	gthis
->
ödexF‹R™k
();

30 
	gthis
->
ödexF‹Sñe˘
();

33 
	gSuccö˘Ve˘‹
::
Succö˘Ve˘‹
(
Encodî
& 
ícodî
, 
usöt
 
univî£_size
) :

34 
BôVe˘‹
()

36 if(
ícodî
.
ôems
 == 0)

38 
°d
::
˚º
 << "Succö˘Ve˘‹: C™nŸ cª©ê®bô ve˘‹ wôhÇÿ1-bôs!" << std::
ídl
;

42 
	gthis
->
	gsize
 = 
univî£_size
;

43 
	gthis
->
	gôems
 = 
ícodî
.
ôems
;

44 
	gthis
->
	gblock_size
 = 
ícodî
.
block_size
;

46 
	gthis
->
	gnumbî_of_blocks
 = (
this
->
size
 +Åhis->
block_size
 * 
WORD_BITS
 - 1) / (this->block_size * WORD_BITS);

47 
	gthis
->
c›yAºay
(
ícodî
);

49 
	gthis
->
	göãgî_bôs
 = 
Àngth
(
this
->
size
);

50 
	gthis
->
ödexF‹R™k
();

51 
	gthis
->
ödexF‹Sñe˘
();

54 
	gSuccö˘Ve˘‹
::
Succö˘Ve˘‹
(
Encodî
& 
ícodî
) :

55 
BôVe˘‹
()

57 if(
ícodî
.
ôems
 == 0)

59 
°d
::
˚º
 << "Succö˘Ve˘‹: C™nŸ cª©ê®bô ve˘‹ wôhÇÿ1-bôs!" << std::
ídl
;

63 
	gthis
->
	gsize
 = 
°d
::
max
(
ícodî
.
size
,Éncodî.
su≥rblock_byãs
 * 
CHAR_BIT
);

64 
	gthis
->
	gôems
 = 
ícodî
.
ôems
;

65 
	gthis
->
	gblock_size
 = 
ícodî
.
block_size
;

67 
	gthis
->
	gnumbî_of_blocks
 = (
this
->
size
 +Åhis->
block_size
 * 
WORD_BITS
 - 1) / (this->block_size * WORD_BITS);

68 
	gthis
->
c›yAºay
(
ícodî
, 
åue
);

70 
	gthis
->
	göãgî_bôs
 = 
Àngth
(
this
->
size
);

71 
	gthis
->
ödexF‹R™k
();

72 
	gthis
->
ödexF‹Sñe˘
();

75 
	gSuccö˘Ve˘‹
::~
Succö˘Ve˘‹
()

82 
Succö˘Ve˘‹
::
wrôeTo
(
°d
::
of°ªam
& 
fûe
) const

84 
this
->
wrôeHódî
(
fûe
);

85 
	gthis
->
wrôeAºay
(
fûe
);

89 
	gSuccö˘Ve˘‹
::
wrôeTo
(
FILE
* 
fûe
) const

91 
this
->
wrôeHódî
(
fûe
);

92 
	gthis
->
wrôeAºay
(
fûe
);

95 
usöt


96 
	gSuccö˘Ve˘‹
::
ªp‹tSize
() const

98 
usöt
 
byãs
 = (*
this
);

99 
	gbyãs
 +
BôVe˘‹
::
ªp‹tSize
();

100  
	gbyãs
;

106 
	gSuccö˘Ve˘‹
::
ödexF‹R™k
()

108 
dñëe
 
this
->
ønk_ödex
; 
	gthis
->
	gønk_ödex
 = 0;

110 
WrôeBuf„r
 
buf„r
(
this
->
numbî_of_blocks
 + 1,Åhis->
öãgî_bôs
);

111 c⁄° 
usöt
* 
	gd©a
 = 
this
->
¨øy
;

113 
	gbuf„r
.
wrôeIãm
(0);

114 
usöt
 
	gbôcou¡
 = 0;

115 
usöt
 
	gblock
 = 0; block < 
	gthis
->
	gnumbî_of_blocks
; block++)

117 
usöt
 
	gw‹d
 = 0; w‹d < 
	gthis
->
	gblock_size
; w‹d++, ++
	gd©a
Ë{ 
	gbôcou¡
 +
p›cou¡
(*
d©a
); }

118 
	gbuf„r
.
wrôeIãm
(
bôcou¡
);

121 
	gthis
->
	gønk_ödex
 = 
buf„r
.
gëRódBuf„r
();

125 
	gSuccö˘Ve˘‹
::
ödexF‹Sñe˘
()

127 
dñëe
 
this
->
£À˘_ödex
; 
	gthis
->
	g£À˘_ödex
 = 0;

129 
	gthis
->
	g£À˘_øã
 = (
this
->
ôems
 +Åhis->
numbî_of_blocks
 - 1) /Åhis->number_of_blocks;

130 
usöt
 
	gödex_ßm∂es
 = (
this
->
ôems
 +Åhis->
£À˘_øã
 - 1) /Åhis->select_rate + 1;

131 
WrôeBuf„r
 
buf„r
(
ödex_ßm∂es
, 
this
->
öãgî_bôs
);

134 
usöt
 
	gpoöãr
 = 0;

135 
usöt
 
	g√xt_ønk
 = 
this
->
ønk_ödex
->
ªadIãm
(1);

136 
usöt
 
	gcuºít
 = 0; cuºíà< 
	gthis
->
	gôems
; cuºíà+
this
->
£À˘_øã
)

138 
√xt_ønk
 <
cuºít
)

140 
poöãr
++; 
	g√xt_ønk
 = 
this
->
ønk_ödex
->
ªadIãm
();

142 
	gbuf„r
.
wrôeIãm
(
poöãr
);

144 
	gbuf„r
.
wrôeIãm
(
this
->
numbî_of_blocks
 - 1);

146 
	gthis
->
	g£À˘_ödex
 = 
buf„r
.
gëRódBuf„r
();

151 
	gSuccö˘Ve˘‹
::
Iãøt‹
::Iãøt‹(c⁄° 
Succö˘Ve˘‹
& 
∑r
) :

152 
∑ª¡
(
∑r
),

153 
cur
(0)

157 
	gSuccö˘Ve˘‹
::
Iãøt‹
::~Iterator()

161 
usöt


162 
Succö˘Ve˘‹
::
Iãøt‹
::
ønk
(
usöt
 
vÆue
, 
boﬁ
 
©_Àa°
)

164 c⁄° 
	gSuccö˘Ve˘‹
& 
	g∑r
 = (c⁄° 
Succö˘Ve˘‹
&)(
this
->
∑ª¡
);

166 if(
	gvÆue
 >
∑r
.
size
Ë{ Ö¨.
ôems
; }

168 
usöt
 
	gblock
 = 
vÆue
 / (
∑r
.
block_size
 * 
WORD_BITS
);

169 
usöt
 
	gªsu…
 = 
∑r
.
ønk_ödex
->
ªadIãmC⁄°
(
block
);

170 c⁄° 
usöt
* 
	gd©a
 = 
∑r
.
¨øy
 + 
block
 *Ö¨.
block_size
;

174 
	gvÆue
 = 
vÆue
 - 
block
 * 
∑r
.
block_size
 * 
WORD_BITS
 + 1;

175 
	gvÆue
 >
WORD_BITS
)

177 
ªsu…
 +
p›cou¡
(*
d©a
);

178 ++
	gd©a
; 
	gvÆue
 -
WORD_BITS
;

182 if(
	gvÆue
 > 0)

184 
	gªsu…
 +
p›cou¡
(
GET
(
LOWER
(*
d©a
, 
WORD_BITS
 - 
vÆue
), value));

187  
	gªsu…
;

190 
usöt


191 
	gSuccö˘Ve˘‹
::
Iãøt‹
::
£À˘
(
usöt
 
ödex
)

193 c⁄° 
Succö˘Ve˘‹
& 
∑r
 = (c⁄° Succö˘Ve˘‹&)(
this
->
∑ª¡
);

194 
RódBuf„r
 
ønk_ödex
(*(
∑r
.rank_index));

196 if(
	gödex
 >
∑r
.
ôems
Ë{ Ö¨.
size
; }

199 
usöt
 
	glow
 = 
∑r
.
£À˘_ödex
->
ªadIãmC⁄°
(
ödex
 /Ö¨.
£À˘_øã
);

200 
usöt
 
	ghigh
 = 
∑r
.
£À˘_ödex
->
ªadIãmC⁄°
(
ödex
 /Ö¨.
£À˘_øã
 + 1);

203 
	ghigh
 - 
	glow
 >
Succö˘Ve˘‹
::
SHORT_RANGE
)

205 
usöt
 
mid
 = 
low
 + (
high
 -Üow) / 2;

206 
usöt
 
	gvÆ
 = 
ønk_ödex
.
ªadIãm
(
mid
);

207 if(
	gvÆ
 > 
	gödex
Ë{ 
	ghigh
 = 
mid
 - 1; }

208 { 
	glow
 = 
mid
; }

212 
usöt
 
	glimô
 = 
ønk_ödex
.
ªadIãm
(
low
 + 1);

213 
	glimô
 <
ödex
;

214 
	glimô
 = 
ønk_ödex
.
ªadIãm
(), 
	glow
++);

219 c⁄° 
usöt
* 
	gd©a
 = 
∑r
.
¨øy
 + 
low
 *Ö¨.
block_size
;

220 
usöt
 
	gªsu…
 = 
low
 * 
∑r
.
block_size
 * 
WORD_BITS
;

221 
	gthis
->
	gcur
 = 
ønk_ödex
.
ªadIãm
(
low
);

222 
usöt
 
	gcou¡
 = 
p›cou¡
(*
d©a
); 
	gthis
->
	gcur
 + cou¡ <
ödex
; count =Öopcount(*data))

224 ++
d©a
; 
	gªsu…
 +
WORD_BITS
; 
	gthis
->
	gcur
 +
cou¡
;

226 
usöt
 
	gbô
 = (usöt)1 << (
WORD_BITS
 - 1); 
	gthis
->
	gcur
 <
ödex
; bit >>= 1)

228 
ªsu…
++; if(*
	gd©a
 & 
	gbô
Ë{ 
	gthis
->
	gcur
++; }

231 
	gthis
->
	gcur
--;

232  
	gªsu…
 - 1;

235 
usöt


236 
	gSuccö˘Ve˘‹
::
Iãøt‹
::
£À˘Next
()

238  
this
->
£À˘
—his->
cur
 + 1);

241 
∑ú_ty≥


242 
	gSuccö˘Ve˘‹
::
Iãøt‹
::
£À˘Run
(
usöt
 
ödex
, usöà
max_Àngth
)

244  
∑ú_ty≥
(
this
->
£À˘
(
ödex
), 0);

247 
∑ú_ty≥


248 
	gSuccö˘Ve˘‹
::
Iãøt‹
::
£À˘NextRun
(
usöt
 
max_Àngth
)

250  
∑ú_ty≥
(
this
->
£À˘
—his->
cur
 + 1), 0);

253 
∑ú_ty≥


254 
	gSuccö˘Ve˘‹
::
Iãøt‹
::
vÆueBef‹e
(
usöt
 
vÆue
)

256 c⁄° 
Succö˘Ve˘‹
& 
∑r
 = (c⁄° Succö˘Ve˘‹&)(
this
->
∑ª¡
);

257 if(
	gvÆue
 >
∑r
.
size
Ë{  
∑ú_ty≥
’¨.size,Ö¨.
ôems
); }

259 
usöt
 
	gãmp
 = 
this
->
ønk
(
vÆue
);

260 if(
	gãmp
 =0Ë{  
∑ú_ty≥
(
∑r
.
size
,Ö¨.
ôems
); }

261  
∑ú_ty≥
(
this
->
£À˘
(
ãmp
 - 1),Åemp - 1);

264 
∑ú_ty≥


265 
	gSuccö˘Ve˘‹
::
Iãøt‹
::
vÆueA·î
(
usöt
 
vÆue
)

267 c⁄° 
Succö˘Ve˘‹
& 
∑r
 = (c⁄° Succö˘Ve˘‹&)(
this
->
∑ª¡
);

268 if(
	gvÆue
 >
∑r
.
size
Ë{  
∑ú_ty≥
’¨.size,Ö¨.
ôems
); }

270 if(
	gvÆue
 =0Ë{  
∑ú_ty≥
(
this
->
£À˘
(0), 0); }

271 
usöt
 
	gãmp
 = 
this
->
ønk
(
vÆue
 - 1);

272  
∑ú_ty≥
(
this
->
£À˘
(
ãmp
),Åemp);

275 
∑ú_ty≥


276 
	gSuccö˘Ve˘‹
::
Iãøt‹
::
√xtVÆue
()

278 
usöt
 
ãmp
 = 
this
->
cur
 + 1;

279  
∑ú_ty≥
(
this
->
£À˘
(
ãmp
),Åemp);

282 
boﬁ


283 
	gSuccö˘Ve˘‹
::
Iãøt‹
::
isSë
(
usöt
 
vÆue
)

285 c⁄° 
Succö˘Ve˘‹
& 
∑r
 = (c⁄° Succö˘Ve˘‹&)(
this
->
∑ª¡
);

286 if(
	gvÆue
 >
∑r
.
size
Ë{  
Ál£
; }

287  (
	g∑r
.
	g¨øy
[
vÆue
 / 
WORD_BITS
] & ((
	gusöt
)1 << (
	gWORD_BITS
 - 
	gvÆue
 % WORD_BITS - 1)));

290 
usöt


291 
	gSuccö˘Ve˘‹
::
Iãøt‹
::
cou¡Runs
()

293 
usöt
 
runs
 = 0;

294 
usöt
 
	g¥ev
 = 
this
->
£À˘
(0);

295 
	gthis
->
hasNext
())

297 
usöt
 
	gãmp
 = 
this
->
£À˘Next
();

298 if(
	gãmp
 !
¥ev
 + 1Ë{ 
runs
++; }

299 
	g¥ev
 = 
ãmp
;

301  
	gruns
;

306 
	gSuccö˘Encodî
::
Succö˘Encodî
(
usöt
 
block_byãs
, usöà
su≥rblock_size
) :

307 
Ve˘‹Encodî
(
block_byãs
, 
su≥rblock_size
, 
Ál£
)

311 
	gSuccö˘Encodî
::~
Succö˘Encodî
()

316 
Succö˘Encodî
::
£tBô
(
usöt
 
vÆue
)

319 if(
vÆue
 < 
this
->
¨øy_blocks
.
size
(Ë*Åhis->
su≥rblock_byãs
 * 
CHAR_BIT
) { ; }

320 
	gthis
->
	gsize
 = 
°d
::
max
(
this
->
size
, 
vÆue
 + 1);

322 
	gvÆue
 -
this
->
¨øy_blocks
.
size
(Ë*Åhis->
su≥rblock_byãs
 * 
CHAR_BIT
;

323 
	gvÆue
 >
this
->
su≥rblock_byãs
 * 
CHAR_BIT
)

325 
this
->
addNewBlock
();

326 
	gvÆue
 -
this
->
su≥rblock_byãs
 * 
CHAR_BIT
;

329 if(!(
	gthis
->
	gbuf„r
->
isSë
(
vÆue
))Ë{Åhis->
	gôems
++; }

330 
	gthis
->
	gbuf„r
->
£tBô
(
vÆue
);

334 
	gSuccö˘Encodî
::
£tRun
(
usöt
 
°¨t
, usöà
Àn
)

336 
usöt
 
	gi
 = 
°¨t
; i < 
	g°¨t
 + 
	gÀn
; i++Ë{ 
	gthis
->
£tBô
(
i
); }

340 
	gSuccö˘Encodî
::
addBô
(
usöt
 
vÆue
)

342 
this
->
£tBô
(
vÆue
);

346 
	gSuccö˘Encodî
::
addRun
(
usöt
 
°¨t
, usöà
Àn
)

348 
	gthis
->
£tRun
(
°¨t
, 
Àn
);

352 
	gSuccö˘Encodî
::
Êush
()

	@bits/succinctvector.h

1 #i‚de‡
_RLCSA_SUCCINCTVECTOR_H


2 
	#_RLCSA_SUCCINCTVECTOR_H


	)

4 
	~<f°ªam
>

6 
	~"bôve˘‹.h
"

9 
«me•a˚
 
	gCSA


19 ˛as†
	cSuccö˘Encodî
 : 
public
 
Ve˘‹Encodî


21 
public
:

22 
Succö˘Encodî
(
usöt
 
block_byãs
, usöà
su≥rblock_size
 = 
Ve˘‹Encodî
::
SUPERBLOCK_SIZE
);

23 ~
Succö˘Encodî
();

25 
£tBô
(
usöt
 
vÆue
);

26 
£tRun
(
usöt
 
°¨t
, usöà
Àn
);

28 
addBô
(
usöt
 
vÆue
);

29 
addRun
(
usöt
 
°¨t
, usöà
Àn
);

30 
Êush
();

32 
	g¥Ÿe˘ed
:

35 
Succö˘Encodî
();

36 
Succö˘Encodî
(const SuccinctEncoder&);

37 
	gSuccö˘Encodî
& 
	g›î©‹
 = (c⁄° 
Succö˘Encodî
&);

45 ˛as†
	cSuccö˘Ve˘‹
 : 
public
 
BôVe˘‹


47 
public
:

48 c⁄° 
usöt
 
SHORT_RANGE
 = 16;

50 
Succö˘Encodî
 
	tEncodî
;

52 
ex∂icô
 
Succö˘Ve˘‹
(
°d
::
if°ªam
& 
fûe
);

53 
ex∂icô
 
Succö˘Ve˘‹
(
FILE
* 
fûe
);

54 
Succö˘Ve˘‹
(
Encodî
& 
ícodî
, 
usöt
 
univî£_size
);

55 
ex∂icô
 
Succö˘Ve˘‹
(
Encodî
& 
ícodî
);

57 ~
Succö˘Ve˘‹
();

61 
wrôeTo
(
°d
::
of°ªam
& 
fûe
) const;

62 
wrôeTo
(
FILE
* 
fûe
) const;

63 
usöt
 
ªp‹tSize
() const;

67 
°rù
() {}

71 ˛as†
	cIãøt‹


73 
	gpublic
:

74 
ex∂icô
 
Iãøt‹
(c⁄° 
Succö˘Ve˘‹
& 
∑r
);

75 ~
Iãøt‹
();

77 
usöt
 
ønk
(usöà
vÆue
, 
boﬁ
 
©_Àa°
 = 
Ál£
);

79 
usöt
 
£À˘
(usöà
ödex
);

80 
usöt
 
£À˘Next
();

81 
ölöe
 
boﬁ
 
hasNext
(Ëc⁄° {  (
	gthis
->
	gcur
 <Åhis->
	g∑ª¡
.
	gôems
 - 1); }

83 
∑ú_ty≥
 
vÆueBef‹e
(
usöt
 
vÆue
);

84 
∑ú_ty≥
 
vÆueA·î
(
usöt
 
vÆue
);

85 
∑ú_ty≥
 
√xtVÆue
();

87 
∑ú_ty≥
 
£À˘Run
(
usöt
 
ödex
, usöà
max_Àngth
);

88 
∑ú_ty≥
 
£À˘NextRun
(
usöt
 
max_Àngth
);

90 
boﬁ
 
isSë
(
usöt
 
vÆue
);

92 
usöt
 
cou¡Runs
();

94 
	g¥Ÿe˘ed
:

95 c⁄° 
Succö˘Ve˘‹
& 
∑ª¡
;

96 
usöt
 
	gcur
;

99 
Iãøt‹
();

100 
Iãøt‹
(const Iterator&);

101 
	gIãøt‹
& 
	g›î©‹
 = (c⁄° 
Iãøt‹
&);

106 
	g¥Ÿe˘ed
:

109 
ödexF‹R™k
();

112 
ödexF‹Sñe˘
();

115 
Succö˘Ve˘‹
();

116 
Succö˘Ve˘‹
(const SuccinctVector&);

117 
	gSuccö˘Ve˘‹
& 
	g›î©‹
 = (c⁄° 
Succö˘Ve˘‹
&);

	@bits/vectors.h

1 #i‚de‡
VECTORS_H


2 
	#VECTORS_H


	)

5 
	~<Æg‹ôhm
>

7 
	~"bôve˘‹.h
"

10 
«me•a˚
 
	gCSA


20 
	gãm∂©e
<
˛ass
 
	gV
>

21 
V
*

22 
mîgeVe˘‹s
(
V
* 
fú°
, V* 
£c⁄d
, 
usöt
* 
posôi⁄s
, usöà
n
, usöà
size
, usöà
block_size
)

24 if((
	gfú°
 =0 && 
£c⁄d
 =0Ë|| 
posôi⁄s
 == 0) {  0; }

26 
ty≥«me
 
	gV
::
Iãøt‹
* 
fú°_ôî
 = 0;

27 
ty≥«me
 
	gV
::
Iãøt‹
* 
£c⁄d_ôî
 = 0;

29 
∑ú_ty≥
 
	gfú°_run
;

30 
boﬁ
 
	gfú°_föished
;

31 if(
	gfú°
 == 0)

33 
fú°_run
 = 
∑ú_ty≥
(
size
, 0);

34 
	gfú°_föished
 = 
åue
;

38 
	gfú°_ôî
 = 
√w
 
ty≥«me
 
V
::
Iãøt‹
(*
fú°
);

39 
	gfú°_run
 = 
fú°_ôî
->
£À˘Run
(0, 
size
);

40 
	gfú°_run
.
	g£c⁄d
++;

41 
	gfú°_föished
 = 
Ál£
;

44 
usöt
 
	g£c⁄d_bô
;

45 if(
	g£c⁄d
 == 0)

47 
£c⁄d_bô
 = 
n
;

51 
	g£c⁄d_ôî
 = 
√w
 
ty≥«me
 
V
::
Iãøt‹
(*
£c⁄d
);

52 
	g£c⁄d_bô
 = 
£c⁄d_ôî
->
£À˘
(0);

55 
ty≥«me
 
	gV
::
Encodî
 
ícodî
(
block_size
);

56 
usöt
 
	gi
 = 0; i < 
	gn
; i++)

58 !
	gfú°_föished
 && 
	gfú°_run
.
	gfú°
 + 
	gi
 < 
	gposôi⁄s
[
i
])

60 
usöt
 
	gbôs
 = 
°d
::
mö
(
fú°_run
.
£c⁄d
, 
posôi⁄s
[
i
] - i - fú°_run.
fú°
);

61 
	gícodî
.
addRun
(
fú°_run
.
fú°
 + 
i
, 
bôs
);

62 
	gfú°_run
.
	gfú°
 +
bôs
;

63 
	gfú°_run
.
	g£c⁄d
 -
bôs
;

64 if(
	gfú°_run
.
	g£c⁄d
 == 0)

66 if(
fú°_ôî
->
hasNext
())

68 
fú°_run
 = 
fú°_ôî
->
£À˘NextRun
(
size
);

69 
	gfú°_run
.
	g£c⁄d
++;

71 { 
	gfú°_föished
 = 
åue
; }

75 if(
	gi
 =
£c⁄d_bô
)

77 
ícodî
.
addBô
(
posôi⁄s
[
i
]);

78 
	g£c⁄d_bô
 = 
£c⁄d_ôî
->
£À˘Next
();

82 !
	gfú°_föished
)

84 
	gícodî
.
addRun
(
fú°_run
.
fú°
 + 
n
, fú°_run.
£c⁄d
);

85 if(
	gfú°_ôî
->
hasNext
())

87 
	gfú°_run
 = 
fú°_ôî
->
£À˘NextRun
(
size
);

88 
	gfú°_run
.
	g£c⁄d
++;

90 { 
	gfú°_föished
 = 
åue
; }

93 
dñëe
 
	gfú°_ôî
; dñëê
	g£c⁄d_ôî
;

94 
dñëe
 
	gfú°
; dñëê
	g£c⁄d
;

95 
	gícodî
.
Êush
();

96  
√w
 
V
(
ícodî
, 
size
);

106 
	gãm∂©e
<
˛ass
 
	gV
>

107 
V
*

108 
ícode
(c⁄° 
RódBuf„r
& 
buf„r
, 
usöt
 
block_size
, usöà
n
)

110 
usöt
 
	g⁄ebôs
 = 0;

111 
ty≥«me
 
	gV
::
Encodî
 
ícodî
(
block_size
);

112 
usöt
 
	gi
 = 0; i < 
	gn
; i++)

114 if(
	gbuf„r
.
isSë
(
i
)Ë{ 
	gícodî
.
addBô
(i); 
	g⁄ebôs
++; }

116 
	gícodî
.
Êush
();

118 if(
	g⁄ebôs
 == 0) {  0; }

119  
√w
 
V
(
ícodî
, 
n
);

	@build_plcp.cpp

1 
	~<c°dlib
>

2 
	~<f°ªam
>

3 
	~<io°ªam
>

5 
	~"æcß.h
"

8 
usög
 
«me•a˚
 
	gCSA
;

17 
	$maö
(
¨gc
, ** 
¨gv
)

19 
°d
::
cout
 << "PLCP buûdî" << std::
ídl
;

20 if(
¨gc
 < 2)

22 
°d
::
cout
 << "Ußge: buûd_∂˝ ba£_«mê[block_size]" << std::
ídl
;

26 
°d
::
°rög
 
ba£_«me
 = 
¨gv
[1];

27 
°d
::
°rög
 
∂˝_«me
 = 
ba£_«me
 + 
PLCP_EXTENSION
;

28 
°d
::
cout
 << "PLCP: " << 
∂˝_«me
 << std::
ídl
;

29 
°d
::
of°ªam
 
	`∂˝_fûe
(
∂˝_«me
.
	`c_°r
(), std::
ios_ba£
::
bö¨y
);

30 if(!
∂˝_fûe
)

32 
°d
::
˚º
 << "Eº‹ cª©ög PLCP fûe!" << std::
ídl
;

36 
usöt
 
block_size
 = 32;

37 if(
¨gc
 > 2Ë{ 
block_size
 = 
	`©oi
(
¨gv
[2]); }

38 
°d
::
cout
 << "Block size: " << 
block_size
 << std::
ídl
;

39 
°d
::
cout
 << std::
ídl
;

40 
RLCSA
 
	`æcß
(
ba£_«me
);

42 
˛ock_t
 
°¨t
 = 
	`˛ock
();

43 
PLCPVe˘‹
* 
∂˝
 = 
æcß
.
	`buûdPLCP
(
block_size
);

44 
∂˝
->
	`wrôeTo
(
∂˝_fûe
);

45 
˛ock_t
 
°›
 = 
	`˛ock
();

47 
time
 = ((
°›
 - 
°¨t
Ë/ ()
CLOCKS_PER_SEC
);

48 
megabyãs
 = 
æcß
.
	`gëSize
(Ë/ ()
MEGABYTE
;

49 
size
 = 
∂˝
->
	`ªp‹tSize
(Ë/ ()
MEGABYTE
;

50 
PLCPVe˘‹
::
Iãøt‹
 
	`ôî
(*
∂˝
);

51 
usöt
 
runs
 = 
ôî
.
	`cou¡Runs
();

53 
°d
::
cout
 << 
megabyãs
 << " megabyã†ö " << 
time
 << " sec⁄d†(" << (megabyã†/ÅimeË<< " MB/s)" << std::
ídl
;

54 
°d
::
cout
 << "PLCP size: " << 
size
 << " MB" << std::
ídl
;

55 
°d
::
cout
 << "Runs: " << 
runs
 << std::
ídl
;

56 
°d
::
cout
 << std::
ídl
;

58 
∂˝_fûe
.
	`˛o£
();

59 
dñëe
 
∂˝
;

62 
	}
}

	@build_rlcsa.cpp

1 
	~<Æg‹ôhm
>

2 
	~<c°dlib
>

3 
	~<f°ªam
>

4 
	~<io°ªam
>

6 
	~"æcß_buûdî.h
"

9 
usög
 
«me•a˚
 
	gCSA
;

13 c⁄° 
	gMAX_THREADS
 = 64;

17 
	$maö
(
¨gc
, ** 
¨gv
)

19 
°d
::
cout
 << "RLCSA buûdî" << std::
ídl
;

20 if(
¨gc
 < 2)

22 
°d
::
cout
 << "Ußge: buûd_æcß ba£_«mê[thªads]" << std::
ídl
;

26 
°d
::
°rög
 
ba£_«me
 = 
¨gv
[1];

27 
thªads
 = 1;

28 if(
¨gc
 > 2)

30 
thªads
 = 
°d
::
	`max
—hªads, 
	`©oi
(
¨gv
[2]));

31 
thªads
 = 
°d
::
	`mö
—hªads, 
MAX_THREADS
);

33 
°d
::
cout
 << "Ba£Çame: " << 
ba£_«me
 << std::
ídl
;

34 
°d
::
cout
 << "Thªads: " << 
thªads
 << std::
ídl
;

35 
°d
::
cout
 << std::
ídl
;

37 
°d
::
°rög
 
∑ømëîs_«me
 = 
ba£_«me
 + 
PARAMETERS_EXTENSION
;

38 
P¨amëîs
 
∑ømëîs
;

39 
∑ømëîs
.
	`£t
(
RLCSA_BLOCK_SIZE
);

40 
∑ømëîs
.
	`£t
(
SAMPLE_RATE
);

41 
∑ømëîs
.
	`£t
(
SUPPORT_LOCATE
);

42 
∑ømëîs
.
	`£t
(
SUPPORT_DISPLAY
);

43 
∑ømëîs
.
	`£t
(
WEIGHTED_SAMPLES
);

44 
∑ømëîs
.
	`ªad
(
∑ømëîs_«me
);

45 
∑ømëîs
.
	`¥öt
();

47 
°¨t
 = 
	`ªadTimî
();

48 
°d
::
if°ªam
 
	`öput
(
ba£_«me
.
	`c_°r
(), std::
ios_ba£
::
bö¨y
);

49 if(!
öput
)

51 
°d
::
˚º
 << "Eº‹ o≥nög i≈uàfûê" << 
ba£_«me
 << "!" << std::
ídl
;

54 
usöt
 
size
 = 
	`fûeSize
(
öput
);

55 if(
size
 <= 0)

57 
°d
::
˚º
 << "Eº‹: I≈uàfûêi†em±y!" << std::
ídl
;

58 
öput
.
	`˛o£
();

61 
uch¨
* 
d©a
 = 
√w
 uch¨[
size
];

62 
öput
.
	`ªad
((*)
d©a
, 
size
);

63 
öput
.
	`˛o£
();

65 
RLCSA
 
	`æcß
(
d©a
, 
size
, 
∑ømëîs
.
	`gë
(
RLCSA_BLOCK_SIZE
),Ö¨amëîs.gë(
SAMPLE_RATE
), 
thªads
, 
åue
);

66 
d©a
 = 0;

67 if(!(
æcß
.
	`isOk
())) {  4; }

68 
æcß
.
	`¥ötInfo
();

69 
æcß
.
	`ªp‹tSize
(
åue
);

70 
æcß
.
	`wrôeTo
(
ba£_«me
);

71 
tŸÆ
 = 
	`ªadTimî
(Ë- 
°¨t
;

73 
megabyãs
 = 
size
 / ()
MEGABYTE
;

74 
°d
::
cout
 << "Indexed " << 
megabyãs
 << " megabyã†ö " << 
tŸÆ
 << " sec⁄d†(" << (megabyã†/ÅŸÆË<< " MB/s)." << std::
ídl
;

75 
°d
::
cout
 << "Mem‹y: " << 
	`mem‹yUßge
(Ë<< " kB" << std::
ídl
;

76 
°d
::
cout
 << std::
ídl
;

79 
	}
}

	@build_sa.cpp

1 
	~<io°ªam
>

3 
	~"suffix¨øy.h
"

4 
	~"misc/utûs.h
"

7 
usög
 
«me•a˚
 
	gCSA
;

11 
	$maö
(
¨gc
, ** 
¨gv
)

13 
°d
::
cout
 << "Suffixáºay buûdî" << std::
ídl
;

14 if(
¨gc
 < 2)

16 
°d
::
cout
 << "Ußge: buûd_ß ba£_«me" << std::
ídl
;

20 
°d
::
°rög
 
ba£_«me
 = 
¨gv
[1];

21 
°d
::
cout
 << "I≈ut: " << 
ba£_«me
 << std::
ídl
;

22 
°d
::
cout
 << std::
ídl
;

24 
°d
::
if°ªam
 
	`öput
(
ba£_«me
.
	`c_°r
(), std::
ios_ba£
::
bö¨y
);

25 if(!
öput
)

27 
°d
::
˚º
 << "Eº‹: C™nŸ o≥¿öpuàfûe!" << std::
ídl
;

30 
usöt
 
byãs
 = 
	`fûeSize
(
öput
);

31 
uch¨
* 
d©a
 = 
√w
 uch¨[
byãs
];

32 
öput
.
	`ªad
((*)
d©a
, 
byãs
);

33 
öput
.
	`˛o£
();

35 
°¨t
 = 
	`ªadTimî
();

36 
SuffixAºay
 
	`ß
(
d©a
, 
byãs
);

37 if(!
ß
.
	`isOk
()) {  3; }

38 
time
 = 
	`ªadTimî
(Ë- 
°¨t
;

39 
megabyãs
 = 
byãs
 / ()
MEGABYTE
;

40 
°d
::
cout
 << "Indexed " << 
megabyãs
 << " megabyã†ö " << 
time
 << " sec⁄d†(" << (megabyã†/ÅimeË<< " MB/s)." << std::
ídl
;

41 
°d
::
cout
 << "Mem‹y: " << 
	`mem‹yUßge
(Ë<< " kB" << std::
ídl
;

42 
°d
::
cout
 << std::
ídl
;

44 
ß
.
	`wrôeTo
(
ba£_«me
);

46 
	}
}

	@display_test.cpp

1 
	~<Æg‹ôhm
>

2 
	~<c°dlib
>

3 
	~<f°ªam
>

4 
	~<io°ªam
>

6 
	~"æcß.h
"

7 
	~"ßm∂î.h
"

8 
	~"misc/utûs.h
"

11 
usög
 
«me•a˚
 
	gCSA
;

14 
usöt
*

15 
gíî©ePosôi⁄s
(
weight_ty≥
* 
weights
, 
usöt
 
size
, usöà
numbî
);

17 
	$maö
(
¨gc
, ** 
¨gv
)

19 
°d
::
cout
 << "RLCSA di•œyÅe°" << std::
ídl
;

20 if(
¨gc
 < 5)

22 
°d
::
cout
 << "Ußge: di•œy_ã° ba£«mêweight†£quí˚†Àngth [øndom_£ed]" << std::
ídl
;

25 
°d
::
cout
 << std::
ídl
;

27 
°d
::
cout
 << "Ba£Çame: " << 
¨gv
[1] << std::
ídl
;

28 
°d
::
cout
 << "Weights: " << 
¨gv
[2] << std::
ídl
;

30 
usöt
 
£quí˚s
 = 
°d
::
	`max
(
	`©oi
(
¨gv
[3]), 1);

31 
°d
::
cout
 << "Sequí˚s: " << 
£quí˚s
 << std::
ídl
;

33 
usöt
 
£q_Àngth
 = 
°d
::
	`max
(
	`©oi
(
¨gv
[4]), 1);

34 
°d
::
cout
 << "Sequí˚Üígth: " << 
£q_Àngth
 << std::
ídl
;

36 
usöt
 
£ed
 = 0xDEADBEEF;

37 if(
¨gc
 > 5)

39 
£ed
 = 
	`©oi
(
¨gv
[5]);

41 
°d
::
cout
 << "R™dom sìd: " << 
£ed
 << std::
ídl
;

42 
°d
::
cout
 << std::
ídl
;

44 
RLCSA
 
	`æcß
(
¨gv
[1]);

45 if(!
æcß
.
	`isOk
(Ë|| !æcß.
	`suµ‹tsDi•œy
())

47 
°d
::
˚º
 << "Eº‹: Di•œy i†nŸ suµ‹ãd!" << std::
ídl
;

50 
æcß
.
	`¥ötInfo
();

51 
æcß
.
	`ªp‹tSize
(
åue
);

52 
usöt
 
size
 = 
æcß
.
	`gëSize
();

56 
weight_ty≥
* 
weights
 = 
√w
 weight_ty≥[
size
];

57 
°d
::
if°ªam
 
	`weight_fûe
(
¨gv
[2], std::
ios_ba£
::
bö¨y
);

58 if(!
weight_fûe
)

60 
°d
::
˚º
 << "Eº‹: C™nŸ o≥¿weighàfûe!" << std::
ídl
;

61 
dñëe
[] 
weights
;

64 
weight_fûe
.
	`ªad
((*)
weights
, 
size
 * (
weight_ty≥
));

65 
weight_fûe
.
	`˛o£
();

66 
	`§™d
(
£ed
);

67 
usöt
* 
posôi⁄s
 = 
	`gíî©ePosôi⁄s
(
weights
, 
size
, 
£quí˚s
);

68 
dñëe
[] 
weights
;

69 
°d
::
cout
 << "Gíî©ed " << 
£quí˚s
 << "Öosôi⁄s." << std::
ídl
;

70 
°d
::
cout
 << std::
ídl
;

74 
uch¨
* 
buf„r
 = 
√w
 uch¨[
£q_Àngth
];

75 
°¨t
 = 
	`ªadTimî
();

76 
usöt
 
i
 = 0; i < 
£quí˚s
; i++)

78 
æcß
.
	`di•œy
(0, 
	`∑ú_ty≥
(
posôi⁄s
[
i
],Öosôi⁄s[i] + 
£q_Àngth
 - 1), 
buf„r
);

80 
time
 = 
	`ªadTimî
(Ë- 
°¨t
;

81 
°d
::
cout
 << "TŸÆÅime: " << 
time
 << " sec⁄ds." << std::
ídl
;

82 
°d
::
cout
 << std::
ídl
;

85 
dñëe
[] 
buf„r
;

86 
dñëe
[] 
posôi⁄s
;

88 
	}
}

91 
usöt
*

92 
	$gíî©ePosôi⁄s
(
weight_ty≥
* 
weights
, 
usöt
 
size
, usöà
numbî
)

94 
DñèEncodî
 
	`weight_ícodî
(2 * (
usöt
));

95 
DñèEncodî
 
	`pos_ícodî
(2 * (
usöt
));

96 
usöt
 
sum
 = 0;

97 
usöt
 
i
 = 0; i < 
size
; i++)

99 if(
weights
[
i
] > 0)

101 
sum
 +
weights
[
i
];

102 
weight_ícodî
.
	`addBô
(
sum
);

103 
pos_ícodî
.
	`addBô
(
i
);

106 
weight_ícodî
.
	`Êush
();

107 
pos_ícodî
.
	`Êush
();

108 
DñèVe˘‹
 
	`weight_ve˘‹
(
weight_ícodî
, 
sum
);

109 
DñèVe˘‹
 
	`pos_ve˘‹
(
pos_ícodî
, 
size
);

111 
usöt
* 
ªsu…
 = 
√w
 usöt[
numbî
];

112 
DñèVe˘‹
::
Iãøt‹
 
	`weight_ôî
(
weight_ve˘‹
);

113 
DñèVe˘‹
::
Iãøt‹
 
	`pos_ôî
(
pos_ve˘‹
);

114 
usöt
 
i
 = 0; i < 
numbî
; i++)

116 
ªsu…
[
i
] = 
pos_ôî
.
	`£À˘
(
weight_ôî
.
	`ønk
(
	`ønd
(Ë% 
sum
));

119  
ªsu…
;

120 
	}
}

	@docarray.cpp

1 
	~<Æg‹ôhm
>

2 
	~<c˘y≥
>

3 
	~<c°dlib
>

4 
	~<f°ªam
>

5 
	~<io°ªam
>

6 
	~<s°ªam
>

7 
	~<ve˘‹
>

9 
	~"doˇºay.h
"

10 
	~"misc/utûs.h
"

13 
«me•a˚
 
	gCSA


18 
	gSTNode
::
STNode
(
uöt
 
l˝
, 
∑ú_ty≥
 
ß_ønge
) :

19 
°rög_dïth
(
l˝
), 
ønge
(
ß_ønge
),

20 
∑ª¡
(0), 
chûd
(0), 
siblög
(0), 
√xt
(0),

21 
°‹ed_documíts
(0), 
id
(0), 
c⁄èös_Æl
(
Ál£
),

22 
docs
(0)

26 
	gSTNode
::~
STNode
()

28 
this
->
∑ª¡
 = 0;

29 
dñëe
 
	gthis
->
	gdocs
;Åhis->docs = 0;

30 
dñëe
 
	gthis
->
	gchûd
;Åhis->child = 0;

31 
	gthis
->
	gsiblög
 != 0)

33 
STNode
* 
ãmp
 = 
this
->
siblög
; 
	gthis
->
	gsiblög
 =Åhis->sibling->sibling;

34 
	gãmp
->
	gsiblög
 = 0; 
dñëe
Åemp;

39 
	gSTNode
::
addChûd
(
STNode
* 
node
)

41 
node
->
∑ª¡
 = 
this
;

42 if(
	gthis
->
	gchûd
 =0Ë{ 
this
->
chûd
 = 
node
; ; }

43 
	gthis
->
	gchûd
->
addSiblög
(
node
);

47 
	gSTNode
::
addSiblög
(
STNode
* 
node
)

49 if(
this
->
siblög
 =0Ë{Åhis->siblög = 
node
; ; }

50 
	gthis
->
	gsiblög
->
addSiblög
(
node
);

54 
	gSTNode
::
dñëeChûdªn
()

56 
dñëe
 
this
->
chûd
; 
	gthis
->
	gchûd
 = 0;

60 
	gSTNode
::
addLóves
()

62 
°d
::
°ack
<
STNode
*> 
node°ack
;

63 
	gnode°ack
.
push
(
this
);

65 !(
	gnode°ack
.
em±y
()))

67 
STNode
* 
	gcuº
 = 
node°ack
.
t›
(); 
	gnode°ack
.
p›
();

68 if(
	gcuº
->
	gchûd
 == 0) { ; }

69 
usöt
 
	gex≥˘
 = 
cuº
->
ønge
.
fú°
;

70 
STNode
* 
	g¥ev
 = 0;

71 
STNode
* 
	gãmp
 = 
cuº
->
chûd
;Åem∞!0;Åem∞
ãmp
->
siblög
)

73 
ex≥˘
 < 
ãmp
->
ønge
.
fú°
Ë{ 
¥ev
 = 
cuº
->
addLóf
’ªv,Åemp,Éx≥˘); 
	gex≥˘
++; }

74 
	gnode°ack
.
push
(
ãmp
);

75 
	gex≥˘
 = 
ãmp
->
ønge
.
£c⁄d
 + 1;

76 
	g¥ev
 = 
ãmp
;

78 
	gex≥˘
 < 
	gcuº
->
	gønge
.
	g£c⁄d
 + 1Ë{ 
	g¥ev
 = 
cuº
->
addLóf
(
¥ev
, 0, 
ex≥˘
);Éxpect++; }

82 
STNode
*

83 
	gSTNode
::
addLóf
(
STNode
* 
À·
, STNode* 
right
, 
usöt
 
pos
)

85 
STNode
* 
	gÀaf
 = 
√w
 STNode(0, 
∑ú_ty≥
(
pos
,Öos));

86 
	gÀaf
->
	g∑ª¡
 = 
this
;

87 if(
	gÀ·
 =0Ë{ 
this
->
chûd
 = 
Àaf
; }

88 { 
	gÀ·
->
	gsiblög
 = 
Àaf
; }

89 
	gÀaf
->
	gsiblög
 = 
right
;

90  
	gÀaf
;

93 
boﬁ


94 
	gSTNode
::
vîifyTªe
()

96 
°d
::
°ack
<
STNode
*> 
node°ack
;

97 
	gnode°ack
.
push
(
this
);

99 !(
	gnode°ack
.
em±y
()))

101 
STNode
* 
	gcuº
 = 
node°ack
.
t›
(); 
	gnode°ack
.
p›
();

102 if(
	gcuº
->
	gchûd
 == 0) { ; }

103 
usöt
 
	gex≥˘
 = 
cuº
->
ønge
.
fú°
, 
	gœ°
 = 0;

104 
STNode
* 
	gãmp
 = 
cuº
->
chûd
;Åem∞!0;Åem∞
ãmp
->
siblög
)

106 if(
ãmp
->
ønge
.
fú°
 !
ex≥˘
)

108 
°d
::
˚º
 << "Eº‹:Çodê" << *
cuº
 << ",Éx≥˘ed " << 
ex≥˘
 << ", gŸ " << *
ãmp
 << std::
ídl
;

109 
	g°d
::
˚º
 << "Children:";

110 
	gãmp
 = 
cuº
->
chûd
;Åem∞!0;Åem∞
ãmp
->
siblög
Ë{ 
°d
::
˚º
 << " " << *temp; }

111 
	g°d
::
˚º
 << 
°d
::
ídl
;

112 if(
	gcuº
->
	g∑ª¡
Ë{ 
	g°d
::
˚º
 << "P¨ít: " << *(
cuº
->
∑ª¡
Ë<< 
°d
::
ídl
; }

113  
	gÁl£
;

115 
	gnode°ack
.
push
(
ãmp
);

116 
	gex≥˘
 = 
ãmp
->
ønge
.
£c⁄d
 + 1;

117 
	gœ°
 = 
ãmp
->
ønge
.
£c⁄d
;

119 if(
	gœ°
 !
cuº
->
ønge
.
£c⁄d
)

121 
°d
::
˚º
 << "Eº‹:Çodê" << *
cuº
 << ", chûdª¿ídáà" << 
œ°
 << std::
ídl
;

122  
	gÁl£
;

126  
	gåue
;

130 
	gSTNode
::
ªmove
()

132 if(
this
->
chûd
 =0 ||Åhis->
∑ª¡
 == 0) { ; }

134 
STNode
* 
	gcuº
;

135 
	gcuº
 = 
this
->
chûd
; cuº !0; cuº = 
cuº
->
siblög
Ë{ cuº->
∑ª¡
 =Åhis->parent; }

136 if(
	gthis
 =
this
->
∑ª¡
->
chûd
) {Åhis->parent->child =Åhis->child; }

139 
	gcuº
 = 
this
->
∑ª¡
->
chûd
; cuº->
	gsiblög
 !this; cuº = 
cuº
->
siblög
);

140 
	gcuº
->
	gsiblög
 = 
this
->
chûd
;

142 
	gcuº
 = 
this
->
chûd
; cuº->
	gsiblög
 !0; cuº = 
cuº
->
siblög
);

143 
	gcuº
->
	gsiblög
 = 
this
->
siblög
;

145 
	gthis
->
	g∑ª¡
 = 
this
->
chûd
 =Åhis->
siblög
 = 0;

149 
	gSTNode
::
dëîmöeSize
(
uöt
& 
nodes
, uöt& 
Àaves
)

151 
	gnodes
 = 0; 
	gÀaves
 = 0;

152 
	g°d
::
°ack
<
STNode
*> 
node°ack
;

153 
	gnode°ack
.
push
(
this
);

155 !(
	gnode°ack
.
em±y
()))

157 
STNode
* 
	gcuº
 = 
node°ack
.
t›
(); 
	gnode°ack
.
p›
(); 
	gnodes
++;

158 if(
	gcuº
->
	gchûd
 =0Ë{ 
Àaves
++; }

159 
STNode
* 
	gãmp
 = 
cuº
->
chûd
;Åem∞!0;Åem∞
ãmp
->
siblög
Ë{ 
node°ack
.
push
(temp); }

164 
	gSTNode
::
compuãSt‹edDocumíts
(
usöt
* 
documíts
)

166 
this
->
°‹ed_documíts
 = 0;

167 
dñëe
 
	gthis
->
	gdocs
;Åhis->docs = 0;

168 if(
	gthis
->
	gchûd
 == 0)

170 
this
->
docs
 = 
√w
 
°d
::
ve˘‹
<
uöt
>(
documíts
 +Åhis->
ønge
.
fú°
, 
	gdocumíts
 + 
	gthis
->
	gønge
.
	g£c⁄d
 + 1);

174 
	gthis
->
	gdocs
 = 
√w
 
°d
::
ve˘‹
<
uöt
>;

175 
STNode
* 
	gcuº
 = 
this
->
chûd
; cuº !0; cuº = 
cuº
->
siblög
)

177 
this
->
docs
->
ö£π
—his->docs->
íd
(), 
cuº
->docs->
begö
(), curr->docs->end());

178 
	gthis
->
	g°‹ed_documíts
 +
cuº
->
°‹ed_documíts
;

181 
ªmoveDu∂iˇãs
(
this
->
docs
, (this->docs->
size
(Ë>
DocAºay
::
PARALLEL_SORT_THRESHOLD
));

185 
	gSTNode
::
c⁄èösAŒDocumíts
()

187 if(
this
->
docs
 != 0)

189 
this
->
°‹ed_documíts
 =Åhis->
docs
->
size
();

190 
dñëe
 
	gthis
->
	gdocs
;Åhis->docs = 0;

192 
STNode
* 
	gcuº
 = 
this
; cuº !0; cuº = 
cuº
->
∑ª¡
)

194 
cuº
->
c⁄èös_Æl
 = 
åue
;

199 
	gSTNode
::
°‹eThisSë
()

201 if(!(
this
->
c⁄èös_Æl
)Ë{Åhis->
°‹ed_documíts
 =Åhis->
docs
->
size
(); }

202 
STNode
* 
	gcuº
 = 
this
->
chûd
; cuº !0; cuº = 
cuº
->
siblög
)

204 
dñëe
 
cuº
->
docs
; 
	gcuº
->
	gdocs
 = 0;

209 
	gSTNode
::
£tNext
()

211 
°d
::
°ack
<
STNode
*> 
node°ack
;

212 
	g°d
::
ve˘‹
<
STNode
*> 
¥evious
;

213 
STNode
* 
	gãmp
 = 
this
;Åem∞!0;Åem∞
ãmp
->
chûd
Ë{ 
node°ack
.
push
(temp); }

214 
	gthis
->
	g√xt
 = 0;

216 
	gnode°ack
.
t›
(Ë!
this
)

218 
STNode
* 
cuº
 = 
node°ack
.
t›
(); 
	gnode°ack
.
p›
();

219 
STNode
* 
	gãmp
 = 
cuº
->
siblög
;Åem∞!0;Åem∞
ãmp
->
chûd
Ë{ 
node°ack
.
push
(temp); }

221 if(
	gcuº
->
	gchûd
 == 0)

223 
°d
::
ve˘‹
<
STNode
*>::
ôî©‹
 
ôî
 = 
¥evious
.
begö
(); 
	gôî
 !¥evious.
íd
(); ++iter)

225 (*
	gôî
)->
	g√xt
 = 
cuº
;

227 
	g¥evious
.
˛ór
();

229 
	gcuº
->
	g√xt
 = 0; 
	g¥evious
.
push_back
(
cuº
);

233 
	g°d
::
o°ªam
&

234 
›î©‹
<<(
°d
::
o°ªam
& 
°ªam
, c⁄° 
	gSTNode
& 
	gd©a
)

236 
	g°ªam
 << "(dïth = " << 
	gd©a
.
	g°rög_dïth
 << ",Ñ™gê" << d©a.
	gønge
 << ",Ö¨íà" << d©a.
	g∑ª¡
;

238 
	g°ªam
 << ", siblings = (";

239 
STNode
* 
	gcuº
 = 
d©a
.
siblög
; cuº !0; cuº = 
cuº
->sibling)

241 if(
cuº
 !
d©a
.
siblög
Ë{ 
°ªam
 << ", "; }

242 
	g°ªam
 << 
	gcuº
;

244 
	g°ªam
 << ")";

246 
	g°ªam
 << ", children = (";

247 
STNode
* 
	gcuº
 = 
d©a
.
chûd
; cuº !0; cuº = 
cuº
->
siblög
)

249 if(
cuº
 !
d©a
.
chûd
Ë{ 
°ªam
 << ", "; }

250 
	g°ªam
 << 
	gcuº
;

252 
	g°ªam
 << ")";

254 
	g°ªam
 << ")";

255  
	g°ªam
;

260 
	gDocAºay
::
DocAºay
(c⁄° 
RLCSA
& 
_æcß
) :

261 
æcß
(
_æcß
),

262 
Àaf_ønges
(0), 
fú°_chûdªn
(0), 
∑ª¡s
(0), 
√xt_Àaves
(0),

263 
ruÀ_b‹dîs
(0), 
ruÀs
(0),

264 
block_b‹dîs
(0), 
blocks
(0),

265 
ok
(
Ál£
), 
has_gømm¨
(Ál£), 
u£s_æe
(false)

269 
	gDocAºay
::
DocAºay
(
STNode
* 
roŸ
, c⁄° 
RLCSA
& 
_æcß
) :

270 
æcß
(
_æcß
),

271 
Àaf_ønges
(0), 
fú°_chûdªn
(0), 
∑ª¡s
(0), 
√xt_Àaves
(0),

272 
ruÀ_b‹dîs
(0), 
ruÀs
(0),

273 
block_b‹dîs
(0), 
blocks
(0),

274 
ok
(
Ál£
), 
has_gømm¨
(Ál£), 
u£s_æe
(false)

276 if(
	groŸ
 == 0) { ; }

278 
uöt
 
	gnodes
 = 0, 
	gÀaves
 = 0;

279 
	groŸ
->
dëîmöeSize
(
nodes
, 
Àaves
);

280 
	groŸ
->
£tNext
();

282 
	gDñèVe˘‹
::
Encodî
 
ønge_ícodî
(
RANGE_BLOCK_SIZE
);

283 
	gSuccö˘Ve˘‹
::
Encodî
 
chûd_ícodî
(
PARENT_BLOCK_SIZE
,

284 
√xtMu…ùÀOf
(
PARENT_BLOCK_SIZE
, 
BITS_TO_BYTES
(
nodes
)));

286 
	g°d
::
°ack
<
STNode
*> 
node°ack
;

287 
STNode
* 
	gcuº
 = 
roŸ
; cuº !0; cuº = 
cuº
->
chûd
Ë{ 
node°ack
.
push
(curr); }

288 
	gnode°ack
.
t›
(Ë!
roŸ
)

290 
STNode
* 
cuº
 = 
node°ack
.
t›
(); 
	gnode°ack
.
p›
();

291 
STNode
* 
	gãmp
 = 
cuº
->
siblög
;Åem∞!0;Åem∞
ãmp
->
chûd
Ë{ 
node°ack
.
push
(temp); }

292 if(
	gcuº
->
	gchûd
 =0Ë{ 
ønge_ícodî
.
addBô
(
cuº
->
ønge
.
fú°
); }

293 if(
	gcuº
 =
cuº
->
∑ª¡
->
chûd
Ë{ 
chûd_ícodî
.
£tBô
(cuº->
id
); }

295 
	gthis
->
	gÀaf_ønges
 = 
√w
 
DñèVe˘‹
(
ønge_ícodî
, 
roŸ
->
ønge
.
£c⁄d
 + 1);

296 
	gthis
->
	gfú°_chûdªn
 = 
√w
 
Succö˘Ve˘‹
(
chûd_ícodî
);

299 
WrôeBuf„r
 
∑r_buf„r
(
nodes
 - 
Àaves
, 
Àngth
(nodes -Üeaves - 1));

300 
WrôeBuf„r
 
√xt_buf„r
(
nodes
 - 
Àaves
, 
Àngth
(leaves));

301 
	gSuccö˘Ve˘‹
::
Iãøt‹
 
ôî
(*(
this
->
fú°_chûdªn
));

302 !(
	gnode°ack
.
em±y
())Ë{Çode°ack.
p›
(); }

303 
STNode
* 
	gcuº
 = 
roŸ
; cuº !0; cuº = 
cuº
->
chûd
Ë{ 
node°ack
.
push
(curr); }

304 
	gnode°ack
.
t›
(Ë!
roŸ
)

306 
STNode
* 
cuº
 = 
node°ack
.
t›
(); 
	gnode°ack
.
p›
();

307 
STNode
* 
	gãmp
 = 
cuº
->
siblög
;Åem∞!0;Åem∞
ãmp
->
chûd
Ë{ 
node°ack
.
push
(temp); }

308 if(
	gcuº
 =
cuº
->
∑ª¡
->
chûd
)

310 
∑r_buf„r
.
goToIãm
(
ôî
.
ønk
(
cuº
->
id
) - 1);

311 
	g∑r_buf„r
.
wrôeIãm
(
cuº
->
∑ª¡
->
id
 - 
Àaves
);

313 if(
	gcuº
->
	gid
 >
Àaves
)

315 
√xt_buf„r
.
wrôeIãm
(
cuº
->
√xt
 =0 ? 
this
->
gëNumbîOfLóves
(Ë: cuº->√xt->
id
);

318 
	gthis
->
	g∑ª¡s
 = 
∑r_buf„r
.
gëRódBuf„r
();

319 
	gthis
->
	g√xt_Àaves
 = 
√xt_buf„r
.
gëRódBuf„r
();

321 
	gthis
->
	gok
 = 
åue
;

324 
	gDocAºay
::
DocAºay
(c⁄° 
RLCSA
& 
_æcß
, c⁄° 
°d
::
°rög
& 
ba£_«me
, 
boﬁ
 
lﬂd_gømm¨
) :

325 
æcß
(
_æcß
),

326 
Àaf_ønges
(0), 
fú°_chûdªn
(0), 
∑ª¡s
(0), 
√xt_Àaves
(0),

327 
ruÀ_b‹dîs
(0), 
ruÀs
(0),

328 
block_b‹dîs
(0), 
blocks
(0),

329 
ok
(
Ál£
), 
has_gømm¨
(Ál£), 
u£s_æe
(false)

331 
	g°d
::
°rög
 
öput_«me
 = 
ba£_«me
 + 
DOCUMENT_EXTENSION
;

332 
	g°d
::
if°ªam
 
öput
(
öput_«me
.
c_°r
(), 
°d
::
ios_ba£
::
bö¨y
);

333 if(!
	göput
)

335 
	g°d
::
˚º
 << "DocAºay: Eº‹ o≥nög i≈uàfûê" << 
öput_«me
 << "!" << 
°d
::
ídl
;

339 
usöt
 
	gÊags
 = 0;

340 
	göput
.
ªad
((*)(&
Êags
), (flags));

341 if(
	gÊags
 & 
	gRLE_FLAG
Ë{ 
	gthis
->
	gu£s_æe
 = 
åue
; }

343 
	gthis
->
	gÀaf_ønges
 = 
√w
 
DñèVe˘‹
(
öput
);

344 
	gthis
->
	gfú°_chûdªn
 = 
√w
 
Succö˘Ve˘‹
(
öput
);

346 
	gthis
->
	g∑ª¡s
 = 
√w
 
RódBuf„r
(
öput
, 
this
->
gëNumbîOfI¡î«lNodes
(),

347 
Àngth
(
this
->
gëNumbîOfI¡î«lNodes
() - 1));

348 
	gthis
->
	g√xt_Àaves
 = 
√w
 
RódBuf„r
(
öput
, 
this
->
gëNumbîOfI¡î«lNodes
(),

349 
Àngth
(
this
->
gëNumbîOfLóves
()));

350 
	gthis
->
	gok
 = 
åue
;

352 if(
	glﬂd_gømm¨
)

354 
	gthis
->
	gruÀ_b‹dîs
 = 
√w
 
Succö˘Ve˘‹
(
öput
);

355 
	gthis
->
	gruÀs
 = 
√w
 
RódBuf„r
(
öput
, 
this
->
ruÀ_b‹dîs
->
gëSize
(),

356 
Àngth
(
this
->
gëNumbîOfDocumíts
()));

357 
	gthis
->
	gblock_b‹dîs
 = 
√w
 
Succö˘Ve˘‹
(
öput
);

358 
	gthis
->
	gblocks
 = 
√w
 
RódBuf„r
(
öput
, 
this
->
block_b‹dîs
->
gëSize
(),

359 
Àngth
(
this
->
maxI¡egî
()));

360 
	gthis
->
	ghas_gømm¨
 = 
åue
;

363 
	göput
.
˛o£
();

366 
	gDocAºay
::~
DocAºay
()

368 
dñëe
 
this
->
Àaf_ønges
; 
	gthis
->
	gÀaf_ønges
 = 0;

369 
dñëe
 
	gthis
->
	gfú°_chûdªn
;Åhis->first_children = 0;

370 
dñëe
 
	gthis
->
	g∑ª¡s
;Åhis->parents = 0;

371 
dñëe
 
	gthis
->
	g√xt_Àaves
;Åhis->next_leaves = 0;

373 
dñëe
 
	gthis
->
	gruÀ_b‹dîs
;Åhis->rule_borders = 0;

374 
dñëe
 
	gthis
->
	gruÀs
;Åhis->rules = 0;

376 
dñëe
 
	gthis
->
	gblock_b‹dîs
;Åhis->block_borders = 0;

377 
dñëe
 
	gthis
->
	gblocks
;Åhis->blocks = 0;

383 
∑r£Löe
(
°d
::
°rög
& 
row
, std::
ve˘‹
<
usöt
>& 
bef‹e
, 
£∑øt‹
, std::ve˘‹<usöt>& 
a·î
)

385 
boﬁ
 
found
 = 
Ál£
, 
	gnum
 = false;

386 
usöt
 
	gvÆue
 = 0;

387 
usöt
 
	gi
 = 0; i < 
	grow
.
Àngth
(); i++)

389 if(
isdigô
(
row
[
i
])Ë{ 
	gvÆue
 = 10 * 
vÆue
 +Ñow[i] - '0'; 
	gnum
 = 
åue
; }

390 if(
	gnum
)

392 if(
	gfound
Ë{ 
	ga·î
.
push_back
(
vÆue
); }

393 { 
	gbef‹e
.
push_back
(
vÆue
); }

394 
	gvÆue
 = 0; 
	gnum
 = 
Ál£
;

396 if(
	grow
[
i
] =
£∑øt‹
Ë{ 
found
 = 
åue
; }

398 if(
	gnum
)

400 if(
	gfound
Ë{ 
	ga·î
.
push_back
(
vÆue
); }

401 { 
	gbef‹e
.
push_back
(
vÆue
); }

402 
	gvÆue
 = 0; 
	gnum
 = 
Ál£
;

406 
usöt


407 
∑r£SögÀt⁄Fûe
(c⁄° 
°d
::
°rög
& 
fûe_«me
, c⁄° 
DocAºay
& 
doˇºay
, std::
ve˘‹
<
∑ú_ty≥
>& 
occuºí˚s
, 
boﬁ
 
¥öt
)

409 
	g°d
::
if°ªam
 
öput
(
fûe_«me
.
c_°r
(), 
°d
::
ios_ba£
::
bö¨y
);

410 if(!
	göput
) {  0; }

412 
usöt
 
	gtŸÆ_sögÀt⁄s
 = 0;

413 
	g°d
::
ve˘‹
<
°d
::
°rög
> 
rows
;

414 
ªadRows
(
öput
, 
rows
, 
åue
);

415 
	göput
.
˛o£
();

417 
boﬁ
 
	gövÆid_blocks
 = 
Ál£
, 
	gövÆid_docs
 = false;

418 
	g°d
::
ve˘‹
<
°d
::
°rög
>::
ôî©‹
 
ôî
 = 
rows
.
begö
(); 
	gôî
 !rows.
íd
(); ++iter)

420 
	g°d
::
ve˘‹
<
usöt
> 
bef‹e
, 
	ga·î
;

421 
∑r£Löe
(*
ôî
, 
bef‹e
, ':', 
a·î
);

423 if(
	gbef‹e
.
size
(Ë!1 || !(
doˇºay
.
nodeIsBlock
(
bef‹e
[0])))

425 
övÆid_blocks
 = 
åue
;

428 
usöt
 
	gblock_id
 = 
doˇºay
.
nodeToBlock
(
bef‹e
[0]);

430 
usöt
 
	g¥ev_sögÀt⁄
 = 0;

431 
	g°d
::
ve˘‹
<
usöt
>::
ôî©‹
 
ôî
 = 
a·î
.
begö
(); 
	gôî
 !a·î.
íd
(); ++iter)

433 if(
	gdoˇºay
.
nodeIsDoc
(*
ôî
))

436 if(*
	gôî
 !
¥ev_sögÀt⁄
)

438 
occuºí˚s
.
push_back
(
∑ú_ty≥
(
block_id
, 
doˇºay
.
nodeToDoc
(*
ôî
)));

439 
	gtŸÆ_sögÀt⁄s
++; 
	g¥ev_sögÀt⁄
 = *
ôî
;

442 { 
	gövÆid_docs
 = 
åue
; }

446 if(
	g¥öt
)

448 
	g°d
::
cout
 << "SögÀt⁄ fûe" << 
fûe_«me
 << ": " << 
tŸÆ_sögÀt⁄s
 << " sögÀt⁄s" << 
°d
::
ídl
;

449 if(
	gövÆid_blocks
Ë{ 
	g°d
::
cout
 << "ThîêwîêövÆid block ids." << 
°d
::
ídl
; }

450 if(
	gövÆid_docs
Ë{ 
	g°d
::
cout
 << "ThîêwîêövÆid documíàids." << 
°d
::
ídl
; }

451 
	g°d
::
cout
 << 
°d
::
ídl
;

454  
	gtŸÆ_sögÀt⁄s
;

458 
	gDocAºay
::
ªadRuÀs
(c⁄° 
°d
::
°rög
& 
«me_¥efix
, 
boﬁ
 
¥öt
)

460 
	g°d
::
ve˘‹
<
∑ú_ty≥
> 
occuºí˚s
;

461 
	g°d
::
ve˘‹
<
usöt
> 
docs
;

462 
	gSuccö˘Ve˘‹
::
Encodî
 
rb_ícodî
(
RULE_BLOCK_SIZE
);

463 
	gSuccö˘Ve˘‹
::
Encodî
 
rb_ícodî_æe
(
RULE_BLOCK_SIZE
);

464 
usöt
 
	gfûes
 = 0, 
	gcuºít_ruÀ
 = 
this
->
gëNumbîOfDocumíts
();

465 
usöt
 
	gtŸÆ_ruÀs
 = 0, 
	gtŸÆ_occs
 = 0, 
	gtŸÆ_size
 = 0, 
	gtŸÆ_runs
 = 0;

469 
	gåue
)

471 
	g°d
::
o°rög°ªam
 
‚
;

472 
	g‚
 << 
	g«me_¥efix
 << "-bi˛ique-ô-" << 
	gfûes
 << ".txt";

473 
	g°d
::
if°ªam
 
öput
(
‚
.
°r
().
c_°r
(), 
°d
::
ios_ba£
::
bö¨y
);

474 if(!
	göput
) { ; }

476 
	g°d
::
ve˘‹
<
°d
::
°rög
> 
rows
;

477 
ªadRows
(
öput
, 
rows
, 
åue
);

478 
	göput
.
˛o£
();

480 
boﬁ
 
	gövÆid_blocks
 = 
Ál£
, 
	gn⁄occuºög_ruÀs
 = fÆ£, 
	gövÆid_docs
 = fÆ£, 
	gem±y_ruÀs
 = false;

481 
usöt
 
	gcuº_ruÀs
 = 0, 
	gcuº_occs
 = 0, 
	gcuº_size
 = 0, 
	gcuº_runs
 = 0;

482 
	g°d
::
ve˘‹
<
°d
::
°rög
>::
ôî©‹
 
sôî
 = 
rows
.
begö
(); 
	gsôî
 !rows.
íd
(); ++siter)

484 
	g°d
::
ve˘‹
<
usöt
> 
bef‹e
, 
	ga·î
;

485 
∑r£Löe
(*
sôî
, 
bef‹e
, '-', 
a·î
);

488 
boﬁ
 
	goccurs
 = 
Ál£
;

489 
	g°d
::
ve˘‹
<
usöt
>::
ôî©‹
 
ôî
 = 
bef‹e
.
begö
(); 
	gôî
 !bef‹e.
íd
(); ++iter)

491 if(
	gthis
->
nodeIsBlock
(*
ôî
))

493 
	goccuºí˚s
.
push_back
(
∑ú_ty≥
(
this
->
nodeToBlock
(*
ôî
), 
cuºít_ruÀ
));

494 
	gcuº_occs
++; 
	goccurs
 = 
åue
;

496 { 
	gövÆid_blocks
 = 
åue
; }

498 if(!
	goccurs
Ë{ 
	gn⁄occuºög_ruÀs
 = 
åue
; }

499 
	gcuº_ruÀs
++; 
	gcuºít_ruÀ
++;

502 
	grb_ícodî
.
addBô
(
tŸÆ_size
 + 
cuº_size
);

503 
	grb_ícodî_æe
.
addBô
(
docs
.
size
());

504 
	goccurs
 = 
Ál£
;

505 
usöt
 
	g¥ev_doc
 = 
WORD_MAX
 - 1, 
	grun_Àngth
 = 0;

506 
	g°d
::
ve˘‹
<
usöt
>::
ôî©‹
 
ôî
 = 
a·î
.
begö
(); 
	gôî
 !a·î.
íd
(); ++iter)

508 if(
	gthis
->
nodeIsDoc
(*
ôî
))

510 
usöt
 
	gdoc_id
 = 
this
->
nodeToDoc
(*
ôî
);

511 if(
	gdoc_id
 =
¥ev_doc
 + 1Ë{ 
run_Àngth
++; 
	g¥ev_doc
++; }

514 if(
	grun_Àngth
 > 0Ë{ 
	gdocs
.
push_back
(
run_Àngth
); }

515 
	gdocs
.
push_back
(
doc_id
); 
	grun_Àngth
 = 1; 
	gcuº_runs
++;

516 
	g¥ev_doc
 = 
doc_id
;

518 
	gcuº_size
++; 
	goccurs
 = 
åue
;

520 { 
	gövÆid_docs
 = 
åue
; }

522 if(!
	goccurs
)

524 
	gdocs
.
push_back
(
this
->
gëNumbîOfDocumíts
());

525 
	gcuº_size
++; 
	gcuº_runs
++; 
	gem±y_ruÀs
 = 
åue
;

527 { 
	gdocs
.
push_back
(
run_Àngth
); }

530 if(
	g¥öt
)

532 
	g°d
::
cout
 << "Fûê" << 
fûes
 << ": "

533 << 
cuº_ruÀs
 << "Ñules, "

534 << 
cuº_occs
 << " occurrences, "

535 << 
cuº_size
 << " document ids in "

536 << 
cuº_runs
 << "Ñuns" << 
°d
::
ídl
;

537 if(
	gövÆid_blocks
Ë{ 
	g°d
::
cout
 << "ThîêwîêövÆid block ids." << 
°d
::
ídl
; }

538 if(
	gn⁄occuºög_ruÀs
Ë{ 
	g°d
::
cout
 << "Thîêwîên⁄-occuºögÑuÀs." << 
°d
::
ídl
; }

539 if(
	gövÆid_docs
Ë{ 
	g°d
::
cout
 << "ThîêwîêövÆid documíàids." << 
°d
::
ídl
; }

540 if(
	gem±y_ruÀs
Ë{ 
	g°d
::
cout
 << "Thîêwîêem±yÑuÀs." << 
°d
::
ídl
; }

541 
	g°d
::
cout
 << 
°d
::
ídl
;

543 
	gfûes
++;

544 
	gtŸÆ_ruÀs
 +
cuº_ruÀs
; 
	gtŸÆ_occs
 +
cuº_occs
; 
	gtŸÆ_size
 +
cuº_size
; 
	gtŸÆ_runs
 +
cuº_runs
;

549 
usöt
 
	gtŸÆ_sögÀt⁄s
 = 0, 
	gãmp
 = 0;

551 
	g°d
::
o°rög°ªam
 
f‚
;

552 
	gf‚
 << 
	g«me_¥efix
 << "-ô-" << (
	gfûes
 - 1);

553 
	g°d
::
°rög
 
ªmaödî_«me
 = 
f‚
.
°r
();

554 
	gãmp
 = 
∑r£SögÀt⁄Fûe
(
ªmaödî_«me
, *
this
, 
occuºí˚s
, 
¥öt
);

555 if(
	gãmp
 > 0Ë{ 
	gtŸÆ_sögÀt⁄s
 +
ãmp
; 
	gfûes
++; }

557 
	g°d
::
°rög
 
sögÀt⁄_«me
 = 
«me_¥efix
 + ".singletons";

558 
	gãmp
 = 
∑r£SögÀt⁄Fûe
(
sögÀt⁄_«me
, *
this
, 
occuºí˚s
, 
¥öt
);

559 if(
	gãmp
 > 0Ë{ 
	gtŸÆ_sögÀt⁄s
 +
ãmp
; 
	gfûes
++; }

563 if(
	gtŸÆ_size
 < 
	gdocs
.
size
())

565 
	gthis
->
	gu£s_æe
 = 
Ál£
;

566 
	gthis
->
	gruÀ_b‹dîs
 = 
√w
 
Succö˘Ve˘‹
(
rb_ícodî
, 
tŸÆ_size
);

567 
WrôeBuf„r
 
rbuf
(
tŸÆ_size
, 
Àngth
(
this
->
gëNumbîOfDocumíts
()));

568 
boﬁ
 
	g√ed_run_Àngth
 = 
Ál£
; 
usöt
 
	g¥ev
 = 0;

569 
	g°d
::
ve˘‹
<
usöt
>::
ôî©‹
 
ôî
 = 
docs
.
begö
(); 
	gôî
 !docs.
íd
(); ++iter)

571 if(!
	g√ed_run_Àngth
)

573 
	g¥ev
 = *
ôî
;

574 
	grbuf
.
wrôeIãm
(*
ôî
);

575 
	g√ed_run_Àngth
 = (*
ôî
 !
this
->
gëNumbîOfDocumíts
());

579 
usöt
 
	gi
 = 1; i < *
	gôî
; i++Ë{ 
	grbuf
.
wrôeIãm
(
¥ev
 + 
i
); }

580 
	g√ed_run_Àngth
 = 
Ál£
;

583 
	gthis
->
	gruÀs
 = 
rbuf
.
gëRódBuf„r
();

587 
	gthis
->
	gu£s_æe
 = 
åue
;

588 
	gthis
->
	gruÀ_b‹dîs
 = 
√w
 
Succö˘Ve˘‹
(
rb_ícodî_æe
, 
docs
.
size
());

589 
WrôeBuf„r
 
rbuf
(
docs
.
size
(), 
Àngth
(
this
->
gëNumbîOfDocumíts
()));

590 
	g°d
::
ve˘‹
<
usöt
>::
ôî©‹
 
ôî
 = 
docs
.
begö
(); 
	gôî
 !docs.
íd
(); ++iter)

592 
	grbuf
.
wrôeIãm
(*
ôî
);

594 
	gthis
->
	gruÀs
 = 
rbuf
.
gëRódBuf„r
();

597 
∑øŒñS‹t
(
occuºí˚s
.
begö
(), occuºí˚s.
íd
());

598 
usöt
 
	gªÆ_occs
 = 
occuºí˚s
.
size
();

599 
usöt
 
	gi
 = 0, 
	glookög_f‹
 = 0; i < 
	goccuºí˚s
.
size
(); i++)

601 
	glookög_f‹
 < 
	goccuºí˚s
[
i
].
	gfú°
Ë{ 
	gªÆ_occs
++;Üooking_for++; }

602 
	glookög_f‹
 = 
occuºí˚s
[
i
].
fú°
 + 1;

604 
	gªÆ_occs
 +
this
->
gëNumbîOfNodes
(Ë- 1 - 
occuºí˚s
.
rbegö
()->
fú°
;

606 
	gSuccö˘Ve˘‹
::
Encodî
 
bb_ícodî
(
BLOCK_BLOCK_SIZE
);

607 
WrôeBuf„r
 
bbuf
(
ªÆ_occs
, 
Àngth
(
this
->
maxI¡egî
()));

608 
usöt
 
	gpos
 = 0;

609 
usöt
 
	gi
 = 0, 
	glookög_f‹
 = 0; i < 
	goccuºí˚s
.
size
(); i++)

611 
	glookög_f‹
 < 
	goccuºí˚s
[
i
].
	gfú°
)

613 
	gbb_ícodî
.
addBô
(
pos
);

614 
	gbbuf
.
wrôeIãm
(
this
->
maxI¡egî
()); 
	gpos
++;

615 
	glookög_f‹
++;

617 if(
	gi
 =0 || 
occuºí˚s
[
i
].
fú°
 != occurrences[i - 1].first)

619 
bb_ícodî
.
addBô
(
pos
);

620 
	glookög_f‹
++;

622 
	gbbuf
.
wrôeIãm
(
occuºí˚s
[
i
].
£c⁄d
); 
	gpos
++;

624 
usöt
 
	gi
 = 
occuºí˚s
.
rbegö
()->
fú°
 + 1; i < 
	gthis
->
gëNumbîOfNodes
(); i++)

626 
	gbb_ícodî
.
addBô
(
pos
);

627 
	gbbuf
.
wrôeIãm
(
this
->
maxI¡egî
()); 
	gpos
++;

629 
	gthis
->
	gblock_b‹dîs
 = 
√w
 
Succö˘Ve˘‹
(
bb_ícodî
, 
ªÆ_occs
);

630 
	gthis
->
	gblocks
 = 
bbuf
.
gëRódBuf„r
();

632 if(
	g¥öt
)

634 
	g°d
::
cout
 << 
fûes
 << " files: "

635 << 
tŸÆ_ruÀs
 << "Ñules, "

636 << 
tŸÆ_occs
 << " occurrences, "

637 << 
tŸÆ_size
 << " document ids in "

638 << 
tŸÆ_runs
 << "Ñuns, "

639 << 
tŸÆ_sögÀt⁄s
 << " singletons, "

640 << (
ªÆ_occs
 - 
tŸÆ_occs
 - 
tŸÆ_sögÀt⁄s
Ë<< " com∂ëêblocks" << 
°d
::
ídl
;

641 if(
	gthis
->
u£sRLE
()Ë{ 
	g°d
::
cout
 << "UsögÑun-ÀngthÉncodedÑuÀs." << 
°d
::
ídl
; }

642 
	g°d
::
cout
 << 
°d
::
ídl
;

644 
	gthis
->
	ghas_gømm¨
 = 
åue
;

650 
	gDocAºay
::
wrôeTo
(c⁄° 
°d
::
°rög
& 
ba£_«me
) const

652 
°d
::
°rög
 
ouçut_«me
 = 
ba£_«me
 + 
DOCUMENT_EXTENSION
;

653 
	g°d
::
of°ªam
 
ouçut
(
ouçut_«me
.
c_°r
(), 
°d
::
ios_ba£
::
bö¨y
);

654 if(!
	gouçut
)

656 
	g°d
::
˚º
 << "DocAºay: Eº‹ cª©ög ouçuàfûê" << 
ouçut_«me
 << "!" << 
°d
::
ídl
;

660 
usöt
 
	gÊags
 = 0; if(
	gthis
->
u£sRLE
()Ë{ fœg†|
RLE_FLAG
; }

661 
	gouçut
.
wrôe
((*)(&
Êags
), (flags));

663 
	gthis
->
	gÀaf_ønges
->
wrôeTo
(
ouçut
);

664 
	gthis
->
	gfú°_chûdªn
->
wrôeTo
(
ouçut
);

665 
	gthis
->
	g∑ª¡s
->
wrôeBuf„r
(
ouçut
);

666 
	gthis
->
	g√xt_Àaves
->
wrôeBuf„r
(
ouçut
);

668 if(
	gthis
->
hasGømm¨
())

670 
	gthis
->
	gruÀ_b‹dîs
->
wrôeTo
(
ouçut
);

671 
	gthis
->
	gruÀs
->
wrôeBuf„r
(
ouçut
);

672 
	gthis
->
	gblock_b‹dîs
->
wrôeTo
(
ouçut
);

673 
	gthis
->
	gblocks
->
wrôeBuf„r
(
ouçut
);

676 
	gouçut
.
˛o£
();

679 
usöt


680 
	gDocAºay
::
ªp‹tSize
(
boﬁ
 
¥öt
) const

682 
usöt
 
byãs
 = (*
this
);

684 
usöt
 
	gåì_byãs
 = 
this
->
Àaf_ønges
->
ªp‹tSize
() +

685 
this
->
fú°_chûdªn
->
ªp‹tSize
() +

686 
this
->
∑ª¡s
->
ªp‹tSize
() +

687 
this
->
√xt_Àaves
->
ªp‹tSize
();

688 if(
	g¥öt
)

690 
	g°d
::
cout
 << "Tªe: " << (
åì_byãs
 / ()
MEGABYTE
Ë<< " MB" << 
°d
::
ídl
;

693 
usöt
 
	gruÀ_byãs
 = 0, 
	gblock_byãs
 = 0;

694 if(
	gthis
->
hasGømm¨
())

696 
	gruÀ_byãs
 = 
this
->
ruÀ_b‹dîs
->
ªp‹tSize
(Ë+Åhis->
ruÀs
->reportSize();

697 
	gblock_byãs
 = 
this
->
block_b‹dîs
->
ªp‹tSize
(Ë+Åhis->
blocks
->reportSize();

699 if(
	g¥öt
 && 
	gthis
->
hasGømm¨
())

701 
	g°d
::
cout
 << "RuÀs: " << (
ruÀ_byãs
 / ()
MEGABYTE
Ë<< " MB" << 
°d
::
ídl
;

702 
	g°d
::
cout
 << "Blocks: " << (
block_byãs
 / ()
MEGABYTE
Ë<< " MB" << 
°d
::
ídl
;

705 
	gbyãs
 +
åì_byãs
 + 
ruÀ_byãs
 + 
block_byãs
;

706 if(
	g¥öt
)

708 
	g°d
::
cout
 << "TŸÆ size: " << (
byãs
 / ()
MEGABYTE
Ë<< " MB" << 
°d
::
ídl
;

709 
	g°d
::
cout
 << 
°d
::
ídl
;

712  
	gbyãs
;

717 
	g°d
::
ve˘‹
<
usöt
>*

718 
DocAºay
::
li°Documíts
(c⁄° 
°d
::
°rög
& 
∑âîn
) const

720  
this
->
li°Documíts
—his->
æcß
.
cou¡
(
∑âîn
));

723 
	g°d
::
ve˘‹
<
usöt
>*

724 
DocAºay
::
li°Documíts
(
∑ú_ty≥
 
ønge
) const

726 if(
isEm±y
(
ønge
Ë||Ñ™ge.
£c⁄d
 >
this
->
gëSize
()) {  0; }

728 
	g°d
::
ve˘‹
<
usöt
>* 
ªsu…
 = 
this
->
documítLi°ög
<usöt>(
ønge
);

729 if(
	gªsu…
 !0Ë{ 
ªmoveDu∂iˇãs
(
ªsu…
, 
Ál£
); }

731  
	gªsu…
;

734 
	g°d
::
ve˘‹
<
∑ú_ty≥
>*

735 
DocAºay
::
li°DocumítsRLE
(c⁄° 
°d
::
°rög
& 
∑âîn
) const

737  
this
->
li°DocumítsRLE
—his->
æcß
.
cou¡
(
∑âîn
));

740 
	g°d
::
ve˘‹
<
∑ú_ty≥
>*

741 
DocAºay
::
li°DocumítsRLE
(
∑ú_ty≥
 
ønge
) const

743 if(
isEm±y
(
ønge
Ë||Ñ™ge.
£c⁄d
 >
this
->
gëSize
()) {  0; }

745 
	g°d
::
ve˘‹
<
∑ú_ty≥
>* 
ªsu…
 = 
this
->
documítLi°ög
<∑ú_ty≥>(
ønge
);

746 if(
	gªsu…
 !0Ë{ 
mîgeR™ges
(
ªsu…
, 
Ál£
); }

748  
	gªsu…
;

751 
	g°d
::
ve˘‹
<
usöt
>*

752 
DocAºay
::
dúe˘Li°ög
(
∑ú_ty≥
 
ønge
) const

754 if(
isEm±y
(
ønge
Ë||Ñ™ge.
£c⁄d
 >
this
->
gëSize
()) {  0; }

755 
	g°d
::
ve˘‹
<
usöt
>* 
ªsu…
 = 
√w
 
°d
::vector<usint>;

756 
	gthis
->
¥o˚ssR™ge
(
ønge
, *
ªsu…
);

757 
ªmoveDu∂iˇãs
(
ªsu…
, 
Ál£
);

758  
	gªsu…
;

761 
	g°d
::
ve˘‹
<
∑ú_ty≥
>*

762 
DocAºay
::
dúe˘Li°ögRLE
(
∑ú_ty≥
 
ønge
) const

764 if(
isEm±y
(
ønge
Ë||Ñ™ge.
£c⁄d
 >
this
->
gëSize
()) {  0; }

765 
	g°d
::
ve˘‹
<
∑ú_ty≥
>* 
ªsu…
 = 
√w
 
°d
::vector<pair_type>;

766 
	gthis
->
¥o˚ssR™ge
(
ønge
, *
ªsu…
);

767 
mîgeR™ges
(
ªsu…
, 
Ál£
);

768  
	gªsu…
;

	@docarray.h

1 #i‚de‡
_RLCSA_DOCARRAY_H


2 
	#_RLCSA_DOCARRAY_H


	)

4 
	~<°ack
>

5 
	~<ve˘‹
>

7 
	~"æcß.h
"

10 
«me•a˚
 
	gCSA


13 
	sSTNode


15 
uöt
 
	g°rög_dïth
;

16 
∑ú_ty≥
 
	gønge
;

17 
STNode
* 
	g∑ª¡
;

18 
STNode
* 
	gchûd
;

19 
STNode
* 
	gsiblög
;

20 
STNode
* 
	g√xt
;

22 
usöt
 
	g°‹ed_documíts
;

23 
uöt
 
	gid
;

24 
boﬁ
 
	gc⁄èös_Æl
;

26 
	g°d
::
ve˘‹
<
uöt
>* 
docs
;

28 
STNode
(
uöt
 
l˝
, 
∑ú_ty≥
 
ß_ønge
);

29 ~
STNode
();

31 
addChûd
(
STNode
* 
node
);

32 
addSiblög
(
STNode
* 
node
);

34 
dñëeChûdªn
();

36 
addLóves
();

37 
STNode
* 
addLóf
(STNode* 
À·
, STNode* 
right
, 
usöt
 
pos
);

39 
boﬁ
 
vîifyTªe
();

42 
ªmove
();

44 
dëîmöeSize
(
uöt
& 
nodes
, uöt& 
Àaves
);

45 
compuãSt‹edDocumíts
(
usöt
* 
documíts
);

46 
c⁄èösAŒDocumíts
();

47 
°‹eThisSë
();

48 
£tNext
();

51 
	g°d
::
o°ªam
& 
›î©‹
<<(
°d
::o°ªam& 
°ªam
, c⁄° 
	gSTNode
& 
	gd©a
);

53 ˛as†
	cDocAºay


55 
	gpublic
:

56 c⁄° 
usöt
 
PARALLEL_SORT_THRESHOLD
 = 4096;

58 
ex∂icô
 
DocAºay
(c⁄° 
RLCSA
& 
_æcß
);

59 
DocAºay
(
STNode
* 
roŸ
, c⁄° 
RLCSA
& 
_æcß
);

60 
DocAºay
(c⁄° 
RLCSA
& 
_æcß
, c⁄° 
°d
::
°rög
& 
ba£_«me
, 
boﬁ
 
lﬂd_gømm¨
 = 
åue
);

61 ~
DocAºay
();

63 
ªadRuÀs
(c⁄° 
°d
::
°rög
& 
«me_¥efix
, 
boﬁ
 
¥öt
 = 
Ál£
);

65 
wrôeTo
(c⁄° 
°d
::
°rög
& 
ba£_«me
) const;

66 
usöt
 
ªp‹tSize
(
boﬁ
 
¥öt
 = 
Ál£
) const;

68 
	g°d
::
ve˘‹
<
usöt
>* 
li°Documíts
(c⁄° 
°d
::
°rög
& 
∑âîn
) const;

69 
	g°d
::
ve˘‹
<
usöt
>* 
li°Documíts
(
∑ú_ty≥
 
ønge
) const;

72 
	g°d
::
ve˘‹
<
∑ú_ty≥
>* 
li°DocumítsRLE
(c⁄° 
°d
::
°rög
& 
∑âîn
) const;

73 
	g°d
::
ve˘‹
<
∑ú_ty≥
>* 
li°DocumítsRLE
’aú_ty≥ 
ønge
) const;

76 
	g°d
::
ve˘‹
<
usöt
>* 
dúe˘Li°ög
(
∑ú_ty≥
 
ønge
) const;

77 
	g°d
::
ve˘‹
<
∑ú_ty≥
>* 
dúe˘Li°ögRLE
’aú_ty≥ 
ønge
) const;

79 
ölöe
 
boﬁ
 
isOk
(Ëc⁄° {  
	gthis
->
	gok
; }

80 
ölöe
 
boﬁ
 
hasGømm¨
(Ëc⁄° {  
	gthis
->
	ghas_gømm¨
; }

81 
ölöe
 
boﬁ
 
u£sRLE
(Ëc⁄° {  
	gthis
->
	gu£s_æe
; }

82 
ölöe
 
usöt
 
gëSize
(Ëc⁄° {  
	gthis
->
	gæcß
.getSize(); }

84 
ölöe
 
usöt
 
gëNumbîOfNodes
(Ëc⁄° {  
	gthis
->
gëNumbîOfLóves
(Ë+Åhis->
gëNumbîOfI¡î«lNodes
(); }

85 
ölöe
 
usöt
 
gëNumbîOfLóves
(Ëc⁄° {  
	gthis
->
	gÀaf_ønges
->
gëNumbîOfIãms
(); }

86 
ölöe
 
usöt
 
gëNumbîOfI¡î«lNodes
(Ëc⁄° {  
	gthis
->
	gfú°_chûdªn
->
gëNumbîOfIãms
(); }

88 
ölöe
 
usöt
 
maxI¡egî
(Ëc⁄° {  
	gthis
->
gëNumbîOfDocumíts
(Ë+Åhis->
gëNumbîOfRuÀs
(); }

89 
ölöe
 
usöt
 
gëNumbîOfDocumíts
(Ëc⁄° {  
	gthis
->
	gæcß
.
gëNumbîOfSequí˚s
(); }

90 
ölöe
 
usöt
 
gëNumbîOfRuÀs
(Ëc⁄° {  
	gthis
->
	gruÀ_b‹dîs
->
gëNumbîOfIãms
(); }

99 
ölöe
 
boﬁ
 
nodeIsDoc
(
usöt
 
node_id
) const

101  (
	gnode_id
 > 0 &&Çode_id <
this
->
gëNumbîOfDocumíts
());

104 
ölöe
 
boﬁ
 
nodeIsBlock
(
usöt
 
node_id
) const

106  (
	gnode_id
 > 
	gthis
->
gëNumbîOfDocumíts
() &&

107 
	gnode_id
 <
this
->
gëNumbîOfDocumíts
(Ë+Åhis->
gëNumbîOfNodes
());

110 
ölöe
 
usöt
 
nodeToDoc
(usöà
node_id
Ëc⁄° {  
	gnode_id
 - 1; }

111 
ölöe
 
usöt
 
nodeToBlock
(usöà
node_id
Ëc⁄° {  
	gnode_id
 - 
	gthis
->
gëNumbîOfDocumíts
() - 1; }

115 
	g¥iv©e
:

116 c⁄° 
usöt
 
RANGE_BLOCK_SIZE
 = 32;

117 c⁄° 
usöt
 
	gPARENT_BLOCK_SIZE
 = 32;

118 c⁄° 
usöt
 
	gRULE_BLOCK_SIZE
 = 32;

119 c⁄° 
usöt
 
	gBLOCK_BLOCK_SIZE
 = 32;

121 c⁄° 
	gRLCSA
& 
	gæcß
;

123 
DñèVe˘‹
* 
	gÀaf_ønges
;

124 
Succö˘Ve˘‹
* 
	gfú°_chûdªn
;

125 
RódBuf„r
* 
	g∑ª¡s
;

126 
RódBuf„r
* 
	g√xt_Àaves
;

128 
Succö˘Ve˘‹
* 
	gruÀ_b‹dîs
;

129 
RódBuf„r
* 
	gruÀs
;

131 
Succö˘Ve˘‹
* 
	gblock_b‹dîs
;

132 
RódBuf„r
* 
	gblocks
;

134 
boﬁ
 
	gok
, 
	ghas_gømm¨
, 
	gu£s_æe
;

136 c⁄° 
usöt
 
	gRLE_FLAG
 = 0x01;

140 
	gãm∂©e
<
˛ass
 
	gT
>

141 
	g°d
::
ve˘‹
<
T
>*

142 
documítLi°ög
(
∑ú_ty≥
 
ønge
) const

144 
°d
::
ve˘‹
<
T
>* 
ªsu…
 = 
√w
 std::vector<T>;

145 
	gDñèVe˘‹
::
Iãøt‹
 
block_ôî
(*(
this
->
Àaf_ønges
));

148 
∑ú_ty≥
 
	gfú°_block
 = 
block_ôî
.
vÆueA·î
(
ønge
.
fú°
);

149 if(
	gfú°_block
.
	gfú°
 > 
	gønge
.first)

151 
usöt
 
	gãmp
 = 
°d
::
mö
(
ønge
.
£c⁄d
, 
fú°_block
.
fú°
 - 1);

152 
	gthis
->
¥o˚ssR™ge
(
∑ú_ty≥
(
ønge
.
fú°
, 
ãmp
), *
ªsu…
);

153 if(
	gønge
.
	g£c⁄d
 <
ãmp
Ë{  
ªsu…
; }

155 
	gønge
.
	gfú°
 = 
fú°_block
.
£c⁄d
;

158 
∑ú_ty≥
 
	gœ°_block
 = 
block_ôî
.
vÆueBef‹e
(
ønge
.
£c⁄d
);

159 
∑ú_ty≥
 
	g√xt_block
 = 
block_ôî
.
√xtVÆue
();

160 if(
	gønge
.
	g£c⁄d
 < 
	g√xt_block
.
	gfú°
 - 1)

162 
	gthis
->
¥o˚ssR™ge
(
∑ú_ty≥
(
œ°_block
.
fú°
, 
ønge
.
£c⁄d
), *
ªsu…
);

163 if(
	gfú°_block
.
	g£c⁄d
 >
œ°_block
.
£c⁄d
Ë{  
ªsu…
; }

164 
	gœ°_block
.
	g£c⁄d
--;

166 
	gønge
.
	g£c⁄d
 = 
œ°_block
.
£c⁄d
;

169 
	gSuccö˘Ve˘‹
::
Iãøt‹
 
chûd_ôî
(*(
this
->
fú°_chûdªn
));

170 
usöt
 
	g¥ev_block
 = 
this
->
gëNumbîOfNodes
(), 
	grun
 = 0;

171 
usöt
 
	gi
 = 
ønge
.
fú°
; i <ønge.
£c⁄d
; )

173 
usöt
 
	g√xt_Àaf
 = 
i
 + 1;

174 
	gchûd_ôî
.
isSë
(
i
))

176 
∑ú_ty≥
 
	g∑ª¡
 = 
this
->
∑ª¡Of
(
i
, 
chûd_ôî
);

177 if(
	g∑ª¡
.
	g£c⁄d
 <
ønge
.
£c⁄d
 + 1)

179 
i
 = 
∑ª¡
.
fú°
; 
	g√xt_Àaf
 =Ö¨ít.
£c⁄d
;

183 if(
	gi
 =
¥ev_block
 + 
run
) {Ñun++; }

186 if(
	gthis
->
addBlocks
(
¥ev_block
, 
run
, *
ªsu…
)Ë{ 
dñëe
 
	gªsu…
; Åhis->
	gÆlDocumíts
<
	gT
>(); }

187 
	g¥ev_block
 = 
i
; 
	grun
 = 1;

189 
	gi
 = 
√xt_Àaf
;

191 if(
	gthis
->
addBlocks
(
¥ev_block
, 
run
, *
ªsu…
)Ë{ 
dñëe
 
	gªsu…
; Åhis->
	gÆlDocumíts
<
	gT
>(); }

193  
	gªsu…
;

196 
	gãm∂©e
<
˛ass
 
	gT
>

198 
¥o˚ssR™ge
(
∑ú_ty≥
 
ønge
, 
°d
::
ve˘‹
<
T
>& 
ªsu…
) const

200 if(
isEm±y
(
ønge
)) { ; }

202 
usöt
* 
	gªs
 = 
this
->
æcß
.
loˇã
(
ønge
);

203 
	gthis
->
	gæcß
.
gëSequí˚F‹Posôi⁄
(
ªs
, 
Àngth
(
ønge
));

204 
usöt
 
	gi
 = 0; i < 
Àngth
(
ønge
); i++)

206 
	gthis
->
addIãm
(
ªs
[
i
], 
ªsu…
);

210 
	gãm∂©e
<
˛ass
 
	gT
>

211 
boﬁ


212 
addBlocks
(
usöt
 
fú°
, usöà
numbî
, 
°d
::
ve˘‹
<
T
>& 
ªsu…
) const

214 if(
fú°
 >
this
->
gëNumbîOfNodes
(Ë|| 
numbî
 =0Ë{  
Ál£
; }

216 
	gSuccö˘Ve˘‹
::
Iãøt‹
 
ôî
(*(
this
->
block_b‹dîs
));

217 
usöt
 
	g‰om
 = 
ôî
.
£À˘
(
fú°
);

218 
usöt
 
	gto
 = (
numbî
 =1 ? 
ôî
.
£À˘Next
(Ë: iãr.
£À˘
(
fú°
 +Çumber));

220 
usöt
 
	gi
 = 
‰om
; i < 
	gto
; i++)

222 
usöt
 
	gvÆ
 = 
this
->
blocks
->
ªadIãmC⁄°
(
i
);

223 if(
	gvÆ
 >
this
->
maxI¡egî
()Ë{  
åue
; }

224 if(
	gvÆ
 < 
	gthis
->
gëNumbîOfDocumíts
())

226 
	gthis
->
addIãm
(
vÆ
, 
ªsu…
);

230 
	gvÆ
 -
this
->
gëNumbîOfDocumíts
();

231 
	gSuccö˘Ve˘‹
::
Iãøt‹
 
ruÀ_ôî
(*(
this
->
ruÀ_b‹dîs
));

232 
usöt
 
	gr‰om
 = 
ruÀ_ôî
.
£À˘
(
vÆ
);

233 
usöt
 
	gπo
 = 
ruÀ_ôî
.
£À˘Next
();

235 if(
	gthis
->
u£sRLE
())

237 
usöt
 
	grun_°¨t
 = 0;

238 
boﬁ
 
	gw™t_run_Àngth
 = 
Ál£
;

239 
usöt
 
	gj
 = 
r‰om
; j < 
	gπo
; j++)

241 
	gvÆ
 = 
this
->
ruÀs
->
ªadIãmC⁄°
(
j
);

242 if(
	gvÆ
 >
this
->
gëNumbîOfDocumíts
()Ë{  
åue
; }

243 if(
	gw™t_run_Àngth
Ë{ 
	gthis
->
addRun
(
run_°¨t
, 
vÆ
, 
ªsu…
); w™t_run_Àngth = 
Ál£
; }

244 { 
	grun_°¨t
 = 
vÆ
; 
	gw™t_run_Àngth
 = 
åue
; }

249 
usöt
 
	gj
 = 
r‰om
; j < 
	gπo
; j++)

251 
	gvÆ
 = 
this
->
ruÀs
->
ªadIãmC⁄°
(
j
);

252 if(
	gvÆ
 >
this
->
gëNumbîOfDocumíts
()Ë{  
åue
; }

253 { 
	gthis
->
addIãm
(
vÆ
, 
ªsu…
); }

259  
	gÁl£
;

262 
	gãm∂©e
<
˛ass
 
	gT
>

263 
	g°d
::
ve˘‹
<
T
>* 
ÆlDocumíts
() const

265 
°d
::
ve˘‹
<
T
>* 
ªsu…
 = 
√w
 std::vector<T>;

266 
	gthis
->
addRun
(0, 
this
->
gëNumbîOfDocumíts
(), *
ªsu…
);

267  
	gªsu…
;

272 
ölöe
 
addRun
(
usöt
 
‰om
, usöà
Àngth
, 
°d
::
ve˘‹
<usöt>& 
ªsu…
) const

274 
usöt
 
i
 = 
‰om
; 
	gi
 < 
	g‰om
 + 
	gÀngth
; i++Ë{ 
	gªsu…
.
push_back
(i); }

277 
ölöe
 
addRun
(
usöt
 
‰om
, usöà
Àngth
, 
°d
::
ve˘‹
<
∑ú_ty≥
>& 
ªsu…
) const

279 
ªsu…
.
push_back
(
∑ú_ty≥
(
‰om
, from + 
Àngth
 - 1));

282 
ölöe
 
addIãm
(
usöt
 
ôem
, 
°d
::
ve˘‹
<usöt>& 
ªsu…
) const

284 
ªsu…
.
push_back
(
ôem
);

287 
ölöe
 
addIãm
(
usöt
 
ôem
, 
°d
::
ve˘‹
<
∑ú_ty≥
>& 
ªsu…
) const

289 
ªsu…
.
push_back
(
∑ú_ty≥
(
ôem
, item));

294 
ölöe
 
∑ú_ty≥
 
∑ª¡Of
(
usöt
 
åì_node
, 
Succö˘Ve˘‹
::
Iãøt‹
& 
ôî
) const

296 
usöt
 
∑r
 = 
this
->
∑ª¡s
->
ªadIãmC⁄°
(
ôî
.
ønk
(
åì_node
) - 1);

297 
usöt
 
	g√xt_Àaf
 = 
this
->
√xt_Àaves
->
ªadIãmC⁄°
(
∑r
);

298  
∑ú_ty≥
(
∑r
 + 
this
->
gëNumbîOfLóves
(), 
√xt_Àaf
);

304 
DocAºay
();

305 
DocAºay
(const DocArray&);

306 
	gDocAºay
& 
	g›î©‹
 = (c⁄° 
DocAºay
&);

	@document_graph.cpp

1 
	~<Æg‹ôhm
>

2 
	~<c°dlib
>

3 
	~<f°ªam
>

4 
	~<io°ªam
>

5 
	~<°ack
>

7 #ifde‡
MULTITHREAD_SUPPORT


8 
	~<omp.h
>

11 
	~"æcß.h
"

12 
	~"doˇºay.h
"

14 
usög
 
«me•a˚
 
	gCSA
;

22 
ã°Doˇºay
(c⁄° 
°d
::
°rög
& 
ba£_«me
);

23 
buûdIndex
(c⁄° 
°d
::
°rög
& 
ba£_«me
, c⁄° std::°rög& 
¥efix
);

27 
	$maö
(
¨gc
, ** 
¨gv
)

29 
°d
::
cout
 << "DocumíàgøphÉxåa˘‹" << std::
ídl
;

30 if(
¨gc
 < 2)

32 
°d
::
cout
 << "Ußge:" << std::
ídl
;

33 
°d
::
cout
 << "documít_gøph ba£«mêblock_sizê°‹ög_Á˘‹" << std::
ídl
;

34 
°d
::
cout
 << "ÅÿbuûdÅhêdocumíàgøphánd s∑r£ suffixÅªe" << std::
ídl
;

35 
°d
::
cout
 << "documít_gøph ba£«mê¥efix" << std::
ídl
;

36 
°d
::
cout
 << "Åÿcom¥es†thêgømm¨ánd buûdÅhêödex" << std::
ídl
;

37 
°d
::
cout
 << "documít_gøph ba£«me" << std::
ídl
;

38 
°d
::
cout
 << "Åÿã°Åhêdocumíà¨øy" << std::
ídl
;

41 
°d
::
cout
 << std::
ídl
;

43 
°d
::
°rög
 
ba£_«me
 = 
¨gv
[1];

44 
°d
::
cout
 << "Ba£Çame: " << 
ba£_«me
 << std::
ídl
;

47 if(
¨gc
 == 2)

49 
°d
::
cout
 << std::
ídl
;

50  
	`ã°Doˇºay
(
ba£_«me
);

54 if(
¨gc
 == 3)

56 
°d
::
°rög
 
¥efix
 = 
¨gv
[2];

57 
°d
::
cout
 << "Pªfix: " << 
¥efix
 << std::
ídl
;

58 
°d
::
cout
 << std::
ídl
;

59  
	`buûdIndex
(
ba£_«me
, 
¥efix
);

62 
usöt
 
block_size
 = 
	`©oi
(
¨gv
[2]);

63 
°d
::
cout
 << "Block size: " << 
block_size
 << std::
ídl
;

64 
usöt
 
°‹ög_Á˘‹
 = 
	`©oi
(
¨gv
[3]);

65 
°d
::
cout
 << "St‹ög fa˘‹: " << 
°‹ög_Á˘‹
 << std::
ídl
;

66 
°d
::
cout
 << std::
ídl
;

68 
RLCSA
 
	`æcß
(
¨gv
[1]);

69 if(!
æcß
.
	`isOk
(Ë|| !æcß.
	`suµ‹tsLoˇã
())

71 
°d
::
˚º
 << "Eº‹: Loˇã i†nŸ suµ‹ãd!" << std::
ídl
;

74 
æcß
.
	`¥ötInfo
();

75 
æcß
.
	`ªp‹tSize
(
åue
);

76 if(
block_size
 =0 || 
°‹ög_Á˘‹
 == 0) {  0; }

79 
°¨t
 = 
	`ªadTimî
();

82 
usöt
 
size
 = 
æcß
.
	`gëSize
();

83 
uöt
 
docs
 = 
æcß
.
	`gëNumbîOfSequí˚s
();

84 
usöt
* 
documíts
 = 
√w
 usöt[
size
];

85 #¥agm®
omp
 
∑øŒñ
 
	`scheduÀ
()

86 
usöt
 
i
 = 0; i < 
size
; i +
MEGABYTE
)

88 
æcß
.
	`loˇã
(
	`∑ú_ty≥
(
i
, 
°d
::
	`mö
(ò+ 
MEGABYTE
, 
size
 - 1)), 
documíts
 + i);

90 
loˇã
 = 
	`ªadTimî
();

91 
°d
::
cout
 << "Loˇã: " << (
loˇã
 - 
°¨t
Ë<< " sec⁄ds" << std::
ídl
;

94 
uöt
* 
l˝
 = 
√w
 uöt[
size
 + 1];Ücp[size] = 0;

108 
PLCPVe˘‹
* 
∂˝vec
 = 
æcß
.
	`buûdPLCP
(16);

109 
PLCPVe˘‹
::
Iãøt‹
 
	`ôî
(*
∂˝vec
);

110 
usöt
 
i
 = 0; i < 
size
; i++)

112 
l˝
[
i
] = 
ôî
.
	`£À˘
(
documíts
[i]) - 2 * documents[i];

115 
dñëe
 
∂˝vec
;

116 
l˝¨øy
 = 
	`ªadTimî
();

117 
°d
::
cout
 << "LCP: " << (
l˝¨øy
 - 
loˇã
Ë<< " sec⁄ds" << std::
ídl
;

120 #¥agm®
omp
 
∑øŒñ
 
	`scheduÀ
()

121 
usöt
 
i
 = 0; i < 
size
; i +
MEGABYTE
)

123 
æcß
.
	`gëSequí˚F‹Posôi⁄
(
documíts
 + 
i
, 
°d
::
	`mö
(
MEGABYTE
, 
size
 - i));

126 #¥agm®
omp
 
∑øŒñ
 
	`scheduÀ
(, 
MEGABYTE
)

127 
usöt
 
i
 = 0; i < 
size
; i++Ë{ 
documíts
[i]++; }

128 
föd
 = 
	`ªadTimî
();

129 
°d
::
cout
 << "Documíts: " << (
föd
 - 
l˝¨øy
Ë<< " sec⁄ds" << std::
ídl
;

133 
°d
::
°ack
<
STNode
*> 
node°ack
;Çode°ack.
	`push
(
√w
 
	`STNode
(0, 
	`∑ú_ty≥
(0, 0)));

134 
STNode
* 
¥ev
 = 0; STNode* 
roŸ
 = 0;

135 
usöt
 
i
 = 1; i <
size
; i++)

137 
usöt
 
À·
 = 
i
 - 1;

138 
l˝
[
i
] < 
node°ack
.
	`t›
()->
°rög_dïth
)

140 
node°ack
.
	`t›
()->
ønge
.
£c⁄d
 = 
i
 - 1;

141 
¥ev
 = 
node°ack
.
	`t›
();Çode°ack.
	`p›
();

142 if(
	`Àngth
(
¥ev
->
ønge
Ë<
block_size
Ë{Öªv->
	`dñëeChûdªn
(); }

143 
roŸ
 = 
¥ev
;

144 
À·
 = 
¥ev
->
ønge
.
fú°
;

145 if(
l˝
[
i
] <
node°ack
.
	`t›
()->
°rög_dïth
Ë{Çode°ack.t›()->
	`addChûd
(
¥ev
);Örev = 0; }

147 if(
l˝
[
i
] > 
node°ack
.
	`t›
()->
°rög_dïth
)

149 
STNode
* 
cuº
 = 
√w
 
	`STNode
(
l˝
[
i
], 
	`∑ú_ty≥
(
À·
,Üeft));

150 if(
¥ev
 !0Ë{ 
cuº
->
	`addChûd
(prev);Örev = 0; }

151 
node°ack
.
	`push
(
cuº
);

154 
roŸ
->
∑ª¡
 != 0) {Ñoot =Ñoot->parent; }

155 
roŸ
->
ønge
.
£c⁄d
 = 
size
 - 1;ÑoŸ->
	`c⁄èösAŒDocumíts
();

156 
dñëe
[] 
l˝
;Ücp = 0;

157 
uöt
 
°_nodes
 = 0, 
Àaf_nodes
 = 0;

158 
roŸ
->
	`addLóves
();

159 
roŸ
->
	`vîifyTªe
();

160 
roŸ
->
	`dëîmöeSize
(
°_nodes
, 
Àaf_nodes
);

161 
°
 = 
	`ªadTimî
();

162 
°d
::
cout
 << "SuffixÅªe: " << (
°
 - 
föd
Ë<< " sec⁄ds" << std::
ídl
;

163 
°d
::
cout
 << "TŸÆ " << 
size
 << "Öosôi⁄s, " << 
docs
 << " documíts" << std::
ídl
;

164 
°d
::
cout
 << "Trunˇãd suffixÅªêha†" << 
°_nodes
 << "Çodes" << std::
ídl
;

165 
°d
::
cout
 << std::
ídl
;

169 
uöt
 
åì_Àaves
 = 0, 
åì_nodes
 = 
Àaf_nodes
, 
gøph_nodes
 = 0, 
edges
 = 0;

170 
°d
::
°rög
 
gøph_«me
 = 
ba£_«me
 + ".graph";

171 
°d
::
of°ªam
 
	`ouçut
(
gøph_«me
.
	`c_°r
(), std::
ios_ba£
::
bö¨y
);

172 if(!
ouçut
)

174 
°d
::
˚º
 << "Eº‹: C™nŸ o≥¿ouçuàfûê" << 
gøph_«me
 << "!" << std::
ídl
;

175 
dñëe
[] 
documíts
;

178 
°d
::
°rög
 
sögÀt⁄_«me
 = 
ba£_«me
 + ".singletons";

179 
°d
::
of°ªam
 
	`sögÀt⁄s
(
sögÀt⁄_«me
.
	`c_°r
(), std::
ios_ba£
::
bö¨y
);

180 if(!
sögÀt⁄s
)

182 
°d
::
˚º
 << "Eº‹: C™nŸ o≥¿ouçuàfûê" << 
sögÀt⁄_«me
 << "!" << std::
ídl
;

183 
dñëe
[] 
documíts
;

184 
ouçut
.
	`˛o£
();

187 
ouçut
.
	`wrôe
((*)&
åì_nodes
, (tree_nodes));

188 
ouçut
.
	`wrôe
((*)&
edges
, (edges));

191 
£ts
 = 
	`ªadTimî
();

192 !
node°ack
.
	`em±y
()Ë{Çode°ack.
	`p›
(); }

193 
¥ev
 = 
roŸ
;Öªv !0;Öªv =Öªv->
chûd
Ë{ 
node°ack
.
	`push
(prev); }

194 
node°ack
.
	`t›
(Ë!
roŸ
)

196 
STNode
* 
cuº
 = 
node°ack
.
	`t›
();Çode°ack.
	`p›
();

197 
STNode
* 
ãmp
 = 
cuº
->
siblög
;Åem∞!0;Åem∞ãmp->
chûd
Ë{ 
node°ack
.
	`push
(temp); }

198 if(
cuº
->
c⁄èös_Æl
)

200 
cuº
->
id
 = 
åì_nodes
;Åree_nodes++;

204 
cuº
->
	`compuãSt‹edDocumíts
(
documíts
);

205 if(
cuº
->
docs
->
	`size
(Ë>docsË{ cuº->
	`c⁄èösAŒDocumíts
(); }

207 if(
cuº
->
chûd
 =0 || cuº->
c⁄èös_Æl
 || cuº->
°‹ed_documíts
 > 
°‹ög_Á˘‹
 * cuº->
docs
->
	`size
())

209 
cuº
->
	`°‹eThisSë
();

210 
cuº_node
 = -1 * 
docs
;

211 if(
cuº
->
chûd
 =0Ë{ cuº->
id
 = 
åì_Àaves
;Åªe_Àaves++; 
cuº_node
 -=Åree_leaves; }

212 { 
cuº
->
id
 = 
åì_nodes
;Åªe_nodes++; 
cuº_node
 -=Åree_nodes; }

213 if(!(
cuº
->
c⁄èös_Æl
))

217 if(
cuº
->
docs
->
	`size
() == 1)

219 
sögÀt⁄s
 << (-
cuº_node
Ë<< ": " << 
cuº
->
docs
->
	`©
(0Ë<< 
°d
::
ídl
;

223 
ouçut
.
	`wrôe
((*)&
cuº_node
, (curr_node));

224 
°d
::
ve˘‹
<
uöt
>::
ôî©‹
 
ôî
 = 
cuº
->
docs
->
	`begö
(); iã∏!cuº->docs->
	`íd
(); ++iter)

226 
uöt
 
ãmp
 = *
ôî
;

227 
ouçut
.
	`wrôe
((*)&
ãmp
, (temp));

229 
gøph_nodes
++;

230 
edges
 +
cuº
->
docs
->
	`size
();

236 
cuº
->
	`ªmove
();

237 
dñëe
 
cuº
;

240 
roŸ
->
id
 = 
åì_nodes
;Åree_nodes++;

241 
block_°›
 = 
	`ªadTimî
();

242 
°d
::
cout
 << "Blocks: " << (
block_°›
 - 
£ts
Ë<< " sec⁄ds" << std::
ídl
;

243 
°d
::
cout
 << std::
ídl
;

246 
ouçut
.
	`£ekp
(0, 
°d
::
ios
::
beg
);

247 
ouçut
.
	`wrôe
((*)&
gøph_nodes
, (graph_nodes));

248 
ouçut
.
	`wrôe
((*)&
edges
, (edges));

249 
°d
::
cout
 << "Gøph ha†" << 
gøph_nodes
 << "Çodes, " << 
edges
 << "Édges" << std::
ídl
;

250 
°d
::
cout
 << std::
ídl
;

251 
ouçut
.
	`˛o£
();

252 
sögÀt⁄s
.
	`˛o£
();

253 
dñëe
[] 
documíts
;

256 
DocAºay
 
	`doˇºay
(
roŸ
, 
æcß
);

257 if(
doˇºay
.
	`isOk
())

259 
°d
::
cout
 << "FöÆÅªêha†" << 
doˇºay
.
	`gëNumbîOfNodes
(Ë<< "Çodes, " << 
åì_Àaves
 << "Üóves" << std::
ídl
;

260 
°d
::
cout
 << std::
ídl
;

261 
doˇºay
.
	`ªp‹tSize
(
åue
);

262 
doˇºay
.
	`wrôeTo
(
ba£_«me
);

265 
dñëe
 
roŸ
;

267 
	}
}

271 
	$ã°Doˇºay
(c⁄° 
°d
::
°rög
& 
ba£_«me
)

273 
RLCSA
 
	`æcß
(
ba£_«me
);

274 if(!(
æcß
.
	`isOk
())) {  4; }

275 
DocAºay
 
	`doˇºay
(
æcß
, 
ba£_«me
, 
åue
);

276 if(!(
doˇºay
.
	`isOk
())) {  5; }

278 
æcß
.
	`¥ötInfo
();

279 
æcß
.
	`ªp‹tSize
(
åue
);

280 
doˇºay
.
	`ªp‹tSize
(
åue
);

283 
	}
}

287 
	$buûdIndex
(c⁄° 
°d
::
°rög
& 
ba£_«me
, c⁄° std::°rög& 
¥efix
)

289 
RLCSA
 
	`æcß
(
ba£_«me
);

290 if(!(
æcß
.
	`isOk
())) {  4; }

291 
DocAºay
 
	`doˇºay
(
æcß
, 
ba£_«me
, 
Ál£
);

292 if(!(
doˇºay
.
	`isOk
())) {  5; }

294 
doˇºay
.
	`ªadRuÀs
(
¥efix
, 
åue
);

295 if(!(
doˇºay
.
	`hasGømm¨
())) {  6; }

296 
doˇºay
.
	`wrôeTo
(
ba£_«me
);

298 
æcß
.
	`¥ötInfo
();

299 
æcß
.
	`ªp‹tSize
(
åue
);

300 
doˇºay
.
	`ªp‹tSize
(
åue
);

303 
	}
}

	@extract_sequence.cpp

1 
	~<Æg‹ôhm
>

2 
	~<c°dlib
>

3 
	~<˘ime
>

4 
	~<f°ªam
>

5 
	~<io°ªam
>

7 
	~"æcß.h
"

8 
	~"misc/utûs.h
"

10 #ifde‡
MULTITHREAD_SUPPORT


11 
	~<omp.h
>

12 c⁄° 
	gMAX_THREADS
 = 64;

16 
usög
 
«me•a˚
 
	gCSA
;

19 
	$maö
(
¨gc
, ** 
¨gv
)

21 
°d
::
cout
 << "RLCSA di•œyÅe°" << std::
ídl
;

22 if(
¨gc
 < 4)

24 
°d
::
cout
 << "Ußge:Éxåa˘_£quí˚ ba£_«mê£quí˚_numbî ouçut" << std::
ídl
;

28 
°d
::
cout
 << "Ba£Çame: " << 
¨gv
[1] << std::
ídl
;

29 
usöt
 
£quí˚
 = 
	`©oi
(
¨gv
[2]);

30 
°d
::
cout
 << "Sequí˚Çumbî: " << 
£quí˚
 << std::
ídl
;

31 
°d
::
cout
 << "Ouçut: " << 
¨gv
[3] << std::
ídl
;

32 
°d
::
cout
 << std::
ídl
;

34 
RLCSA
 
	`æcß
(
¨gv
[1]);

35 if(!
æcß
.
	`suµ‹tsDi•œy
())

37 
°d
::
˚º
 << "Eº‹: Di•œy i†nŸ suµ‹ãd!" << std::
ídl
;

40 
æcß
.
	`¥ötInfo
();

41 
æcß
.
	`ªp‹tSize
(
åue
);

42 if(
£quí˚
 >
æcß
.
	`gëNumbîOfSequí˚s
())

44 
°d
::
˚º
 << "Eº‹: InvÆid sequí˚Çumbî!" << std::
ídl
;

48 
°d
::
of°ªam
 
	`ouçut
(
¨gv
[3], std::
ios_ba£
::
bö¨y
);

49 if(!
ouçut
)

51 
°d
::
˚º
 << "Eº‹: C™nŸ o≥¿ouçuàfûe!" << std::
ídl
;

55 
°¨t
 = 
	`ªadTimî
();

56 
uch¨
* 
buf„r
 = 
æcß
.
	`di•œy
(
£quí˚
);

57 
usöt
 
byãs
 = 
	`Àngth
(
æcß
.
	`gëSequí˚R™ge
(
£quí˚
));

58 
ouçut
.
	`wrôe
((*)
buf„r
, 
byãs
);

59 
dñëe
[] 
buf„r
;

60 
ouçut
.
	`˛o£
();

62 
time
 = 
	`ªadTimî
(Ë- 
°¨t
;

63 
megabyãs
 = 
byãs
 / ()
MEGABYTE
;

64 
°d
::
cout
 << 
megabyãs
 << " megabyã†ö " << 
time
 << " sec⁄d†(" << (megabyã†/ÅimeË<< " MB/s)" << std::
ídl
;

65 
°d
::
cout
 << std::
ídl
;

68 
	}
}

	@lcp_test.cpp

1 
	~<Æg‹ôhm
>

2 
	~<c°dlib
>

3 
	~<˘ime
>

4 
	~<f°ªam
>

5 
	~<io°ªam
>

7 
	~"æcß.h
"

8 
	~"misc/utûs.h
"

11 
usög
 
«me•a˚
 
	gCSA
;

14 
	$maö
(
¨gc
, ** 
¨gv
)

16 
°d
::
cout
 << "RLCSA LCPÅe°" << std::
ídl
;

17 if(
¨gc
 < 5)

19 
°d
::
cout
 << "Ußge:Ü˝_ã° ba£«mêquîõ†run†mode†[øndom_£ed]" << std::
ídl
;

20 
°d
::
cout
 << std::
ídl
;

21 
°d
::
cout
 << "Suµ‹ãd modes:" << std::
ídl
;

22 
°d
::
cout
 << "¯-- Cou¡Åhênumbî o‡°ïs" << std::
ídl
;

23 
°d
::
cout
 << "d -- Dúe˘ LCP" << std::
ídl
;

24 
°d
::
cout
 << "∞-- PLCP" << std::
ídl
;

25 
°d
::
cout
 << "†-- Sam∂ed LCP" << std::
ídl
;

26 
°d
::
cout
 << "»-- Loˇã" << std::
ídl
;

27 
°d
::
cout
 << "v -- VîifyÑesu…s" << std::
ídl
;

28 
°d
::
cout
 << std::
ídl
;

32 
°d
::
°rög
 
ba£_«me
 = 
¨gv
[1];

33 
°d
::
cout
 << "Ba£Çame: " << 
ba£_«me
 << std::
ídl
;

34 
usöt
 
quîõs
 = 
	`©oi
(
¨gv
[2]);

35 
°d
::
cout
 << "Numbî o‡quîõs: " << 
quîõs
 << std::
ídl
;

36 
usöt
 
runs
 = 
°d
::
	`max
(1, 
	`©oi
(
¨gv
[3]));

37 
°d
::
cout
 << "Numbî o‡ã°Ñuns: " << 
runs
 << std::
ídl
;

39 
°d
::
°rög
 
	`mode_°rög
(
¨gv
[4]);

40 
usöt
 
modes
 = 0;

41 
boﬁ
 
°ïs
 = (
mode_°rög
.
	`föd
('c'Ë!
°d
::
°rög
::
≈os
);

42 
boﬁ
 
mode_dúe˘
 = (
mode_°rög
.
	`föd
('d'Ë!
°d
::
°rög
::
≈os
);

43 
boﬁ
 
mode_∂˝
 = (
mode_°rög
.
	`föd
('p'Ë!
°d
::
°rög
::
≈os
);

44 
boﬁ
 
mode_ßm∂ed
 = (
mode_°rög
.
	`föd
('s'Ë!
°d
::
°rög
::
≈os
);

45 
boﬁ
 
mode_loˇã
 = (
mode_°rög
.
	`föd
('l'Ë!
°d
::
°rög
::
≈os
);

46 
boﬁ
 
mode_vîify
 = (
mode_°rög
.
	`föd
('v'Ë!
°d
::
°rög
::
≈os
);

47 if(
°ïs
Ë{ 
mode_vîify
 = 
Ál£
; }

48 
°d
::
cout
 << "Modes: ";

49 if(
°ïs
Ë{ 
°d
::
cout
 << "steps "; }

50 if(
mode_dúe˘
Ë{ 
°d
::
cout
 << "dúe˘ "; 
modes
++; }

51 if(
mode_∂˝
Ë{ 
°d
::
cout
 << "∂˝ "; 
modes
++; }

52 if(
mode_ßm∂ed
Ë{ 
°d
::
cout
 << "ßm∂ed "; 
modes
++; }

53 if(
mode_loˇã
Ë{ 
°d
::
cout
 << "locate "; }

54 if(
mode_vîify
Ë{ 
°d
::
cout
 << "verify"; }

55 
°d
::
cout
 << std::
ídl
;

57 
usöt
 
£ed
 = 0xDEADBEEF;

58 if(
¨gc
 > 5)

60 
£ed
 = 
	`©oi
(
¨gv
[5]);

62 
°d
::
cout
 << "R™dom sìd: " << 
£ed
 << std::
ídl
;

63 
°d
::
cout
 << std::
ídl
;

64 if(
modes
 =0 || 
quîõs
 == 0) {  0; }

66 
RLCSA
 
	`æcß
(
ba£_«me
);

67 if(
mode_∂˝
 && !
æcß
.
	`suµ‹tsLoˇã
())

69 
°d
::
˚º
 << "Eº‹: Loˇã i†nŸ suµ‹ãd!" << std::
ídl
;

72 
æcß
.
	`¥ötInfo
();

73 
æcß
.
	`ªp‹tSize
(
åue
);

75 
PLCPVe˘‹
* 
∂˝
 = 0;

76 if(
mode_∂˝
)

78 
°d
::
°rög
 
∂˝_«me
 = 
ba£_«me
 + 
PLCP_EXTENSION
;

79 
°d
::
if°ªam
 
	`∂˝_fûe
(
∂˝_«me
.
	`c_°r
(), std::
ios_ba£
::
bö¨y
);

80 if(!
∂˝_fûe
)

82 
°d
::
˚º
 << "Eº‹: C™nŸ o≥¿PLCP fûe!" << std::
ídl
;

85 
∂˝
 = 
√w
 
	`PLCPVe˘‹
(
∂˝_fûe
);

86 
°d
::
cout
 << "PLCP: " << (
∂˝
->
	`ªp‹tSize
(Ë/ ()
MEGABYTE
Ë<< " MB" << std::
ídl
;

87 
∂˝_fûe
.
	`˛o£
();

90 
LCPSam∂es
* 
l˝
 = 0;

91 if(
mode_ßm∂ed
)

93 
°d
::
°rög
 
l˝_«me
 = 
ba£_«me
 + 
LCP_SAMPLES_EXTENSION
;

94 
°d
::
if°ªam
 
	`l˝_fûe
(
l˝_«me
.
	`c_°r
(), std::
ios_ba£
::
bö¨y
);

95 if(!
l˝_fûe
)

97 
°d
::
˚º
 << "Eº‹: C™nŸ o≥¿LCP sam∂êfûe!" << std::
ídl
;

98 
dñëe
 
∂˝
;

101 
l˝
 = 
√w
 
	`LCPSam∂es
(
l˝_fûe
);

102 
°d
::
cout
 << "Sam∂ed LCP: " << (
l˝
->
	`ªp‹tSize
(Ë/ ()
MEGABYTE
Ë<< " MB" << std::
ídl
;

103 
l˝_fûe
.
	`˛o£
();

105 
°d
::
cout
 << std::
ídl
;

107 
	`§™d
(
£ed
);

108 
usöt
* 
posôi⁄s
 = 
√w
 usöt[
quîõs
];

109 
usöt
* 
ªsu…s1
 = 
√w
 usöt[
quîõs
];

110 
usöt
* 
ªsu…s2
 = 
√w
 usöt[
quîõs
];

111 
usöt
* 
ªsu…s3
 = 
√w
 usöt[
quîõs
];

112 
usöt
* 
ªsu…s4
 = 
√w
 usöt[
quîõs
];

113 
usöt
 
i
 = 0; i < 
quîõs
; i++)

115 
posôi⁄s
[
i
] = 
	`ønd
(Ë% 
æcß
.
	`gëSize
();

117 
°¨t
, 
time
;

118 
usöt
 
tŸÆ
;

120 if(
mode_dúe˘
)

122 
°d
::
cout
 << "Dúe˘ LCP compuèti⁄:" << std::
ídl
;

123 
usöt
 
j
 = 0; j < 
runs
; j++)

125 
tŸÆ
 = 0;

126 
°¨t
 = 
	`ªadTimî
();

127 
usöt
 
i
 = 0; i < 
quîõs
; i++)

129 
ªsu…s1
[
i
] = 
æcß
.
	`l˝Dúe˘
(
posôi⁄s
[i]);

130 
tŸÆ
 +
ªsu…s1
[
i
];

132 
time
 = 
	`ªadTimî
(Ë- 
°¨t
;

133 
°d
::
cout
 << 
quîõs
 << " quîõ†ö " << 
time
 << " sec⁄d†(" << (quîõ†/ÅimeË<< " / s)" << std::
ídl
;

135 if(
°ïs
Ë{ 
°d
::
cout
 << 
tŸÆ
 << " sãp†(" << (((ÈŸÆË/ 
quîõs
Ë<< " / quîy)" << std::
ídl
; }

136 
°d
::
cout
 << std::
ídl
;

139 if(
mode_∂˝
)

141 
°d
::
cout
 << "Usög PLCP:" << std::
ídl
;

142 
PLCPVe˘‹
::
Iãøt‹
 
	`ôî
(*
∂˝
);

143 
usöt
 
j
 = 0; j < 
runs
; j++)

145 
tŸÆ
 = 0;

146 
°¨t
 = 
	`ªadTimî
();

147 
usöt
 
i
 = 0; i < 
quîõs
; i++)

149 
usöt
 
pos
 = 
æcß
.
	`loˇã
(
posôi⁄s
[
i
], 
°ïs
);

150 
tŸÆ
 +
pos
;

151 
ªsu…s2
[
i
] = 
ôî
.
	`£À˘
(
pos
) - 2 *Öos;

153 
time
 = 
	`ªadTimî
(Ë- 
°¨t
;

154 
°d
::
cout
 << 
quîõs
 << " quîõ†ö " << 
time
 << " sec⁄d†(" << (quîõ†/ÅimeË<< " / s)" << std::
ídl
;

156 if(
°ïs
Ë{ 
°d
::
cout
 << 
tŸÆ
 << " sãp†(" << (((ÈŸÆË/ 
quîõs
Ë<< " / quîy)" << std::
ídl
; }

157 
°d
::
cout
 << std::
ídl
;

160 if(
mode_ßm∂ed
)

162 
°d
::
cout
 << "Usög Sam∂ed LCP:" << std::
ídl
;

163 
usöt
 
j
 = 0; j < 
runs
; j++)

165 
tŸÆ
 = 0;

166 
°¨t
 = 
	`ªadTimî
();

167 
usöt
 
i
 = 0; i < 
quîõs
; i++)

169 
ªsu…s3
[
i
] = 
æcß
.
	`l˝
(
posôi⁄s
[i], *
l˝
, 
°ïs
);

170 
tŸÆ
 +
ªsu…s3
[
i
];

172 
time
 = 
	`ªadTimî
(Ë- 
°¨t
;

173 
°d
::
cout
 << 
quîõs
 << " quîõ†ö " << 
time
 << " sec⁄d†(" << (quîõ†/ÅimeË<< " / s)" << std::
ídl
;

175 if(
°ïs
Ë{ 
°d
::
cout
 << 
tŸÆ
 << " sãp†(" << (((ÈŸÆË/ 
quîõs
Ë<< " / quîy)" << std::
ídl
; }

176 
°d
::
cout
 << std::
ídl
;

179 if(
mode_loˇã
)

181 
°d
::
cout
 << "Loˇã:" << std::
ídl
;

182 
usöt
 
j
 = 0; j < 
runs
; j++)

184 
tŸÆ
 = 0;

185 
°¨t
 = 
	`ªadTimî
();

186 
usöt
 
i
 = 0; i < 
quîõs
; i++)

188 
ªsu…s4
[
i
] = 
æcß
.
	`loˇã
(
posôi⁄s
[i], 
°ïs
);

189 
tŸÆ
 +
ªsu…s4
[
i
];

191 
time
 = 
	`ªadTimî
(Ë- 
°¨t
;

192 
°d
::
cout
 << 
quîõs
 << " quîõ†ö " << 
time
 << " sec⁄d†(" << (quîõ†/ÅimeË<< " / s)" << std::
ídl
;

194 if(
°ïs
Ë{ 
°d
::
cout
 << 
tŸÆ
 << " sãp†(" << (((ÈŸÆË/ 
quîõs
Ë<< " / quîy)" << std::
ídl
; }

195 
°d
::
cout
 << std::
ídl
;

198 if(
mode_vîify
 && 
modes
 > 1)

200 
usöt
 
i
 = 0; i < 
quîõs
; i++)

202 
boﬁ
 
ok
 = 
åue
;

203 
ok
 &!
mode_dúe˘
 | !
mode_∂˝
 | (
ªsu…s1
[
i
] =
ªsu…s2
[i]);

204 
ok
 &!
mode_dúe˘
 | !
mode_ßm∂ed
 | (
ªsu…s1
[
i
] =
ªsu…s3
[i]);

205 
ok
 &!
mode_∂˝
 | !
mode_ßm∂ed
 | (
ªsu…s2
[
i
] =
ªsu…s3
[i]);

206 if(!
ok
)

208 
°d
::
cout
 << "Quîy " << 
i
 << ": LCP[" << 
posôi⁄s
[i] << "] = ";

209 if(
mode_dúe˘
Ë{ 
°d
::
cout
 << 
ªsu…s1
[
i
] << " (direct) "; }

210 if(
mode_∂˝
Ë{ 
°d
::
cout
 << 
ªsu…s2
[
i
] << " (plcp) "; }

211 if(
mode_ßm∂ed
Ë{ 
°d
::
cout
 << 
ªsu…s3
[
i
] << " (sampled) "; }

212 
°d
::
cout
 << std::
ídl
;

217 
dñëe
[] 
posôi⁄s
;

218 
dñëe
[] 
ªsu…s1
; dñëe[] 
ªsu…s2
; dñëe[] 
ªsu…s3
; dñëe[] 
ªsu…s4
;

219 
dñëe
 
∂˝
; dñëê
l˝
;

221 
	}
}

	@lcpsamples.cpp

1 
	~<Æg‹ôhm
>

2 
	~<f°ªam
>

3 
	~<io°ªam
>

5 
	~"l˝ßm∂es.h
"

6 
	~"misc/utûs.h
"

9 
«me•a˚
 
	gCSA


13 
	gLCPSam∂es
::
LCPSam∂es
(
°d
::
if°ªam
& 
ßm∂e_fûe
)

15 
this
->
ödexes
 = 
√w
 
LCPVe˘‹
(
ßm∂e_fûe
);

16 
	gthis
->
	gvÆues
 = 
√w
 
Aºay
(
ßm∂e_fûe
);

18 
	gthis
->
	gsize
 = 
ödexes
->
gëSize
();

19 
	gthis
->
	gôems
 = 
ödexes
->
gëNumbîOfIãms
();

22 
	gLCPSam∂es
::
LCPSam∂es
(
FILE
* 
ßm∂e_fûe
)

24 if(
ßm∂e_fûe
 == 0) { ; }

26 
	gthis
->
	gödexes
 = 
√w
 
LCPVe˘‹
(
ßm∂e_fûe
);

27 
	gthis
->
	gvÆues
 = 
√w
 
Aºay
(
ßm∂e_fûe
);

29 
	gthis
->
	gsize
 = 
ödexes
->
gëSize
();

30 
	gthis
->
	gôems
 = 
ödexes
->
gëNumbîOfIãms
();

33 
	gLCPSam∂es
::
LCPSam∂es
(
∑ú_ty≥
* 
öput
, 
usöt
 
_size
, usöà
_ôems
, 
boﬁ
 
ªp‹t
, boﬁ 
‰ì_öput
) :

34 
size
(
_size
),

35 
ôems
(
_ôems
)

37 
	gLCPVe˘‹
::
Encodî
 
ödex_ícodî
(
LCPSam∂es
::
INDEX_BLOCK_SIZE
);

38 
AºayEncodî
 
vÆue_ícodî
(
LCPSam∂es
::
VALUE_BLOCK_SIZE
);

40 
usöt
 
	gmax_ßm∂e
 = 0;

41 
usöt
 
	gi
 = 0; i < 
	gthis
->
	gôems
; i++)

43 
	gödex_ícodî
.
£tBô
(
öput
[
i
].
fú°
);

44 
	gvÆue_ícodî
.
addIãm
(
öput
[
i
].
£c⁄d
 + 1);

45 
	gmax_ßm∂e
 = 
°d
::
max
(
max_ßm∂e
, 
öput
[
i
].
£c⁄d
);

48 
	gthis
->
	gödexes
 = 
√w
 
LCPVe˘‹
(
ödex_ícodî
, 
this
->
size
);

49 
	gthis
->
	gvÆues
 = 
√w
 
Aºay
(
vÆue_ícodî
);

51 if(
	g‰ì_öput
Ë{ 
	gdñëe
[] 
	göput
; }

53 if(
	gªp‹t
)

55 
usöt
 
	gmax_bôs
 = 
Àngth
(
max_ßm∂e
);

56 
	gtŸÆ_size
 = 
max_bôs
 * ()(
this
->
ôems
Ë/ (
CHAR_BIT
 * ()
MEGABYTE
);

57 
	g°d
::
cout
 << "Maximum sam∂êvÆue: " << 
max_ßm∂e
 << " (" << 
max_bôs
 << " bôs)" << 
°d
::
ídl
;

58 
	g°d
::
cout
 << "Raw sam∂es: " << 
tŸÆ_size
 << " MB" << 
°d
::
ídl
;

59 
	g°d
::
cout
 << "Encoded sam∂es: " << (
this
->
vÆues
->
ªp‹tSize
(Ë/ ()
MEGABYTE
Ë<< " MB" << 
°d
::
ídl
;

60 
	g°d
::
cout
 << 
°d
::
ídl
;

64 
	gLCPSam∂es
::
LCPSam∂es
(
LCPVe˘‹
::
Encodî
& 
ödex_ícodî
, 
AºayEncodî
& 
vÆue_ícodî
, 
usöt
 
_size
) :

65 
size
(
_size
)

67 
this
->
ödexes
 = 
√w
 
LCPVe˘‹
(
ödex_ícodî
,Åhis->
size
);

68 
	gthis
->
	gvÆues
 = 
√w
 
Aºay
(
vÆue_ícodî
);

69 
	gthis
->
	gôems
 = 
this
->
ödexes
->
gëNumbîOfIãms
();

72 
	gLCPSam∂es
::~
LCPSam∂es
()

74 
dñëe
 
this
->
ödexes
;

75 
dñëe
 
	gthis
->
	gvÆues
;

79 
	gLCPSam∂es
::
wrôeTo
(
°d
::
of°ªam
& 
ßm∂e_fûe
) const

81 
this
->
ödexes
->
wrôeTo
(
ßm∂e_fûe
);

82 
	gthis
->
	gvÆues
->
wrôeTo
(
ßm∂e_fûe
);

86 
	gLCPSam∂es
::
wrôeTo
(
FILE
* 
ßm∂e_fûe
) const

88 
this
->
ödexes
->
wrôeTo
(
ßm∂e_fûe
);

89 
	gthis
->
	gvÆues
->
wrôeTo
(
ßm∂e_fûe
);

94 
usöt


95 
	gLCPSam∂es
::
ªp‹tSize
() const

97 
usöt
 
byãs
 = (*
this
);

98 
	gbyãs
 +
this
->
ödexes
->
ªp‹tSize
();

99 
	gbyãs
 +
this
->
vÆues
->
ªp‹tSize
();

100  
	gbyãs
;

	@lcpsamples.h

1 #i‚de‡
LCPSAMPLES_H


2 
	#LCPSAMPLES_H


	)

4 
	~<c°dio
>

5 
	~<f°ªam
>

8 #ifde‡
SUCCINCT_LCP_VECTOR


9 
	~"bôs/succö˘ve˘‹.h
"

11 
	~"bôs/dñève˘‹.h
"

14 
	~"bôs/¨øy.h
"

15 
	~"misc/utûs.h
"

18 
«me•a˚
 
	gCSA


22 #ifde‡
SUCCINCT_LCP_VECTOR


23 
Succö˘Ve˘‹
 
	tLCPVe˘‹
;

25 
DñèVe˘‹
 
	tLCPVe˘‹
;

29 ˛as†
	cLCPSam∂es


31 
	gpublic
:

32 #ifde‡
SUCCINCT_LCP_VECTOR


33 c⁄° 
usöt
 
INDEX_BLOCK_SIZE
 = 32;

35 c⁄° 
usöt
 
	gINDEX_BLOCK_SIZE
 = 16;

37 c⁄° 
usöt
 
	gVALUE_BLOCK_SIZE
 = 32;

39 
ex∂icô
 
LCPSam∂es
(
°d
::
if°ªam
& 
ßm∂e_fûe
);

40 
ex∂icô
 
LCPSam∂es
(
FILE
* 
ßm∂e_fûe
);

43 
LCPSam∂es
(
∑ú_ty≥
* 
öput
, 
usöt
 
_size
, usöà
_ôems
, 
boﬁ
 
ªp‹t
 = 
Ál£
, boﬁ 
‰ì_öput
 = false);

45 
LCPSam∂es
(
LCPVe˘‹
::
Encodî
& 
ödex_ícodî
, 
AºayEncodî
& 
vÆue_ícodî
, 
usöt
 
_size
);

47 ~
LCPSam∂es
();

49 
wrôeTo
(
°d
::
of°ªam
& 
ßm∂e_fûe
) const;

50 
wrôeTo
(
FILE
* 
fûe
) const;

52 
ölöe
 
boﬁ
 
isSam∂ed
(
usöt
 
ß_ödex
) const

54 
	gLCPVe˘‹
::
Iãøt‹
 
ôî
(*(
this
->
ödexes
));

55  
	gôî
.
isSë
(
ß_ödex
);

59 
ölöe
 
usöt
 
gëSam∂eAt
(usöà
ß_ödex
) const

61 
	gLCPVe˘‹
::
Iãøt‹
 
ödex_ôî
(*(
this
->
ödexes
));

62 
	gAºay
::
Iãøt‹
 
vÆue_ôî
(*(
this
->
vÆues
));

63  
	gvÆue_ôî
.
gëIãm
(
ödex_ôî
.
ønk
(
ß_ödex
) - 1) - 1;

66 
ölöe
 
usöt
 
gëNumbîOfSam∂es
(Ëc⁄° {  
	gthis
->
	gôems
; }

68 
usöt
 
ªp‹tSize
() const;

70 
	g¥iv©e
:

71 
usöt
 
size
, 
	gôems
;

73 
LCPVe˘‹
* 
	gödexes
;

74 
Aºay
* 
	gvÆues
;

77 
LCPSam∂es
();

78 
LCPSam∂es
(const LCPSamples&);

79 
	gLCPSam∂es
& 
	g›î©‹
 = (c⁄° 
LCPSam∂es
&);

	@locate_test.cpp

1 
	~<Æg‹ôhm
>

2 
	~<c°dlib
>

3 
	~<˘ime
>

4 
	~<f°ªam
>

5 
	~<io°ªam
>

7 
	~"æcß.h
"

8 
	~"misc/utûs.h
"

11 
usög
 
«me•a˚
 
	gCSA
;

14 
	$maö
(
¨gc
, ** 
¨gv
)

16 
°d
::
cout
 << "RLCSAÜoˇãÅe°" << std::
ídl
;

17 if(
¨gc
 < 3)

19 
°d
::
cout
 << "Ußge:Üoˇã_ã° ba£«mê[begöÉnd] ouçuà[d|s]" << std::
ídl
;

20 
°d
::
cout
 << " d U£ dúe˘Üoˇã." << std::
ídl
;

21 
°d
::
cout
 << " s Ouçuà®32-bô suffixáºay." << std::
ídl
;

25 
usöt
 
begö
 = 0, 
íd
 = 0;

26 
ouçut_¨g
 = 2;

27 
°d
::
cout
 << "Ba£Çame: " << 
¨gv
[1] << std::
ídl
;

28 if(
¨gc
 >= 5)

30 
ouçut_¨g
 = 4;

31 
begö
 = 
	`©oi
(
¨gv
[2]), 
íd
 =átoi(argv[3]);

32 
°d
::
cout
 << "Begö: " << 
begö
 << std::
ídl
;

33 
°d
::
cout
 << "End: " << 
íd
 << std::
ídl
;

34 if(
begö
 > 
íd
)

36 
°d
::
˚º
 << "Eº‹: Em±yÑ™ge!" << std::
ídl
;

41 
boﬁ
 
dúe˘
 = 
Ál£
, 
do_ouçut
 = false;

42 
i
 = 
ouçut_¨g
 + 1; i < 
¨gc
; i++)

44 
¨gv
[
i
][0])

47 
dúe˘
 = 
åue
; ;

49 
do_ouçut
 = 
åue
; ;

52 if(!
dúe˘
)

54 
°d
::
cout
 << "UsögÑun-ba£d o±imiz©i⁄s." << std::
ídl
;

58 
°d
::
cout
 << "Usög dúe˘Üoˇã." << std::
ídl
;

60 if(
do_ouçut
)

62 
°d
::
cout
 << "WrôögÖœö SAÅÿouçuàfûe, ign‹ög begöándÉnd." << std::
ídl
;

64 
°d
::
cout
 << std::
ídl
;

66 
RLCSA
 
	`æcß
(
¨gv
[1]);

67 if(!
æcß
.
	`suµ‹tsLoˇã
())

69 
°d
::
˚º
 << "Eº‹: Loˇã i†nŸ suµ‹ãd!" << std::
ídl
;

73 if(
ouçut_¨g
 =4 && !
do_ouçut
)

75 if(
íd
 >
æcß
.
	`gëSize
())

77 
°d
::
˚º
 << "Eº‹: InvÆidÑ™ge!" << std::
ídl
;

83 
begö
 = 0; 
íd
 = 
æcß
.
	`gëSize
() - 1;

86 
°d
::
of°ªam
 
	`ouçut
(
¨gv
[
ouçut_¨g
], std::
ios_ba£
::
bö¨y
);

87 if(!
ouçut
)

89 
°d
::
˚º
 << "Eº‹: C™nŸ o≥¿ouçuàfûe!" << std::
ídl
;

93 
usöt
* 
buf„r
 = 
√w
 usöt[
MILLION
]; 
CSA
::
uöt
 
ãmp
;

94 
°d
::
˛ock_t
 
°¨t
 = std::
	`˛ock
();

95 if(
do_ouçut
Ë{ 
ãmp
 = 
æcß
.
	`gëSize
(); 
ouçut
.
	`wrôe
((*)&temp, (temp)); }

96 
usöt
 
cuº
 = 
begö
; cuº <
íd
; cuº +
MILLION
)

98 
∑ú_ty≥
 
	`ønge
(
cuº
, 
°d
::
	`mö
(
íd
, cuº + 
MILLION
 - 1));

99 if(
dúe˘
)

101 
usöt
 
i
 = 0; i < 
ønge
.
£c⁄d
 + 1 -Ñ™ge.
fú°
; i++)

103 
buf„r
[
i
] = 
æcß
.
	`loˇã
(
cuº
 + i, 
Ál£
);

106 { 
æcß
.
	`loˇã
(
ønge
, 
buf„r
); }

107 
usöt
 
i
 = 0; i < 
ønge
.
£c⁄d
 + 1 -Ñ™ge.
fú°
; i++)

109 if(
do_ouçut
Ë{ 
ãmp
 = 
buf„r
[
i
]; 
ouçut
.
	`wrôe
((*)&temp, (temp)); }

110 { 
ouçut
.
	`wrôe
((*)&(
buf„r
[
i
]), (
usöt
)); }

113 
°d
::
˛ock_t
 
°›
 = std::
	`˛ock
();

114 
dñëe
[] 
buf„r
;

116 
size
 = (
íd
 + 1 - 
begö
);

117 
time
 = (
°›
 - 
°¨t
Ë/ ()
CLOCKS_PER_SEC
;

118 
°d
::
cout
 << 
size
 << "Üoˇã†ö " << 
time
 << " sec⁄d†(" << (sizê/ÅimeË<< "Üoˇãs/s)" << std::
ídl
;

119 
ouçut
.
	`˛o£
();

122 
	}
}

	@misc/definitions.h

1 #i‚de‡
DEFINITIONS_H


2 
	#DEFINITIONS_H


	)

4 
	~<Æg‹ôhm
>

5 
	~<˛imôs
>

12 
«me•a˚
 
	gCSA


16 #ifde‡
MASSIVE_DATA_RLCSA


18 
	tusöt
;

19 sig√d 
	tsöt
;

21 
ölöe
 
usöt
 
p›cou¡
(usöà
fõld
)

23  
__buûtö_p›cou¡l
(
fõld
);

28 
	tusöt
;

29 sig√d 
	tsöt
;

31 
ölöe
 
usöt
 
p›cou¡
(usöà
fõld
)

33  
__buûtö_p›cou¡
(
fõld
);

39 #i‚de‡
uch¨


40 
	tuch¨
;

43 
	g°d
::
	t∑ú
<
	tusöt
, usöt> 
	t∑ú_ty≥
;

46 
ölöe
 
usöt
 
Àngth
(usöà
n
)

48 
usöt
 
	gb
 = 0;

49 
	gn
 > 0Ë{ 
	gb
++;Ç >>= 1; }

50  
	gb
;

53 
ölöe
 
boﬁ
 
isEm±y
(c⁄° 
∑ú_ty≥
 
d©a
)

55  (
	gd©a
.
	gfú°
 > d©a.
	g£c⁄d
);

58 
ölöe
 
usöt
 
Àngth
(c⁄° 
∑ú_ty≥
 
d©a
)

60  
	gd©a
.
	g£c⁄d
 + 1 - d©a.
	gfú°
;

63 
ölöe
 
usöt
 
√xtMu…ùÀOf
(usöà
mu…ùlõr
, usöà
vÆue
)

65  
	gmu…ùlõr
 * ((
	gvÆue
 / multiplier) + 1);

69 c⁄° 
usöt
 
	gCHARS
 = ((usöt)1 << 
CHAR_BIT
);

70 c⁄° 
usöt
 
	gMEGABYTE
 = 1048576;

71 c⁄° 
usöt
 
	gMILLION
 = 1000000;

72 c⁄° 
usöt
 
	gWORD_BITS
 = 
CHAR_BIT
 * (usint);

73 c⁄° 
usöt
 
	gWORD_MAX
 = ~((usint)0);

75 c⁄° 
∑ú_ty≥
 
	gEMPTY_PAIR
 =Öair_type(1, 0);

81 
	#GET
(
FIELD
, 
BITS
Ë((FIELDË& (
WORD_MAX
 >> (
WORD_BITS
 - (BITS))))

	)

82 
	#LOWER
(
FIELD
, 
N
Ë((FIELDË>> (N))

	)

83 
	#HIGHER
(
FIELD
, 
N
Ë((FIELDË<< (N))

	)

85 
	#BITS_TO_BYTES
(
BITS
Ë(((BITSË+ 
CHAR_BIT
 - 1Ë/ CHAR_BIT)

	)

86 
	#BYTES_TO_WORDS
(
BYTES
Ë(((BYTESË+ (
usöt
Ë- 1Ë/ (usöt))

	)

87 
	#BITS_TO_WORDS
(
BITS
Ë(((BITSË+ 
WORD_BITS
 - 1Ë/ WORD_BITS)

	)

	@misc/parameters.cpp

1 
	~<io°ªam
>

2 
	~<s°ªam
>

4 
	~"∑ømëîs.h
"

7 
«me•a˚
 
	gCSA


11 
boﬁ


12 
	gP¨amëîs
::
c⁄èös
(c⁄° 
°d
::
°rög
& 
key
) const

14  (
this
->
∑ømëîs
.
föd
(
key
Ë!this->∑ømëîs.
íd
());

17 
usöt


18 
	gP¨amëîs
::
gë
(c⁄° 
°d
::
°rög
& 
key
) const

20 
°d
::
m≠
<°d::
°rög
, 
	gusöt
>::
c⁄°_ôî©‹
 
ôî
 = 
this
->
∑ømëîs
.
föd
(
key
);

21 if(
	gôî
 =
this
->
∑ømëîs
.
íd
()) {  0; }

22  
	gôî
->
	g£c⁄d
;

25 
usöt


26 
	gP¨amëîs
::
gë
(c⁄° 
∑ømëî_ty≥
& 
∑øm
) const

28  
this
->
gë
(
∑øm
.
fú°
);

32 
	gP¨amëîs
::
£t
(c⁄° 
°d
::
°rög
& 
key
, 
usöt
 
vÆue
)

34 
	gthis
->
	g∑ømëîs
[
key
] = 
vÆue
;

38 
	gP¨amëîs
::
£t
(c⁄° 
∑ømëî_ty≥
& 
∑øm
)

40 
this
->
£t
(
∑øm
.
fú°
,Ö¨am.
£c⁄d
);

44 
	gP¨amëîs
::
ªad
(
°d
::
if°ªam
& 
fûe
)

46 
fûe
)

48 
°d
::
°rög
 
key
;

49 
	g°d
::
°rög
 
c
;

50 
usöt
 
	gvÆue
;

52 
	gfûe
 >> 
	gkey
 >> 
	gc
 >> 
	gvÆue
;

53 if(
	gc
 ="="Ë{ 
this
->
∑ømëîs
[
key
] = 
vÆue
; }

58 
	gP¨amëîs
::
ªad
(
FILE
* 
fûe
)

60 if(
fûe
 == 0) { ; }

62 !
	g°d
::
„of
(
fûe
))

64 
buf„r
[1000];

65 if(!
	g°d
::
fgës
(
buf„r
, 1000, 
fûe
)) { ; }

66 
	g°d
::
°rög°ªam
 
°ªam
;

67 
	g°ªam
 << 
	gbuf„r
;

69 
	g°d
::
°rög
 
key
;

70 
	g°d
::
°rög
 
c
;

71 
usöt
 
	gvÆue
;

72 
	g°ªam
 >> 
	gkey
 >> 
	gc
 >> 
	gvÆue
;

73 if(
	gc
 ="="Ë{ 
this
->
∑ømëîs
[
key
] = 
vÆue
; }

77 
	gP¨amëîs
::
ªad
(c⁄° 
°d
::
°rög
& 
fûe_«me
)

79 
°d
::
if°ªam
 
fûe
(
fûe_«me
.
c_°r
(), std::
ios_ba£
::
bö¨y
);

80 if(!
	gfûe
)

82 
	g°d
::
˚º
 << "C™nŸ o≥¿∑ømëî fûê" << 
fûe_«me
 << " f‹Ñódög!" << 
°d
::
ídl
;

85 
	gthis
->
ªad
(
fûe
);

86 
	gfûe
.
˛o£
();

90 
	gP¨amëîs
::
¥öt
() const

92 
this
->
wrôe
(
°d
::
cout
);

93 
	g°d
::
cout
 << 
°d
::
ídl
;

97 
	gP¨amëîs
::
wrôe
(
°d
::
o°ªam
& 
°ªam
) const

99 
°d
::
m≠
<°d::
°rög
, 
	gusöt
>::
c⁄°_ôî©‹
 
ôî
 = 
this
->
∑ømëîs
.
begö
(); 
	gôî
 !this->∑ømëîs.
íd
(); iter++)

101 
	g°ªam
 << 
	gôî
->
	gfú°
 << " = " << iãr->
	g£c⁄d
 << 
	g°d
::
ídl
;

106 
	gP¨amëîs
::
wrôe
(
FILE
* 
fûe
) const

108 if(
fûe
 == 0) { ; }

110 
	g°d
::
m≠
<
°d
::
°rög
, 
	gusöt
>::
c⁄°_ôî©‹
 
ôî
 = 
this
->
∑ømëîs
.
begö
(); 
	gôî
 !this->∑ømëîs.
íd
(); iter++)

112 
	g°d
::
°rög°ªam
 
buf„r
;

113 
	gbuf„r
 << 
	gôî
->
	gfú°
 << " = " << iãr->
	g£c⁄d
 << 
	g°d
::
ídl
;

114 
	g°d
::
°rög
 
löe
 = 
buf„r
.
°r
();

115 
	g°d
::
fwrôe
(
löe
.
c_°r
(),Üöe.
Àngth
(), 1, 
fûe
);

120 
	gP¨amëîs
::
wrôe
(c⁄° 
°d
::
°rög
& 
fûe_«me
) const

122 
°d
::
of°ªam
 
fûe
(
fûe_«me
.
c_°r
(), std::
ios_ba£
::
bö¨y
);

123 if(!
	gfûe
)

125 
	g°d
::
˚º
 << "C™nŸ o≥¿∑ømëî fûê" << 
fûe_«me
 << " f‹ wrôög!" << 
°d
::
ídl
;

128 
	gthis
->
wrôe
(
fûe
);

129 
	gfûe
.
˛o£
();

	@misc/parameters.h

1 #i‚de‡
PARAMETERS_H


2 
	#PARAMETERS_H


	)

4 
	~<c°dio
>

5 
	~<f°ªam
>

6 
	~<m≠
>

8 
	~"deföôi⁄s.h
"

11 
«me•a˚
 
	gCSA


15 
	g°d
::
	t∑ú
<
	t°d
::
	t°rög
, 
	tusöt
> 
	t∑ømëî_ty≥
;

18 ˛as†
	cP¨amëîs


20 
	gpublic
:

21 
P¨amëîs
() {};

22 ~
P¨amëîs
() {};

24 
boﬁ
 
c⁄èös
(c⁄° 
°d
::
°rög
& 
key
) const;

25 
usöt
 
gë
(c⁄° 
°d
::
°rög
& 
key
) const;

26 
usöt
 
gë
(c⁄° 
∑ømëî_ty≥
& 
∑øm
) const;

27 
£t
(c⁄° 
°d
::
°rög
& 
key
, 
usöt
 
vÆue
);

28 
£t
(c⁄° 
∑ømëî_ty≥
& 
∑øm
);

30 
ªad
(
°d
::
if°ªam
& 
fûe
);

31 
ªad
(
FILE
* 
fûe
);

32 
ªad
(c⁄° 
°d
::
°rög
& 
fûe_«me
);

33 
¥öt
() const;

34 
wrôe
(
°d
::
o°ªam
& 
°ªam
) const;

35 
wrôe
(
FILE
* 
fûe
) const;

36 
wrôe
(c⁄° 
°d
::
°rög
& 
fûe_«me
) const;

38 
	g¥iv©e
:

39 
°d
::
m≠
<°d::
°rög
, 
	gusöt
> 
	g∑ømëîs
;

	@misc/utils.cpp

1 
	~<c°dlib
>

2 
	~<io°ªam
>

3 
	~<f°ªam
>

4 
	~<limôs
>

6 
	~<sys/ªsour˚.h
>

8 
	~"utûs.h
"

10 #ifde‡
MULTITHREAD_SUPPORT


11 
	~<omp.h
>

15 
«me•a˚
 
	gCSA


20 
	g°d
::
°ªamoff


21 
fûeSize
(
°d
::
if°ªam
& 
fûe
)

23 
°d
::
°ªamoff
 
cuº
 = 
fûe
.
ãŒg
();

25 
	gfûe
.
£ekg
(0, 
°d
::
ios
::
íd
);

26 
	g°d
::
°ªamoff
 
size
 = 
fûe
.
ãŒg
();

27 
	gfûe
.
£ekg
(0, 
°d
::
ios
::
beg
);

28 
	gsize
 -
fûe
.
ãŒg
();

30 
	gfûe
.
£ekg
(
cuº
, 
°d
::
ios
::
beg
);

31  
	gsize
;

34 
	g°d
::
°ªamoff


35 
fûeSize
(
°d
::
of°ªam
& 
fûe
)

37 
°d
::
°ªamoff
 
cuº
 = 
fûe
.
ãŒp
();

39 
	gfûe
.
£ekp
(0, 
°d
::
ios
::
íd
);

40 
	g°d
::
°ªamoff
 
size
 = 
fûe
.
ãŒp
();

41 
	gfûe
.
£ekp
(0, 
°d
::
ios
::
beg
);

42 
	gsize
 -
fûe
.
ãŒp
();

44 
	gfûe
.
£ekp
(
cuº
, 
°d
::
ios
::
beg
);

45  
	gsize
;

49 
œrgeWrôe
(
°d
::
of°ªam
& 
fûe
, * 
d©a
, std::
°ªamoff
 
size
, std::°ªamof‡
block_size
)

51 
block_size
 = 
°d
::
max
(block_size, (°d::
°ªamoff
)1);

52 
	gblock_size
 *
MEGABYTE
;

54 
	g°d
::
°ªamoff
 
i
 = 0; 
	gi
 < 
	gsize
; i +
block_size
)

56 
fûe
.
wrôe
(
d©a
 + 
i
, 
°d
::
mö
(
size
 - i, 
block_size
));

63 
ªadRows
(
°d
::
if°ªam
& 
fûe
, std::
ve˘‹
<°d::
°rög
>& 
rows
, 
boﬁ
 
skùEm±yRows
)

65 
	gfûe
)

67 
	g°d
::
°rög
 
buf
;

68 
	g°d
::
gëlöe
(
fûe
, 
buf
);

69 if(
	gskùEm±yRows
 && 
	gbuf
.
Àngth
() == 0) { ; }

70 
	grows
.
push_back
(
buf
);

75 
ªadPizzaChûi
(
°d
::
if°ªam
& 
fûe
, std::
ve˘‹
<°d::
°rög
>& 
∑âîns
)

77 
°d
::
°rög
 
hódî
;

78 
	g°d
::
gëlöe
(
fûe
, 
hódî
);

80 
	g°d
::
size_t
 
°¨t
 = 
hódî
.
föd
("number=");

81 if(
	g°¨t
 =
°d
::
°rög
::
≈os
) { ; }

82 
	gãmp
 = 
°d
::
©oi
(
hódî
.
sub°r
(
°¨t
 + 7).
c_°r
());

83 if(
	gãmp
 <= 0) { ; }

84 
usöt
 
	gn
 = 
ãmp
;

86 
	g°¨t
 = 
hódî
.
föd
("length=");

87 if(
	g°¨t
 =
°d
::
°rög
::
≈os
) { ; }

88 
	gãmp
 = 
°d
::
©oi
(
hódî
.
sub°r
(
°¨t
 + 7).
c_°r
());

89 if(
	gãmp
 <= 0) { ; }

90 
usöt
 
	gl
 = 
ãmp
;

92 
	gbuf„r
[
l
];

93 
usöt
 
	gi
 = 0; i < 
	gn
; i++)

95 
	gfûe
.
ªad
(
buf„r
, 
l
);

96 
	g∑âîns
.
push_back
(
°d
::
°rög
(
buf„r
, 
l
));

103 
ªadTimî
()

105 #ifde‡
MULTITHREAD_SUPPORT


106  
omp_gë_wtime
();

108  
˛ock
(Ë/ ()
	gCLOCKS_PER_SEC
;

112 
usöt


113 
mem‹yUßge
()

115 
rußge
 
	gußge
;

116 
gërußge
(
RUSAGE_SELF
, &
ußge
);

117  
	gußge
.
	gru_maxrss
;

122 
	g°d
::
	t∑ú
<
	tuöt
, uöt> 
	tss_ønge
;

123 
	g°d
::
	t∑ú
<
	tuöt
, 
	tusöt
> 
	tskew_∑ú
;

125 
	sSSSkewCom∑øt‹


127 
boﬁ
 
›î©‹
(Ë(c⁄° 
	gskew_∑ú
& 
	ga
, c⁄° skew_∑ú& 
	gb
) const

129  (
	ga
.
	g£c⁄d
 < 
	gb
.second);

131 } 
	gskew_com∑øt‹
;

133 
	sSSKeyCom∑øt‹


135 
boﬁ
 
›î©‹
(Ë(c⁄° 
	gsh‹t_∑ú
& 
	ga
, c⁄° sh‹t_∑ú& 
	gb
) const

137  (
	ga
.
	g£c⁄d
 < 
	gb
.second);

139 } 
	gkey_com∑øt‹
;

141 
	gãm∂©e
<
˛ass
 
	gT
>

142 
uöt


143 
£tR™ks
(
T
* 
∑ús
, 
uöt
* 
keys
, uöà
n
, 
°d
::
ve˘‹
<
ss_ønge
>& 
uns‹ãd
, uöà
thªads
, uöà
chunk
)

145 
uöt
 
	gtŸÆ
 = 0;

147 #ifde‡
MULTITHREAD_SUPPORT


148 
	g°d
::
ve˘‹
<
ss_ønge
> 
buf„rs
[
thªads
];

149 
uöt
 
	gsubtŸÆs
[
thªads
];

150 
uöt
 
	gi
 = 0; i < 
	gthªads
; i++Ë{ 
	gsubtŸÆs
[
i
] = 0; }

152 
	g°d
::
ve˘‹
<
ss_ønge
> 
√xt_uns‹ãd
;

155 #¥agm®
omp
 
∑øŒñ
 
scheduÀ
(
dy«mic
, 
chunk
)

156 
uöt
 
	gi
 = 0; i < 
	guns‹ãd
.
size
(); i++)

158 #ifde‡
MULTITHREAD_SUPPORT


159 
uöt
 
	gthªad
 = 
omp_gë_thªad_num
();

161 
T
* 
	g¥ev
 = 
∑ús
 + 
uns‹ãd
[
i
].
fú°
;

162 
	gkeys
[
¥ev
->
fú°
] = 
uns‹ãd
[
i
].first;

163 
T
* 
	glimô
 = 
∑ús
 + 
uns‹ãd
[
i
].
£c⁄d
;

164 
	g¥ev
 < 
	glimô
)

166 
T
* 
	gcuº
 = 
¥ev
 + 1;

167 if(
	gcuº
->
	g£c⁄d
 !
¥ev
->
£c⁄d
)

169 ++
¥ev
; 
	gkeys
[¥ev->
fú°
] =Öªv - 
∑ús
;

172 
	gkeys
[
cuº
->
fú°
] = 
¥ev
 - 
∑ús
;

174 ++
	gcuº
; cuº <
limô
 && 
cuº
->
£c⁄d
 =
¥ev
->second; ++curr)

176 
	gkeys
[
cuº
->
fú°
] = 
¥ev
 - 
∑ús
;

179 #ifde‡
MULTITHREAD_SUPPORT


180 
	gbuf„rs
[
thªad
].
push_back
(
ss_ønge
(
¥ev
 - 
∑ús
, (
cuº
 - 1) -Öairs));

181 
	gsubtŸÆs
[
thªad
] +
cuº
 - 
¥ev
;

183 
	g√xt_uns‹ãd
.
push_back
(
ss_ønge
(
¥ev
 - 
∑ús
, (
cuº
 - 1) -Öairs));

184 
	gtŸÆ
 +
cuº
 - 
¥ev
;

186 
	g¥ev
 = 
cuº
; if’ªv <
limô
Ë{ 
keys
[
¥ev
->
fú°
] =Öªv - 
∑ús
; }

190 #ifde‡
MULTITHREAD_SUPPORT


191 
	guns‹ãd
.
˛ór
();

192 
uöt
 
	gi
 = 0; i < 
	gthªads
; i++)

194 
	guns‹ãd
.
ö£π
(
uns‹ãd
.
íd
(), 
buf„rs
[
i
].
begö
(), buffers[i].end());

195 
	gtŸÆ
 +
subtŸÆs
[
i
];

198 
	guns‹ãd
.
assign
(
√xt_uns‹ãd
.
begö
(),Çext_uns‹ãd.
íd
());

201  
	gtŸÆ
;

204 
uöt


205 
öôülS‹t
(
sh‹t_∑ú
* 
∑ús
, 
uöt
* 
keys
, 
°d
::
ve˘‹
<
ss_ønge
>& 
uns‹ãd
, uöà
n
, uöà
thªads
, uöà
h
)

208 
∑øŒñS‹t
(
∑ús
,Öaú†+ 
n
, 
key_com∑øt‹
);

209 
	guns‹ãd
.
push_back
(
ss_ønge
(0, 
n
 - 1));

210 
uöt
 
	gtŸÆ
 = 
£tR™ks
(
∑ús
, 
keys
, 
n
, 
uns‹ãd
, 
thªads
, 1);

213  
	gtŸÆ
;

216 
sh‹t_∑ú
*

217 
∑ckPaús
(
skew_∑ú
* 
ﬁd_∑ús
, 
uöt
 
n
)

219 
sh‹t_∑ú
* 
	g√w_∑ús
 = (sh‹t_∑ú*)
ﬁd_∑ús
;

220 
uöt
 
	gi
 = 0; i < 
	gn
; i++)

222 
	g√w_∑ús
[
i
].
	gfú°
 = 
ﬁd_∑ús
[i].
fú°
;

223 
	g√w_∑ús
[
i
].
	g£c⁄d
 = 
ﬁd_∑ús
[i].
£c⁄d
;

225  
	g√w_∑ús
;

228 
sh‹t_∑ú
*

229 
¥efixDoublög
(
sh‹t_∑ú
* 
∑ús
, 
uöt
* 
keys
, 
°d
::
ve˘‹
<
ss_ønge
>& 
uns‹ãd
, uöà
n
, uöà
thªads
, uöà
tŸÆ
, uöà
h
)

232 
	gtŸÆ
 > 0)

234 
uöt
 
	gchunk
 = 
°d
::
max
((
size_t
)1, 
uns‹ãd
.
size
(Ë/ (
thªads
 *Åhreads));

235 #¥agm®
omp
 
∑øŒñ
 
scheduÀ
(
dy«mic
, 
chunk
)

236 
uöt
 
	gi
 = 0; i < 
	guns‹ãd
.
size
(); i++)

239 
sh‹t_∑ú
* 
	glimô
 = 
∑ús
 + 
uns‹ãd
[
i
].
£c⁄d
;

240 
sh‹t_∑ú
* 
	gcuº
 = 
∑ús
 + 
uns‹ãd
[
i
].
fú°
; cuº <
limô
; ++curr)

242 
	gcuº
->
	g£c⁄d
 = 
keys
[
cuº
->
fú°
 + 
h
];

244 
£quítülS‹t
(
∑ús
 + 
uns‹ãd
[
i
].
fú°
,Öaú†+ uns‹ãd[i].
£c⁄d
 + 1, 
key_com∑øt‹
);

246 
	gtŸÆ
 = 
£tR™ks
(
∑ús
, 
keys
, 
n
, 
uns‹ãd
, 
thªads
, 
chunk
);

247 
	gh
 *= 2;

251 #¥agm®
omp
 
∑øŒñ
 
scheduÀ
()

252 
uöt
 
	gi
 = 0; i < 
	gn
; i++Ë{ 
	g∑ús
[
i
].
	g£c⁄d
 = 
keys
[i]; }

253 
	gdñëe
[] 
	gkeys
; keys = 0;

254  
	g∑ús
;

257 
sh‹t_∑ú
*

258 
¥efixTrùlög
(
skew_∑ú
* 
∑ús
, 
uöt
* 
keys
, 
°d
::
ve˘‹
<
ss_ønge
>& 
uns‹ãd
, uöà
n
, uöà
thªads
, uöà
tŸÆ
, uöà
h
)

260 c⁄° 
usöt
 
	gPACK_FACTOR
 = (usötË* 
CHAR_BIT
 / 2;

263 
	gtŸÆ
 > 0)

265 
uöt
 
	gchunk
 = 
°d
::
max
((
size_t
)1, 
uns‹ãd
.
size
(Ë/ (
thªads
 *Åhreads));

266 #¥agm®
omp
 
∑øŒñ
 
scheduÀ
(
dy«mic
, 
chunk
)

267 
uöt
 
	gi
 = 0; i < 
	guns‹ãd
.
size
(); i++)

270 
skew_∑ú
* 
	glimô
 = 
∑ús
 + 
uns‹ãd
[
i
].
£c⁄d
;

271 
skew_∑ú
* 
	gcuº
 = 
∑ús
 + 
uns‹ãd
[
i
].
fú°
; cuº <
limô
; ++curr)

273 
	gcuº
->
	g£c⁄d
 = (
usöt
)(
keys
[
cuº
->
fú°
 + 
h
]Ë<< 
PACK_FACTOR
;

274 if(
	gn
 - 
	gh
 > 
	gcuº
->
	gfú°
 + hË{ cuº->
	g£c⁄d
 +
keys
[
cuº
->
fú°
 + 2 * 
h
]; }

276 
£quítülS‹t
(
∑ús
 + 
uns‹ãd
[
i
].
fú°
,Öaú†+ uns‹ãd[i].
£c⁄d
 + 1, 
skew_com∑øt‹
);

278 
	gtŸÆ
 = 
£tR™ks
(
∑ús
, 
keys
, 
n
, 
uns‹ãd
, 
thªads
, 
chunk
);

279 
	gh
 *= 3;

283 #¥agm®
omp
 
∑øŒñ
 
scheduÀ
()

284 
uöt
 
	gi
 = 0; i < 
	gn
; i++Ë{ 
	g∑ús
[
i
].
	g£c⁄d
 = 
keys
[i]; }

285 
	gdñëe
[] 
	gkeys
; keys = 0;

286  
∑ckPaús
(
∑ús
, 
n
);

289 
sh‹t_∑ú
*

290 
sim∂eSuffixS‹t
(c⁄° 
usöt
* 
£quí˚
, 
uöt
 
n
, uöà
thªads
)

292 if(
	g£quí˚
 =0 || 
n
 == 0) {  0; }

294 
skew_∑ú
* 
	g∑ús
 = (skew_∑ú*)
√w
 
sh‹t_∑ú
[
n
 * (skew_pair) / (short_pair) + 1];

295 
uöt
* 
	gkeys
 = 
√w
 uöt[
n
];

296 
	g°d
::
ve˘‹
<
ss_ønge
> 
uns‹ãd
;

297 
	gthªads
 = 
°d
::
max
(
thªads
, (
uöt
)1);

298 #ifde‡
MULTITHREAD_SUPPORT


299 
omp_£t_num_thªads
(
thªads
);

303 #¥agm®
omp
 
∑øŒñ
 
scheduÀ
()

304 
uöt
 
	gi
 = 0; i < 
	gn
; i++Ë{ 
	g∑ús
[
i
].
	gfú°
 = i;Öaús[i].
	g£c⁄d
 = 
£quí˚
[i]; }

307 
∑øŒñS‹t
(
∑ús
,Öaú†+ 
n
, 
skew_com∑øt‹
);

308 
	guns‹ãd
.
push_back
(
ss_ønge
(0, 
n
 - 1));

309 
uöt
 
	gtŸÆ
 = 
£tR™ks
(
∑ús
, 
keys
, 
n
, 
uns‹ãd
, 
thªads
, 1);

311 if((
	gusöt
Ë< 2 * (
	guöt
))

313  
¥efixDoublög
(
∑ckPaús
(
∑ús
, 
n
), 
keys
, 
uns‹ãd
,Ç, 
thªads
, 
tŸÆ
, 1);

317  
¥efixTrùlög
(
∑ús
, 
keys
, 
uns‹ãd
, 
n
, 
thªads
, 
tŸÆ
, 1);

321 
sh‹t_∑ú
*

322 
sim∂eSuffixS‹t
(
sh‹t_∑ú
* 
∑ús
, 
uöt
 
n
, uöà
thªads
)

324 if(
	g∑ús
 =0 || 
n
 == 0) {  0; }

326 
uöt
* 
	gkeys
 = 
√w
 uöt[
n
];

327 
	g°d
::
ve˘‹
<
ss_ønge
> 
uns‹ãd
;

328 
	gthªads
 = 
°d
::
max
(
thªads
, (
uöt
)1);

329 #ifde‡
MULTITHREAD_SUPPORT


330 
omp_£t_num_thªads
(
thªads
);

334 #¥agm®
omp
 
∑øŒñ
 
scheduÀ
()

335 
uöt
 
	gi
 = 0; i < 
	gn
; i++Ë{ 
	g∑ús
[
i
].
	gfú°
 = i; }

337 
uöt
 
	gtŸÆ
 = 
öôülS‹t
(
∑ús
, 
keys
, 
uns‹ãd
, 
n
, 
thªads
, 1);

338  
¥efixDoublög
(
∑ús
, 
keys
, 
uns‹ãd
, 
n
, 
thªads
, 
tŸÆ
, 1);

341 
sh‹t_∑ú
*

342 
sim∂eSuffixS‹t
(c⁄° 
uch¨
* 
£quí˚
, 
uöt
 
n
, uöà
£quí˚s
, uöà
thªads
)

344 if(
	g£quí˚
 =0 || 
n
 == 0) {  0; }

346 
sh‹t_∑ú
* 
	g∑ús
 = 
√w
 sh‹t_∑ú[
n
];

347 
uöt
* 
	gkeys
 = 
√w
 uöt[
n
];

348 
	g°d
::
ve˘‹
<
ss_ønge
> 
uns‹ãd
;

349 
	gthªads
 = 
°d
::
max
(
thªads
, (
uöt
)1);

350 #ifde‡
MULTITHREAD_SUPPORT


351 
omp_£t_num_thªads
(
thªads
);

355 
uöt
 
	gÆphabë
[
CHARS
];

356 
uöt
 
	gc
 = 0; c < 
	gCHARS
; c++Ë{ 
	gÆphabë
[
c
] = 0; }

357 
uöt
 
	gi
 = 0; i < 
	gn
; i++Ë{ 
	gÆphabë
[
£quí˚
[
i
]]++; }

358 
uöt
 
	gÆphabë_size
 = 
£quí˚s
;

359 
uöt
 
	gc
 = 1; c < 
	gCHARS
; c++)

361 
uöt
 
	gãmp
 = 
Æphabë_size
;

362 if(
	gÆphabë
[
c
] > 0Ë{ 
	gÆphabë_size
++; }

363 
	gÆphabë
[
c
] = 
ãmp
;

367 
uöt
 
	glimô
 = 
°d
::
numîic_limôs
<uöt>::
max
(Ë/ 
Æphabë_size
;

368 
uöt
 
	gh
 = 1, 
	g∑ck_mu…ùlõr
 = 1;

369 if(
	gÆphabë_size
 > 1)

371 
∑ck_mu…ùlõr
 * 
	gÆphabë_size
 <
limô
Ë{ 
h
++; 
	g∑ck_mu…ùlõr
 *
Æphabë_size
; }

375 
uöt
 
	gzîos
 = 0, 
	gvÆue
 = 0;

376 
uöt
 
	gi
 = 0; i < 
	gh
; i++)

378 
	gvÆue
 *
Æphabë_size
;

379 if(
	g£quí˚
[
i
] =0Ë{ 
vÆue
 +
zîos
; 
	gzîos
++; }

380 { 
	gvÆue
 +
Æphabë
[
£quí˚
[
i
]]; }

382 
uöt
 
	gi
 = 0; i < 
	gn
 - 
	gh
; i++)

384 
	g∑ús
[
i
].
	gfú°
 = i;Öaús[i].
	g£c⁄d
 = 
vÆue
;

385 
	gvÆue
 = (
vÆue
 % 
∑ck_mu…ùlõr
Ë* 
Æphabë_size
;

386 if(
	g£quí˚
[
i
 + 
h
] =0Ë{ 
vÆue
 +
zîos
; 
	gzîos
++; }

387 { 
	gvÆue
 +
Æphabë
[
£quí˚
[
i
 + 
h
]]; }

389 
uöt
 
	gi
 = 
n
 - 
h
; i < 
	gn
; i++)

391 
	g∑ús
[
i
].
	gfú°
 = i;Öaús[i].
	g£c⁄d
 = 
vÆue
;

392 
	gvÆue
 = (
vÆue
 % 
∑ck_mu…ùlõr
Ë* 
Æphabë_size
;

413 
uöt
 
	gtŸÆ
 = 
öôülS‹t
(
∑ús
, 
keys
, 
uns‹ãd
, 
n
, 
thªads
, 
h
);

414  
¥efixDoublög
(
∑ús
, 
keys
, 
uns‹ãd
, 
n
, 
thªads
, 
tŸÆ
, 
h
);

420 
mîgeR™ges
(
°d
::
ve˘‹
<
∑ú_ty≥
>* 
vec
, 
boﬁ
 
∑øŒñ
)

422 if(
	gvec
 =0 || 
vec
->
size
() <= 1) { ; }

423 if(
	g∑øŒñ
Ë{ 
∑øŒñS‹t
(
vec
->
begö
(), vec->
íd
()); }

424 { 
£quítülS‹t
(
vec
->
begö
(), vec->
íd
()); }

426 
	g°d
::
ve˘‹
<
∑ú_ty≥
>::
ôî©‹
 
¥ev
 = 
vec
->
begö
();

427 
	g°d
::
ve˘‹
<
∑ú_ty≥
>::
ôî©‹
 
cuº
 = 
¥ev
 + 1; 
	gcuº
 !
vec
->
íd
(); ++curr)

429 if(
	g¥ev
->
	g£c⁄d
 + 1 >
cuº
->
fú°
Ë{ 
¥ev
->
£c⁄d
 = 
°d
::
max
(curr->second,Örev->second); }

430 { ++
	g¥ev
; *¥ev = *
cuº
; }

432 
	gvec
->
ªsize
((
¥ev
 - 
vec
->
begö
()) + 1);

	@misc/utils.h

1 #i‚de‡
_RLCSA_UTILS_H


2 
	#_RLCSA_UTILS_H


	)

4 
	~<Æg‹ôhm
>

5 
	~<f°ªam
>

6 
	~<ve˘‹
>

8 
	~"deföôi⁄s.h
"

10 #ifde‡
MULTITHREAD_SUPPORT


11 
	~<omp.h
>

15 
«me•a˚
 
	gCSA


20 
	gãm∂©e
<
˛ass
 
	gT
>

21 
	sGíîicTrùÀ


23 
T
 
	gfú°
;

24 
T
 
	g£c⁄d
;

25 
T
 
	gthúd
;

27 
GíîicTrùÀ
() {}

28 
GíîicTrùÀ
(
T
 
a
, T 
b
, T 
c
Ë: 
fú°
◊), 
£c⁄d
(b), 
thúd
(c) {}

31 
	gGíîicTrùÀ
<
	tusöt
> 
	tTrùÀ
;

36 
	g°d
::
°ªamoff
 
fûeSize
(
°d
::
if°ªam
& 
fûe
);

37 
	g°d
::
°ªamoff
 
fûeSize
(
°d
::
of°ªam
& 
fûe
);

42 
œrgeWrôe
(
°d
::
of°ªam
& 
fûe
, * 
d©a
, std::
°ªamoff
 
size
, std::°ªamof‡
block_size
);

46 
	gãm∂©e
<
˛ass
 
	gA
, cœs†
	gB
>

47 
	g°d
::
o°ªam
& 
›î©‹
<<(
°d
::o°ªam& 
°ªam
, c⁄° std::
∑ú
<
A
, 
	gB
>& 
	gd©a
)

49  
	g°ªam
 << "(" << 
	gd©a
.
	gfú°
 << ", " << d©a.
	g£c⁄d
 << ")";

52 
ªadRows
(
°d
::
if°ªam
& 
fûe
, std::
ve˘‹
<°d::
°rög
>& 
rows
, 
boﬁ
 
skùEm±yRows
);

53 
ªadPizzaChûi
(
°d
::
if°ªam
& 
fûe
, std::
ve˘‹
<°d::
°rög
>& 
∑âîns
);

57 
ªadTimî
();

58 
usöt
 
mem‹yUßge
();

64 
	g°d
::
	t∑ú
<
	tuöt
, uöt> 
	tsh‹t_∑ú
;

65 
sh‹t_∑ú
* 
sim∂eSuffixS‹t
(c⁄° 
usöt
* 
£quí˚
, 
uöt
 
n
, uöà
thªads
 = 1);

71 
sh‹t_∑ú
* 
sim∂eSuffixS‹t
(sh‹t_∑ú* 
∑ús
, 
uöt
 
n
, uöà
thªads
 = 1);

75 
sh‹t_∑ú
* 
sim∂eSuffixS‹t
(c⁄° 
uch¨
* 
£quí˚
, 
uöt
 
n
, uöà
£quí˚s
, uöà
thªads
 = 1);

79 
	gãm∂©e
 <
˛ass
 
	gIãøt‹
>

80 
∑øŒñS‹t
(
Iãøt‹
 
fú°
, Iãøt‹ 
œ°
)

82 #ifde‡
MULTITHREAD_SUPPORT


83 #ifde‡
_GLIBCXX_PARALLEL


84 
	g°d
::
s‹t
(
fú°
, 
œ°
, 
__gnu_∑øŒñ
::
bÆ™˚d_quicks‹t_èg
());

86 
	g°d
::
s‹t
(
fú°
, 
œ°
);

89 
	g°d
::
s‹t
(
fú°
, 
œ°
);

93 
	gãm∂©e
 <
˛ass
 
	gIãøt‹
, cœs†
	gCom∑ª
>

95 
∑øŒñS‹t
(
Iãøt‹
 
fú°
, Iãøt‹ 
œ°
, c⁄° 
Com∑ª
& 
comp
)

97 #ifde‡
MULTITHREAD_SUPPORT


98 #ifde‡
_GLIBCXX_PARALLEL


99 
	g°d
::
s‹t
(
fú°
, 
œ°
, 
comp
, 
__gnu_∑øŒñ
::
bÆ™˚d_quicks‹t_èg
());

101 
	g°d
::
s‹t
(
fú°
, 
œ°
, 
comp
);

104 
	g°d
::
s‹t
(
fú°
, 
œ°
, 
comp
);

108 
	gãm∂©e
 <
˛ass
 
	gIãøt‹
>

109 
£quítülS‹t
(
Iãøt‹
 
fú°
, Iãøt‹ 
œ°
)

111 #ifde‡
MULTITHREAD_SUPPORT


112 #ifde‡
_GLIBCXX_PARALLEL


113 
	g°d
::
s‹t
(
fú°
, 
œ°
, 
__gnu_∑øŒñ
::
£quítül_èg
());

115 
	g°d
::
s‹t
(
fú°
, 
œ°
, 
mc°l
::
£quítül_èg
());

118 
	g°d
::
s‹t
(
fú°
, 
œ°
);

122 
	gãm∂©e
 <
˛ass
 
	gIãøt‹
, cœs†
	gCom∑ª
>

124 
£quítülS‹t
(
Iãøt‹
 
fú°
, Iãøt‹ 
œ°
, c⁄° 
Com∑ª
& 
comp
)

126 #ifde‡
MULTITHREAD_SUPPORT


127 #ifde‡
_GLIBCXX_PARALLEL


128 
	g°d
::
s‹t
(
fú°
, 
œ°
, 
comp
, 
__gnu_∑øŒñ
::
£quítül_èg
());

130 
	g°d
::
s‹t
(
fú°
, 
œ°
, 
comp
, 
mc°l
::
£quítül_èg
());

133 
	g°d
::
s‹t
(
fú°
, 
œ°
, 
comp
);

137 
	gãm∂©e
<
˛ass
 
	gT
>

139 
ªmoveDu∂iˇãs
(
°d
::
ve˘‹
<
T
>* 
vec
, 
boﬁ
 
∑øŒñ
 = 
åue
)

141 if(
vec
 == 0) { ; }

142 if(
	g∑øŒñ
Ë{ 
∑øŒñS‹t
(
vec
->
begö
(), vec->
íd
()); }

143 { 
£quítülS‹t
(
vec
->
begö
(), vec->
íd
()); }

144 
	gvec
->
ªsize
(
°d
::
unique
(
vec
->
begö
(), vec->
íd
()) - vec->begin());

147 
	gãm∂©e
<
˛ass
 
	gT
>

149 
ªmoveDu∂iˇãs
(
°d
::
ve˘‹
<
T
>& 
vec
, 
boﬁ
 
∑øŒñ
 = 
åue
)

151 
ªmoveDu∂iˇãs
(&
vec
, 
∑øŒñ
);

154 
mîgeR™ges
(
°d
::
ve˘‹
<
∑ú_ty≥
>* 
vec
, 
boﬁ
 
∑øŒñ
 = 
åue
);

	@parallel_build.cpp

1 
	~<Æg‹ôhm
>

2 
	~<c°dlib
>

3 
	~<f°ªam
>

4 
	~<io°ªam
>

5 
	~<ve˘‹
>

7 #ifde‡
MULTITHREAD_SUPPORT


8 
	~<omp.h
>

11 
	~"æcß_buûdî.h
"

12 
	~"misc/utûs.h
"

15 
usög
 
«me•a˚
 
	gCSA
;

18 
gëRLCSA
(
RLCSABuûdî
& 
buûdî
, c⁄° 
°d
::
°rög
& 
ba£_«me
);

19 
ödexP¨ts
(
°d
::
ve˘‹
<°d::
°rög
>& 
fûíames
, 
usöt
 
thªads
, 
P¨amëîs
& 
∑ømëîs
, & 
buûd_time
);

21 c⁄° 
	gMAX_THREADS
 = 64;

25 
	$maö
(
¨gc
, ** 
¨gv
)

27 
°d
::
cout
 << "P¨ÆÀ»RLCSA buûdî" << std::
ídl
;

28 if(
¨gc
 < 3)

30 
°d
::
cout
 << "Ußge:Ö¨ÆÀl_buûd [-f|-n]Üi°«mêouçuà[thªads]" << std::
ídl
;

31 
°d
::
cout
 << " -‡ u£ fa°álg‹ôhm wôhÜ¨gî mem‹y ußge" << std::
ídl
;

32 
°d
::
cout
 << " -¿ dÿnŸ mîgêthêödexes" << std::
ídl
;

36 
li°_∑ømëî
 = 1, 
ouçut_∑ømëî
 = 2, 
thªads_∑ømëî
 = 3;

37 
boﬁ
 
do_mîge
 = 
åue
;

38 
boﬁ
 
Á°_Æg‹ôhm
 = 
Ál£
;

39 if(
¨gv
[1][0] == '-')

41 if(
¨gv
[1][1] == 'f')

43 
li°_∑ømëî
++; 
ouçut_∑ømëî
++; 
thªads_∑ømëî
++;

44 
Á°_Æg‹ôhm
 = 
åue
;

45 
°d
::
cout
 << "Usög fa°álg‹ôhm." << std::
ídl
;

47 if(
¨gv
[1][1] == 'n')

49 
li°_∑ømëî
++; 
ouçut_∑ømëî
++; 
thªads_∑ømëî
++;

50 
do_mîge
 = 
Ál£
;

51 
°d
::
cout
 << "O±i⁄ '-n' s≥cifõd. P¨tü»ödexe†wû»nŸ bêmîged." << std::
ídl
;

55 
°d
::
if°ªam
 
	`fûñi°
(
¨gv
[
li°_∑ømëî
], std::
ios_ba£
::
bö¨y
);

56 if(!
fûñi°
)

58 
°d
::
˚º
 << "Eº‹ o≥nög fûêli°!" << std::
ídl
;

61 
°d
::
ve˘‹
<°d::
°rög
> 
fûes
;

62 
	`ªadRows
(
fûñi°
, 
fûes
, 
åue
);

63 
fûñi°
.
	`˛o£
();

64 
°d
::
cout
 << "I≈uàfûes: " << 
fûes
.
	`size
(Ë<< std::
ídl
;

66 
°d
::
°rög
 
ba£_«me
 = 
¨gv
[
ouçut_∑ømëî
];

67 
°d
::
cout
 << "Ouçut: " << 
ba£_«me
 << std::
ídl
;

69 
usöt
 
thªads
 = 1;

70 if(
¨gc
 > 
thªads_∑ømëî
)

72 
thªads
 = 
°d
::
	`mö
(
MAX_THREADS
, std::
	`max
(
	`©oi
(
¨gv
[
thªads_∑ømëî
]), 1));

74 
°d
::
cout
 << "Thªads: " << 
thªads
 << std::
ídl
;

75 
°d
::
cout
 << std::
ídl
;

77 
°d
::
°rög
 
∑ømëîs_«me
 = 
ba£_«me
 + 
PARAMETERS_EXTENSION
;

78 
P¨amëîs
 
∑ømëîs
;

79 
∑ømëîs
.
	`£t
(
RLCSA_BLOCK_SIZE
);

80 
∑ømëîs
.
	`£t
(
SAMPLE_RATE
);

81 
∑ømëîs
.
	`£t
(
SUPPORT_LOCATE
);

82 
∑ømëîs
.
	`£t
(
SUPPORT_DISPLAY
);

83 
∑ømëîs
.
	`£t
(
WEIGHTED_SAMPLES
);

84 
∑ømëîs
.
	`ªad
(
∑ømëîs_«me
);

85 
∑ømëîs
.
	`¥öt
();

87 
°¨t
 = 
	`ªadTimî
();

88 
megabyãs
 = 0.0, 
buûd_time
 = 0.0;

89 
RLCSABuûdî
 
	`buûdî
(
∑ømëîs
.
	`gë
(
RLCSA_BLOCK_SIZE
),Ö¨amëîs.gë(
SAMPLE_RATE
), 0, 
thªads
);

91 if(
Á°_Æg‹ôhm
)

93 
°d
::
ve˘‹
<°d::
°rög
>::
ôî©‹
 
ôî
 = 
fûes
.
	`begö
(); iã∏!fûes.
	`íd
(); ++iter)

95 
m¨k
 = 
	`ªadTimî
();

96 
°d
::
cout
 << "In¸emít: " << *
ôî
; std::cout.
	`Êush
();

97 
buûdî
.
	`ö£πCﬁÀ˘i⁄
(*
ôî
);

98 
°d
::
cout
 << " (" << (
	`ªadTimî
(Ë- 
m¨k
Ë<< " sec⁄ds)" << std::
ídl
;

100 
°d
::
cout
 << std::
ídl
;

101 
megabyãs
 = 
	`gëRLCSA
(
buûdî
, 
ba£_«me
);

105 
megabyãs
 = 
	`ödexP¨ts
(
fûes
, 
thªads
, 
∑ømëîs
, 
buûd_time
);

106 if(
do_mîge
)

108 
°d
::
cout
 << "Pha£ 2: MîgögÅhêödexes" << std::
ídl
;

109 
°d
::
ve˘‹
<°d::
°rög
>::
ôî©‹
 
ôî
 = 
fûes
.
	`begö
(); iã∏!fûes.
	`íd
(); ++iter)

111 
m¨k
 = 
	`ªadTimî
();

112 
°d
::
cout
 << "In¸emít: " << *
ôî
; std::cout.
	`Êush
();

113 
buûdî
.
	`ö£πFromFûe
(*
ôî
);

114 
°d
::
cout
 << " (" << (
	`ªadTimî
(Ë- 
m¨k
Ë<< " sec⁄ds)" << std::
ídl
;

116 
°d
::
cout
 << std::
ídl
;

117 
megabyãs
 = 
	`gëRLCSA
(
buûdî
, 
ba£_«me
);

121 
°›
 = 
	`ªadTimî
();

122 
°d
::
cout
 << 
megabyãs
 << " megabyã†ödexed i¿" << (
°›
 - 
°¨t
Ë<< " sec⁄d†(" << (megabyã†/ (°› - sèπ)Ë<< " MB/s)." << std::
ídl
;

123 if(
do_mîge
)

125 
°d
::
cout
 << "BuûdÅime: " << 
buûd_time
 + 
buûdî
.
	`gëBuûdTime
(Ë<< " sec⁄ds" << std::
ídl
;

126 
°d
::
cout
 << "SórchÅime: " << 
buûdî
.
	`gëSórchTime
(Ë<< " sec⁄ds" << std::
ídl
;

127 
°d
::
cout
 << "S‹àtime: " << 
buûdî
.
	`gëS‹tTime
(Ë<< " sec⁄ds" << std::
ídl
;

128 
°d
::
cout
 << "Mîgêtime: " << 
buûdî
.
	`gëMîgeTime
(Ë<< " sec⁄ds" << std::
ídl
;

130 
°d
::
cout
 << "Mem‹y ußge: " << 
	`mem‹yUßge
(Ë<< " kB" << std::
ídl
;

131 
°d
::
cout
 << std::
ídl
;

134 
	}
}

138 
	$gëRLCSA
(
RLCSABuûdî
& 
buûdî
, c⁄° 
°d
::
°rög
& 
ba£_«me
)

140 
megabyãs
 = 0.0;

142 
RLCSA
* 
ödex
 = 
buûdî
.
	`gëRLCSA
();

143 if(
ödex
 !0 && index->
	`isOk
())

145 
ödex
->
	`¥ötInfo
();

146 
ödex
->
	`ªp‹tSize
(
åue
);

147 
ödex
->
	`wrôeTo
(
ba£_«me
);

148 
megabyãs
 = 
ödex
->
	`gëSize
(Ë/ ()
MEGABYTE
;

151 
dñëe
 
ödex
;

152  
megabyãs
;

153 
	}
}

157 
ödexP¨ts
(
°d
::
ve˘‹
<°d::
°rög
>& 
fûíames
, 
usöt
 
thªads
, 
P¨amëîs
& 
∑ømëîs
, & 
buûd_time
)

159 
	g°¨t
 = 
ªadTimî
();

160 
	g°d
::
cout
 << "Pha£ 1: Buûdög indexe†f‹ i≈uàfûes" << 
°d
::
ídl
;

161 
usöt
 
	gblock_size
 = 
∑ømëîs
.
gë
(
RLCSA_BLOCK_SIZE
);

162 
usöt
 
	gßm∂e_øã
 = 
∑ømëîs
.
gë
(
SAMPLE_RATE
);

163 
usöt
 
	gtŸÆ_size
 = 0;

165 
usöt
 
	gi
 = 0; i < 
	gfûíames
.
size
(); i++)

167 
	göô
 = 
ªadTimî
();

168 
uch¨
* 
	gd©a
 = 0; 
usöt
 
	gsize
 = 0;

169 
	g°d
::
cout
 << "I≈ut: " << 
fûíames
[
i
]; std::cout.
Êush
();

170 
	g°d
::
if°ªam
 
öput
(
fûíames
[
i
].
c_°r
(), 
°d
::
ios_ba£
::
bö¨y
);

171 if(!
	göput
)

173 
	g°d
::
˚º
 << "Eº‹ o≥nög i≈uàfûê" << 
fûíames
[
i
] << "!" << 
°d
::
ídl
;

177 
	gsize
 = 
fûeSize
(
öput
);

178 
	gd©a
 = 
√w
 
uch¨
[
size
];

179 
	göput
.
ªad
((*)
d©a
, 
size
);

180 
	göput
.
˛o£
();

183 if(
	gsize
 > 0)

185 
	gm¨k
 = 
ªadTimî
();

186 
RLCSA
* 
	gödex
 = 
√w
 RLCSA(
d©a
, 
size
, 
block_size
, 
ßm∂e_øã
, 
thªads
, 
åue
);

187 
	gd⁄e
 = 
ªadTimî
();

188 
	g°d
::
cout
 << " (" << (
d⁄e
 - 
öô
Ë<< " sec⁄ds)" << 
°d
::
ídl
;

189 
	gbuûd_time
 +
d⁄e
 - 
m¨k
;

190 if(
	gödex
 !0 && 
ödex
->
isOk
()Ë{ index->
wrôeTo
(
fûíames
[
i
]); 
	gtŸÆ_size
 +
size
; }

191 
dñëe
 
	gödex
;

195 
	g°d
::
˚º
 << "W¨nög: Em±y i≈uàfûê" << 
fûíames
[
i
] << "!" << 
°d
::
ídl
;

199 
	gtŸÆ_time
 = 
ªadTimî
(Ë- 
°¨t
;

200 
	gmegabyãs
 = 
tŸÆ_size
 / ()
MEGABYTE
;

201 
	g°d
::
cout
 << "Indexed " << 
megabyãs
 << " megabyã†ö " << 
tŸÆ_time
 << " sec⁄d†(" << (megabyã†/ÅŸÆ_timeË<< " MB/s)." << 
°d
::
ídl
;

202 
	g°d
::
cout
 << "Mem‹y: " << 
mem‹yUßge
(Ë<< " kB" << 
°d
::
ídl
;

203 
	g°d
::
cout
 << 
°d
::
ídl
;

205  
	gmegabyãs
;

	@read_bwt.cpp

1 
	~<c°dlib
>

2 
	~<f°ªam
>

3 
	~<io°ªam
>

5 
	~"æcß.h
"

8 
usög
 
«me•a˚
 
	gCSA
;

16 
usöt


17 
	$cou¡Runs
(
usöt
 
¥ev
, 
uch¨
* 
buf„r
, usöà
Àngth
)

19 
usöt
 
runs
 = 0;

21 
usöt
 
i
 = 0; i < 
Àngth
; i++)

23 if(
buf„r
[
i
] !
¥ev
)

25 
¥ev
 = 
buf„r
[
i
];

26 if(
buf„r
[
i
] !0Ë{ 
runs
++; }

30  
runs
;

31 
	}
}

35 
	$maö
(
¨gc
, ** 
¨gv
)

37 
°d
::
cout
 << "RLCSAÅÿBWT c⁄vîãr" << std::
ídl
;

38 if(
¨gc
 < 2)

40 
°d
::
cout
 << "Ußge:Ñód_bwàba£_«mê[buf„r_size]" << std::
ídl
;

44 
°d
::
°rög
 
ba£_«me
 = 
¨gv
[1];

45 
°d
::
°rög
 
bwt_«me
 = 
ba£_«me
 + ".bwt";

46 
°d
::
cout
 << "BWT: " << 
bwt_«me
 << std::
ídl
;

47 
°d
::
of°ªam
 
	`bwt_fûe
(
bwt_«me
.
	`c_°r
(), std::
ios_ba£
::
bö¨y
);

48 if(!
bwt_fûe
)

50 
°d
::
˚º
 << "Eº‹ cª©ög BWT fûe!" << std::
ídl
;

53 
°d
::
cout
 << std::
ídl
;

55 
RLCSA
 
	`æcß
(
ba£_«me
);

56 
˛ock_t
 
°¨t
 = 
	`˛ock
();

57 
usöt
 
buf„r_size
 = 0;

58 if(
¨gc
 > 2Ë{ 
buf„r_size
 = 
	`©oi
(
¨gv
[2]); }

59 
usöt
 
n
 = 
æcß
.
	`gëSize
(Ë+Ñlcß.
	`gëNumbîOfSequí˚s
();

61 
usöt
 
runs
 = 0, 
¥ev
 = 
CHARS
;

62 if(
buf„r_size
 > 0)

64 
usöt
 
i
 = 0; i < 
n
; i +
buf„r_size
)

66 
∑ú_ty≥
 
	`ønge
(
i
, 
°d
::
	`mö
(ò+ 
buf„r_size
 - 1, 
n
 - 1));

67 
uch¨
* 
bwt
 = 
æcß
.
	`ªadBWT
(
ønge
);

68 if(
bwt
 != 0)

70 
runs
 +
	`cou¡Runs
(
¥ev
, 
bwt
, 
	`Àngth
(
ønge
));

71 
¥ev
 = 
bwt
[
	`Àngth
(
ønge
) - 1];

72 
bwt_fûe
.
	`wrôe
((*)
bwt
, 
	`Àngth
(
ønge
));

73 
dñëe
[] 
bwt
;

79 
uch¨
* 
bwt
 = 
æcß
.
	`ªadBWT
();

80 if(
bwt
 != 0)

82 
runs
 = 
	`cou¡Runs
(
¥ev
, 
bwt
, 
n
);

83 
bwt_fûe
.
	`wrôe
((*)
bwt
, 
n
);

84 
dñëe
[] 
bwt
;

88 
˛ock_t
 
°›
 = 
	`˛ock
();

89 
time
 = ((
°›
 - 
°¨t
Ë/ ()
CLOCKS_PER_SEC
);

90 
megabyãs
 = 
n
 / ()
MEGABYTE
;

91 
°d
::
cout
 << 
megabyãs
 << " megabyã†ö " << 
time
 << " sec⁄d†(" << (megabyã†/ÅimeË<< " MB/s)" << std::
ídl
;

92 
°d
::
cout
 << std::
ídl
;

96 
°d
::
cout
 << "Numbî o‡runs: " << 
runs
 << std::
ídl
;

97 
runs
 = 
æcß
.
	`cou¡Runs
();

98 
°d
::
cout
 << "Numbî o‡run†(dúe˘ cou¡): " << 
runs
 << std::
ídl
;

99 
°d
::
cout
 << std::
ídl
;

101 
bwt_fûe
.
	`˛o£
();

103 
	}
}

	@rlcsa.cpp

1 
	~<Æg‹ôhm
>

2 
	~<c°dlib
>

3 
	~<c°rög
>

4 
	~<f°ªam
>

5 
	~<io°ªam
>

6 
	~<li°
>

8 
	~"æcß.h
"

9 
	~"misc/utûs.h
"

10 
	~"bôs/ve˘‹s.h
"

13 #ifde‡
MULTITHREAD_SUPPORT


14 
	~<omp.h
>

19 
«me•a˚
 
	gCSA


23 
	gRLCSA
::
RLCSA
(c⁄° 
°d
::
°rög
& 
ba£_«me
, 
boﬁ
 
¥öt
) :

24 
ok
(
Ál£
),

25 
Æphabë
(0),

26 
ß_ßm∂es
(0), 
suµ‹t_loˇã
(
Ál£
), 
suµ‹t_di•œy
(false),

27 
íd_poöts
(0)

29 
usöt
 
	gc
 = 0; c < 
	gCHARS
; c++Ë{ 
	gthis
->
	g¨øy
[
c
] = 0; }

31 
	g°d
::
°rög
 
¨øy_«me
 = 
ba£_«me
 + 
ARRAY_EXTENSION
;

32 
	g°d
::
if°ªam
 
¨øy_fûe
(
¨øy_«me
.
c_°r
(), 
°d
::
ios_ba£
::
bö¨y
);

33 if(!
	g¨øy_fûe
)

35 
	g°d
::
˚º
 << "RLCSA: Eº‹ o≥nög Psò¨øy fûe!" << 
°d
::
ídl
;

39 
usöt
 
	gdi°ributi⁄
[
CHARS
];

40 
	g¨øy_fûe
.
ªad
((*)
di°ributi⁄
, 
CHARS
 * (
usöt
));

41 
	gthis
->
	gÆphabë
 = 
√w
 
AÕhabë
(
di°ributi⁄
);Åhis->
	gd©a_size
 = 
this
->
Æphabë
->
gëD©aSize
();

43 
P¨amëîs
 
	g∑ømëîs
;

44 
	g∑ømëîs
.
ªad
(
ba£_«me
 + 
PARAMETERS_EXTENSION
);

45 
usöt
 
	gc
 = 0; c < 
	gCHARS
; c++)

47 if(
	gthis
->
	gÆphabë
->
hasCh¨
(
c
)Ë{Åhis->
	g¨øy
[c] = 
√w
 
PsiVe˘‹
(
¨øy_fûe
); }

50 
	gthis
->
	gíd_poöts
 = 
√w
 
DñèVe˘‹
(
¨øy_fûe
);

51 
	gthis
->
	gnumbî_of_£quí˚s
 = 
this
->
íd_poöts
->
gëNumbîOfIãms
();

53 
	g¨øy_fûe
.
ªad
((*)&(
this
->
ßm∂e_øã
), (this->sample_rate));

54 
	g¨øy_fûe
.
˛o£
();

56 if(
	g∑ømëîs
.
gë
(
SUPPORT_LOCATE
Ë||Ö¨amëîs.gë(
SUPPORT_DISPLAY
))

58 
	g°d
::
°rög
 
ß_ßm∂e_«me
 = 
ba£_«me
 + 
SA_SAMPLES_EXTENSION
;

59 
	g°d
::
if°ªam
 
ß_ßm∂e_fûe
(
ß_ßm∂e_«me
.
c_°r
(), 
°d
::
ios_ba£
::
bö¨y
);

60 if(!
	gß_ßm∂e_fûe
)

62 
	g°d
::
˚º
 << "RLCSA: Eº‹ o≥nög suffixáºay sam∂êfûe!" << 
°d
::
ídl
;

65 
boﬁ
 
	gweighãd
 = 
∑ømëîs
.
gë
(
WEIGHTED_SAMPLES
);

66 
	gthis
->
	gß_ßm∂es
 = 
√w
 
SASam∂es
(
ß_ßm∂e_fûe
, 
this
->
ßm∂e_øã
, 
weighãd
);

67 
	gß_ßm∂e_fûe
.
˛o£
();

69 
	gthis
->
	gsuµ‹t_loˇã
 = 
this
->
ß_ßm∂es
->
suµ‹tsLoˇã
();

70 
	gthis
->
	gsuµ‹t_di•œy
 = 
this
->
ß_ßm∂es
->
suµ‹tsDi•œy
();

73 if(
	g¥öt
Ë{ 
	g∑ømëîs
.
¥öt
(); }

75 
	gthis
->
	gok
 = 
åue
;

78 
	gRLCSA
::
RLCSA
(
uch¨
* 
d©a
, 
usöt
 
byãs
, usöà
block_size
, usöà
ß_ßm∂e_øã
, usöà
thªads
, 
boﬁ
 
dñëe_d©a
) :

79 
ok
(
Ál£
),

80 
Æphabë
(0),

81 
ß_ßm∂es
(0), 
suµ‹t_loˇã
(
Ál£
), 
suµ‹t_di•œy
(false),

82 
ßm∂e_øã
(
ß_ßm∂e_øã
), 
íd_poöts
(0)

84 
usöt
 
	gc
 = 0; c < 
	gCHARS
; c++Ë{ 
	gthis
->
	g¨øy
[
c
] = 0; }

86 if(!
	gd©a
 || 
	gbyãs
 == 0)

88 
°d
::
˚º
 << "RLCSA: Nÿöpuàd©®giví!" << std::
ídl
;

89 if(
	gdñëe_d©a
Ë{ 
	gdñëe
[] 
	gd©a
; }

92 if(
	gblock_size
 < 2 * (
	gusöt
) || block_size % (usint) != 0)

94 
°d
::
˚º
 << "RLCSA: Block sizêmu° bê®mu…ùÀ o‡" << (
usöt
Ë<< " byãs!" << std::
ídl
;

95 if(
	gdñëe_d©a
Ë{ 
	gdñëe
[] 
	gd©a
; }

99 
	gthis
->
buûdRLCSA
(
d©a
, 0, 
byãs
, 
block_size
, 
thªads
, 0, 
åue
, 
dñëe_d©a
);

102 
	gRLCSA
::
RLCSA
(
uch¨
* 
d©a
, 
usöt
* 
ønks
, usöà
byãs
, usöà
block_size
, usöà
ß_ßm∂e_øã
, usöà
thªads
, 
boﬁ
 
dñëe_d©a
) :

103 
ok
(
Ál£
),

104 
ß_ßm∂es
(0), 
suµ‹t_loˇã
(
Ál£
), 
suµ‹t_di•œy
(false),

105 
ßm∂e_øã
(
ß_ßm∂e_øã
), 
íd_poöts
(0)

107 
usöt
 
	gc
 = 0; c < 
	gCHARS
; c++Ë{ 
	gthis
->
	g¨øy
[
c
] = 0; }

109 if(!
	gd©a
 || !
	gønks
 || 
	gbyãs
 == 0)

111 
°d
::
˚º
 << "RLCSA: Nÿöpuàd©®giví!" << std::
ídl
;

112 if(
	gdñëe_d©a
Ë{ 
	gdñëe
[] 
	gd©a
; }

115 if(
	gblock_size
 < 2 * (
	gusöt
) || block_size % (usint) != 0)

117 
°d
::
˚º
 << "RLCSA: Block sizêmu° bê®mu…ùÀ o‡" << (
usöt
Ë<< " byãs!" << std::
ídl
;

118 if(
	gdñëe_d©a
Ë{ 
	gdñëe
[] 
	gd©a
; }

122 
	gthis
->
buûdRLCSA
(
d©a
, 
ønks
, 
byãs
, 
block_size
, 
thªads
, 0, 
åue
, 
dñëe_d©a
);

125 
	gRLCSA
::
RLCSA
(
uch¨
* 
d©a
, 
usöt
 
byãs
, usöà
block_size
, usöà
ß_ßm∂e_øã
, usöà
thªads
, 
Sam∂î
* 
ßm∂î
, 
boﬁ
 
dñëe_d©a
) :

126 
ok
(
Ál£
),

127 
Æphabë
(0),

128 
ß_ßm∂es
(0), 
suµ‹t_loˇã
(
Ál£
), 
suµ‹t_di•œy
(false),

129 
ßm∂e_øã
(
ß_ßm∂e_øã
),

130 
íd_poöts
(0)

132 
usöt
 
	gc
 = 0; c < 
	gCHARS
; c++Ë{ 
	gthis
->
	g¨øy
[
c
] = 0; }

134 if(!
	gd©a
 || 
	gbyãs
 == 0)

136 
°d
::
˚º
 << "RLCSA: Nÿöpuàd©®giví!" << std::
ídl
;

137 if(
	gdñëe_d©a
Ë{ 
	gdñëe
[] 
	gd©a
; }

140 if(
	gblock_size
 < 2 * (
	gusöt
) || block_size % (usint) != 0)

142 
°d
::
˚º
 << "RLCSA: Block sizêmu° bê®mu…ùÀ o‡" << (
usöt
Ë<< " byãs!" << std::
ídl
;

143 if(
	gdñëe_d©a
Ë{ 
	gdñëe
[] 
	gd©a
; }

146 if(
	gßm∂î
 !0 && 
ßm∂î
->
gëSètus
(Ë!
Sam∂î
::
SAMPLED
)

148 
°d
::
˚º
 << "RLCSA: Nÿßm∂e†giví!" << std::
ídl
;

149 if(
	gdñëe_d©a
Ë{ 
	gdñëe
[] 
	gd©a
; }

153 
	gthis
->
buûdRLCSA
(
d©a
, 0, 
byãs
, 
block_size
, 
thªads
, 
ßm∂î
, 
Ál£
, 
dñëe_d©a
);

156 
	gRLCSA
::
RLCSA
(RLCSA& 
ödex
, RLCSA& 
ö¸emít
, 
usöt
* 
posôi⁄s
, usöà
block_size
, usöà
thªads
) :

157 
ok
(
Ál£
),

158 
Æphabë
(0),

159 
ß_ßm∂es
(0), 
suµ‹t_loˇã
(
Ál£
), 
suµ‹t_di•œy
(false),

160 
íd_poöts
(0)

162 
usöt
 
	gc
 = 0; c < 
	gCHARS
; c++Ë{ 
	gthis
->
	g¨øy
[
c
] = 0; }

164 if(!
	gödex
.
isOk
(Ë|| !
	gö¸emít
.isOk())

168 if(
	gposôi⁄s
 == 0)

170 
°d
::
˚º
 << "RLCSA: Posôi⁄†f‹ in£πi⁄†nŸávaûabÀ!" << std::
ídl
;

173 if(
	gödex
.
	gßm∂e_øã
 !
ö¸emít
.
ßm∂e_øã
)

175 
°d
::
˚º
 << "RLCSA: C™nŸ comböêödexe†wôh dif„ª¡ sam∂êøãs!" << std::
ídl
;

179 
	gödex
.
°rù
();

180 
	gö¸emít
.
°rù
();

183 
usöt
 
	gdi°ributi⁄
[
CHARS
];

184 
usöt
 
	gc
 = 0; c < 
	gCHARS
; c++)

186 
	gdi°ributi⁄
[
c
] = 
ödex
.
Æphabë
->
cou¡Of
(cË+ 
ö¸emít
.alphabet->countOf(c);

188 
	gthis
->
	gÆphabë
 = 
√w
 
AÕhabë
(
di°ributi⁄
);Åhis->
	gd©a_size
 = 
this
->
Æphabë
->
gëD©aSize
();

189 
	gthis
->
	gßm∂e_øã
 = 
ödex
.
ßm∂e_øã
;

190 
	gthis
->
	gnumbî_of_£quí˚s
 = 
ödex
.
numbî_of_£quí˚s
 + 
ö¸emít
.number_of_sequences;

194 
usöt
 
	gpsi_size
 = 
this
->
d©a_size
 +Åhis->
numbî_of_£quí˚s
;

195 
boﬁ
 
	gshould_be_ok
 = 
åue
;

197 #ifde‡
MULTITHREAD_SUPPORT


198 
omp_£t_num_thªads
(
thªads
);

200 #¥agm®
omp
 
∑øŒñ
 
scheduÀ
(
dy«mic
, 1)

201 
	gc
 = -2; c < ()
	gCHARS
; c++)

203 if(
	gc
 =-2Ë{ 
this
->
mîgeEndPoöts
(
ödex
, 
ö¸emít
); }

204 if(
	gc
 =-1Ë{ 
this
->
mîgeSam∂es
(
ödex
, 
ö¸emít
, 
posôi⁄s
); }

205 if(
	gthis
->
	gÆphabë
->
hasCh¨
(
c
) != 0)

207 
this
->
¨øy
[
c
] = 
mîgeVe˘‹s
<
PsiVe˘‹
>(
ödex
.¨øy[c], 
	gö¸emít
.
	g¨øy
[c], 
	gposôi⁄s
, in¸emít.
	gd©a_size
 + in¸emít.
	gnumbî_of_£quí˚s
, 
	gpsi_size
, 
	gblock_size
);

208 
	gödex
.
	g¨øy
[
c
] = 0;

209 
	gö¸emít
.
	g¨øy
[
c
] = 0;

211 if(
	gthis
->
	g¨øy
[
c
] == 0)

213 
°d
::
˚º
 << "RLCSA: MîgêÁûed f‹ ve˘‹†" << 
c
 << "!" << std::
ídl
;

214 
	gshould_be_ok
 = 
Ál£
;

219 
	gthis
->
	gok
 = 
should_be_ok
;

222 
	gRLCSA
::~
RLCSA
()

224 
usöt
 
c
 = 0; 
	gc
 < 
	gCHARS
; c++Ë{ 
dñëe
 
	gthis
->
	g¨øy
[c];Åhis->array[c] = 0; }

225 
dñëe
 
	gthis
->
	gÆphabë
;Åhis->alphabet = 0;

226 
dñëe
 
	gthis
->
	gß_ßm∂es
;Åhis->sa_samples = 0;

227 
dñëe
 
	gthis
->
	gíd_poöts
;Åhis->end_points = 0;

233 
	gRLCSA
::
wrôeTo
(c⁄° 
°d
::
°rög
& 
ba£_«me
) const

235 
°d
::
°rög
 
¨øy_«me
 = 
ba£_«me
 + 
ARRAY_EXTENSION
;

236 
	g°d
::
of°ªam
 
¨øy_fûe
(
¨øy_«me
.
c_°r
(), 
°d
::
ios_ba£
::
bö¨y
);

237 if(!
	g¨øy_fûe
)

239 
	g°d
::
˚º
 << "RLCSA: Eº‹ cª©ög Psò¨øy fûe!" << 
°d
::
ídl
;

243 
	gthis
->
	gÆphabë
->
wrôeTo
(
¨øy_fûe
);

244 
usöt
 
	gc
 = 0; c < 
	gCHARS
; c++)

246 if(
	gthis
->
	g¨øy
[
c
] != 0)

248 
this
->
¨øy
[
c
]->
wrôeTo
(
¨øy_fûe
);

252 
	gthis
->
	gíd_poöts
->
wrôeTo
(
¨øy_fûe
);

253 
	g¨øy_fûe
.
wrôe
((*)&(
this
->
ßm∂e_øã
), (this->sample_rate));

254 
	g¨øy_fûe
.
˛o£
();

256 if(
	gthis
->
	gß_ßm∂es
 != 0)

258 
°d
::
°rög
 
ß_ßm∂e_«me
 = 
ba£_«me
 + 
SA_SAMPLES_EXTENSION
;

259 
	g°d
::
of°ªam
 
ß_ßm∂e_fûe
(
ß_ßm∂e_«me
.
c_°r
(), 
°d
::
ios_ba£
::
bö¨y
);

260 if(!
	gß_ßm∂e_fûe
)

262 
	g°d
::
˚º
 << "RLCSA: Eº‹ cª©ög suffixáºay sam∂êfûe!" << 
°d
::
ídl
;

266 
	gthis
->
	gß_ßm∂es
->
wrôeTo
(
ß_ßm∂e_fûe
);

267 
	gß_ßm∂e_fûe
.
˛o£
();

270 
P¨amëîs
 
	g∑ømëîs
;

271 
	g∑ømëîs
.
£t
(
RLCSA_BLOCK_SIZE
.
fú°
, 
this
->
gëBlockSize
(Ë* (
usöt
));

272 
	g∑ømëîs
.
£t
(
SAMPLE_RATE
.
fú°
, 
this
->
ßm∂e_øã
);

273 
	g∑ømëîs
.
£t
(
SUPPORT_LOCATE
.
fú°
, 
this
->
suµ‹t_loˇã
);

274 
	g∑ømëîs
.
£t
(
SUPPORT_DISPLAY
.
fú°
, 
this
->
suµ‹t_di•œy
);

275 if(
	gthis
->
	gß_ßm∂es
 !0 && 
this
->
ß_ßm∂es
->
isWeighãd
())

277 
∑ømëîs
.
£t
(
WEIGHTED_SAMPLES
.
fú°
, 1);

279 { 
	g∑ømëîs
.
£t
(
WEIGHTED_SAMPLES
); }

280 
	g∑ømëîs
.
wrôe
(
ba£_«me
 + 
PARAMETERS_EXTENSION
);

285 
∑ú_ty≥


286 
	gRLCSA
::
cou¡
(c⁄° 
°d
::
°rög
& 
∑âîn
) const

288 if(
∑âîn
.
Àngth
(Ë=0Ë{  
this
->
gëSAR™ge
(); }

290 
	g°d
::
°rög
::
c⁄°_ªvî£_ôî©‹
 
ôî
 = 
∑âîn
.
rbegö
();

291 
∑ú_ty≥
 
	gödex_ønge
 = 
this
->
gëCh¨R™ge
((
uch¨
)*
ôî
);

292 if(
isEm±y
(
ödex_ønge
)Ë{  
	gödex_ønge
; }

294 ++
	gôî
; iã∏!
∑âîn
.
ªnd
(); ++iter)

296 
	gödex_ønge
 = 
this
->
LF
(
ödex_ønge
, (
uch¨
)*
ôî
);

297 if(
isEm±y
(
ödex_ønge
)Ë{  
	gEMPTY_PAIR
; }

299 
	gthis
->
c⁄vîtToSAR™ge
(
ödex_ønge
);

301  
	gödex_ønge
;

307 
	gRLCSA
::
ªp‹tPosôi⁄s
(
uch¨
* 
d©a
, 
usöt
 
Àngth
, usöt* 
posôi⁄s
) const

309 if(
	gd©a
 =0 || 
Àngth
 =0 || 
posôi⁄s
 == 0) { ; }

311 
	gPsiVe˘‹
::
Iãøt‹
** 
ôîs
 = 
this
->
gëIãøt‹s
();

313 
usöt
 
	gcuºít
 = 
this
->
numbî_of_£quí˚s
 - 1;

314 
	gposôi⁄s
[
Àngth
] = 
cuºít
;

315 
söt
 
	gi
 = (söt)(
Àngth
 - 1); i >= 0; i--)

317 
usöt
 
	gc
 = (usöt)
d©a
[
i
];

318 if(
	gthis
->
	g¨øy
[
c
] != 0)

320 
cuºít
 = 
this
->
LF
(cuºít, 
c
, *(
ôîs
[c]));

324 if(
	gc
 < 
	gthis
->
	gÆphabë
->
gëFú°Ch¨
())

326 
	gcuºít
 = 
this
->
numbî_of_£quí˚s
 - 1;

330 
	gcuºít
 = 
this
->
Æphabë
->
cumuœtive
(
c
Ë- 1 +Åhis->
numbî_of_£quí˚s
;

333 
	gposôi⁄s
[
i
] = 
cuºít
;

336 
	gthis
->
dñëeIãøt‹s
(
ôîs
);

341 
usöt
*

342 
	gRLCSA
::
loˇã
(
∑ú_ty≥
 
ønge
, 
boﬁ
 
dúe˘
, boﬁ 
°ïs
) const

344 if(!(
	gthis
->
	gsuµ‹t_loˇã
Ë|| 
isEm±y
(
ønge
Ë|| 
	gønge
.
	g£c⁄d
 >
this
->
d©a_size
) {  0; }

346 
usöt
* 
	gd©a
 = 
√w
 usöt[
Àngth
(
ønge
)];

347 if(
	gdúe˘
Ë{ 
	gthis
->
dúe˘Loˇã
(
ønge
, 
d©a
, 
°ïs
); }

348 { 
	gthis
->
loˇãUnß„
(
ønge
, 
d©a
, 
°ïs
); }

350  
	gd©a
;

353 
usöt
*

354 
	gRLCSA
::
loˇã
(
∑ú_ty≥
 
ønge
, 
usöt
* 
d©a
, 
boﬁ
 
dúe˘
, boﬁ 
°ïs
) const

356 if(!(
	gthis
->
	gsuµ‹t_loˇã
Ë|| 
isEm±y
(
ønge
Ë|| 
	gønge
.
	g£c⁄d
 >
this
->
d©a_size
 || 
d©a
 == 0) {  0; }

358 if(
	gdúe˘
Ë{ 
	gthis
->
dúe˘Loˇã
(
ønge
, 
d©a
, 
°ïs
); }

359 { 
	gthis
->
loˇãUnß„
(
ønge
, 
d©a
, 
°ïs
); }

361  
	gd©a
;

364 
usöt


365 
	gRLCSA
::
loˇã
(
usöt
 
ödex
, 
boﬁ
 
°ïs
) const

367 if(!(
	gthis
->
	gsuµ‹t_loˇã
Ë|| 
	gödex
 >
this
->
d©a_size
Ë{  (
°ïs
 ? 0 :Åhis->data_size); }

369  
	gthis
->
dúe˘Loˇã
(
ödex
 + 
this
->
numbî_of_£quí˚s
, 
°ïs
);

373 
	gRLCSA
::
dúe˘Loˇã
(
∑ú_ty≥
 
ønge
, 
usöt
* 
d©a
, 
boﬁ
 
°ïs
) const

375 
	gthis
->
c⁄vîtToBWTR™ge
(
ønge
);

376 
usöt
 
	gi
 = 0, 
	gj
 = 
ønge
.
fú°
; j <ønge.
£c⁄d
; i++, j++)

378 
	gd©a
[
i
] = 
this
->
dúe˘Loˇã
(
j
, 
°ïs
);

382 
usöt


383 
	gRLCSA
::
dúe˘Loˇã
(
usöt
 
ödex
, 
boﬁ
 
°ïs
) const

385 
usöt
 
	goff£t
 = 0;

386 
	gåue
)

388 if(
	gthis
->
hasIm∂icôSam∂e
(
ödex
))

390 if(
	g°ïs
Ë{  
	goff£t
; }

391 {  
	gthis
->
gëIm∂icôSam∂e
(
ödex
Ë- 
	goff£t
; }

393 
	gödex
 -
this
->
numbî_of_£quí˚s
;

394 if(
	gthis
->
	gß_ßm∂es
->
isSam∂ed
(
ödex
))

396  (
	g°ïs
 ? 
	goff£t
 : 
this
->
ß_ßm∂es
->
gëSam∂eAt
(
ödex
Ë- 
off£t
);

398 
	gödex
 = 
this
->
psi
(
ödex
);

399 
	goff£t
++;

404 
	gRLCSA
::
loˇãUnß„
(
∑ú_ty≥
 
ønge
, 
usöt
* 
d©a
, 
boﬁ
 
°ïs
) const

406 
	gthis
->
c⁄vîtToBWTR™ge
(
ønge
);

407 
usöt
 
	gôems
 = 
Àngth
(
ønge
);

408 
usöt
* 
	goff£ts
 = 
√w
 usöt[
ôems
];

409 
boﬁ
* 
	gföished
 = 
√w
 boﬁ[
ôems
];

411 
	gPsiVe˘‹
::
Iãøt‹
** 
ôîs
 = 
this
->
gëIãøt‹s
();

413 
usöt
 
	gi
 = 0, 
	gj
 = 
ønge
.
fú°
; i < 
	gôems
; i++, j++)

415 
	gd©a
[
i
] = 
j
;

416 
	goff£ts
[
i
] = 0;

417 
	gföished
[
i
] = 
Ál£
;

420 
boﬁ
 
	gfound
 = 
Ál£
;

421 !
	gfound
)

423 
	gfound
 = 
åue
;

424 
∑ú_ty≥
 
	grun
 = 
EMPTY_PAIR
;

425 
usöt
 
	gi
 = 0; i < 
	gôems
; i++)

427 if(
	gföished
[
i
])

431 if(
isEm±y
(
run
))

433 
	grun
 = 
∑ú_ty≥
(
i
, i);

435 if(
	gd©a
[
i
] - d©a[
run
.
fú°
] == i -Ñun.first)

437 
run
.
£c⁄d
 = 
i
;

441 
	gfound
 &
this
->
¥o˚ssRun
(
run
, 
d©a
, 
off£ts
, 
föished
, 
ôîs
, 
°ïs
);

442 
	grun
 = 
∑ú_ty≥
(
i
, i);

445 if(!
isEm±y
(
run
)Ë{ 
	gfound
 &
this
->
¥o˚ssRun
‘un, 
d©a
, 
off£ts
, 
föished
, 
ôîs
, 
°ïs
); }

448 
	gthis
->
dñëeIãøt‹s
(
ôîs
);

449 
	gdñëe
[] 
	goff£ts
;

450 
	gdñëe
[] 
	gföished
;

453 
boﬁ


454 
	gRLCSA
::
¥o˚ssRun
(
∑ú_ty≥
 
run
, 
usöt
* 
d©a
, usöt* 
off£ts
, 
boﬁ
* 
föished
, 
PsiVe˘‹
::
Iãøt‹
** 
ôîs
, boﬁ 
°ïs
) const

456 
boﬁ
 
	gfound
 = 
åue
;

457 
usöt
 
	grun_°¨t
 = 0, 
	grun_À·
 = 0;

458 
∑ú_ty≥
 
	g√xt_ßm∂e
 =Öair_type(0, 0);

460 
usöt
 
	gi
 = 
run
.
fú°
; i <run.
£c⁄d
; i++)

462 if(
	gföished
[
i
])

464 if(
	grun_À·
 > 0) {Ñun_left--; }

467 if(
	gd©a
[
i
] < 
	gthis
->
	gnumbî_of_£quí˚s
)

469 
	gDñèVe˘‹
::
Iãøt‹
 
ôî
(*(
this
->
íd_poöts
));

470 
	gd©a
[
i
] = (
°ïs
 ? 
off£ts
[i] : 
ôî
.
£À˘
(
d©a
[i]) + 1 - offsets[i]);

471 
	gföished
[
i
] = 
åue
;

472 if(
	grun_À·
 > 0) {Ñun_left--; }

475 if(
	g√xt_ßm∂e
.
	gfú°
 < 
	gd©a
[
i
])

477 
	g√xt_ßm∂e
 = 
this
->
ß_ßm∂es
->
gëFú°Sam∂eA·î
(
d©a
[
i
] -Åhis->
numbî_of_£quí˚s
);

478 
	g√xt_ßm∂e
.
	gfú°
 +
this
->
numbî_of_£quí˚s
;

480 if(
	gd©a
[
i
] < 
	g√xt_ßm∂e
.
	gfú°
)

482 if(
	grun_À·
 > 0)

484 
	gd©a
[
i
] = 
d©a
[
run_°¨t
] + i -Ñun_start;

485 
	grun_À·
--;

489 
∑ú_ty≥
 
	gvÆue
 = 
this
->
psi
(
d©a
[
i
] -Åhis->
numbî_of_£quí˚s
, 
run
.
£c⁄d
 - i, 
ôîs
);

490 
	gd©a
[
i
] = 
vÆue
.
fú°
;

491 
	grun_À·
 = 
vÆue
.
£c⁄d
;

492 
	grun_°¨t
 = 
i
;

494 
	goff£ts
[
i
]++;

495 
	gfound
 = 
Ál£
;

499 
	gd©a
[
i
] = (
°ïs
 ? 
off£ts
[i] : 
this
->
ß_ßm∂es
->
gëSam∂e
(
√xt_ßm∂e
.
£c⁄d
) - offsets[i]);

500 
	gföished
[
i
] = 
åue
;

501 if(
	grun_À·
 > 0) {Ñun_left--; }

504  
	gfound
;

509 
uch¨
*

510 
	gRLCSA
::
di•œy
(
usöt
 
£quí˚
, 
boﬁ
 
ö˛ude_íd_m¨kî
) const

512 if(!(
	gthis
->
	gsuµ‹t_di•œy
)) {  0; }

514 
∑ú_ty≥
 
	g£q_ønge
 = 
this
->
gëSequí˚R™ge
(
£quí˚
);

515 if(
isEm±y
(
£q_ønge
)) {  0; }

517 
uch¨
* 
	gd©a
 = 
√w
 uch¨[
Àngth
(
£q_ønge
Ë+ 
ö˛ude_íd_m¨kî
];

518 
	gthis
->
di•œyUnß„
(
£q_ønge
, 
d©a
);

519 if(
	gö˛ude_íd_m¨kî
Ë{ 
	gd©a
[
Àngth
(
£q_ønge
)] = 0; }

521  
	gd©a
;

524 
uch¨
*

525 
	gRLCSA
::
di•œy
(
usöt
 
£quí˚
, 
∑ú_ty≥
 
ønge
) const

527 if(!(
	gthis
->
	gsuµ‹t_di•œy
Ë|| 
isEm±y
(
ønge
)) {  0; }

529 
∑ú_ty≥
 
	g£q_ønge
 = 
this
->
gëSequí˚R™ge
(
£quí˚
);

530 if(
isEm±y
(
£q_ønge
)) {  0; }

532 
	gønge
.
	gfú°
 +
£q_ønge
.
fú°
;Ñ™ge.
	g£c⁄d
 += seq_range.first;

533 if(
	gønge
.
	g£c⁄d
 > 
	g£q_ønge
.second) {  0; }

535 
uch¨
* 
	gd©a
 = 
√w
 uch¨[
Àngth
(
ønge
)];

536 
	gthis
->
di•œyUnß„
(
ønge
, 
d©a
);

538  
	gd©a
;

541 
uch¨
*

542 
	gRLCSA
::
di•œy
(
usöt
 
£quí˚
, 
∑ú_ty≥
 
ønge
, 
uch¨
* 
d©a
) const

544 if(!(
	gthis
->
	gsuµ‹t_di•œy
Ë|| 
isEm±y
(
ønge
Ë|| 
	gd©a
 == 0) {  0; }

546 
∑ú_ty≥
 
	g£q_ønge
 = 
this
->
gëSequí˚R™ge
(
£quí˚
);

547 if(
isEm±y
(
£q_ønge
)) {  0; }

549 
	gønge
.
	gfú°
 +
£q_ønge
.
fú°
;Ñ™ge.
	g£c⁄d
 += seq_range.first;

550 if(
	gønge
.
	g£c⁄d
 > 
	g£q_ønge
.second) {  0; }

552 
	gthis
->
di•œyUnß„
(
ønge
, 
d©a
);

553  
	gd©a
;

556 
uch¨
*

557 
	gRLCSA
::
di•œy
(
usöt
 
posôi⁄
, usöà
Àn
, usöà
c⁄ãxt
, usöt& 
ªsu…_Àngth
) const

559 if(!(
	gthis
->
	gsuµ‹t_di•œy
)) {  0; }

561 
∑ú_ty≥
 
	gønge
 = 
this
->
gëSequí˚R™geF‹Posôi⁄
(
posôi⁄
);

562 if(
isEm±y
(
ønge
)) {  0; }

564 
	gønge
.
	gfú°
 = 
posôi⁄
 - 
°d
::
mö
(
c⁄ãxt
,Öosôi⁄ - 
ønge
.
fú°
);

565 
	gønge
.
	g£c⁄d
 = 
°d
::
mö
(
ønge
.
£c⁄d
, 
posôi⁄
 + 
Àn
 + 
c⁄ãxt
 - 1);

566 
	gªsu…_Àngth
 = 
Àngth
(
ønge
);

567 if(
isEm±y
(
ønge
)) {  0; }

569 
uch¨
* 
	gd©a
 = 
√w
 uch¨[
Àngth
(
ønge
)];

570 
	gthis
->
di•œyUnß„
(
ønge
, 
d©a
);

572  
	gd©a
;

575 
usöt


576 
	gRLCSA
::
di•œyPªfix
(
usöt
 
£quí˚
, usöà
Àn
, 
uch¨
* 
d©a
) const

578 if(!(
	gthis
->
	gsuµ‹t_di•œy
Ë|| 
	gÀn
 =0 || 
d©a
 == 0) {  0; }

580 
∑ú_ty≥
 
	g£q_ønge
 = 
this
->
gëSequí˚R™ge
(
£quí˚
);

581 if(
isEm±y
(
£q_ønge
)) {  0; }

583 
∑ú_ty≥
 
ønge
(
£q_ønge
.
fú°
, 
°d
::
mö
(£q_ønge.
£c⁄d
, seq_ønge.fú° + 
Àn
 - 1));

585 
	gthis
->
di•œyUnß„
(
ønge
, 
d©a
);

586  
Àngth
(
ønge
);

589 
usöt


590 
	gRLCSA
::
di•œyFromPosôi⁄
(
usöt
 
ödex
, usöà
max_Àn
, 
uch¨
* 
d©a
) const

592 if(
	gmax_Àn
 =0 || 
d©a
 =0 || 
ödex
 >
this
->
d©a_size
) {  0; }

594 
usöt
 
	gi
 = 0; i < 
	gmax_Àn
; i++)

596 
	gd©a
[
i
] = 
this
->
gëCh¨a˘î
(
ödex
);

597 
	gödex
 = 
this
->
psiUnß„
(
ödex
, 
d©a
[
i
]);

598 if(
	gödex
 < 
	gthis
->
	gnumbî_of_£quí˚s
Ë{  
	gi
 + 1; }

599 
	gödex
 -
this
->
numbî_of_£quí˚s
;

602  
	gmax_Àn
;

606 
	gRLCSA
::
di•œyUnß„
(
∑ú_ty≥
 
ønge
, 
uch¨
* 
d©a
, 
boﬁ
 
gë_ønks
, 
usöt
* 
ønks
) const

608 
∑ú_ty≥
 
	gªs
 = 
this
->
ß_ßm∂es
->
övî£SA
(
ønge
.
fú°
);

609 
usöt
 
	gi
 = 
ªs
.
fú°
, 
	gpos
 =Ñes.
£c⁄d
;

611 if(
Àngth
(
ønge
) >= 1024)

613 
PsiVe˘‹
::
Iãøt‹
** 
ôîs
 = 
this
->
gëIãøt‹s
();

614 ; 
	gi
 < 
	gønge
.
	gfú°
; i++)

616 
	gpos
 = 
this
->
psi
(
pos
, 
ôîs
Ë- 
	gthis
->
	gnumbî_of_£quí˚s
;

618 ; 
	gi
 <
ønge
.
£c⁄d
; i++)

620 
usöt
 
	gc
 = 
this
->
gëCh¨a˘î
(
pos
);

621 
	gd©a
[
i
 - 
ønge
.
fú°
] = 
c
;

622 if(
	ggë_ønks
Ë{ 
	gønks
[
i
 - 
ønge
.
fú°
] = 
pos
 + 
this
->
numbî_of_£quí˚s
; }

623 
	gpos
 = 
this
->
psiUnß„
(
pos
, 
c
, *(
ôîs
[c])Ë- 
	gthis
->
	gnumbî_of_£quí˚s
;

625 
	gthis
->
dñëeIãøt‹s
(
ôîs
);

629 ; 
	gi
 < 
	gønge
.
	gfú°
; i++)

631 
	gpos
 = 
this
->
psi
(
pos
Ë-Åhis->
numbî_of_£quí˚s
;

633 ; 
	gi
 <
ønge
.
£c⁄d
; i++)

635 
usöt
 
	gc
 = 
this
->
gëCh¨a˘î
(
pos
);

636 
	gd©a
[
i
 - 
ønge
.
fú°
] = 
c
;

637 if(
	ggë_ønks
Ë{ 
	gønks
[
i
 - 
ønge
.
fú°
] = 
pos
 + 
this
->
numbî_of_£quí˚s
; }

638 
	gpos
 = 
this
->
psiUnß„
(
pos
, 
c
Ë- 
	gthis
->
	gnumbî_of_£quí˚s
;

645 
∑ú_ty≥


646 
	gRLCSA
::
gëSAR™ge
() const

648  
∑ú_ty≥
(0, 
this
->
d©a_size
 - 1);

651 
∑ú_ty≥


652 
	gRLCSA
::
gëBWTR™ge
() const

654  
∑ú_ty≥
(
this
->
numbî_of_£quí˚s
,Åhis->numbî_of_£quí˚†+Åhis->
d©a_size
 - 1);

657 
∑ú_ty≥


658 
	gRLCSA
::
gëCh¨R™ge
(
usöt
 
c
) const

660 if(
c
 >
CHARS
Ë{  
EMPTY_PAIR
; }

661 
∑ú_ty≥
 
	gödex_ønge
 = 
this
->
Æphabë
->
gëR™ge
(
c
);

662 
	gthis
->
c⁄vîtToBWTR™ge
(
ödex_ønge
);

663  
	gödex_ønge
;

667 
	gRLCSA
::
c⁄vîtToSAR™ge
(
∑ú_ty≥
& 
bwt_ønge
) const

669 
bwt_ønge
.
fú°
 -
this
->
numbî_of_£quí˚s
;

670 
	gbwt_ønge
.
	g£c⁄d
 -
this
->
numbî_of_£quí˚s
;

674 
	gRLCSA
::
c⁄vîtToBWTR™ge
(
∑ú_ty≥
& 
ß_ønge
) const

676 
ß_ønge
.
fú°
 +
this
->
numbî_of_£quí˚s
;

677 
	gß_ønge
.
	g£c⁄d
 +
this
->
numbî_of_£quí˚s
;

681 
	gRLCSA
::
c⁄vîtToSAR™ge
(
°d
::
ve˘‹
<
∑ú_ty≥
>& 
bwt_ønges
) const

683 
°d
::
ve˘‹
<
∑ú_ty≥
>::
ôî©‹
 
ôî
 = 
bwt_ønges
.
begö
(); 
	gôî
 !bwt_ønges.
íd
(); ++iter)

685 
	gthis
->
c⁄vîtToSAR™ge
(*
ôî
);

689 
∑ú_ty≥


690 
	gRLCSA
::
LF
(
∑ú_ty≥
 
ønge
, 
usöt
 
c
) const

692 if(
	gc
 >
CHARS
 || 
this
->
¨øy
[
c
] =0Ë{  
EMPTY_PAIR
; }

693 
	gPsiVe˘‹
::
Iãøt‹
 
ôî
(*(
this
->
¨øy
[
c
]));

695 
usöt
 
	g°¨t
 = 
this
->
Æphabë
->
cumuœtive
(
c
Ë+Åhis->
numbî_of_£quí˚s
 - 1;

696 
	gønge
.
	gfú°
 = 
°¨t
 + 
ôî
.
ønk
(
ønge
.
fú°
, 
åue
);

697 
	gønge
.
	g£c⁄d
 = 
°¨t
 + 
ôî
.
ønk
(
ønge
.
£c⁄d
);

699  
	gønge
;

702 
	g°d
::
ve˘‹
<
usöt
>*

703 
RLCSA
::
loˇãR™ge
(
∑ú_ty≥
 
ønge
) const

705 
°d
::
ve˘‹
<
usöt
>* 
ªsu…s
 = 
√w
 std::vector<usint>;

706 if(!(
	gthis
->
	gsuµ‹t_loˇã
)Ë{  
	gªsu…s
; }

708 
	gthis
->
loˇãR™ge
(
ønge
, *
ªsu…s
);

709 
ªmoveDu∂iˇãs
(
ªsu…s
, 
Ál£
);

711  
	gªsu…s
;

715 
	gRLCSA
::
loˇãR™ge
(
∑ú_ty≥
 
ønge
, 
°d
::
ve˘‹
<
usöt
>& 
vec
) const

717 if(
isEm±y
(
ønge
Ë||Ñ™ge.
£c⁄d
 >
this
->
d©a_size
) { ; }

719 
usöt
* 
	gd©a
 = 
√w
 usöt[
Àngth
(
ønge
)];

720 
	gthis
->
loˇãUnß„
(
ønge
, 
d©a
, 
Ál£
);

721 
usöt
 
	gi
 = 0; i < 
Àngth
(
ønge
); i++Ë{ 
	gvec
.
push_back
(
d©a
[
i
]); }

722 
	gdñëe
[] 
	gd©a
;

725 
	g°d
::
ve˘‹
<
usöt
>*

726 
RLCSA
::
loˇãR™ges
(
°d
::
ve˘‹
<
∑ú_ty≥
>& 
ønges
) const

728 
°d
::
ve˘‹
<
usöt
>* 
ªsu…s
 = 
√w
 std::vector<usint>;

729 if(!(
	gthis
->
	gsuµ‹t_loˇã
)Ë{  
	gªsu…s
; }

731 
	g°d
::
ve˘‹
<
∑ú_ty≥
>::
ôî©‹
 
ôî
 = 
ønges
.
begö
(); 
	gôî
 !ønges.
íd
(); ++iter)

733 
	gthis
->
loˇãR™ge
(*
ôî
, *
ªsu…s
);

735 
ªmoveDu∂iˇãs
(
ªsu…s
, 
Ál£
);

737  
	gªsu…s
;

742 
∑ú_ty≥


743 
	gRLCSA
::
gëSequí˚R™ge
(
usöt
 
numbî
) const

745 if(
numbî
 >
this
->
numbî_of_£quí˚s
Ë{  
EMPTY_PAIR
; }

747 
∑ú_ty≥
 
	gªsu…
;

748 
	gDñèVe˘‹
::
Iãøt‹
 
ôî
(*(
this
->
íd_poöts
));

749 if(
	gnumbî
 == 0)

751 
ªsu…
.
fú°
 = 0;

752 
	gªsu…
.
	g£c⁄d
 = 
ôî
.
£À˘
(
numbî
);

756 
	gªsu…
.
	gfú°
 = 
√xtMu…ùÀOf
(
this
->
ßm∂e_øã
, 
ôî
.
£À˘
(
numbî
 - 1));

757 
	gªsu…
.
	g£c⁄d
 = 
ôî
.
£À˘Next
();

760  
	gªsu…
;

763 
usöt


764 
	gRLCSA
::
gëSequí˚F‹Posôi⁄
(
usöt
 
vÆue
) const

766 if(
vÆue
 == 0) {  0; }

767 
	gDñèVe˘‹
::
Iãøt‹
 
ôî
(*(
this
->
íd_poöts
));

768  
	gôî
.
ønk
(
vÆue
 - 1);

771 
∑ú_ty≥


772 
	gRLCSA
::
gëSequí˚R™geF‹Posôi⁄
(
usöt
 
vÆue
) const

774  
this
->
gëSequí˚R™ge
—his->
gëSequí˚F‹Posôi⁄
(
vÆue
));

777 
usöt
*

778 
	gRLCSA
::
gëSequí˚F‹Posôi⁄
(
usöt
* 
vÆues
, usöà
Àn
) const

780 if(
	gvÆues
 == 0) {  0; }

782 
	gDñèVe˘‹
::
Iãøt‹
 
ôî
(*(
this
->
íd_poöts
));

783 
usöt
 
	gi
 = 0; i < 
	gÀn
; i++)

785 if(
	gvÆues
[
i
] > 0Ë{ vÆues[i] = 
ôî
.
ønk
(
vÆues
[i] - 1); }

788  
	gvÆues
;

791 
∑ú_ty≥


792 
	gRLCSA
::
gëRñ©ivePosôi⁄
(
usöt
 
vÆue
) const

794 
DñèVe˘‹
::
Iãøt‹
 
ôî
(*(
this
->
íd_poöts
));

795 
∑ú_ty≥
 
ªsu…
(0, 
vÆue
);

797 if(
	gvÆue
 > 0Ë{ 
	gªsu…
.
	gfú°
 = 
ôî
.
ønk
(
vÆue
 - 1); }

798 if(
	gªsu…
.
	gfú°
 > 0)

800 
	gªsu…
.
	g£c⁄d
 -
√xtMu…ùÀOf
(
this
->
ßm∂e_øã
, 
ôî
.
£À˘
(
ªsu…
.
fú°
 - 1));

803  
	gªsu…
;

808 
uch¨
*

809 
	gRLCSA
::
ªadBWT
() const

811  
this
->
ªadBWT
(
∑ú_ty≥
(0,Åhis->
d©a_size
 +Åhis->
numbî_of_£quí˚s
 - 1));

814 
uch¨
*

815 
	gRLCSA
::
ªadBWT
(
∑ú_ty≥
 
ønge
) const

817 if(
isEm±y
(
ønge
Ë||Ñ™ge.
£c⁄d
 >
this
->
d©a_size
 +Åhis->
numbî_of_£quí˚s
) {  0; }

819 
usöt
 
	gn
 = 
Àngth
(
ønge
);

821 
uch¨
* 
	gbwt
 = 
√w
 uch¨[
n
];

822 
mem£t
(
bwt
, 0, 
n
);

824 
usöt
 
	gc
 = 0; c < 
	gCHARS
; c++)

826 if(
	gthis
->
	g¨øy
[
c
] != 0)

828 
PsiVe˘‹
::
Iãøt‹
 
ôî
(*(
this
->
¨øy
[
c
]));

829 
usöt
 
	gpos
 = 
ôî
.
vÆueA·î
(
ønge
.
fú°
).first;

830 
	gpos
 <
ønge
.
£c⁄d
)

832 
bwt
[
pos
 - 
ønge
.
fú°
] = 
c
;

833 
	gpos
 = 
ôî
.
£À˘Next
();

838  
	gbwt
;

841 
usöt


842 
	gRLCSA
::
cou¡Runs
() const

844 
usöt
 
runs
 = 0;

845 
usöt
 
	gc
 = 0; c < 
	gCHARS
; c++)

847 if(
	gthis
->
	g¨øy
[
c
] != 0)

849 
PsiVe˘‹
::
Iãøt‹
 
ôî
(*(
this
->
¨øy
[
c
]));

850 
	gruns
 +
ôî
.
cou¡Runs
();

854  
	gruns
;

859 
SuffixAºay
*

860 
	gRLCSA
::
gëSuffixAºayF‹Sequí˚
(
usöt
 
numbî
) const

862 if(!
this
->
suµ‹tsDi•œy
()) {  0; }

864 
∑ú_ty≥
 
	g£q_ønge
 = 
this
->
gëSequí˚R™ge
(
numbî
);

865 if(
isEm±y
(
£q_ønge
)) {  0; }

867 
uch¨
* 
	gd©a
 = 
√w
 uch¨[
Àngth
(
£q_ønge
) + 1];

868 
usöt
* 
	gønks
 = 
√w
 usöt[
Àngth
(
£q_ønge
) + 1];

869 
	gthis
->
di•œyUnß„
(
£q_ønge
, 
d©a
, 
åue
, 
ønks
);

870 
	gd©a
[
Àngth
(
£q_ønge
)] = 0; 
	gønks
[Àngth(£q_ønge)] = 
numbî
;

872  
√w
 
SuffixAºay
(
d©a
, 
ønks
, 
Àngth
(
£q_ønge
) + 1, 1);

877 
	gPsiVe˘‹
::
Iãøt‹
**

878 
RLCSA
::
gëIãøt‹s
() const

880 
PsiVe˘‹
::
Iãøt‹
** 
ôîs
 = 
√w
 PsiVe˘‹::Iãøt‹*[
CHARS
];

881 
usöt
 
	gi
 = 0; i < 
	gCHARS
; i++)

883 if(
	gthis
->
	g¨øy
[
i
] =0Ë{ 
ôîs
[i] = 0; }

884 { 
	gôîs
[
i
] = 
√w
 
PsiVe˘‹
::
Iãøt‹
(*(
this
->
¨øy
[i])); }

886  
	gôîs
;

890 
	gRLCSA
::
dñëeIãøt‹s
(
PsiVe˘‹
::
Iãøt‹
** 
ôîs
) const

892 if(
ôîs
 == 0) { ; }

893 
usöt
 
	gi
 = 0; i < 
	gCHARS
; i++Ë{ 
dñëe
 
	gôîs
[
i
]; }

894 
	gdñëe
[] 
	gôîs
;

899 
usöt


900 
	gRLCSA
::
ªp‹tSize
(
boﬁ
 
¥öt
) const

902 
usöt
 
byãs
 = 0, 
	gãmp
 = 0, 
	gbwt
 = 0;

904 
usöt
 
	gc
 = 0; c < 
	gCHARS
; c++)

906 if(
	gthis
->
	g¨øy
[
c
])

908 
	gbyãs
 +
this
->
¨øy
[
c
]->
ªp‹tSize
();

909 
	gbwt
 +
this
->
¨øy
[
c
]->
gëCom¥es£dSize
();

912 
	gbyãs
 +(*
this
Ë+Åhis->
Æphabë
->
ªp‹tSize
(Ë+Åhis->
íd_poöts
->reportSize();

913 if(
	g¥öt
)

915 
	g°d
::
cout
 << "RLCSA: " << (
byãs
 / ()
MEGABYTE
Ë<< " MB" << 
°d
::
ídl
;

916 
	g°d
::
cout
 << " BWT o∆y: " << (
bwt
 / ()
MEGABYTE
Ë<< " MB" << 
°d
::
ídl
;

919 if(
	gthis
->
	gsuµ‹t_loˇã
 ||Åhis->
	gsuµ‹t_di•œy
)

921 
	gãmp
 = 
this
->
ß_ßm∂es
->
ªp‹tSize
();

922 if(
	g¥öt
Ë{ 
	g°d
::
cout
 << "SA sam∂es: " << (
ãmp
 / ()
MEGABYTE
Ë<< " MB" << 
°d
::
ídl
; }

923 
	gbyãs
 +
ãmp
;

926 if(
	g¥öt
)

928 
	g°d
::
cout
 << "TŸÆ size: " << (
byãs
 / ()
MEGABYTE
Ë<< " MB" << 
°d
::
ídl
;

929 
	g°d
::
cout
 << 
°d
::
ídl
;

932  
	gbyãs
;

936 
	gRLCSA
::
¥ötInfo
() const

938 
megabyãs
 = 
this
->
d©a_size
 / ()
MEGABYTE
;

940 
	g°d
::
cout
 << "Sequí˚s: " << 
this
->
numbî_of_£quí˚s
 << 
°d
::
ídl
;

941 
	g°d
::
cout
 << "OrigöÆ size: " << 
megabyãs
 << " MB" << 
°d
::
ídl
;

942 
	g°d
::
cout
 << "Block size: " << (
this
->
gëBlockSize
(Ë* (
usöt
)Ë<< " byãs" << 
°d
::
ídl
;

943 if(
	gthis
->
	gsuµ‹t_loˇã
 ||Åhis->
	gsuµ‹t_di•œy
)

945 
	g°d
::
cout
 << "Sam∂êøã: " << 
this
->
ßm∂e_øã
;

946 if(
	gthis
->
	gß_ßm∂es
->
isWeighãd
()Ë{ 
	g°d
::
cout
 << " (weighted)"; }

947 
	g°d
::
cout
 << 
°d
::
ídl
;

949 
	g°d
::
cout
 << 
°d
::
ídl
;

954 
PLCPVe˘‹
*

955 
	gRLCSA
::
buûdPLCP
(
usöt
 
block_size
) const

957 if(
block_size
 < 2 * (
usöt
) || block_size % (usint) != 0)

959 
°d
::
˚º
 << "PLCP: Block sizêmu° bê®mu…ùÀ o‡" << (
usöt
Ë<< " byãs!" << std::
ídl
;

963 
	gPsiVe˘‹
::
Iãøt‹
** 
ôîs
 = 
this
->
gëIãøt‹s
();

965 
	gPLCPVe˘‹
::
Encodî
 
∂˝
(
block_size
);

966 
	g°d
::
li°
<
∑ú_ty≥
> 
m©ches
;

967 
∑ú_ty≥
 
	g¥ev_ønge
 = 
EMPTY_PAIR
;

968 
usöt
 
	gj
 = 0; j < 
	gthis
->
	gnumbî_of_£quí˚s
; j++)

971 
∑ú_ty≥
 
	g£q_ønge
 = 
this
->
gëSequí˚R™ge
(
j
);

972 if(
	gj
 > 0 && 
	g¥ev_ønge
.
	g£c⁄d
 + 1 < 
	g£q_ønge
.
	gfú°
)

974 
	gthis
->
ícodePLCPRun
(
∂˝
, 
¥ev_ønge
.
£c⁄d
 + 1, 
£q_ønge
.
fú°
, seq_range.first -Örev_range.second - 2);

976 
	g¥ev_ønge
 = 
£q_ønge
;

978 
usöt
 
	gmaximÆ
 = 
£q_ønge
.
fú°
;

979 
usöt
 
	gx
 = 
this
->
ß_ßm∂es
->
övî£SA
(
£q_ønge
.
fú°
).
£c⁄d
, 
	g√xt_x
;

982 
usöt
 
	gi
 = 
£q_ønge
.
fú°
; i <£q_ønge.
£c⁄d
; i++, 
	gx
 = 
√xt_x
)

984 
usöt
 
c
 = 
this
->
gëCh¨a˘î
(
x
);

987 if(
	gx
 =
this
->
Æphabë
->
cumuœtive
(
c
))

989 if(!
m©ches
.
em±y
())

991 
maximÆ
 = (*(
m©ches
.
begö
())).
fú°
;

992 
	gm©ches
.
˛ór
();

994 
	gthis
->
ícodePLCPRun
(
∂˝
, 
maximÆ
, 
i
 + 1, i - maximal);

995 
	gmaximÆ
 = 
i
 + 1;

996 
	g√xt_x
 = 
this
->
psiUnß„
(
x
, 
c
, *(
ôîs
[c])Ë- 
	gthis
->
	gnumbî_of_£quí˚s
;

1001 
usöt
 
	glow
 = 
this
->
Æphabë
->
cumuœtive
(
c
Ë+Åhis->
numbî_of_£quí˚s
;

1002 
usöt
 
	g°¨t
, 
	g°›
; sèπ = 
°›
 = 
maximÆ
;

1003 
	g°d
::
li°
<
∑ú_ty≥
>::
ôî©‹
 
ôî
 = 
m©ches
.
begö
(); 
	gôî
 !m©ches.
íd
();)

1005 
∑ú_ty≥
 
	gm©ch
 = *
ôî
;

1006 if(
	gm©ch
.
	g£c⁄d
 < 
	glow
)

1008 if(
	gm©ch
.
	gfú°
 < 
	g°¨t
Ë{ sèπ = 
m©ch
.
fú°
; }

1009 
	gôî
 = 
m©ches
.
îa£
(
ôî
);

1013 if(
	gm©ch
.
	gfú°
 < 
	g°›
Ë{ st› = 
m©ch
.
fú°
; }

1014 (*
	gôî
).
	g£c⁄d
 = 
this
->
psiUnß„
(
m©ch
.
£c⁄d
 -Åhis->
numbî_of_£quí˚s
, 
c
, *(
ôîs
[c]));

1015 ++
	gôî
;

1018 if(
	g°¨t
 < 
	g°›
Ë{ 
	gthis
->
ícodePLCPRun
(
∂˝
, 
°¨t
, 
°›
, 
i
 - start); }

1022 
usöt
 
	g√xt_y
 = 
this
->
psiUnß„
(
x
 - 1, 
c
, *(
ôîs
[c]));

1023 
	g√xt_x
 = 
this
->
psiUnß„Next
(
c
, *(
ôîs
[c])Ë- 
	gthis
->
	gnumbî_of_£quí˚s
;

1024 if(
	g√xt_y
 !
√xt_x
 + 
this
->
numbî_of_£quí˚s
 - 1)

1026 
m©ches
.
push_back
(
∑ú_ty≥
(
maximÆ
, 
√xt_y
));

1027 
	gmaximÆ
 = 
i
 + 1;

1031 if(!
	gm©ches
.
em±y
())

1033 
	gmaximÆ
 = (*(
m©ches
.
begö
())).
fú°
;

1034 
	gm©ches
.
˛ór
();

1036 if(
	gmaximÆ
 <
£q_ønge
.
£c⁄d
)

1038 
this
->
ícodePLCPRun
(
∂˝
, 
maximÆ
, 
£q_ønge
.
£c⁄d
 + 1, seq_range.second + 1 - maximal);

1042 
	gthis
->
dñëeIãøt‹s
(
ôîs
);

1044 
	g∂˝
.
Êush
();

1045  
√w
 
PLCPVe˘‹
(
∂˝
, 2 * (
this
->
íd_poöts
->
gëSize
() + 1));

1195 
usöt


1196 
	gRLCSA
::
ßm∂eLCP
(
usöt
 
ßm∂e_øã
, 
∑ú_ty≥
*& 
ßm∂ed_vÆues
, 
boﬁ
 
ªp‹t
) const

1198 if(
	gßm∂e_øã
 == 0)

1200 
ßm∂e_øã
 = 
this
->
d©a_size
 + 1;

1203 
	gPsiVe˘‹
::
Iãøt‹
** 
ôîs
 = 
this
->
gëIãøt‹s
();

1205 
usöt
 
	gruns
 = 
this
->
cou¡Runs
();

1206 
usöt
 
	gßm∂es
 = 0, 
	gmöimÆ_sum
 = 0, 
	gn⁄°ri˘_möimÆ_sum
 = 0, 
	gmöimÆ_ßm∂es
 = 0;

1207 
usöt
 
	gmax_ßm∂es
 = 
runs
 + (
this
->
d©a_size
 -ÑunsË/ 
ßm∂e_øã
;

1208 
	gßm∂ed_vÆues
 = 
√w
 
∑ú_ty≥
[
max_ßm∂es
];

1210 
	g°d
::
li°
<
TrùÀ
> 
m©ches
;

1211 
usöt
 
	gj
 = 0; j < 
	gthis
->
	gnumbî_of_£quí˚s
; j++)

1213 
∑ú_ty≥
 
	g£q_ønge
 = 
this
->
gëSequí˚R™ge
(
j
);

1214 
usöt
 
	gfú°_ßm∂e
 = 
ßm∂es
;

1215 
usöt
 
	gi
, 
	gx
 = 
this
->
ß_ßm∂es
->
övî£SA
(
£q_ønge
.
fú°
).
£c⁄d
, 
	g√xt_x
;

1218 
	gi
 = 
£q_ønge
.
fú°
; i <£q_ønge.
£c⁄d
; i++, 
	gx
 = 
√xt_x
)

1220 
usöt
 
c
 = 
this
->
gëCh¨a˘î
(
x
);

1223 if(
	gx
 =
this
->
Æphabë
->
cumuœtive
(
c
))

1225 if(!
m©ches
.
em±y
())

1227 
°d
::
li°
<
TrùÀ
>::
ôî©‹
 
ôî
 = 
m©ches
.
begö
(); 
	gôî
 !m©ches.
íd
(); ++iter)

1229 
	gn⁄°ri˘_möimÆ_sum
 +
i
 - (*
ôî
).
fú°
;

1231 
	gm©ches
.
˛ór
();

1235 
	gßm∂ed_vÆues
[
ßm∂es
] = 
∑ú_ty≥
(
x
, 0);

1236 
	gßm∂es
++; 
	gmöimÆ_ßm∂es
++;

1237 
	g√xt_x
 = 
this
->
psiUnß„
(
x
, 
c
, *(
ôîs
[c])Ë- 
	gthis
->
	gnumbî_of_£quí˚s
;

1242 
usöt
 
	glow
 = 
this
->
Æphabë
->
cumuœtive
(
c
Ë+Åhis->
numbî_of_£quí˚s
;

1243 
∑ú_ty≥
 
pŸítül_ßm∂e
(
this
->
d©a_size
,Åhis->data_size);

1244 
	g°d
::
li°
<
TrùÀ
>::
ôî©‹
 
ôî
 = 
m©ches
.
begö
(); 
	gôî
 !m©ches.
íd
();)

1246 
TrùÀ
 
	gm©ch
 = *
ôî
;

1247 if(
	gm©ch
.
	g£c⁄d
 < 
	glow
)

1249 if(
	gpŸítül_ßm∂e
.
	gfú°
 !
this
->
d©a_size
Ë{ 
n⁄°ri˘_möimÆ_sum
 +
pŸítül_ßm∂e
.
£c⁄d
; }

1252 
	gpŸítül_ßm∂e
 = 
∑ú_ty≥
(
m©ch
.
thúd
, 
i
 - m©ch.
fú°
);

1253 
	gôî
 = 
m©ches
.
îa£
(
ôî
);

1257 (*
	gôî
).
	g£c⁄d
 = 
this
->
psiUnß„
(
m©ch
.
£c⁄d
 -Åhis->
numbî_of_£quí˚s
, 
c
, *(
ôîs
[c]));

1258 ++
	gôî
;

1261 if(
	gpŸítül_ßm∂e
.
	gfú°
 !
this
->
d©a_size
)

1264 
ßm∂ed_vÆues
[
ßm∂es
] = 
pŸítül_ßm∂e
;

1265 
	gßm∂es
++; 
	gmöimÆ_sum
 +
pŸítül_ßm∂e
.
£c⁄d
; 
	gmöimÆ_ßm∂es
++;

1271 
usöt
 
	g√xt_y
 = 
this
->
psiUnß„
(
x
 - 1, 
c
, *(
ôîs
[c]));

1272 
	g√xt_x
 = 
this
->
psiUnß„Next
(
c
, *(
ôîs
[c]));

1273 if(
	g√xt_y
 !
√xt_x
 - 1 ||Çext_x < 
this
->
numbî_of_£quí˚s
)

1275 
m©ches
.
push_back
(
TrùÀ
(
i
, 
√xt_y
, 
x
));

1277 
	g√xt_x
 -
this
->
numbî_of_£quí˚s
;

1281 if(!
	gm©ches
.
em±y
())

1283 
∑ú_ty≥
 
pŸítül_ßm∂e
(
this
->
d©a_size
,Åhis->data_size);

1284 
	g°d
::
li°
<
TrùÀ
>::
ôî©‹
 
ôî
 = 
m©ches
.
begö
(); 
	gôî
 !m©ches.
íd
(); ++iter)

1286 
TrùÀ
 
	gm©ch
 = *
ôî
;

1287 if(
	gpŸítül_ßm∂e
.
	gfú°
 !
this
->
d©a_size
Ë{ 
n⁄°ri˘_möimÆ_sum
 +
pŸítül_ßm∂e
.
£c⁄d
; }

1290 
	gpŸítül_ßm∂e
 = 
∑ú_ty≥
(
m©ch
.
thúd
, 
i
 - m©ch.
fú°
);

1292 
	gm©ches
.
˛ór
();

1293 if(
	gpŸítül_ßm∂e
.
	gfú°
 !
this
->
d©a_size
)

1296 
ßm∂ed_vÆues
[
ßm∂es
] = 
pŸítül_ßm∂e
;

1297 
	gßm∂es
++; 
	gmöimÆ_sum
 +
pŸítül_ßm∂e
.
£c⁄d
; 
	gmöimÆ_ßm∂es
++;

1302 if(
	gßm∂e_øã
 <
this
->
d©a_size
)

1304 
usöt
 
œ°_ßm∂e
 = 
ßm∂es
 - 1;

1305 
	gi
 = 
£q_ønge
.
fú°
; 
	gx
 = 
this
->
ß_ßm∂es
->
övî£SA
(£q_ønge.fú°).
£c⁄d
;

1306 
usöt
 
	gcuºít_ßm∂e
 = 
fú°_ßm∂e
; cuºít_ßm∂ê<
œ°_ßm∂e
; current_sample++)

1309 
∑ú_ty≥
 
fú°_n⁄möimÆ
(
i
 + 
ßm∂e_øã
 - 1, 
ßm∂es
);

1310 
∑ú_ty≥
 
	g√xt_n⁄möimÆ
 = 
fú°_n⁄möimÆ
;

1311 
	gx
 !
ßm∂ed_vÆues
[
cuºít_ßm∂e
].
fú°
)

1313 if(
i
 =
√xt_n⁄möimÆ
.
fú°
)

1315 
ßm∂ed_vÆues
[
ßm∂es
] = 
∑ú_ty≥
(
x
, 0); 
	gßm∂es
++;

1316 
	g√xt_n⁄möimÆ
.
	gfú°
 +
ßm∂e_øã
;Çext_n⁄möimÆ.
	g£c⁄d
++;

1318 
	gi
++; 
	gx
 = 
this
->
psi
(
x
, 
ôîs
Ë- 
	gthis
->
	gnumbî_of_£quí˚s
;

1322 
	g√xt_n⁄möimÆ
 = 
fú°_n⁄möimÆ
;Çext_n⁄möimÆ.
	g£c⁄d
 < 
	gßm∂es
;Çext_n⁄möimÆ.
	gfú°
 +
ßm∂e_øã
,Çext_nonminimal.second++)

1324 
	gßm∂ed_vÆues
[
√xt_n⁄möimÆ
.
£c⁄d
].
	g£c⁄d
 = 
ßm∂ed_vÆues
[
cuºít_ßm∂e
].£c⁄d + 
i
 -Çext_n⁄möimÆ.
fú°
;

1326 
	gi
++; 
	gx
 = 
this
->
psi
(
x
, 
ôîs
Ë- 
	gthis
->
	gnumbî_of_£quí˚s
;

1331 
	g°d
::
s‹t
(
ßm∂ed_vÆues
, sam∂ed_vÆue†+ 
ßm∂es
);

1333 if(
	gªp‹t
)

1335 
	g°d
::
cout
 << "Sam∂es: " << 
ßm∂es
 << " (tŸÆË/ " << 
möimÆ_ßm∂es
 << " (möimÆ)" << 
°d
::
ídl
;

1336 
	g°d
::
cout
 << "Uµî bounds: " << 
max_ßm∂es
 << " (tŸÆË/ " << 
runs
 << " (möimÆ)" << 
°d
::
ídl
;

1337 
	g°d
::
cout
 << "Sum o‡möimÆ sam∂es: " << (
möimÆ_sum
 + 
n⁄°ri˘_möimÆ_sum
Ë<< " (tŸÆË/ " << möimÆ_sum << " (°ri˘)" << 
°d
::
ídl
;

1338 
	g°d
::
cout
 << 
°d
::
ídl
;

1341 
	gthis
->
dñëeIãøt‹s
(
ôîs
);

1343  
	gßm∂es
;

1346 
usöt


1347 
	gRLCSA
::
l˝
(
usöt
 
ödex
, c⁄° 
LCPSam∂es
& 
l˝_ßm∂es
, 
boﬁ
 
°ïs
) const

1349 if(
	gödex
 >
this
->
d©a_size
) {  0; }

1351 
usöt
 
	goff£t
 = 0;

1352 
	gåue
)

1354 if(
	gl˝_ßm∂es
.
isSam∂ed
(
ödex
))

1356  (
	g°ïs
 ? 
	goff£t
 : 
l˝_ßm∂es
.
gëSam∂eAt
(
ödex
Ë+ 
off£t
);

1358 
	gödex
 = 
this
->
psi
(
ödex
); 
	gthis
->
c⁄vîtToSAIndex
(index);

1359 
	goff£t
++;

1363 
usöt


1364 
	gRLCSA
::
l˝Dúe˘
(
usöt
 
ödex
) const

1366 if(
ödex
 >
this
->
d©a_size
 || index == 0)

1371 
usöt
 
	gm©ch
 = 
ödex
 - 1;

1372 
usöt
 
	gvÆue
 = 0;

1374 
usöt
 
	gc
 = 
this
->
gëCh¨a˘î
(
ödex
);

1375 
usöt
 
	glow
 = 
this
->
Æphabë
->
cumuœtive
(
c
);

1376 
	gm©ch
 >
low
)

1378 
PsiVe˘‹
::
Iãøt‹
 
ôî
(*(
this
->
¨øy
[
c
]));

1379 
	gm©ch
 = 
this
->
psiUnß„
(
m©ch
, 
c
, 
ôî
);

1380 
	gödex
 = 
this
->
psiUnß„
(
ödex
, 
c
, 
ôî
);

1381 
	gvÆue
++;

1383 if(
	gm©ch
 < 
	gthis
->
	gnumbî_of_£quí˚s
 || 
	gödex
 <Åhis->number_of_sequences)

1387 
	gthis
->
c⁄vîtToSAIndex
(
m©ch
);Åhis->c⁄vîtToSAIndex(
ödex
);

1389 
	gc
 = 
this
->
gëCh¨a˘î
(
ödex
);

1390 
	glow
 = 
this
->
Æphabë
->
cumuœtive
(
c
);

1393  
	gvÆue
;

1399 
	gRLCSA
::
mîgeEndPoöts
(
RLCSA
& 
ödex
, RLCSA& 
ö¸emít
)

1401 
DñèEncodî
* 
	gídögs
 = 
√w
 DñèEncodî(
RLCSA
::
ENDPOINT_BLOCK_SIZE
);

1403 
	gDñèVe˘‹
::
Iãøt‹
 
ödex_ôî
(*(
ödex
.
íd_poöts
));

1404 
	gDñèVe˘‹
::
Iãøt‹
 
ö¸emít_ôî
(*(
ö¸emít
.
íd_poöts
));

1406 
	gídögs
->
£tBô
(
ödex_ôî
.
£À˘
(0));

1407 
usöt
 
	gi
 = 1; i < 
	gödex
.
	gnumbî_of_£quí˚s
; i++)

1409 
	gídögs
->
£tBô
(
ödex_ôî
.
£À˘Next
());

1411 
usöt
 
	gsum
 = 
ödex
.
íd_poöts
->
gëSize
();

1412 
dñëe
 
	gödex
.
	gíd_poöts
; index.end_points = 0;

1414 
	gídögs
->
£tBô
(
sum
 + 
ö¸emít_ôî
.
£À˘
(0));

1415 
usöt
 
	gi
 = 1; i < 
	gö¸emít
.
	gnumbî_of_£quí˚s
; i++)

1417 
	gídögs
->
£tBô
(
sum
 + 
ö¸emít_ôî
.
£À˘Next
());

1419 
	gsum
 +
ö¸emít
.
íd_poöts
->
gëSize
();

1420 
dñëe
 
	gö¸emít
.
	gíd_poöts
; increment.end_points = 0;

1422 
	gthis
->
	gíd_poöts
 = 
√w
 
DñèVe˘‹
(*
ídögs
, 
sum
);

1423 
dñëe
 
	gídögs
;

1428 
	gRLCSA
::
mîgeSam∂es
(
RLCSA
& 
ödex
, RLCSA& 
ö¸emít
, 
usöt
* 
posôi⁄s
)

1430 if(
	gödex
.
	gß_ßm∂es
 =0 || 
ö¸emít
.
ß_ßm∂es
 == 0) { ; }

1432 
	gposôi⁄s
 +
ö¸emít
.
numbî_of_£quí˚s
;

1433 
	gthis
->
	gß_ßm∂es
 = 
√w
 
SASam∂es
(*(
ödex
.
ß_ßm∂es
), *(
ö¸emít
.ß_ßm∂es), 
posôi⁄s
, in¸emít.
d©a_size
, 
this
->
numbî_of_£quí˚s
);

1435 
	gthis
->
	gsuµ‹t_loˇã
 = 
this
->
ß_ßm∂es
->
suµ‹tsLoˇã
();

1436 
	gthis
->
	gsuµ‹t_di•œy
 = 
this
->
ß_ßm∂es
->
suµ‹tsDi•œy
();

1442 
	gRLCSA
::
°rù
()

1444 
usöt
 
c
 = 0; 
	gc
 < 
	gCHARS
; c++)

1446 if(
	gthis
->
	g¨øy
[
c
] !0Ë{ 
this
->
¨øy
[c]->
°rù
(); }

1448 if(
	gthis
->
	gß_ßm∂es
 !0Ë{ 
this
->
ß_ßm∂es
->
°rù
(); }

1449 
	gthis
->
	gíd_poöts
->
°rù
();

1455 
	gRLCSA
::
buûdRLCSA
(
uch¨
* 
d©a
, 
usöt
* 
ønks
, usöà
byãs
, usöà
block_size
, usöà
thªads
, 
Sam∂î
* 
ßm∂î
, 
boﬁ
 
mu…ùÀ_£quí˚s
, boﬁ 
dñëe_d©a
)

1457 
	gthªads
 = 
°d
::
max
(
thªads
, (
usöt
)1);

1458 #ifde‡
MULTITHREAD_SUPPORT


1459 
omp_£t_num_thªads
(
thªads
);

1464 
boﬁ
 
	gßm∂e_ß
 = 
åue
;

1465 if(
	gthis
->
	gßm∂e_øã
 == 0)

1467 
ßm∂e_ß
 = 
Ál£
; 
	gthis
->
	gßm∂e_øã
 = 1;

1472 
DñèEncodî
 
ídögs
(
RLCSA
::
ENDPOINT_BLOCK_SIZE
);

1473 if(
	gmu…ùÀ_£quí˚s
)

1475 
	gthis
->
	gnumbî_of_£quí˚s
 = 0;

1476 
usöt
 
	gm¨kî
 = 0;

1477 
usöt
 
	g∑ddög
 = 0, 
	gch¨s_ícou¡îed
 = 0;

1479 
usöt
 
	gi
 = 0; i < 
	gbyãs
; i++)

1481 if(
	gd©a
[
i
] == 0)

1483 if(
i
 =
m¨kî
) { ; }

1484 
	gthis
->
	gnumbî_of_£quí˚s
++;

1485 
	gm¨kî
 = 
i
 + 1;

1486 
usöt
 
	gpos
 = 
ch¨s_ícou¡îed
 + 
∑ddög
 - 1;

1487 
	gídögs
.
£tBô
(
pos
);

1488 
	g∑ddög
 = ((
pos
 + 
this
->
ßm∂e_øã
Ë/Åhis->ßm∂e_øãË*Åhis->ßm∂e_øã - 
ch¨s_ícou¡îed
;

1490 { 
	gch¨s_ícou¡îed
++; }

1493 if(
	gthis
->
	gnumbî_of_£quí˚s
 =0 || 
m¨kî
 !
byãs
)

1495 
°d
::
˚º
 << "RLCSA: CﬁÀ˘i⁄ mu° c⁄si° o‡0-ãrmö©edÇ⁄em±y sequí˚s!" << std::
ídl
;

1496 if(
	gdñëe_d©a
Ë{ 
	gdñëe
[] 
	gd©a
; }

1499 
	gthis
->
	gíd_poöts
 = 
√w
 
DñèVe˘‹
(
ídögs
, 
ch¨s_ícou¡îed
 + 
∑ddög
);

1503 
	gthis
->
	gnumbî_of_£quí˚s
 = 1;

1504 
DñèEncodî
 
ídögs
(
RLCSA
::
ENDPOINT_BLOCK_SIZE
, RLCSA::ENDPOINT_BLOCK_SIZE);

1505 
	gídögs
.
£tBô
(
byãs
 - 1);

1506 
	gthis
->
	gíd_poöts
 = 
√w
 
DñèVe˘‹
(
ídögs
, 
byãs
);

1511 
usöt
 
	gdi°ributi⁄
[
CHARS
];

1512 
usöt
 
	gc
 = 0; c < 
	gCHARS
; c++Ë{ 
	gdi°ributi⁄
[
c
] = 0; }

1513 
usöt
 
	gi
 = 0; i < 
	gbyãs
; i++Ë{ 
	gdi°ributi⁄
[(usöt)
d©a
[
i
]]++; }

1514 if(
	gmu…ùÀ_£quí˚s
Ë{ 
	gdi°ributi⁄
[0] = 0; }

1515 
	gthis
->
	gÆphabë
 = 
√w
 
AÕhabë
(
di°ributi⁄
);Åhis->
	gd©a_size
 = 
this
->
Æphabë
->
gëD©aSize
();

1519 
sh‹t_∑ú
* 
	gß
 = 0;

1520 if(
	gmu…ùÀ_£quí˚s
)

1522 if(
	gønks
 =0Ë{ 
ß
 = 
sim∂eSuffixS‹t
(
d©a
, 
byãs
, 
this
->
numbî_of_£quí˚s
, 
thªads
); }

1523 { 
	gß
 = 
sim∂eSuffixS‹t
(
ønks
, 
byãs
, 
thªads
); }

1527 
	gbyãs
++;

1528 
	gß
 = 
√w
 
sh‹t_∑ú
[
byãs
];

1529 #¥agm®
omp
 
∑øŒñ
 
scheduÀ
()

1530 
usöt
 
	gi
 = 0; i < 
	gbyãs
 - 1; i++Ë{ 
	gß
[
i
].
	g£c⁄d
 = 
d©a
[i] + 1; }

1531 
	gß
[
byãs
 - 1].
	g£c⁄d
 = 0;

1532 
sim∂eSuffixS‹t
(
ß
, 
byãs
, 
thªads
);

1534 if(
	gdñëe_d©a
Ë{ 
	gdñëe
[] 
	gd©a
; }

1538 if(
	gßm∂e_ß
)

1540 if(
	gßm∂î
 !0Ë{ 
this
->
ß_ßm∂es
 = 
√w
 
SASam∂es
(
ß
, 
ßm∂î
, 
thªads
); }

1541 { 
	gthis
->
	gß_ßm∂es
 = 
√w
 
SASam∂es
(
ß
, 
this
->
íd_poöts
,Åhis->
d©a_size
,Åhis->
ßm∂e_øã
, 
thªads
); }

1542 
	gthis
->
	gsuµ‹t_loˇã
 = 
this
->
ß_ßm∂es
->
suµ‹tsLoˇã
();

1543 
	gthis
->
	gsuµ‹t_di•œy
 = 
this
->
ß_ßm∂es
->
suµ‹tsDi•œy
();

1548 #¥agm®
omp
 
∑øŒñ
 
scheduÀ
()

1549 
usöt
 
	gi
 = 0; i < 
	gbyãs
; i++Ë{ 
	gß
[
i
].
	gfú°
 = 
ß
[(ß[i].
fú°
 + 1Ë% 
byãs
].
£c⁄d
; }

1553 #¥agm®
omp
 
∑øŒñ
 
scheduÀ
(
dy«mic
, 1)

1554 
usöt
 
	gc
 = 0; c < 
	gCHARS
; c++)

1556 if(!(
	gthis
->
	gÆphabë
->
hasCh¨
(
c
))Ë{Åhis->
	g¨øy
[c] = 0; ; }

1558 
sh‹t_∑ú
* 
	gcuº
 = 
ß
 + 
this
->
Æphabë
->
cumuœtive
(
c
Ë+Åhis->
numbî_of_£quí˚s
;

1559 
sh‹t_∑ú
* 
	glimô
 = 
cuº
 + 
this
->
Æphabë
->
cou¡Of
(
c
);

1560 
	gPsiVe˘‹
::
Encodî
 
ícodî
(
block_size
);

1561 
∑ú_ty≥
 
run
((*
cuº
).
fú°
, 1); ++
	gcuº
;

1563 ; 
	gcuº
 < 
	glimô
; ++curr)

1565 if((*
	gcuº
).
	gfú°
 =
run
.
fú°
 +Ñun.
£c⁄d
) {Ñun.second++; }

1568 
	gícodî
.
addRun
(
run
.
fú°
,Ñun.
£c⁄d
);

1569 
	grun
 = 
∑ú_ty≥
((*
cuº
).
fú°
, 1);

1572 
	gícodî
.
addRun
(
run
.
fú°
,Ñun.
£c⁄d
);

1573 
	gícodî
.
Êush
();

1575 
	gthis
->
	g¨øy
[
c
] = 
√w
 
PsiVe˘‹
(
ícodî
, 
this
->
d©a_size
 +Åhis->
numbî_of_£quí˚s
);

1577 
	gdñëe
[] 
	gß
;

1580 
	gthis
->
	gok
 = 
åue
;

	@rlcsa.h

1 #i‚de‡
RLCSA_H


2 
	#RLCSA_H


	)

4 
	~<f°ªam
>

5 
	~<ve˘‹
>

7 
	~"bôs/dñève˘‹.h
"

8 
	~"bôs/æeve˘‹.h
"

9 
	~"bôs/nibbÀve˘‹.h
"

10 
	~"bôs/succö˘ve˘‹.h
"

12 
	~"ßßm∂es.h
"

13 
	~"Æphabë.h
"

14 
	~"l˝ßm∂es.h
"

15 
	~"misc/∑ømëîs.h
"

16 
	~"ßm∂î.h
"

17 
	~"suffix¨øy.h
"

20 
«me•a˚
 
	gCSA


24 c⁄° 
	g°d
::
°rög
 
PSI_EXTENSION
 = ".psi";

25 c⁄° 
	g°d
::
°rög
 
ARRAY_EXTENSION
 = ".rlcsa.array";

26 c⁄° 
	g°d
::
°rög
 
SA_SAMPLES_EXTENSION
 = ".rlcsa.sa_samples";

27 c⁄° 
	g°d
::
°rög
 
PARAMETERS_EXTENSION
 = ".rlcsa.parameters";

28 c⁄° 
	g°d
::
°rög
 
DOCUMENT_EXTENSION
 = ".rlcsa.docs";

29 c⁄° 
	g°d
::
°rög
 
LCP_SAMPLES_EXTENSION
 = ".lcp_samples";

30 c⁄° 
	g°d
::
°rög
 
PLCP_EXTENSION
 = ".plcp";

33 c⁄° 
∑ømëî_ty≥
 
	gRLCSA_BLOCK_SIZE
 =Öarameter_type("RLCSA_BLOCK_SIZE", 32);

34 c⁄° 
∑ømëî_ty≥
 
	gSAMPLE_RATE
 =Öarameter_type("SAMPLE_RATE", 128);

35 c⁄° 
∑ømëî_ty≥
 
	gSUPPORT_LOCATE
 =Öarameter_type("SUPPORT_LOCATE", 1);

36 c⁄° 
∑ømëî_ty≥
 
	gSUPPORT_DISPLAY
 =Öarameter_type("SUPPORT_DISPLAY", 1);

37 c⁄° 
∑ømëî_ty≥
 
	gWEIGHTED_SAMPLES
 =Öarameter_type("WEIGHTED_SAMPLES", 0);

40 #ifde‡
USE_NIBBLE_VECTORS


41 
NibbÀVe˘‹
 
	tPsiVe˘‹
;

43 
RLEVe˘‹
 
	tPsiVe˘‹
;

46 #ifde‡
SUCCINCT_LCP_VECTOR


47 
Succö˘Ve˘‹
 
	tPLCPVe˘‹
;

49 
RLEVe˘‹
 
	tPLCPVe˘‹
;

53 ˛as†
	cRLCSA


55 
‰õnd
 
˛ass
 
	gRLCSABuûdî
;

57 
	gpublic
:

63 c⁄° 
usöt
 
ENDPOINT_BLOCK_SIZE
 = 16;

65 
ex∂icô
 
RLCSA
(c⁄° 
°d
::
°rög
& 
ba£_«me
, 
boﬁ
 
¥öt
 = 
Ál£
);

72 
RLCSA
(
uch¨
* 
d©a
, 
usöt
 
byãs
, usöà
block_size
, usöà
ß_ßm∂e_øã
, usöà
thªads
, 
boﬁ
 
dñëe_d©a
);

77 
RLCSA
(
uch¨
* 
d©a
, 
usöt
* 
ønks
, usöà
byãs
, usöà
block_size
, usöà
ß_ßm∂e_øã
, usöà
thªads
, 
boﬁ
 
dñëe_d©a
);

84 
RLCSA
(
uch¨
* 
d©a
, 
usöt
 
byãs
, usöà
block_size
, usöà
ß_ßm∂e_øã
, usöà
thªads
, 
Sam∂î
* 
ßm∂î
, 
boﬁ
 
dñëe_d©a
);

87 
RLCSA
(RLCSA& 
ödex
, RLCSA& 
ö¸emít
, 
usöt
* 
posôi⁄s
, usöà
block_size
, usöà
thªads
 = 1);

88 ~
RLCSA
();

90 
wrôeTo
(c⁄° 
°d
::
°rög
& 
ba£_«me
) const;

92 
ölöe
 
boﬁ
 
isOk
(Ëc⁄° {  
	gthis
->
	gok
; }

101 
∑ú_ty≥
 
cou¡
(c⁄° 
°d
::
°rög
& 
∑âîn
) const;

104 
ªp‹tPosôi⁄s
(
uch¨
* 
d©a
, 
usöt
 
Àngth
, usöt* 
posôi⁄s
) const;

109 
usöt
* 
loˇã
(
∑ú_ty≥
 
ønge
, 
boﬁ
 
dúe˘
 = 
Ál£
, boﬁ 
°ïs
 = false) const;

110 
usöt
* 
loˇã
(
∑ú_ty≥
 
ønge
, usöt* 
d©a
, 
boﬁ
 
dúe˘
 = 
Ál£
, boﬁ 
°ïs
 = false) const;

113 
usöt
 
loˇã
(usöà
ödex
, 
boﬁ
 
°ïs
 = 
Ál£
) const;

117 
uch¨
* 
di•œy
(
usöt
 
£quí˚
, 
boﬁ
 
ö˛ude_íd_m¨kî
 = 
Ál£
) const;

118 
uch¨
* 
di•œy
(
usöt
 
£quí˚
, 
∑ú_ty≥
 
ønge
) const;

119 
uch¨
* 
di•œy
(
usöt
 
£quí˚
, 
∑ú_ty≥
 
ønge
, uch¨* 
d©a
) const;

126 
uch¨
* 
di•œy
(
usöt
 
posôi⁄
, usöà
Àn
, usöà
c⁄ãxt
, usöt& 
ªsu…_Àngth
) const;

129 
usöt
 
di•œyPªfix
(usöà
£quí˚
, usöà
Àn
, 
uch¨
* 
d©a
) const;

133 
usöt
 
di•œyFromPosôi⁄
(usöà
ödex
, usöà
max_Àn
, 
uch¨
* 
d©a
) const;

137 
∑ú_ty≥
 
gëSequí˚R™ge
(
usöt
 
numbî
) const;

138 
∑ú_ty≥
 
gëSequí˚R™geF‹Posôi⁄
(
usöt
 
vÆue
) const;

142 
usöt
 
gëSequí˚F‹Posôi⁄
(usöà
vÆue
) const;

143 
usöt
* 
gëSequí˚F‹Posôi⁄
(usöt* 
vÆue
, usöà
Àngth
) const;

146 
∑ú_ty≥
 
gëRñ©ivePosôi⁄
(
usöt
 
vÆue
) const;

149 
uch¨
* 
ªadBWT
() const;

150 
uch¨
* 
ªadBWT
(
∑ú_ty≥
 
ønge
) const;

153 
usöt
 
cou¡Runs
() const;

156 
SuffixAºay
* 
gëSuffixAºayF‹Sequí˚
(
usöt
 
numbî
) const;

164 
ölöe
 
usöt
 
psi
(usöà
ß_ödex
) const

166 if(
	gß_ödex
 >
this
->
d©a_size
)

168  
this
->
d©a_size
 +Åhis->
numbî_of_£quí˚s
;

171 
usöt
 
	gc
 = 
this
->
gëCh¨a˘î
(
ß_ödex
);

172  
	gthis
->
psiUnß„
(
ß_ödex
, 
c
);

176 
ölöe
 
∑ú_ty≥
 
psi
(
usöt
 
ß_ödex
, usöà
max_Àngth
) const

178 if(
	gß_ödex
 >
this
->
d©a_size
)

180  
∑ú_ty≥
(
this
->
d©a_size
 +Åhis->
numbî_of_£quí˚s
, 0);

183 
usöt
 
	gc
 = 
this
->
gëCh¨a˘î
(
ß_ödex
);

184 
	gPsiVe˘‹
::
Iãøt‹
 
ôî
(*(
this
->
¨øy
[
c
]));

185  
	gôî
.
£À˘Run
(
ß_ödex
 - 
this
->
Æphabë
->
cumuœtive
(
c
), 
max_Àngth
);

188 
ölöe
 
usöt
 
LF
(usöà
ß_ödex
, usöà
c
) const

190 if(
	gc
 >
CHARS
)

192  
this
->
d©a_size
 +Åhis->
numbî_of_£quí˚s
;

194 if(
	gthis
->
	g¨øy
[
c
] == 0)

196 if(
c
 < 
this
->
Æphabë
->
gëFú°Ch¨
()Ë{ Åhis->
numbî_of_£quí˚s
 - 1; }

197  
	gthis
->
	gÆphabë
->
cumuœtive
(
c
Ë+Åhis->
	gnumbî_of_£quí˚s
 - 1;

199 
	gthis
->
c⁄vîtToBWTIndex
(
ß_ödex
);

201 
	gPsiVe˘‹
::
Iãøt‹
 
ôî
(*(
this
->
¨øy
[
c
]));

202  
	gthis
->
LF
(
ß_ödex
, 
c
, 
ôî
);

205 
ölöe
 
c⁄vîtToSAIndex
(
usöt
& 
bwt_ödex
Ëc⁄° { 
	gbwt_ödex
 -
this
->
numbî_of_£quí˚s
; }

206 
ölöe
 
c⁄vîtToBWTIndex
(
usöt
& 
ß_ödex
Ëc⁄° { 
	gß_ödex
 +
this
->
numbî_of_£quí˚s
; }

208 
ölöe
 
boﬁ
 
hasIm∂icôSam∂e
(
usöt
 
bwt_ödex
) const

210  (
	gbwt_ödex
 < 
	gthis
->
	gnumbî_of_£quí˚s
);

213 
ölöe
 
usöt
 
gëIm∂icôSam∂e
(usöà
bwt_ödex
) const

215 
	gDñèVe˘‹
::
Iãøt‹
 
ôî
(*(
this
->
íd_poöts
));

216  
	gôî
.
£À˘
(
bwt_ödex
) + 1;

220 
ölöe
 
usöt
 
gëCh¨a˘î
(usöà
ß_ödex
) const

222  
	gthis
->
	gÆphabë
->
ch¨At
(
ß_ödex
);

229 
∑ú_ty≥
 
gëSAR™ge
() const;

230 
∑ú_ty≥
 
gëBWTR™ge
() const;

231 
∑ú_ty≥
 
gëCh¨R™ge
(
usöt
 
c
) const;

233 
c⁄vîtToBWTR™ge
(
∑ú_ty≥
& 
ß_ønge
) const;

234 
c⁄vîtToSAR™ge
(
∑ú_ty≥
& 
bwt_ønge
) const;

235 
c⁄vîtToSAR™ge
(
°d
::
ve˘‹
<
∑ú_ty≥
>& 
bwt_ønges
) const;

238 
∑ú_ty≥
 
LF
’aú_ty≥ 
bwt_ønge
, 
usöt
 
c
) const;

241 
	g°d
::
ve˘‹
<
usöt
>* 
loˇãR™ge
(
∑ú_ty≥
 
ønge
) const;

242 
	g°d
::
ve˘‹
<
usöt
>* 
loˇãR™ges
(
°d
::ve˘‹<
∑ú_ty≥
>& 
ønges
) const;

248 
ölöe
 
boﬁ
 
suµ‹tsLoˇã
(Ëc⁄° {  
	gthis
->
	gsuµ‹t_loˇã
; }

249 
ölöe
 
boﬁ
 
suµ‹tsDi•œy
(Ëc⁄° {  
	gthis
->
	gsuµ‹t_di•œy
; }

250 
ölöe
 
usöt
 
gëSize
(Ëc⁄° {  
	gthis
->
	gd©a_size
; }

251 
ölöe
 
usöt
 
gëTextSize
(Ëc⁄° {  
	gthis
->
	gíd_poöts
->
gëSize
(); }

252 
ölöe
 
usöt
 
gëNumbîOfSequí˚s
(Ëc⁄° {  
	gthis
->
	gnumbî_of_£quí˚s
; }

253 
ölöe
 
usöt
 
gëBlockSize
(Ëc⁄° {  
	gthis
->
	g¨øy
[
this
->
Æphabë
->
gëFú°Ch¨
()]->getBlockSize(); }

256 
usöt
 
ªp‹tSize
(
boﬁ
 
¥öt
 = 
Ál£
) const;

258 
¥ötInfo
() const;

267 
PLCPVe˘‹
* 
buûdPLCP
(
usöt
 
block_size
) const;

270 
usöt
 
ßm∂eLCP
(usöà
ßm∂e_øã
, 
∑ú_ty≥
*& 
ßm∂ed_vÆues
, 
boﬁ
 
ªp‹t
 = 
Ál£
) const;

272 
usöt
 
l˝
(usöà
ß_ödex
, c⁄° 
LCPSam∂es
& 
l˝_ßm∂es
, 
boﬁ
 
°ïs
 = 
Ál£
) const;

275 
usöt
 
l˝Dúe˘
(usöà
ß_ödex
) const;

278 
ölöe
 
ícodePLCPRun
(
PLCPVe˘‹
::
Encodî
& 
∂˝
, 
usöt
 
°¨t
, usöà
°›
, usöà
fú°_vÆ
) const

280 
	g∂˝
.
addRun
(2 * 
°¨t
 + 
fú°_vÆ
, 
°›
 - start);

288 
	g¥iv©e
:

289 
boﬁ
 
ok
;

290 
usöt
 
	gd©a_size
;

292 
PsiVe˘‹
* 
	g¨øy
[
CHARS
];

293 
AÕhabë
* 
	gÆphabë
;

294 
SASam∂es
* 
	gß_ßm∂es
;

296 
boﬁ
 
	gsuµ‹t_loˇã
, 
	gsuµ‹t_di•œy
;

299 
usöt
 
	gßm∂e_øã
;

300 
usöt
 
	gnumbî_of_£quí˚s
;

301 
DñèVe˘‹
* 
	gíd_poöts
;

307 
dúe˘Loˇã
(
∑ú_ty≥
 
ønge
, 
usöt
* 
d©a
, 
boﬁ
 
°ïs
) const;

308 
usöt
 
dúe˘Loˇã
(usöà
ödex
, 
boﬁ
 
°ïs
) const;

309 
loˇãUnß„
(
∑ú_ty≥
 
ønge
, 
usöt
* 
d©a
, 
boﬁ
 
°ïs
) const;

310 
boﬁ
 
¥o˚ssRun
(
∑ú_ty≥
 
run
, 
usöt
* 
d©a
, usöt* 
off£ts
, boﬁ* 
föished
, 
PsiVe˘‹
::
Iãøt‹
** 
ôîs
, boﬁ 
°ïs
) const;

311 
di•œyUnß„
(
∑ú_ty≥
 
ønge
, 
uch¨
* 
d©a
, 
boﬁ
 
gë_ønks
 = 
Ál£
, 
usöt
* 
ønks
 = 0) const;

313 
loˇãR™ge
(
∑ú_ty≥
 
ønge
, 
°d
::
ve˘‹
<
usöt
>& 
vec
) const;

319 
ölöe
 
usöt
 
psi
(usöà
ödex
, 
PsiVe˘‹
::
Iãøt‹
** 
ôîs
) const

321 
usöt
 
c
 = 
this
->
gëCh¨a˘î
(
ödex
);

322  
	gôîs
[
c
]->
£À˘
(
ödex
 - 
this
->
Æphabë
->
cumuœtive
(c));

325 
ölöe
 
∑ú_ty≥
 
psi
(
usöt
 
ödex
, usöà
max_Àngth
, 
PsiVe˘‹
::
Iãøt‹
** 
ôîs
) const

327 
usöt
 
c
 = 
this
->
gëCh¨a˘î
(
ödex
);

328  
	gôîs
[
c
]->
£À˘Run
(
ödex
 - 
this
->
Æphabë
->
cumuœtive
(c), 
max_Àngth
);

332 
ölöe
 
usöt
 
psiUnß„
(usöà
ödex
, usöà
c
) const

334 
	gPsiVe˘‹
::
Iãøt‹
 
ôî
(*(
this
->
¨øy
[
c
]));

335  
	gthis
->
psiUnß„
(
ödex
, 
c
, 
ôî
);

339 
ölöe
 
usöt
 
psiUnß„
(usöà
ödex
, usöà
c
, 
PsiVe˘‹
::
Iãøt‹
& 
ôî
) const

341  
ôî
.
£À˘
(
ödex
 - 
this
->
Æphabë
->
cumuœtive
(
c
));

345 
ölöe
 
usöt
 
psiUnß„Next
(usöà
c
, 
PsiVe˘‹
::
Iãøt‹
& 
ôî
) const

347  
ôî
.
£À˘Next
();

350 
ölöe
 
usöt
 
LF
(usöà
bwt_ödex
, usöà
c
, 
PsiVe˘‹
::
Iãøt‹
& 
ôî
) const

352  
this
->
Æphabë
->
cumuœtive
(
c
Ë+Åhis->
numbî_of_£quí˚s
 + 
ôî
.
ønk
(
bwt_ödex
) - 1;

360 
	gPsiVe˘‹
::
Iãøt‹
** 
gëIãøt‹s
() const;

361 
dñëeIãøt‹s
(
PsiVe˘‹
::
Iãøt‹
** 
ôîs
) const;

363 
mîgeEndPoöts
(
RLCSA
& 
ödex
, RLCSA& 
ö¸emít
);

364 
mîgeSam∂es
(
RLCSA
& 
ödex
, RLCSA& 
ö¸emít
, 
usöt
* 
posôi⁄s
);

366 
buûdCh¨Indexes
(
usöt
* 
di°ributi⁄
);

367 
buûdRLCSA
(
uch¨
* 
d©a
, 
usöt
* 
ønks
, usöà
byãs
, usöà
block_size
, usöà
thªads
, 
Sam∂î
* 
ßm∂î
, 
boﬁ
 
mu…ùÀ_£quí˚s
, boﬁ 
dñëe_d©a
);

370 
°rù
();

373 
RLCSA
();

374 
RLCSA
(const RLCSA&);

375 
	gRLCSA
& 
	g›î©‹
 = (c⁄° 
RLCSA
&);

	@rlcsa_builder.cpp

1 
	~<Æg‹ôhm
>

2 
	~<c°dlib
>

3 
	~<c°rög
>

4 
	~<io°ªam
>

6 
	~"æcß_buûdî.h
"

7 
	~"misc/utûs.h
"

9 #ifde‡
MULTITHREAD_SUPPORT


10 
	~<omp.h
>

14 
«me•a˚
 
	gCSA


18 
	gRLCSABuûdî
::
RLCSABuûdî
(
usöt
 
_block_size
, usöà
_ßm∂e_øã
, usöà
_buf„r_size
, usöà
_thªads
) :

19 
block_size
(
_block_size
), 
ßm∂e_øã
(
_ßm∂e_øã
), 
buf„r_size
(
_buf„r_size
),

20 
thªads
(
_thªads
),

21 
buf„r
(0)

23 
	gthis
->
ª£t
();

24 
	gthis
->
	gbuûd_time
 = 
this
->
£¨ch_time
 =Åhis->
s‹t_time
 =Åhis->
mîge_time
 = 0.0;

27 
	gRLCSABuûdî
::~
RLCSABuûdî
()

29 
dñëe
 
this
->
ödex
;

30 
	gdñëe
[] 
	gthis
->
	gbuf„r
;

36 
	gRLCSABuûdî
::
ö£πSequí˚
(* 
£quí˚
, 
usöt
 
Àngth
, 
boﬁ
 
dñëe_£quí˚
)

38 if(
	g£quí˚
 =0 || 
Àngth
 =0 || !
this
->
ok
)

40 if(
dñëe_£quí˚
Ë{ 
dñëe
[] 
£quí˚
; }

44 #ifde‡
MULTITHREAD_SUPPORT


45 
omp_£t_num_thªads
(
this
->
thªads
);

48 if(
	gthis
->
	gbuf„r
 == 0)

50 
this
->
addL⁄gSequí˚
((
uch¨
*)
£quí˚
, 
Àngth
, 
dñëe_£quí˚
);

54 if(
	gthis
->
	gbuf„r_size
 -Åhis->
	gch¨s
 > 
	gÀngth
)

56 
mem˝y
(
this
->
buf„r
 +Åhis->
ch¨s
, 
£quí˚
, 
Àngth
);

57 if(
	gdñëe_£quí˚
Ë{ 
	gdñëe
[] 
	g£quí˚
; }

58 
	gthis
->
	gch¨s
 +
Àngth
;

59 
	gthis
->
	gbuf„r
[
this
->
ch¨s
] = 0;

60 
	gthis
->
	gch¨s
++;

64 if(
	gthis
->
	gch¨s
 > 0Ë{Åhis->
Êush
(); }

65 if(
	gÀngth
 >
this
->
buf„r_size
 - 1)

67 
this
->
addL⁄gSequí˚
((
uch¨
*)
£quí˚
, 
Àngth
, 
dñëe_£quí˚
);

71 
mem˝y
(
this
->
buf„r
 +Åhis->
ch¨s
, 
£quí˚
, 
Àngth
);

72 if(
	gdñëe_£quí˚
Ë{ 
	gdñëe
[] 
	g£quí˚
; }

73 
	gthis
->
	gch¨s
 +
Àngth
;

74 
	gthis
->
	gbuf„r
[
this
->
ch¨s
] = 0;

75 
	gthis
->
	gch¨s
++;

81 
	gRLCSABuûdî
::
ö£πFromFûe
(c⁄° 
°d
::
°rög
& 
ba£_«me
)

83 if(!
this
->
ok
) { ; }

85 #ifde‡
MULTITHREAD_SUPPORT


86 
omp_£t_num_thªads
(
this
->
thªads
);

89 
	gthis
->
Êush
();

91 
	g°d
::
if°ªam
 
öput
(
ba£_«me
.
c_°r
(), 
°d
::
ios_ba£
::
bö¨y
);

92 if(!
	göput
) { ; }

93 
RLCSA
* 
	gö¸emít
 = 
√w
 RLCSA(
ba£_«me
);

94 
usöt
 
	gd©a_size
 = 
ö¸emít
->
gëSize
(Ë+ in¸emít->
gëNumbîOfSequí˚s
();

95 
uch¨
* 
	gd©a
 = 
√w
 uch¨[
d©a_size
];

96 
	göput
.
ªad
((*)
d©a
, 
d©a_size
);

97 
	göput
.
˛o£
();

99 
	gthis
->
addRLCSA
(
ö¸emít
, 
d©a
, 
d©a_size
, 
åue
);

103 
	gRLCSABuûdî
::
ö£πCﬁÀ˘i⁄
(c⁄° 
°d
::
°rög
& 
ba£_«me
)

105 if(!
this
->
ok
) { ; }

107 #ifde‡
MULTITHREAD_SUPPORT


108 
omp_£t_num_thªads
(
this
->
thªads
);

111 
	gthis
->
Êush
();

113 
	g°d
::
if°ªam
 
öput
(
ba£_«me
.
c_°r
(), 
°d
::
ios_ba£
::
bö¨y
);

114 if(!
	göput
) { ; }

116 
usöt
 
	gd©a_size
 = 
fûeSize
(
öput
);

117 
uch¨
* 
	gd©a
 = 
√w
 uch¨[
d©a_size
];

118 
	göput
.
ªad
((*)
d©a
, 
d©a_size
);

119 
	göput
.
˛o£
();

121 if(
	gthis
->
	gödex
 == 0)

123 
this
->
addCﬁÀ˘i⁄
(
d©a
, 
d©a_size
, 
åue
);

127 
	g°d
::
ve˘‹
<
usöt
> 
íd_m¨kîs
;

128 
usöt
* 
	gønks
 = 
this
->
gëR™ks
(
d©a
, 
d©a_size
, 
íd_m¨kîs
);

130 
	g°¨t
 = 
ªadTimî
();

131 #¥agm®
omp
 
∑øŒñ
 
scheduÀ
()

132 
usöt
 
	gi
 = 0; i < 
	gd©a_size
; i++Ë{ 
	gønks
[
i
] +
íd_m¨kîs
.
size
(Ë+ 1 + 
d©a
[i]; }

133 
usöt
 
	gi
 = 0; i < 
	gíd_m¨kîs
.
size
(); i++)

135 
	gønks
[
íd_m¨kîs
[
i
]] = 
this
->
ödex
->
gëNumbîOfSequí˚s
() + i;

137 
RLCSA
* 
	gö¸emít
 = 
√w
 RLCSA(
d©a
, 
ønks
, 
d©a_size
, 
this
->
block_size
,Åhis->
ßm∂e_øã
,Åhis->
thªads
, 
Ál£
);

138 #¥agm®
omp
 
∑øŒñ
 
scheduÀ
()

139 
usöt
 
	gi
 = 0; i < 
	gd©a_size
; i++Ë{ 
	gønks
[
i
] -
d©a
[i]; }

140 
	gdñëe
[] 
	gd©a
;

141 
	gm¨k
 = 
ªadTimî
();

142 
	gthis
->
	gbuûd_time
 +
m¨k
 - 
°¨t
;

144 
∑øŒñS‹t
(
ønks
,Ñ™k†+ 
d©a_size
);

145 #¥agm®
omp
 
∑øŒñ
 
scheduÀ
()

146 
usöt
 
	gi
 = 
íd_m¨kîs
.
size
(); i < 
	gd©a_size
; i++Ë{ 
	gønks
[
i
] += i -Énd_markers.size(); }

147 
	gthis
->
	gs‹t_time
 +
ªadTimî
(Ë- 
m¨k
;

149 
	gthis
->
mîgeRLCSA
(
ö¸emít
, 
ønks
, 
d©a_size
);

154 
RLCSA
*

155 
	gRLCSABuûdî
::
gëRLCSA
()

157 if(
this
->
ch¨s
 > 0Ë{Åhis->
Êush
(); }

159 
RLCSA
* 
	gãmp
 = 
this
->
ödex
;

160 
	gthis
->
ª£t
();

162  
	gãmp
;

166 
	gRLCSABuûdî
::
gëBWT
(
usöt
& 
Àngth
)

168 
this
->
Êush
();

170 if(
	gthis
->
	gödex
 =0 || !(
this
->
ok
))

172 
Àngth
 = 0;

176 
	gÀngth
 = 
this
->
ödex
->
gëSize
(Ë+Åhis->ödex->
gëNumbîOfSequí˚s
();

177  (*)(
	gthis
->
	gödex
->
ªadBWT
());

180 
boﬁ


181 
	gRLCSABuûdî
::
isOk
()

183  
this
->
ok
;

187 
	gRLCSABuûdî
::
gëBuûdTime
()

189  
this
->
buûd_time
;

193 
	gRLCSABuûdî
::
gëSórchTime
()

195  
this
->
£¨ch_time
;

199 
	gRLCSABuûdî
::
gëS‹tTime
()

201  
this
->
s‹t_time
;

205 
	gRLCSABuûdî
::
gëMîgeTime
()

207  
this
->
mîge_time
;

213 
	gRLCSABuûdî
::
Êush
()

215 if(
this
->
buf„r
 =0 ||Åhis->
ch¨s
 == 0) { ; }

217 
	g°¨t
 = 
ªadTimî
();

218 
RLCSA
* 
	gãmp
 = 
√w
 RLCSA(
this
->
buf„r
,Åhis->
ch¨s
,Åhis->
block_size
,Åhis->
ßm∂e_øã
,Åhis->
thªads
, (this->
ödex
 == 0));

219 
	gthis
->
	gbuûd_time
 +
ªadTimî
(Ë- 
°¨t
;

220 
	gthis
->
addRLCSA
(
ãmp
, 
this
->
buf„r
,Åhis->
ch¨s
, (this->
ödex
 != 0));

222 
	gthis
->
	gch¨s
 = 0;

223 
	gthis
->
	gbuf„r
 = 
√w
 
uch¨
[
this
->
buf„r_size
];

227 
	gRLCSABuûdî
::
ª£t
()

229 
this
->
ödex
 = 0;

231 if(
	gthis
->
	gbuf„r_size
 != 0)

233 
dñëe
[] 
this
->
buf„r
;

234 
	gthis
->
	gbuf„r
 = 
√w
 
uch¨
[
this
->
buf„r_size
];

236 
	gthis
->
	gch¨s
 = 0;

238 
	gthis
->
	gok
 = 
åue
;

244 
	gRLCSABuûdî
::
addRLCSA
(
RLCSA
* 
ö¸emít
, 
uch¨
* 
£quí˚
, 
usöt
 
Àngth
, 
boﬁ
 
dñëe_£quí˚
)

246 if(
	gthis
->
	gödex
 == 0)

248 if(
dñëe_£quí˚
Ë{ 
dñëe
[] 
£quí˚
; }

249 
	gthis
->
£tRLCSA
(
ö¸emít
);

253 
	g°d
::
ve˘‹
<
usöt
> 
íd_m¨kîs
;

254 
usöt
* 
	gønks
 = 
this
->
gëR™ks
(
£quí˚
, 
Àngth
, 
íd_m¨kîs
);

255 if(
	gdñëe_£quí˚
Ë{ 
	gdñëe
[] 
	g£quí˚
; }

257 
	gm¨k
 = 
ªadTimî
();

258 
∑øŒñS‹t
(
ønks
,Ñ™k†+ 
Àngth
);

259 #¥agm®
omp
 
∑øŒñ
 
scheduÀ
()

260 
usöt
 
	gi
 = 0; i < 
	gÀngth
; i++Ë{ 
	gønks
[
i
] += i + 1; }

261 
	gthis
->
	gs‹t_time
 +
ªadTimî
(Ë- 
m¨k
;

263 
	gthis
->
mîgeRLCSA
(
ö¸emít
, 
ønks
, 
Àngth
);

267 
	gRLCSABuûdî
::
£tRLCSA
(
RLCSA
* 
√w_ödex
)

269 
this
->
ödex
 = 
√w_ödex
;

270 
	gthis
->
	gok
 &
this
->
ödex
->
isOk
();

274 
	gRLCSABuûdî
::
mîgeRLCSA
(
RLCSA
* 
ö¸emít
, 
usöt
* 
ønks
, usöà
Àngth
)

276 
	gm¨k
 = 
ªadTimî
();

278 
RLCSA
* 
	gmîged
 = 
√w
 RLCSA(*(
this
->
ödex
), *
ö¸emít
, 
ønks
,Åhis->
block_size
,Åhis->
thªads
);

279 
	gdñëe
[] 
	gønks
;

280 
dñëe
 
	gthis
->
	gödex
;

281 
dñëe
 
	gö¸emít
;

282 
	gthis
->
	gödex
 = 
mîged
;

284 
	gthis
->
	gmîge_time
 +
ªadTimî
(Ë- 
m¨k
;

286 
	gthis
->
	gok
 &
this
->
ödex
->
isOk
();

291 
usöt
*

292 
	gRLCSABuûdî
::
gëR™ks
(
uch¨
* 
£quí˚
, 
usöt
 
Àngth
, 
°d
::
ve˘‹
<usöt>& 
íd_m¨kîs
)

294 
°¨t
 = 
ªadTimî
();

296 
usöt
 
	g£quí˚s
 = 0;

297 
usöt
 
	gi
 = 0; i < 
	gÀngth
; i++)

299 if(
	g£quí˚
[
i
] =0Ë{ 
íd_m¨kîs
.
push_back
(i); 
	g£quí˚s
++; }

302 
usöt
* 
	gønks
 = 
√w
 usöt[
Àngth
];

303 #ifde‡
MULTITHREAD_SUPPORT


304 
usöt
 
	gchunk
 = 
°d
::
max
((usöt)1, 
£quí˚s
 / (8 * 
this
->
thªads
));

306 #¥agm®
omp
 
∑øŒñ
 
scheduÀ
(
dy«mic
, 
chunk
)

307 
usöt
 
	gi
 = 0; i < 
	g£quí˚s
; i++)

309 
usöt
 
	gbegö
 = (
i
 > 0 ? 
íd_m¨kîs
[i - 1] + 1 : 0);

310 
	gthis
->
	gödex
->
ªp‹tPosôi⁄s
(
£quí˚
 + 
begö
, 
íd_m¨kîs
[
i
] - begö, 
ønks
 + begin);

313 
	gthis
->
	gödex
->
°rù
();

315 
	gthis
->
	g£¨ch_time
 +
ªadTimî
(Ë- 
°¨t
;

316  
	gønks
;

322 
	gRLCSABuûdî
::
addL⁄gSequí˚
(
uch¨
* 
£quí˚
, 
usöt
 
Àngth
, 
boﬁ
 
dñëe_£quí˚
)

324 
	g°¨t
 = 
ªadTimî
();

325 
RLCSA
* 
	gãmp
 = 
√w
 RLCSA(
£quí˚
, 
Àngth
, 
this
->
block_size
,Åhis->
ßm∂e_øã
,Åhis->
thªads
, 0, 
Ál£
);

326 
	gthis
->
	gbuûd_time
 +
ªadTimî
(Ë- 
°¨t
;

327 
	gthis
->
addRLCSA
(
ãmp
, 
£quí˚
, 
Àngth
, 
dñëe_£quí˚
);

331 
	gRLCSABuûdî
::
addCﬁÀ˘i⁄
(
uch¨
* 
£quí˚
, 
usöt
 
Àngth
, 
boﬁ
 
dñëe_£quí˚
)

333 
	g°¨t
 = 
ªadTimî
();

334 
RLCSA
* 
	gãmp
 = 
√w
 RLCSA(
£quí˚
, 
Àngth
, 
this
->
block_size
,Åhis->
ßm∂e_øã
,Åhis->
thªads
, 
dñëe_£quí˚
);

335 
	gthis
->
	gbuûd_time
 +
ªadTimî
(Ë- 
°¨t
;

336 
	gthis
->
£tRLCSA
(
ãmp
);

	@rlcsa_builder.h

1 #i‚de‡
RLCSA_BUILDER_H


2 
	#RLCSA_BUILDER_H


	)

4 
	~"æcß.h
"

7 
«me•a˚
 
	gCSA


11 ˛as†
	cRLCSABuûdî


13 
	gpublic
:

14 
RLCSABuûdî
(
usöt
 
_block_size
, usöà
_ßm∂e_øã
, usöà
_buf„r_size
, usöà
_thªads
 = 1);

15 ~
RLCSABuûdî
();

18 
ö£πSequí˚
(* 
£quí˚
, 
usöt
 
Àngth
, 
boﬁ
 
dñëe_£quí˚
);

21 
ö£πFromFûe
(c⁄° 
°d
::
°rög
& 
ba£_«me
);

24 
ö£πCﬁÀ˘i⁄
(c⁄° 
°d
::
°rög
& 
ba£_«me
);

27 
RLCSA
* 
gëRLCSA
();

30 * 
gëBWT
(
usöt
& 
Àngth
);

32 
boﬁ
 
isOk
();

35 
gëBuûdTime
();

36 
gëSórchTime
();

37 
gëS‹tTime
();

38 
gëMîgeTime
();

40 
	g¥iv©e
:

41 
RLCSA
* 
ödex
;

43 
usöt
 
	gblock_size
;

44 
usöt
 
	gßm∂e_øã
;

45 
usöt
 
	gbuf„r_size
;

47 
usöt
 
	gthªads
;

49 
uch¨
* 
	gbuf„r
;

50 
usöt
 
	gch¨s
;

52 
boﬁ
 
	gok
;

54 
	gbuûd_time
;

55 
	g£¨ch_time
;

56 
	gs‹t_time
;

57 
	gmîge_time
;

59 
Êush
();

60 
ª£t
();

62 
addRLCSA
(
RLCSA
* 
ö¸emít
, 
uch¨
* 
£quí˚
, 
usöt
 
Àngth
, 
boﬁ
 
dñëe_£quí˚
);

63 
£tRLCSA
(
RLCSA
* 
√w_ödex
);

64 
mîgeRLCSA
(
RLCSA
* 
ö¸emít
, 
usöt
* 
ønks
, usöà
Àngth
);

66 
usöt
* 
gëR™ks
(
uch¨
* 
£quí˚
, usöà
Àngth
, 
°d
::
ve˘‹
<usöt>& 
íd_m¨kîs
);

68 
addL⁄gSequí˚
(
uch¨
* 
£quí˚
, 
usöt
 
Àngth
, 
boﬁ
 
dñëe_£quí˚
);

69 
addCﬁÀ˘i⁄
(
uch¨
* 
£quí˚
, 
usöt
 
Àngth
, 
boﬁ
 
dñëe_£quí˚
);

72 
RLCSABuûdî
();

73 
RLCSABuûdî
(const RLCSABuilder&);

74 
	gRLCSABuûdî
& 
	g›î©‹
 = (c⁄° 
RLCSABuûdî
&);

	@rlcsa_grep.cpp

1 
	~<io°ªam
>

3 
	~"æcß.h
"

4 
	~"misc/utûs.h
"

6 
usög
 
«me•a˚
 
	gCSA
;

9 
	emode_ty≥
 { 
	mCOUNT
, 
	mDISPLAY
, 
	mCONTEXT
 };

12 
	$¥ötUßge
()

14 
°d
::
cout
 << "Ußge:Ñlcß_gª∞[-c]Ö©ã∫ ba£_«me" << std::
ídl
;

15 
°d
::
cout
 << " -¯Öröàthênumbî o‡m©chögÜöes" << std::
ídl
;

16 
°d
::
cout
 << " -NUM di•œy NUM ch¨a˘î†o‡ÀadögándÅøûög c⁄ãxàö°ód of" << std::
ídl
;

17 
°d
::
cout
 << "Åhêítúêlöe" << std::
ídl
;

18 
	}
}

21 
	$maö
(
¨gc
, ** 
¨gv
)

23 
ba£_¨g
 = 2, 
∑âîn_¨g
 = 1;

24 
mode_ty≥
 
mode
 = 
DISPLAY
;

25 
usöt
 
c⁄ãxt
 = 0;

27 if(
¨gc
 < 
ba£_¨g
 + 1)

29 
	`¥ötUßge
();

33 if(
¨gv
[1][0] == '-')

35 
ba£_¨g
++; 
∑âîn_¨g
++;

36 if(
°d
::
	`°rög
("-c").
	`com∑ª
(
¨gv
[1]) == 0)

38 
mode
 = 
COUNT
;

42 
mode
 = 
CONTEXT
;

43 
c⁄ãxt
 = 
	`©oi
(&(
¨gv
[1][1]));

45 if(
¨gc
 < 
ba£_¨g
 + 1)

47 
	`¥ötUßge
();

52 
RLCSA
 
	`æcß
(
¨gv
[
ba£_¨g
], 
Ál£
);

53 if(!
æcß
.
	`isOk
())

58 
usöt
 
Àn
 = 
°d
::
	`°rög
(
¨gv
[
∑âîn_¨g
]).
	`Àngth
();

59 
∑ú_ty≥
 
ªsu…_ønge
 = 
æcß
.
	`cou¡
(
¨gv
[
∑âîn_¨g
]);

60 
usöt
 
occuºí˚s
 = 
	`Àngth
(
ªsu…_ønge
);

61 if(
occuºí˚s
 == 0)

63 if(
mode
 =
COUNT
)

65 
°d
::
cout
 << 0 << std::
ídl
;

70 
usöt
 
œ°_row
 = 0;

71 
usöt
* 
ªsu…s
 = 
æcß
.
	`loˇã
(
ªsu…_ønge
);

72 if(
mode
 !
CONTEXT
)

74 
æcß
.
	`gëSequí˚F‹Posôi⁄
(
ªsu…s
, 
occuºí˚s
);

76 
°d
::
	`s‹t
(
ªsu…s
,Ñesu…†+ 
occuºí˚s
);

77 if(
mode
 !
CONTEXT
)

79 
usöt
 
i
 = 1; i < 
occuºí˚s
; i++)

81 if(
ªsu…s
[
i
] !ªsu…s[
œ°_row
])

83 
œ°_row
++; 
ªsu…s
[œ°_row] =Ñesu…s[
i
];

88 if(
mode
 =
COUNT
)

90 
°d
::
cout
 << (
œ°_row
 + 1Ë<< std::
ídl
;

92 if(
mode
 =
DISPLAY
)

94 
usöt
 
i
 = 0; i <
œ°_row
; i++)

96 
uch¨
* 
row
 = 
æcß
.
	`di•œy
(
ªsu…s
[
i
]);

97 
°d
::
cout
.
	`wrôe
((*)
row
, 
	`Àngth
(
æcß
.
	`gëSequí˚R™ge
(
ªsu…s
[
i
])));

98 
°d
::
cout
 << std::
ídl
;

99 
dñëe
[] 
row
;

102 if(
mode
 =
CONTEXT
)

104 
usöt
 
ªsu…_Àngth
 = 0;

105 
usöt
 
i
 = 0; i < 
occuºí˚s
; i++)

107 
uch¨
* 
ãxt
 = 
æcß
.
	`di•œy
(
ªsu…s
[
i
], 
Àn
, 
c⁄ãxt
, 
ªsu…_Àngth
);

108 
°d
::
cout
.
	`wrôe
((*)
ãxt
, 
ªsu…_Àngth
);

109 
°d
::
cout
 << std::
ídl
;

110 
dñëe
[] 
ãxt
;

114 
dñëe
[] 
ªsu…s
;

116 
	}
}

	@rlcsa_test.cpp

1 
	~<c°dlib
>

2 
	~<˘ime
>

3 
	~<io°ªam
>

4 
	~<ve˘‹
>

6 
	~"æcß.h
"

7 
	~"ad≠tive_ßm∂es.h
"

8 
	~"suffix¨øy.h
"

9 
	~"doˇºay.h
"

11 #ifde‡
MULTITHREAD_SUPPORT


12 
	~<omp.h
>

16 
usög
 
«me•a˚
 
	gCSA
;

19 c⁄° 
	gMAX_THREADS
 = 64;

22 
	sP©ã∫


24 
P©ã∫
(c⁄° 
°d
::
°rög
& 
_∑âîn
, 
boﬁ
 
ign‹e_èb
, 
usöt
 
ign‹e
) :

25 
∑âîn
(
_∑âîn
), 
weight
(1), 
ønge
(
EMPTY_PAIR
), 
°ïs
(0), 
docc
(0)

27 if(
	mign‹e_èb
)

29 
usöt
 
	mpos
 = 
this
->
∑âîn
.
föd
('\t');

30 
	mthis
->
	mweight
 = 
©oi
(
this
->
∑âîn
.
sub°r
(0, 
pos
).
c_°r
());

31 
	mthis
->
	m∑âîn
 = 
this
->
∑âîn
.
sub°r
(
pos
 + 1);

33 if(
	mign‹e
 > 0)

35 
	mthis
->
	mweight
 = 
©oi
(
this
->
∑âîn
.
sub°r
(0, 
ign‹e
).
c_°r
());

36 
	mthis
->
	m∑âîn
 = 
this
->
∑âîn
.
sub°r
(
ign‹e
);

40 
ölöe
 
boﬁ
 
found
(Ëc⁄° {  !
isEm±y
(
this
->
ønge
); }

41 
ölöe
 
usöt
 
occ
(Ëc⁄° {  
Àngth
(
this
->
ønge
); }

42 
ölöe
 
øtio
(Ëc⁄° {  
	mthis
->
occ
(Ë/ ()—his->
	mdocc
); }

44 
	m°d
::
°rög
 
∑âîn
;

45 
weight_ty≥
 
	mweight
;

46 
∑ú_ty≥
 
	mønge
;

47 
usöt
 
	m°ïs
;

48 
usöt
 
	mdocc
;

51 
	sP©ã∫OccDoccCom∑øt‹


53 
boﬁ
 
›î©‹
(Ë(c⁄° 
	mP©ã∫
& 
	ma
, c⁄° P©ã∫& 
	mb
)

55 if(
	ma
.
found
(Ë&& 
	mb
.found()Ë{  (a.
øtio
() > b.ratio()); }

56  
	ma
.
found
();

58 } 
	gpod_com∑øt‹
;

62 
¥ötUßge
();

63 
¥ötP©ã∫s
(
°d
::
ve˘‹
<
P©ã∫
>& 
∑âîns
, c⁄° std::
°rög
& 
fûe_«me
, 
boﬁ
 
⁄ly_found
 = 
Ál£
);

64 
¸óãP©ã∫s
(
°d
::
ve˘‹
<°d::
°rög
>& 
rows
, std::ve˘‹<
P©ã∫
>& 
∑âîns
, 
boﬁ
 
ign‹e_èb
, 
usöt
 
ign‹e
);

66 
usöt
 
tŸÆFound
(c⁄° 
°d
::
ve˘‹
<
P©ã∫
>& 
∑âîns
);

67 
usöt
 
tŸÆSize
(c⁄° 
°d
::
ve˘‹
<
P©ã∫
>& 
∑âîns
);

68 
usöt
 
tŸÆOcc
(c⁄° 
°d
::
ve˘‹
<
P©ã∫
>& 
∑âîns
);

69 
usöt
 
tŸÆSãps
(c⁄° 
°d
::
ve˘‹
<
P©ã∫
>& 
∑âîns
);

70 
usöt
 
tŸÆDocc
(c⁄° 
°d
::
ve˘‹
<
P©ã∫
>& 
∑âîns
);

73 
	$maö
(
¨gc
, ** 
¨gv
)

75 
°d
::
cout
 << "RLCSAÅe°" << std::
ídl
;

76 
°d
::
cout
 << std::
ídl
;

78 
boﬁ
 
ad≠tive
 = 
Ál£
, 
dúe˘
 = fÆ£, 
loˇã
 = fÆ£, 
pizza
 = fÆ£, 
cou¡_°ïs
 = false;

79 
boﬁ
 
u£_ß
 = 
Ál£
;

80 
boﬁ
 
li°ög
 = 
Ál£
, 
æe
 = false;

81 
usöt
 
ign‹e
 = 0, 
gíî©e
 = 0;

82 
boﬁ
 
ign‹e_èb
 = 
Ál£
;

83 
boﬁ
 
wrôe
 = 
Ál£
, 
wrôe_∑âîns
 = fÆ£, 
s‹t_∑âîns
 = false;

84 * 
ba£_«me
 = 0;

85 * 
∑âîns_«me
 = 0;

86 #ifde‡
MULTITHREAD_SUPPORT


87 
söt
 
thªads
 = 1;

89 
i
 = 1; i < 
¨gc
; i++)

91 if(
¨gv
[
i
][0] == '-')

93 
¨gv
[
i
][1])

96 
ad≠tive
 = 
åue
; ;

98 
dúe˘
 = 
åue
; ;

100 
gíî©e
 = 
	`©oi
(
¨gv
[
i
] + 2); ;

102 if(
¨gv
[
i
][2] ='t'Ë{ 
ign‹e
 = 1; 
ign‹e_èb
 = 
åue
; }

103 { 
ign‹e
 = 
	`©oi
(
¨gv
[
i
] + 2); }

106 
loˇã
 = 
åue
; ;

108 
li°ög
 = 
åue
; ;

110 
s‹t_∑âîns
 = 
åue
; ;

112 
pizza
 = 
åue
; ;

114 
æe
 = 
åue
; ;

116 
u£_ß
 = 
åue
; ;

118 
cou¡_°ïs
 = 
åue
; ;

120 
wrôe_∑âîns
 = 
åue
; ;

122 
wrôe
 = 
åue
; ;

124 
°d
::
cout
 << "InvÆid o±i⁄: " << 
¨gv
[
i
] << std::
ídl
 << std::endl;

125 
	`¥ötUßge
();

129 if(
ba£_«me
 == 0)

131 
ba£_«me
 = 
¨gv
[
i
];

133 if(
∑âîns_«me
 == 0)

135 
∑âîns_«me
 = 
¨gv
[
i
];

137 #ifde‡
MULTITHREAD_SUPPORT


140 
thªads
 = 
°d
::
	`mö
(
MAX_THREADS
, std::
	`max
(
	`©oi
(
¨gv
[
i
]), 1));

144 if(
ba£_«me
 =0Ë{ 
	`¥ötUßge
();  2; }

146 
°d
::
cout
 << "Options:";

147 if(
gíî©e
 > 0Ë{ 
°d
::
cout
 << " generate=" << generate; }

148 if(
ign‹e_èb
Ë{ 
°d
::
cout
 << " ignore=tab"; }

149 if(
ign‹e
 > 0Ë{ 
°d
::
cout
 << " ignore=" << ignore; }

150 if(
u£_ß
Ë{ 
ad≠tive
 = 
dúe˘
 = 
cou¡_°ïs
 = 
li°ög
 = 
Ál£
; }

151 if(
li°ög
)

153 
loˇã
 = 
ad≠tive
 = 
cou¡_°ïs
 = 
wrôe
 = 
Ál£
;

154 
°d
::
cout
 << "Üisting";

155 if(
dúe˘
 || 
æe
)

157 
°d
::
cout
 << "(";

158 if(
dúe˘
Ë{ 
°d
::
cout
 << " direct"; }

159 if(
æe
Ë{ 
°d
::
cout
 << "Ñle"; }

160 if(
cou¡_°ïs
Ë{ 
°d
::
cout
 << " sãps"; 
wrôe
 = 
Ál£
; }

161 
°d
::
cout
 << " )";

164 if(
loˇã
)

166 
æe
 = 
s‹t_∑âîns
 = 
Ál£
;

167 
°d
::
cout
 << "Üocate";

168 if(
ad≠tive
 || 
dúe˘
 || 
cou¡_°ïs
)

170 
°d
::
cout
 << "(";

171 if(
ad≠tive
Ë{ 
°d
::
cout
 << "ád≠tive"; 
dúe˘
 = 
åue
; }

172 if(
dúe˘
Ë{ 
°d
::
cout
 << " direct"; }

173 if(
cou¡_°ïs
Ë{ 
°d
::
cout
 << " sãps"; 
wrôe
 = 
Ál£
; }

174 
°d
::
cout
 << " )";

177 { 
ad≠tive
 = 
dúe˘
 = 
cou¡_°ïs
 = 
wrôe
 = 
æe
 = 
s‹t_∑âîns
 = 
Ál£
; }

178 if(
s‹t_∑âîns
Ë{ 
°d
::
cout
 << " sort_patterns"; }

179 if(
pizza
Ë{ 
°d
::
cout
 << "Öizza"; }

180 if(
u£_ß
Ë{ 
°d
::
cout
 << " sa"; }

181 if(
wrôe_∑âîns
Ë{ 
°d
::
cout
 << " write_patterns"; }

182 if(
wrôe
Ë{ 
°d
::
cout
 << " write"; }

183 
°d
::
cout
 << std::
ídl
;

184 
°d
::
cout
 << "Ba£Çame: " << 
ba£_«me
 << std::
ídl
;

185 if(
∑âîns_«me
 !0Ë{ 
°d
::
cout
 << "P©ã∫s: " <<Ö©ã∫s_«mê<< std::
ídl
; }

186 #ifde‡
MULTITHREAD_SUPPORT


187 
°d
::
cout
 << "Thªads: " << 
thªads
 << std::
ídl
;

189 
°d
::
cout
 << std::
ídl
;

192 c⁄° 
RLCSA
* 
æcß
 = (
u£_ß
 ? 0 : 
√w
 
	`RLCSA
(
ba£_«me
, 
Ál£
));

193 c⁄° 
SuffixAºay
* 
ß
 = (
u£_ß
 ? 
√w
 
	`SuffixAºay
(
ba£_«me
, 
Ál£
) : 0);

194 
usöt
 
size
 = 0, 
ãxt_size
 = 0;

195 if(
u£_ß
)

197 if(!
ß
->
	`isOk
())

199 
dñëe
 
æcß
;Ñlcsa = 0;

200 
dñëe
 
ß
; sa = 0;

203 
ß
->
	`ªp‹tSize
(
åue
);

204 
size
 = 
ß
->
	`gëSize
();

205 
ãxt_size
 = 
size
;

209 if(!
æcß
->
	`isOk
())

211 
dñëe
 
æcß
;Ñlcsa = 0;

212 
dñëe
 
ß
; sa = 0;

215 
æcß
->
	`¥ötInfo
();

216 
æcß
->
	`ªp‹tSize
(
åue
);

217 
size
 = 
æcß
->
	`gëSize
();

218 
ãxt_size
 = 
æcß
->
	`gëTextSize
();

220 if(
∑âîns_«me
 == 0)

222 
dñëe
 
æcß
;Ñlcsa = 0;

223 
dñëe
 
ß
; sa = 0;

227 
Ad≠tiveSam∂es
* 
ad≠tive_ßm∂es
 = 0;

228 if(
ad≠tive
)

230 
ad≠tive_ßm∂es
 = 
√w
 
	`Ad≠tiveSam∂es
(*
æcß
, 
ba£_«me
);

231 
ad≠tive_ßm∂es
->
	`ªp‹t
();

232 if(!
ad≠tive_ßm∂es
->
	`isOk
())

234 
dñëe
 
æcß
;Ñlcsa = 0;

235 
dñëe
 
ß
; sa = 0;

236 
dñëe
 
ad≠tive_ßm∂es
;ádaptive_samples = 0;

241 
DocAºay
* 
doˇºay
 = 0;

242 if(
li°ög
)

244 if(
dúe˘
)

246 
doˇºay
 = 
√w
 
	`DocAºay
(*
æcß
);

250 
doˇºay
 = 
√w
 
	`DocAºay
(*
æcß
, 
ba£_«me
);

251 
doˇºay
->
	`ªp‹tSize
(
åue
);

252 if(!
doˇºay
->
	`isOk
(Ë|| !doˇºay->
	`hasGømm¨
())

254 
dñëe
 
æcß
;Ñlcsa = 0;

255 
dñëe
 
ß
; sa = 0;

256 
dñëe
 
ad≠tive_ßm∂es
;ádaptive_samples = 0;

257 
dñëe
 
doˇºay
; docarray = 0;

263 
°d
::
if°ªam
 
	`∑âîn_fûe
(
∑âîns_«me
, std::
ios_ba£
::
bö¨y
);

264 if(!
∑âîn_fûe
)

266 
°d
::
˚º
 << "Eº‹ o≥nögÖ©ã∫ fûe!" << std::
ídl
;

267 
dñëe
 
æcß
;Ñlcsa = 0;

268 
dñëe
 
ß
; sa = 0;

269 
dñëe
 
ad≠tive_ßm∂es
;ádaptive_samples = 0;

272 
°d
::
ve˘‹
<°d::
°rög
> 
rows
;

273 if(!
pizza
Ë{ 
	`ªadRows
(
∑âîn_fûe
, 
rows
, 
åue
); }

274 { 
	`ªadPizzaChûi
(
∑âîn_fûe
, 
rows
); }

275 
∑âîn_fûe
.
	`˛o£
();

276 if(
rows
.
	`size
() == 0)

278 
°d
::
˚º
 << "Nÿ∑âîn†found!" << std::
ídl
;

279 
dñëe
 
æcß
;Ñlcsa = 0;

280 
dñëe
 
ß
; sa = 0;

281 
dñëe
 
ad≠tive_ßm∂es
;ádaptive_samples = 0;

284 
°d
::
ve˘‹
<
P©ã∫
> 
∑âîns
;

285 
	`¸óãP©ã∫s
(
rows
, 
∑âîns
, 
ign‹e_èb
, 
ign‹e
);

286 
rows
.
	`˛ór
();

290 if(
gíî©e
 > 0)

292 
DñèEncodî
 
	`ícodî
(2 * (
usöt
));

293 
usöt
 
sum
 = 0;

294 
°d
::
ve˘‹
<
P©ã∫
>::
ôî©‹
 
ôî
 = 
∑âîns
.
	`begö
(); iã∏!∑âîns.
	`íd
(); ++iter)

296 
ícodî
.
	`addBô
(
sum
);

297 
sum
 +
ôî
->
weight
;

299 
ícodî
.
	`Êush
();

300 
DñèVe˘‹
 
	`ve˘‹
(
ícodî
, 
sum
);

302 
°d
::
ve˘‹
<
P©ã∫
> 
√w_∑âîns
;Çew_∑âîns.
	`ª£rve
(
gíî©e
);

303 
DñèVe˘‹
::
Iãøt‹
 
	`vôî
(
ve˘‹
);

304 
	`§™d
(0xDEADBEEF);

305 
usöt
 
i
 = 0; i < 
gíî©e
; i++)

307 
usöt
 
tmp
 = 
vôî
.
	`ønk
(
	`ønd
(Ë% 
sum
);

308 
√w_∑âîns
.
	`push_back
(
∑âîns
[
tmp
 - 1]);

310 
∑âîns
.
	`˛ór
();

311 
∑âîns
.
	`assign
(
√w_∑âîns
.
	`begö
(),Çew_∑âîns.
	`íd
());

312 
√w_∑âîns
.
	`˛ór
();

313 
°d
::
cout
 << "Gíî©ed " << 
∑âîns
.
	`size
(Ë<< "Ö©ã∫s." << std::
ídl
;

314 
°d
::
cout
 << std::
ídl
;

318 
weight_ty≥
* 
tŸÆs
 = 0;

319 if(
wrôe
)

321 
tŸÆs
 = 
√w
 
weight_ty≥
[
ãxt_size
];

322 
usöt
 
i
 = 0; i < 
ãxt_size
; i++Ë{ 
tŸÆs
[i] = 0; }

327 #ifde‡
MULTITHREAD_SUPPORT


328 
	`omp_£t_num_thªads
(
thªads
);

330 
°¨t
 = 
	`ªadTimî
();

332 #¥agm®
omp
 
∑øŒñ
 
	`scheduÀ
(
dy«mic
, 1)

333 
usöt
 
i
 = 0; i < 
∑âîns
.
	`size
(); i++)

335 
∑âîns
[
i
].
ønge
 = (
u£_ß
 ? 
ß
->
	`cou¡
’©ã∫s[i].
∑âîn
Ë: 
æcß
->count(patterns[i].pattern));

337 if(
loˇã
 && 
∑âîns
[
i
].
	`found
())

339 
usöt
* 
m©ches
 = 0;

340 
uöt
* 
ß_m©ches
 = 0;

341 if(
ad≠tive
Ë{ 
m©ches
 = 
ad≠tive_ßm∂es
->
	`loˇã
(
∑âîns
[
i
].
ønge
, 
cou¡_°ïs
); }

342 if(
u£_ß
Ë{ 
ß_m©ches
 = 
ß
->
	`loˇã
(
∑âîns
[
i
].
ønge
); }

343 { 
m©ches
 = 
æcß
->
	`loˇã
(
∑âîns
[
i
].
ønge
, 
dúe˘
, 
cou¡_°ïs
); }

344 if(
cou¡_°ïs
)

346 
∑âîns
[
i
].
°ïs
 = 0;

347 
usöt
 
j
 = 0; j < 
∑âîns
[
i
].
	`occ
(); j++)

349 
∑âîns
[
i
].
°ïs
 +
m©ches
[
j
];

353 if(
wrôe
)

355 #¥agm®
omp
 
¸ôiˇl


357 if(
u£_ß
Ë{ 
usöt
 
j
 = 0; j < 
∑âîns
[
i
].
	`occ
(); j++Ë{ 
tŸÆs
[
ß_m©ches
[j]] +∑âîns[i].
weight
; } }

358 { 
usöt
 
j
 = 0; j < 
∑âîns
[
i
].
	`occ
(); j++Ë{ 
tŸÆs
[
m©ches
[j]] +∑âîns[i].
weight
; } }

361 
dñëe
[] 
ß_m©ches
; sa_matches = 0;

362 
dñëe
[] 
m©ches
; matches = 0;

364 if(
li°ög
 && 
∑âîns
[
i
].
	`found
())

366 if(
æe
)

368 
°d
::
ve˘‹
<
∑ú_ty≥
>* 
docs
 =

369 (
dúe˘
 ? 
doˇºay
->
	`dúe˘Li°ögRLE
(
∑âîns
[
i
].
ønge
)

370 : 
doˇºay
->
	`li°DocumítsRLE
(
∑âîns
[
i
].
ønge
));

371 if(
docs
 != 0)

373 
∑âîns
[
i
].
docc
 = 0;

374 
°d
::
ve˘‹
<
∑ú_ty≥
>::
ôî©‹
 
ôî
 = 
docs
->
	`begö
(); iã∏!docs->
	`íd
(); ++iter)

376 
∑âîns
[
i
].
docc
 +
	`Àngth
(*
ôî
);

379 
dñëe
 
docs
;

383 
°d
::
ve˘‹
<
usöt
>* 
docs
 =

384 (
dúe˘
 ? 
doˇºay
->
	`dúe˘Li°ög
(
∑âîns
[
i
].
ønge
)

385 : 
doˇºay
->
	`li°Documíts
(
∑âîns
[
i
].
ønge
));

386 if(
docs
 != 0)

388 
∑âîns
[
i
].
docc
 = 
docs
->
	`size
();

389 
dñëe
 
docs
; docs = 0;

395 
£c⁄ds
 = 
	`ªadTimî
(Ë- 
°¨t
;

396 
megabyãs
 = 
	`tŸÆSize
(
∑âîns
Ë/ ()
MEGABYTE
;

400 
°d
::
cout
 << "P©ã∫s: " << 
∑âîns
.
	`size
(Ë<< " (" << (∑âîns.size(Ë/ 
£c⁄ds
Ë<< " / sec)" << std::
ídl
;

401 
°d
::
cout
 << "TŸÆ size: " << 
megabyãs
 << " MB";

402 if(!
loˇã
)

404 
°d
::
cout
 << " (" << (
megabyãs
 / 
£c⁄ds
) << " MB/s)";

406 
°d
::
cout
 << std::
ídl
;

408 
usöt
 
tŸÆ_occ
 = 
	`tŸÆOcc
(
∑âîns
), 
tŸÆ_°ïs
 = 
	`tŸÆSãps
(patterns);

409 
°d
::
cout
 << "Found: " << 
	`tŸÆFound
(
∑âîns
Ë<< std::
ídl
;

410 
°d
::
cout
 << "Occuºí˚s: " << 
tŸÆ_occ
;

411 if(
loˇã
)

413 
°d
::
cout
 << " (" << (
tŸÆ_occ
 / 
£c⁄ds
) << " / sec)";

414 if(
cou¡_°ïs
)

416 
°d
::
cout
 << std::
ídl


417 << "Loˇã sãps: " << 
tŸÆ_°ïs
 << " (" << (tŸÆ_°ï†/ ()
tŸÆ_occ
) << " / occurrence)";

420 
°d
::
cout
 << std::
ídl
;

421 if(
li°ög
)

423 
usöt
 
tŸÆ_docc
 = 
	`tŸÆDocc
(
∑âîns
);

424 
°d
::
cout
 << "Documíts: " << 
tŸÆ_docc
 << " (" << (tŸÆ_doc¯/ 
£c⁄ds
Ë<< " / sec)" << std::
ídl
;

426 
°d
::
cout
 << "Time: " << 
£c⁄ds
 << " sec⁄ds" << std::
ídl
;

427 
°d
::
cout
 << std::
ídl
;

431 if(
wrôe
)

433 
°d
::
°rög
 
	`ouçut_«me
(
∑âîns_«me
); 
ouçut_«me
 += ".found";

434 
°d
::
of°ªam
 
	`ouçut
(
ouçut_«me
.
	`c_°r
(), std::
ios_ba£
::
bö¨y
);

435 if(!
ouçut
)

437 
°d
::
˚º
 << "C™nŸ o≥¿ouçuàfûê(" << 
ouçut_«me
 << ")!" << std::
ídl
;

441 
ouçut
.
	`wrôe
((*)
tŸÆs
, 
ãxt_size
 * (
weight_ty≥
));

442 
ouçut
.
	`˛o£
();

445 
weight_ty≥
 
max_weight
 = 0, 
tŸÆ_weight
 = 0;

446 
usöt
 
i
 = 0; i < 
size
; i++)

448 
max_weight
 = 
°d
::
	`max
(max_weight, 
tŸÆs
[
i
]);

449 
tŸÆ_weight
 +
tŸÆs
[
i
];

451 
°d
::
cout
 << "Weights: " << 
max_weight
 << " (max), "

452 << ((()
tŸÆ_weight
Ë/ 
size
Ë<< " (avîage)" << 
°d
::
ídl
;

453 
°d
::
cout
 << std::
ídl
;

456 if(
wrôe_∑âîns
)

458 
	`¥ötP©ã∫s
(
∑âîns
, 
°d
::
	`°rög
(
∑âîns_«me
) + ".selected");

459 
	`¥ötP©ã∫s
(
∑âîns
, 
°d
::
	`°rög
(
∑âîns_«me
Ë+ ".found", 
åue
);

461 if(
s‹t_∑âîns
)

463 
	`£quítülS‹t
(
∑âîns
.
	`begö
(),Ö©ã∫s.
	`íd
(), 
pod_com∑øt‹
);

464 
	`¥ötP©ã∫s
(
∑âîns
, 
°d
::
	`°rög
(
∑âîns_«me
Ë+ ".s‹ãd", 
åue
);

469 if(
ad≠tive
Ë{ 
ad≠tive_ßm∂es
->
	`ªp‹t
(); }

470 
dñëe
 
æcß
;Ñlcsa = 0;

471 
dñëe
 
ß
; sa = 0;

472 
dñëe
 
ad≠tive_ßm∂es
;ádaptive_samples = 0;

473 
dñëe
 
doˇºay
; docarray = 0;

474 
dñëe
[] 
tŸÆs
;Åotals = 0;

476 
	}
}

480 
	$¥ötUßge
()

482 
°d
::
cout
 << "Ußge:Ñlcß_ã° [›ti⁄s] ba£_«mê[∑âîn†[thªads]]" << std::
ídl
;

483 
°d
::
cout
 << " -® U£ád≠tivêßm∂es." << std::
ídl
;

484 
°d
::
cout
 << " -d U£ dúe˘Üoˇã / documíàli°ög." << std::
ídl
;

485 
°d
::
cout
 << " -g# U£Åhêweight†tÿgíî©ê#á˘uÆÖ©ã∫s." << std::
ídl
;

486 
°d
::
cout
 << " -i# Ign‹êfú° # ch¨a˘î†o‡óchÖ©ã∫." << std::
ídl
;

487 
°d
::
cout
 << " -» LoˇãÅhêoccuºí˚s." << std::
ídl
;

488 
°d
::
cout
 << " -L Li°Åhêdocumít†c⁄èöögÅhê∑âîn." << std::
ídl
;

489 
°d
::
cout
 << " -ÿ Wrôêthê∑âîn†s‹ãd by occ/doc¯ötÿ∑âîns.s‹ãd." << std::
ídl
;

490 
°d
::
cout
 << " -∞ P©ã∫ fûêi†ö Pizz®& Chûòf‹m©." << std::
ídl
;

491 
°d
::
cout
 << " -∏ Run-ÀngthÉncodêthêªsu…†‘equúe†-L)." << std::
ídl
;

492 
°d
::
cout
 << " -S U£áÖœö suffixáºay (√g©e†ad≠tive, dúe˘, sãps)." << std::
ídl
;

493 
°d
::
cout
 << " -† Cou¡Åhênumbî o‡°ï†ªquúed f‹Üoˇã(Ë“eg©e†wrôe)." << std::
ídl
;

494 
°d
::
cout
 << " -W Wrôê£À˘edánd foundÖ©ã∫†ötÿ∑âîns.£À˘edándÖ©ã∫s.found." << std::
ídl
;

495 
°d
::
cout
 << " -w WrôêthêweighãdÇumbî o‡occuºí˚†o‡óch suffix i¡ÿ∑âîns.found." << std::
ídl
;

496 
°d
::
cout
 << std::
ídl
;

497 
°d
::
cout
 << "DeÁu…Ö©ã∫ weighàf‹ -gánd -w i†1." << std::
ídl
;

498 
°d
::
cout
 << "I‡-òi†•ecifõd,Åhêign‹ed ch¨a˘î†¨êu£dá†weights." << std::
ídl
;

499 
°d
::
cout
 << "U£ -ôÅÿign‹êthê∑âî¿u¡ûÅhêfú° \\t." << std::
ídl
;

500 
°d
::
cout
 << std::
ídl
;

501 
	}
}

504 
¥ötP©ã∫s
(
°d
::
ve˘‹
<
P©ã∫
>& 
∑âîns
, c⁄° std::
°rög
& 
fûe_«me
, 
boﬁ
 
⁄ly_found
)

506 if(
	g∑âîns
.
em±y
()) { ; }

508 
	g°d
::
of°ªam
 
ouçut
(
fûe_«me
.
c_°r
(), 
°d
::
ios_ba£
::
bö¨y
);

509 if(!
	gouçut
)

511 
	g°d
::
˚º
 << "Eº‹: C™nŸ o≥¿fûê" << 
fûe_«me
 << " f‹ wrôögÖ©ã∫s!" << 
°d
::
ídl
;

515 
	g°d
::
ve˘‹
<
P©ã∫
>::
ôî©‹
 
ôî
 = 
∑âîns
.
begö
(); 
	gôî
 !∑âîns.
íd
(); ++iter)

517 if(!
	g⁄ly_found
 || 
	gôî
->
found
()Ë{ 
	gouçut
 << iãr->
	g∑âîn
 << 
	g°d
::
ídl
; }

519 
	gouçut
.
˛o£
();

523 
¸óãP©ã∫s
(
°d
::
ve˘‹
<°d::
°rög
>& 
rows
, std::ve˘‹<
P©ã∫
>& 
∑âîns
, 
boﬁ
 
ign‹e_èb
, 
usöt
 
ign‹e
)

525 
	g°d
::
ve˘‹
<
°d
::
°rög
>::
ôî©‹
 
ôî
 = 
rows
.
begö
(); 
	gôî
 !rows.
íd
(); ++iter)

527 
	g∑âîns
.
push_back
(
P©ã∫
(*
ôî
, 
ign‹e_èb
, 
ign‹e
));

531 
usöt


532 
tŸÆFound
(c⁄° 
°d
::
ve˘‹
<
P©ã∫
>& 
∑âîns
)

534 
tŸÆ
 = 0;

535 
	g°d
::
ve˘‹
<
P©ã∫
>::
c⁄°_ôî©‹
 
ôî
 = 
∑âîns
.
begö
(); 
	gôî
 !∑âîns.
íd
(); ++iter)

537 if(
	gôî
->
found
()Ë{ 
	gtŸÆ
++; }

539  
	gtŸÆ
;

542 
usöt


543 
tŸÆSize
(c⁄° 
°d
::
ve˘‹
<
P©ã∫
>& 
∑âîns
)

545 
tŸÆ
 = 0;

546 
	g°d
::
ve˘‹
<
P©ã∫
>::
c⁄°_ôî©‹
 
ôî
 = 
∑âîns
.
begö
(); 
	gôî
 !∑âîns.
íd
(); ++iter)

548 
	gtŸÆ
 +
ôî
->
∑âîn
.
Àngth
();

550  
	gtŸÆ
;

553 
usöt


554 
tŸÆOcc
(c⁄° 
°d
::
ve˘‹
<
P©ã∫
>& 
∑âîns
)

556 
tŸÆ
 = 0;

557 
	g°d
::
ve˘‹
<
P©ã∫
>::
c⁄°_ôî©‹
 
ôî
 = 
∑âîns
.
begö
(); 
	gôî
 !∑âîns.
íd
(); ++iter)

559 
	gtŸÆ
 +
ôî
->
occ
();

561  
	gtŸÆ
;

564 
usöt


565 
tŸÆSãps
(c⁄° 
°d
::
ve˘‹
<
P©ã∫
>& 
∑âîns
)

567 
tŸÆ
 = 0;

568 
	g°d
::
ve˘‹
<
P©ã∫
>::
c⁄°_ôî©‹
 
ôî
 = 
∑âîns
.
begö
(); 
	gôî
 !∑âîns.
íd
(); ++iter)

570 
	gtŸÆ
 +
ôî
->
°ïs
;

572  
	gtŸÆ
;

575 
usöt


576 
tŸÆDocc
(c⁄° 
°d
::
ve˘‹
<
P©ã∫
>& 
∑âîns
)

578 
tŸÆ
 = 0;

579 
	g°d
::
ve˘‹
<
P©ã∫
>::
c⁄°_ôî©‹
 
ôî
 = 
∑âîns
.
begö
(); 
	gôî
 !∑âîns.
íd
(); ++iter)

581 
	gtŸÆ
 +
ôî
->
docc
;

583  
	gtŸÆ
;

	@sample_lcp.cpp

1 
	~<Æg‹ôhm
>

2 
	~<f°ªam
>

3 
	~<io°ªam
>

5 
	~"æcß.h
"

6 
	~"misc/utûs.h
"

9 
usög
 
«me•a˚
 
	gCSA
;

13 
	$maö
(
¨gc
, ** 
¨gv
)

15 
°d
::
cout
 << "LCP sam∂î" << std::
ídl
;

16 if(
¨gc
 < 3)

18 
°d
::
cout
 << "Ußge: sam∂e_l˝ ba£_«mêßm∂e_øã" << std::
ídl
;

22 
°d
::
°rög
 
ba£_«me
 = 
¨gv
[1];

23 
°d
::
°rög
 
l˝_«me
 = 
ba£_«me
 + 
LCP_SAMPLES_EXTENSION
;

24 
°d
::
cout
 << "LCP sam∂es: " << 
l˝_«me
 << std::
ídl
;

25 
°d
::
of°ªam
 
	`l˝_fûe
(
l˝_«me
.
	`c_°r
(), std::
ios_ba£
::
bö¨y
);

26 if(!
l˝_fûe
)

28 
°d
::
˚º
 << "Eº‹ cª©ög LCP sam∂êfûe!" << std::
ídl
;

32 
usöt
 
ßm∂e_øã
 = 
	`©oi
(
¨gv
[2]);

33 
°d
::
cout
 << "Sam∂êøã: " << 
ßm∂e_øã
 << std::
ídl
;

34 
°d
::
cout
 << std::
ídl
;

35 
RLCSA
* 
æcß
 = 
√w
 
	`RLCSA
(
ba£_«me
);

37 
°¨t
 = 
	`ªadTimî
();

38 
∑ú_ty≥
* 
ßm∂ed_vÆues
 = 0;

39 
usöt
 
ßm∂es
 = 
æcß
->
	`ßm∂eLCP
(
ßm∂e_øã
, 
ßm∂ed_vÆues
, 
åue
);

40 
usöt
 
d©a_size
 = 
æcß
->
	`gëSize
();

41 
dñëe
 
æcß
;

42 
LCPSam∂es
 
	`l˝
(
ßm∂ed_vÆues
, 
d©a_size
, 
ßm∂es
, 
åue
,Årue);

43 
l˝
.
	`wrôeTo
(
l˝_fûe
);

45 
time
 = 
	`ªadTimî
(Ë- 
°¨t
;

46 
megabyãs
 = 
d©a_size
 / ()
MEGABYTE
;

47 
size
 = 
l˝
.
	`ªp‹tSize
(Ë/ ()
MEGABYTE
;

48 
°d
::
cout
 << 
megabyãs
 << " megabyã†ö " << 
time
 << " sec⁄d†(" << (megabyã†/ÅimeË<< " MB/s)" << std::
ídl
;

49 
°d
::
cout
 << "Sam∂ed LCP size: " << 
size
 << " MB" << std::
ídl
;

50 
°d
::
cout
 << std::
ídl
;

52 
l˝_fûe
.
	`˛o£
();

55 
	}
}

	@sampler.cpp

1 
	~<Æg‹ôhm
>

2 
	~<deque
>

3 
	~<f°ªam
>

4 
	~<io°ªam
>

5 
	~<limôs
>

7 #ifde‡
MULTITHREAD_SUPPORT


8 
	~<omp.h
>

11 
	~"ßm∂î.h
"

12 
	~"æcß.h
"

15 
«me•a˚
 
	gCSA


18 
	gSam∂î
::
Sam∂î
(
uöt
 
_size
) :

19 
size
(
_size
), 
°©us
(
NOT_READY
),

20 
ßm∂es
(0), 
numbî_of_ßm∂es
(0)

24 
	gSam∂î
::~
Sam∂î
()

26 
dñëe
[] 
this
->
ßm∂es
; 
	gthis
->
	gßm∂es
 = 0;

30 
	gSam∂î
::
wrôeTo
(c⁄° 
°d
::
°rög
& 
ba£_«me
) const

32 
°d
::
°rög
 
ßm∂e_«me
 = 
ba£_«me
 + 
SA_SAMPLES_EXTENSION
;

33 
	g°d
::
of°ªam
 
ßm∂e_fûe
(
ßm∂e_«me
.
c_°r
(), 
°d
::
ios_ba£
::
bö¨y
);

34 if(!
	gßm∂e_fûe
)

36 
	g°d
::
˚º
 << "Sam∂î: Eº‹ cª©ög sam∂êfûe!" << 
°d
::
ídl
;

40 
uöt
 
	gi
 = 0; i < 
	gthis
->
	gnumbî_of_ßm∂es
; i++)

42 
	gßm∂e_fûe
.
wrôe
((*)&(
this
->
ßm∂es
[
i
].
£c⁄d
), (
uöt
));

44 
	gßm∂e_fûe
.
˛o£
();

47 
∑ú_ty≥
*

48 
	gSam∂î
::
gëSam∂es
(
sh‹t_∑ú
* 
ß
, 
uöt
 
numbî_of_£quí˚s
, 
usöt
 
thªads
)

50 if(
	gß
 =0 || 
this
->
ßm∂es
 =0 ||Åhis->
°©us
 !
SAMPLED
) {  0; }

52 
uöt
 
	gi
 = 0; i < 
	gthis
->
	gnumbî_of_ßm∂es
; i++)

54 
	gthis
->
	gßm∂es
[
i
].
	gfú°
 = 
ß
[
this
->
ßm∂es
[i].
£c⁄d
].£c⁄d - 
numbî_of_£quí˚s
;

56 #ifde‡
MULTITHREAD_SUPPORT


57 
omp_£t_num_thªads
(
thªads
);

59 
∑øŒñS‹t
(
ßm∂es
, sam∂e†+ 
this
->
numbî_of_ßm∂es
);

61 
∑ú_ty≥
* 
	gªsu…
 = 
this
->
ßm∂es
; 
	gthis
->
	gßm∂es
 = 0;

62 
	gthis
->
	g°©us
 = 
NOT_READY
;

63  
	gªsu…
;

68 
	gWeighãdSam∂î
::
WeighãdSam∂î
(
weight_ty≥
* 
weights
, 
uöt
 
_size
, 
boﬁ
 
_u£_psi
) :

69 
Sam∂î
(
_size
),

70 
u£_psi
(
_u£_psi
), 
adju°mít
(0),

71 
∑th_weights
(0), 
¥ede˚ss‹s
(0),

72 
edge_weights
(0), 
edge_tŸÆs
(0),

73 
nodes
(0), 
node_posôi⁄s
(0)

75 if(
	gweights
 =0 || 
this
->
size
 == 0)

77 
dñëe
[] 
weights
; ;

80 
	gthis
->
ˇlcuœãEdges
(
weights
);

81 
	gthis
->
	g∑th_weights
 = 
√w
 
sum_ty≥
[
this
->
nodes
];

82 
	gthis
->
	g¥ede˚ss‹s
 = 
√w
 
uöt
[
this
->
nodes
];

84 
	gthis
->
	g°©us
 = 
READY
;

87 
	gWeighãdSam∂î
::~
WeighãdSam∂î
()

89 
this
->
˛ónUp
();

90 
	gdñëe
[] 
	gthis
->
	gnode_posôi⁄s
;Åhis->node_positions = 0;

94 
	gWeighãdSam∂î
::
˛ónUp
()

96 
dñëe
[] 
this
->
∑th_weights
; 
	gthis
->
	g∑th_weights
 = 0;

97 
	gdñëe
[] 
	gthis
->
	g¥ede˚ss‹s
;Åhis->predecessors = 0;

98 
	gdñëe
[] 
	gthis
->
	gedge_weights
;Åhis->edge_weights = 0;

99 
	gdñëe
[] 
	gthis
->
	gedge_tŸÆs
;Åhis->edge_totals = 0;

104 
boﬁ


105 
	gWeighãdSam∂î
::
buûdSam∂es
(
uöt
 
ßm∂e_øã
, 
sum_ty≥
 
öôül_adju°mít
, 
usöt
 
thªads
)

107 if(
	gßm∂e_øã
 =0 || 
this
->
°©us
 !
READY
Ë{  
Ál£
; }

109 
usöt
 
	gf‹˚
 = 0;

110 #ifde‡
MULTITHREAD_SUPPORT


111 
omp_£t_num_thªads
(
thªads
);

112 
	gf‹˚
 = 
this
->
nodes
 / (
thªads
 *Åhreads);

115 
	gdñëe
[] 
	gthis
->
	gßm∂es
;Åhis->samples = 0;

116 
	gthis
->
	gnumbî_of_ßm∂es
 = (
this
->
size
 + 
ßm∂e_øã
 - 1) / sample_rate;

118 
sum_ty≥
 
	gavîage_weight
;

119 if(
	gthis
->
	gu£_psi
)

121 
	gavîage_weight
 = 
this
->
edge_tŸÆs
[this->
nodes
 - 1] /Åhis->
size
;

125 
	gavîage_weight
 = 
this
->
edge_tŸÆs
[0] /Åhis->
size
;

127 
	gavîage_weight
 = 
°d
::
max
(
avîage_weight
, (
sum_ty≥
)1);

130 
sum_ty≥
 
	gÀ·
 = 1, 
	gright
 = 
°d
::
numîic_limôs
<sum_ty≥>::
max
();

131 if(
	göôül_adju°mít
 > 0Ë{ 
	gthis
->
	gadju°mít
 = 
öôül_adju°mít
; }

132 { 
	gthis
->
	gadju°mít
 = 
avîage_weight
; }

133 
uöt
 
	gsh‹ã°
 = 0, 
	gl⁄ge°
 = 0;

134 
uöt
* 
	gsh‹ã°_∑th
 = 0;

135 
uöt
* 
	gl⁄ge°_∑th
 = 0;

142 
	g°d
::
cout
 << "À·: " << 
À·
 << ",Ñight: " << 
right
 << 
°d
::
ídl
;

143 
	gåue
)

145 
	g°d
::
cout
 << "Adju°mít: " << 
this
->
adju°mít
 << 
°d
::
ídl
;

147 
	gsh‹ã°
 = 
this
->
möimumWeightP©h
(
åue
, 
f‹˚
);

148 
	g°d
::
cout
 << " sh‹ã°: " << 
sh‹ã°
 << " (weighà" << 
this
->
∑th_weights
[this->
nodes
 - 1] << ")" << 
°d
::
ídl
;

149 if(
	gsh‹ã°
 > 
	gthis
->
	gnumbî_of_ßm∂es
)

151 
	gÀ·
 = 
this
->
adju°mít
 + 1;

152 
	gthis
->
	gadju°mít
 = 
°d
::
mö
(2 * 
this
->
adju°mít
, 
À·
 + (
right
 -Üeft) / 2);

155 
	gsh‹ã°_∑th
 = 
√w
 
uöt
[
sh‹ã°
 + 1];

156 
uöt
 
	gi
 = 
sh‹ã°
 + 1, 
	gcur
 = 
this
->
nodes
 - 1; i > 0; i--, cu∏this->
¥ede˚ss‹s
[
cur
])

158 
sh‹ã°_∑th
[
i
 - 1] = 
cur
;

161 
	gl⁄ge°
 = 
this
->
möimumWeightP©h
(
Ál£
, 
f‹˚
);

162 
	g°d
::
cout
 << "Ü⁄ge°: " << 
l⁄ge°
 << " (weighà" << 
this
->
∑th_weights
[this->
nodes
 - 1] << ")" << 
°d
::
ídl
;

163 if(
	gl⁄ge°
 < 
	gthis
->
	gnumbî_of_ßm∂es
 &&Åhis->
	gadju°mít
 > 1)

165 
	gright
 = 
this
->
adju°mít
 - 1;

166 
	gthis
->
	gadju°mít
 = 
À·
 + (
right
 -Üeft) / 2;

167 
	gdñëe
[] 
	gsh‹ã°_∑th
; shortest_path = 0;

170 
	gl⁄ge°_∑th
 = 
√w
 
uöt
[
l⁄ge°
 + 1];

171 
uöt
 
	gi
 = 
l⁄ge°
 + 1, 
	gcur
 = 
this
->
nodes
 - 1; i > 0; i--, cu∏this->
¥ede˚ss‹s
[
cur
])

173 
l⁄ge°_∑th
[
i
 - 1] = 
cur
;

178 
	g°d
::
cout
 << 
°d
::
ídl
;

179 
	gthis
->
˛ónUp
();

182 
	gthis
->
	gnumbî_of_ßm∂es
 = 
°d
::
mö
(
this
->
numbî_of_ßm∂es
, 
l⁄ge°
);

183 
	gthis
->
buûdP©h
(
this
->
numbî_of_ßm∂es
, 
l⁄ge°_∑th
, 
l⁄ge°
, 
sh‹ã°_∑th
, 
sh‹ã°
);

184 
	gdñëe
[] 
	gsh‹ã°_∑th
; shortest_path = 0;

186 
	gthis
->
	gßm∂es
 = 
√w
 
∑ú_ty≥
[
this
->
numbî_of_ßm∂es
];

187 
uöt
 
	gi
 = 0; i < 
	gthis
->
	gnumbî_of_ßm∂es
; i++)

189 
	gßm∂es
[
i
].
	g£c⁄d
 = 
this
->
node_posôi⁄s
[
l⁄ge°_∑th
[i]];

191 
	gdñëe
[] 
	gl⁄ge°_∑th
;Üongest_path = 0;

193 
	gthis
->
	g°©us
 = 
SAMPLED
;

194  
	gåue
;

200 
	gWeighãdSam∂î
::
buûdP©h
(
uöt
 
löks
, uöt* 
∑th_a
, uöà
Àngth_a
, uöt* 
∑th_b
, uöà
Àngth_b
)

202 
uöt
 
	gcur_a
 = 0, 
	gcur_b
 = 0;

203 
uöt
 
	gadj
 = 
Àngth_a
 - 
löks
;

205 
	gåue
)

207 if(
	gcur_a
 =
cur_b
 + 
adj
 && 
∑th_b
[cur_b] <
∑th_a
[
cur_a
] &&Öath_b[cur_b + 1] >=Öath_a[cur_a + 1])

212 if(
	g∑th_a
[
cur_a
] <
∑th_b
[
cur_b
]) { cur_a++; }

213 { 
	gcur_b
++; }

217 
uöt
 
	gi
 = 0; i <
cur_b
; i++Ë{ 
	g∑th_a
[
i
] = 
∑th_b
[i]; }

218 
uöt
 
	gi
 = 
cur_b
 + 1, 
	gj
 = 
cur_a
 + 1; j < 
	gÀngth_a
; i++, j++Ë{ 
	g∑th_a
[
i
] = 
∑th_a
[
j
]; }

223 
uöt


224 
	gWeighãdSam∂î
::
möimumWeightP©h
(
boﬁ
 
sh‹ã°
, 
uöt
 
f‹˚
)

226 if(
	gf‹˚
 =0Ë{ 
f‹˚
 = 
this
->
nodes
; }

227 
	g°d
::
ve˘‹
<
uöt
> 
íd_poöts
;

228 
	g°d
::
ve˘‹
<
∑ú_ty≥
> 
∑πül_ªsu…s
;

229 
uöt
 
	gi
 = 0; i < 
	gthis
->
	gnodes
 - 1; i +
f‹˚
)

231 
íd_poöts
.
push_back
(
i
);

233 
	gíd_poöts
.
push_back
(
this
->
nodes
 - 1);

234 
uöt
 
	g∑πs
 = 
íd_poöts
.
size
() - 1;

235 
uöt
 
	gi
 = 0; i < 
	gíd_poöts
.
size
(); i++)

237 
	gthis
->
	g∑th_weights
[
íd_poöts
[
i
]] = 0;

238 
	gthis
->
	g¥ede˚ss‹s
[
íd_poöts
[
i
]] = 0;

239 
	g∑πül_ªsu…s
.
push_back
(
∑ú_ty≥
(0, 0));

242 #¥agm®
omp
 
∑øŒñ
 
scheduÀ
()

243 
uöt
 
	g∑π
 = 0;Ö¨à< 
	g∑πs
;Öart++)

245 
	g°d
::
deque
<
node_ty≥
> 
a˘ive_nodes
;

246 
	ga˘ive_nodes
.
push_back
(
node_ty≥
(
íd_poöts
[
∑π
], 0));

248 
uöt
 
	gi
 = 
íd_poöts
[
∑π
] + 1; i < 
	gíd_poöts
[part + 1]; i++)

250 
node_ty≥
 
	gcuºít
 = 
this
->
lök
(
a˘ive_nodes
, 
i
, 
sh‹ã°
);

253 
	ga˘ive_nodes
.
‰⁄t
().
	gfú°
 < 
	gthis
->
	g¥ede˚ss‹s
[
i
])

255 
	ga˘ive_nodes
.
p›_‰⁄t
();

259 
	ga˘ive_nodes
.
size
() > 1 &&

260 
	gthis
->
isSåi˘lyBëãr
(
a˘ive_nodes
[1].
fú°
,á˘ive_nodes[0].fú°, 
i
 + 1))

262 
	ga˘ive_nodes
.
p›_‰⁄t
();

267 
	ga˘ive_nodes
.
size
() > 1 &&

268 
	gthis
->
bridge
(
a˘ive_nodes
[a˘ive_nodes.
size
(Ë- 2].
fú°
,á˘ive_nodes.
back
().fú°, 
i
))

270 
	ga˘ive_nodes
.
p›_back
();

275 if(
	gthis
->
isAsGood
(
i
, 
a˘ive_nodes
.
back
().
fú°
))

277 
	ga˘ive_nodes
.
push_back
(
cuºít
);

281 
	g∑πül_ªsu…s
[
∑π
 + 1] = 
this
->
föÆLök
(
a˘ive_nodes
, 
íd_poöts
[∑π + 1], 
sh‹ã°
);

284 
uöt
 
	gi
 = 1; i < 
	g∑πül_ªsu…s
.
size
(); i++)

286 
	g∑πül_ªsu…s
[
i
].
	gfú°
 +
∑πül_ªsu…s
[ò- 1].
fú°
;

287 
	g∑πül_ªsu…s
[
i
].
	g£c⁄d
 +
∑πül_ªsu…s
[ò- 1].
£c⁄d
;

289 
	gthis
->
	g∑th_weights
[
this
->
nodes
 - 1] = 
∑πül_ªsu…s
[
∑πs
].
£c⁄d
;

291  
	g∑πül_ªsu…s
[
∑πs
].
	gfú°
;

294 
node_ty≥


295 
	gWeighãdSam∂î
::
lök
(
°d
::
deque
<
node_ty≥
>& 
a˘ive_nodes
, 
uöt
 
to
, 
boﬁ
 
sh‹ã°
)

297 
	gthis
->
	g∑th_weights
[
to
] = 
°d
::
numîic_limôs
<
sum_ty≥
>::
max
();

298 
node_ty≥
 
cuºít
(
to
, 0);

299 if(
	gsh‹ã°
Ë{ 
	gcuºít
.
	g£c⁄d
 = 
°d
::
numîic_limôs
<
uöt
>::
max
(); }

301 
	g°d
::
deque
<
node_ty≥
>::
ôî©‹
 
ôî
 = 
a˘ive_nodes
.
begö
(); 
	gôî
 !a˘ive_nodes.
íd
(); ++iter)

303 
sum_ty≥
 
	gweight
 = 
this
->
gëP©hWeight
((*
ôî
).
fú°
, 
to
);

304 if(
	gweight
 > 
	gthis
->
	g∑th_weights
[
to
]Ë{  
	gcuºít
; }

305 if(
	gweight
 < 
	gthis
->
	g∑th_weights
[
to
] ||

306 (
	gsh‹ã°
 && (*
	gôî
).
	g£c⁄d
 + 1 < 
	gcuºít
.second) ||

307 (!
	gsh‹ã°
 && (*
	gôî
).
	g£c⁄d
 + 1 > 
	gcuºít
.second))

309 
	gthis
->
	g∑th_weights
[
to
] = 
weight
;

310 
	gthis
->
	g¥ede˚ss‹s
[
to
] = (*
ôî
).
fú°
;

311 
	gcuºít
.
	g£c⁄d
 = (*
ôî
).
£c⁄d
 + 1;

315  
	gcuºít
;

318 
∑ú_ty≥


319 
	gWeighãdSam∂î
::
föÆLök
(
°d
::
deque
<
node_ty≥
>& 
a˘ive_nodes
, 
uöt
 
to
, 
boﬁ
 
sh‹ã°
)

321 
∑ú_ty≥
 
ªsu…
(0, 
°d
::
numîic_limôs
<
sum_ty≥
>::
max
());

322 
	gªsu…
.
	gfú°
 = (
sh‹ã°
 ? 
°d
::
numîic_limôs
<
uöt
>::
max
() : 0);

324 
	g°d
::
deque
<
node_ty≥
>::
ôî©‹
 
ôî
 = 
a˘ive_nodes
.
begö
(); 
	gôî
 !a˘ive_nodes.
íd
(); ++iter)

326 
sum_ty≥
 
	gweight
 = 
this
->
gëP©hWeight
((*
ôî
).
fú°
, 
to
);

327 if(
	gweight
 > 
	gªsu…
.
	g£c⁄d
) { Ñesult; }

328 if(
	gweight
 < 
	gªsu…
.
	g£c⁄d
 ||

329 (
	gsh‹ã°
 && (*
	gôî
).
	g£c⁄d
 + 1 < 
	gªsu…
.
	gfú°
) ||

330 (!
	gsh‹ã°
 && (*
	gôî
).
	g£c⁄d
 + 1 > 
	gªsu…
.
	gfú°
))

332 
	gthis
->
	g¥ede˚ss‹s
[
to
] = (*
ôî
).
fú°
;

333 
	gªsu…
 = 
∑ú_ty≥
((*
ôî
).
£c⁄d
 + 1, 
weight
);

337  
	gªsu…
;

340 
boﬁ


341 
	gWeighãdSam∂î
::
bridge
(
uöt
 
a
, uöà
b
, uöà
c
)

348 
uöt
 
	glow
 = 
c
 + 1, 
	ghigh
 = 
this
->
nodes
 - 1, 
	gmid
 = 
low
;

349 
	glow
 < 
	ghigh
)

351 if(
	gthis
->
isSåi˘lyBëãr
(
a
, 
b
, 
mid
))

353 
	glow
 = 
mid
 + 1;

354 
	gmid
 = 
°d
::
mö
(
low
 + (
high
 -ÜowË/ 2, 
c
 + 2 * (
mid
 - c));

356 { 
	ghigh
 = 
mid
; 
	gmid
 = 
low
 + (
high
 -Üow) / 2; }

360  
	gthis
->
isSåi˘lyBëãr
(
c
, 
b
, 
high
);

366 
	gWeighãdSam∂î
::
ˇlcuœãEdges
(
weight_ty≥
* 
weights
)

369 
this
->
nodes
 = 2;

370 
uöt
 
	gi
 = 1; i < 
	gthis
->
	gsize
; i++Ë{ if(
	gweights
[
i
] > 0Ë{Åhis->
	gnodes
++; } }

371 
	gthis
->
	gnode_posôi⁄s
 = 
√w
 
uöt
[
this
->
nodes
];

372 
	gthis
->
	gnode_posôi⁄s
[0] = 0;Åhis->node_posôi⁄s[
this
->
nodes
 - 1] =Åhis->
size
;

374 
	gthis
->
	gedge_tŸÆs
 = 
√w
 
sum_ty≥
[
this
->
nodes
];

375 
	gthis
->
	gedge_tŸÆs
[0] = (
this
->
u£_psi
 ? 0 : 
weights
[0]);

376 
uöt
 
	gi
 = 1, 
	gj
 = 1; i < 
	gthis
->
	gsize
; i++)

378 if(
	gweights
[
i
] > 0Ë{ 
	gthis
->
	gedge_tŸÆs
[
j
] = 
weights
[i];Åhis->
	gnode_posôi⁄s
[j] = i; 
	gj
++; }

380 
	gthis
->
	gedge_tŸÆs
[
this
->
nodes
 - 1] = 0;

381 
	gdñëe
[] 
	gweights
;

382 
	gthis
->
	gedge_weights
 = 
√w
 
sum_ty≥
[
this
->
nodes
];

385 if(
	gthis
->
	gu£_psi
)

387 
	gthis
->
	gedge_weights
[0] = 0;

388 
uöt
 
	gi
 = 1; i < 
	gthis
->
	gnodes
; i++)

390 
	gthis
->
	gedge_weights
[
i
] = 
this
->
edge_weights
[ò- 1] +Åhis->
gëDi°™˚
(ò- 1, iË*Åhis->
	gedge_tŸÆs
[i - 1];

391 
	gthis
->
	gedge_tŸÆs
[
i
] +
this
->
edge_tŸÆs
[i - 1];

396 
	gthis
->
	gedge_weights
[
this
->
nodes
 - 1] = 0;

397 
uöt
 
	gi
 = 
this
->
nodes
 - 1; i > 0; i--)

399 
	gthis
->
	gedge_weights
[
i
 - 1] = 
this
->
edge_weights
[i] +Åhis->
gëDi°™˚
(ò- 1, iË*Åhis->
	gedge_tŸÆs
[i];

400 
	gthis
->
	gedge_tŸÆs
[
i
 - 1] +
this
->
edge_tŸÆs
[i];

405 
sum_ty≥


406 
	gWeighãdSam∂î
::
gëEdgeWeight
(
uöt
 
‰om
, uöà
to
)

408 if(
	gthis
->
	gu£_psi
)

410  
	gthis
->
	gedge_weights
[
to
] -Åhis->edge_weights[
‰om
] -

411 
	gthis
->
gëDi°™˚
(
‰om
, 
to
Ë*Åhis->
	gedge_tŸÆs
[‰om] +Åhis->
	gadju°mít
;

415  
	gthis
->
	gedge_weights
[
‰om
] -Åhis->edge_weights[
to
] -

416 
	gthis
->
gëDi°™˚
(
‰om
, 
to
Ë*Åhis->
	gedge_tŸÆs
[to] +Åhis->
	gadju°mít
;

420 
uöt


421 
	gWeighãdSam∂î
::
gëDi°™˚
(
uöt
 
‰om
, uöà
to
)

423  
	gthis
->
	gnode_posôi⁄s
[
to
] -Åhis->node_posôi⁄s[
‰om
];

426 
sum_ty≥


427 
	gWeighãdSam∂î
::
gëP©hWeight
(
uöt
 
through
, uöà
to
)

429  
	gthis
->
	g∑th_weights
[
through
] +Åhis->
gëEdgeWeight
—hrough, 
to
);

432 
boﬁ


433 
	gWeighãdSam∂î
::
isBëãr
(
uöt
 
a
, uöà
b
, uöà
to
)

435  (
	gthis
->
gëP©hWeight
(
a
, 
to
Ë<
this
->gëP©hWeight(
b
,Åo));

438 
boﬁ


439 
	gWeighãdSam∂î
::
isSåi˘lyBëãr
(
uöt
 
a
, uöà
b
, uöà
to
)

441  (
	gthis
->
gëP©hWeight
(
a
, 
to
Ë<Åhis->gëP©hWeight(
b
,Åo));

444 
boﬁ


445 
	gWeighãdSam∂î
::
isAsGood
(
uöt
 
a
, uöà
b
)

447 
sum_ty≥
 
	ga_vÆ
 = 
this
->
∑th_weights
[
a
], 
	gb_vÆ
 =Åhis->∑th_weights[
b
];

449 if(
	gthis
->
	gu£_psi
)

451 
	ga_vÆ
 +
this
->
gëDi°™˚
(
b
, 
a
Ë* 
	gthis
->
	gedge_tŸÆs
[b];

452 
	gb_vÆ
 +
this
->
edge_weights
[
a
] -Åhis->edge_weights[
b
];

453 
	gb_vÆ
 +
this
->
gëDi°™˚
(
a
,Åhis->
nodes
 - 1Ë* (
	gthis
->
	gedge_tŸÆs
[a] -Åhis->edge_tŸÆs[
b
]);

457 
	ga_vÆ
 +
this
->
gëDi°™˚
(
b
, 
a
Ë* 
	gthis
->
	gedge_tŸÆs
[this->
nodes
 - 1];

458 
	gb_vÆ
 +
this
->
edge_weights
[
b
] -Åhis->edge_weights[
a
];

461  (
	ga_vÆ
 <
b_vÆ
);

466 
	gSemiGªedySam∂î
::
SemiGªedySam∂î
(
weight_ty≥
* 
_weights
, 
uöt
 
_size
) :

467 
Sam∂î
(
_size
),

468 
weights
(0),

469 
ßm∂e_øã
(0)

471 if(
	g_weights
 =0 || 
this
->
size
 == 0)

473 
dñëe
[] 
weights
; ;

476 
	gthis
->
	gweights
 = 
√w
 
°d
::
∑ú
<
weight_ty≥
, 
	guöt
>[
this
->
size
];

477 
uöt
 
	gi
 = 0; i < 
	gthis
->
	gsize
; i++)

479 
	gthis
->
	gweights
[
i
].
	gfú°
 = 
_weights
[i];

480 
	gthis
->
	gweights
[
i
].
	g£c⁄d
 = i;

482 
	gdñëe
[] 
	g_weights
;

483 
	gthis
->
	g°©us
 = 
READY
;

486 
	gSemiGªedySam∂î
::~
SemiGªedySam∂î
()

488 
this
->
˛ónUp
();

492 
	gSemiGªedySam∂î
::
˛ónUp
()

494 
dñëe
[] 
this
->
weights
; 
	gthis
->
	gweights
 = 0;

497 
boﬁ


498 
	gSemiGªedySam∂î
::
buûdSam∂es
(
uöt
 
_ßm∂e_øã
, 
gªedöess
)

500 if(
	g_ßm∂e_øã
 =0 || 
this
->
°©us
 !
READY
 || 
gªedöess
 < 0.0 || greediness > 1.0)

502  
Ál£
;

505 
uöt
 
	gnumbî
 = (
this
->
size
 + 
_ßm∂e_øã
 - 1) / _sample_rate;

506 
	gthis
->
	gßm∂es
 = 
√w
 
∑ú_ty≥
[
numbî
];

507 if(
	ggªedöess
 =1.0Ë{ 
_ßm∂e_øã
 = 
this
->
size
; }

510 
	g_ßm∂e_øã
 = 
°d
::
mö
(()(
this
->
size
), 
_ßm∂e_øã
 / (1.0 - 
gªedöess
));

513 
	gthis
->
buûdReguœrSam∂es
(
_ßm∂e_øã
);

514 
	gthis
->
addGªedySam∂es
(
numbî
);

516 
	gthis
->
˛ónUp
();

517 
	gthis
->
	g°©us
 = 
SAMPLED
;

518  
	gåue
;

522 
	gSemiGªedySam∂î
::
buûdReguœrSam∂es
(
uöt
 
_ßm∂e_øã
)

524 
this
->
ßm∂e_øã
 = 
_ßm∂e_øã
;

525 
uöt
 
	gi
 = 0; i < 
	gthis
->
	gsize
; i +
this
->
ßm∂e_øã
)

527 
this
->
ßm∂es
[this->
numbî_of_ßm∂es
].
£c⁄d
 = 
i
;

528 
	gthis
->
	gnumbî_of_ßm∂es
++;

533 
	gSemiGªedySam∂î
::
addGªedySam∂es
(
uöt
 
tŸÆ_ßm∂es
)

535 if(
this
->
numbî_of_ßm∂es
 >
tŸÆ_ßm∂es
) { ; }

537 
	g°d
::
s‹t
(
this
->
weights
,Åhis->weight†+Åhis->
size
);

538 
uöt
 
	gi
 = 
this
->
size
 - 1; 
	gthis
->
	gnumbî_of_ßm∂es
 < 
	gtŸÆ_ßm∂es
; i--)

540 if(
	gthis
->
	gweights
[
i
].
	g£c⁄d
 %Åhis->
	gßm∂e_øã
 != 0)

542 if(
this
->
weights
[
i
].
fú°
 == 0) { ; }

543 
	gthis
->
	gßm∂es
[
this
->
numbî_of_ßm∂es
].
	g£c⁄d
 =Åhis->
weights
[
i
].
£c⁄d
;

544 
	gthis
->
	gnumbî_of_ßm∂es
++;

	@sampler.h

1 #i‚de‡
SAMPLER_H


2 
	#SAMPLER_H


	)

5 
	~<deque
>

7 
	~"misc/utûs.h
"

10 
«me•a˚
 
	gCSA


14 
uöt
 
	tweight_ty≥
;

15 
usöt
 
	tsum_ty≥
;

17 
	g°d
::
	t∑ú
<
	tuöt
, uöt> 
	tnode_ty≥
;

20 ˛as†
	cSam∂î


22 
	gpublic
:

23 
ex∂icô
 
Sam∂î
(
uöt
 
size
);

24 
	gvútuÆ
 ~
Sam∂î
();

27 
wrôeTo
(c⁄° 
°d
::
°rög
& 
ba£_«me
) const;

31 
∑ú_ty≥
* 
gëSam∂es
(
sh‹t_∑ú
* 
ß
, 
uöt
 
numbî_of_£quí˚s
, 
usöt
 
thªads
);

33 c⁄° 
uöt
 
	gNOT_READY
 = 0;

34 c⁄° 
uöt
 
	gREADY
 = 1;

35 c⁄° 
uöt
 
	gSAMPLED
 = 2;

37 
ölöe
 
uöt
 
gëSètus
(Ëc⁄° {  
	gthis
->
	g°©us
; }

38 
ölöe
 
uöt
 
gëSize
(Ëc⁄° {  
	gthis
->
	gsize
; }

39 
ölöe
 
uöt
 
gëIãms
(Ëc⁄° {  
	gthis
->
	gnumbî_of_ßm∂es
; }

41 
	g¥Ÿe˘ed
:

42 
uöt
 
size
, 
	g°©us
;

44 
∑ú_ty≥
* 
	gßm∂es
;

45 
uöt
 
	gnumbî_of_ßm∂es
;

48 
Sam∂î
();

49 
Sam∂î
(const Sampler&);

50 
	gSam∂î
& 
	g›î©‹
 = (c⁄° 
Sam∂î
&);

54 ˛as†
	cWeighãdSam∂î
 : 
public
 
Sam∂î


56 
public
:

59 
WeighãdSam∂î
(
weight_ty≥
* 
weights
, 
uöt
 
_size
, 
boﬁ
 
_u£_psi
);

60 
	gvútuÆ
 ~
WeighãdSam∂î
();

64 
boﬁ
 
buûdSam∂es
(
uöt
 
ßm∂e_øã
, 
sum_ty≥
 
öôül_adju°mít
, 
usöt
 
thªads
);

66 
	g¥iv©e
:

67 c⁄° 
usöt
 
VECTOR_BLOCK_SIZE
 = 64;

69 
boﬁ
 
	gu£_psi
;

70 
sum_ty≥
 
	gadju°mít
;

72 
sum_ty≥
* 
	g∑th_weights
;

73 
uöt
* 
	g¥ede˚ss‹s
;

88 
sum_ty≥
* 
	gedge_weights
;

89 
sum_ty≥
* 
	gedge_tŸÆs
;

91 
uöt
 
	gnodes
;

92 
uöt
* 
	gnode_posôi⁄s
;

95 
˛ónUp
();

99 
buûdP©h
(
uöt
 
löks
, uöt* 
∑th_a
, uöà
Àngth_a
, uöt* 
∑th_b
, uöà
Àngth_b
);

104 
uöt
 
möimumWeightP©h
(
boﬁ
 
sh‹ã°
, uöà
f‹˚
 = 0);

105 
node_ty≥
 
lök
(
°d
::
deque
<node_ty≥>& 
a˘ive_nodes
, 
uöt
 
to
, 
boﬁ
 
sh‹ã°
);

106 
∑ú_ty≥
 
föÆLök
(
°d
::
deque
<
node_ty≥
>& 
a˘ive_nodes
, 
uöt
 
to
, 
boﬁ
 
sh‹ã°
);

109 
boﬁ
 
bridge
(
uöt
 
a
, uöà
b
, uöà
c
);

111 
ˇlcuœãEdges
(
weight_ty≥
* 
weights
);

113 
sum_ty≥
 
gëEdgeWeight
(
uöt
 
‰om
, uöà
to
);

114 
sum_ty≥
 
gëP©hWeight
(
uöt
 
through
, uöà
to
);

116 
uöt
 
gëDi°™˚
(uöà
‰om
, uöà
to
);

119 
boﬁ
 
isBëãr
(
uöt
 
a
, uöà
b
, uöà
to
);

120 
boﬁ
 
isSåi˘lyBëãr
(
uöt
 
a
, uöà
b
, uöà
to
);

126 
boﬁ
 
isAsGood
(
uöt
 
a
, uöà
b
);

129 
WeighãdSam∂î
();

130 
WeighãdSam∂î
(const WeightedSampler&);

131 
	gWeighãdSam∂î
& 
	g›î©‹
 = (c⁄° 
WeighãdSam∂î
&);

135 ˛as†
	cSemiGªedySam∂î
 : 
public
 
Sam∂î


137 
public
:

140 
SemiGªedySam∂î
(
weight_ty≥
* 
weights
, 
uöt
 
_size
);

141 
	gvútuÆ
 ~
SemiGªedySam∂î
();

145 
boﬁ
 
buûdSam∂es
(
uöt
 
_ßm∂e_øã
, 
gªedöess
);

147 
	g¥iv©e
:

148 
°d
::
∑ú
<
weight_ty≥
, 
	guöt
>* 
	gweights
;

149 
uöt
 
	gßm∂e_øã
;

151 
˛ónUp
();

153 
buûdReguœrSam∂es
(
uöt
 
_ßm∂e_øã
);

154 
addGªedySam∂es
(
uöt
 
tŸÆ_ßm∂es
);

157 
SemiGªedySam∂î
();

158 
SemiGªedySam∂î
(const SemiGreedySampler&);

159 
	gSemiGªedySam∂î
& 
	g›î©‹
 = (c⁄° 
SemiGªedySam∂î
&);

	@sampler_test.cpp

1 
	~<cm©h
>

2 
	~<c°dlib
>

3 
	~<f°ªam
>

4 
	~<io°ªam
>

5 
	~<ve˘‹
>

7 
	~"æcß.h
"

10 
usög
 
«me•a˚
 
	gCSA
;

13 c⁄° 
∑ømëî_ty≥
 
	gINITIAL_ADJUSTMENT
 =Öarameter_type("INITIAL_ADJUSTMENT", 0);

17 
	$¥ötUßge
()

19 
°d
::
cout
 << "Ußge: sam∂î_ã° [∑ømëîs] ba£_«mêweights" << std::
ídl
;

20 
°d
::
cout
 << " -b U£ backw¨dÉdgêweight†÷oˇã f‹ LF, di•œy f‹ Psi)." << std::
ídl
;

21 
°d
::
cout
 << " -g# Sñe˘ # (ÊﬂtË∑π o‡ßm∂e†gªedûy,ándÅhêª°áàªguœ∏öãrvÆs." << std::
ídl
;

22 
°d
::
cout
 << " -m# Mu…ùly weight†by # (Êﬂt)." << std::
ídl
;

23 
°d
::
cout
 << " -t# U£ #Åhªads." << std::
ídl
;

24 
°d
::
cout
 << " -w Wrôêthêßm∂edÖosôi⁄†ötÿßm∂êfûe." << std::
ídl
;

25 
	}
}

29 
	$maö
(
¨gc
, ** 
¨gv
)

31 
°d
::
cout
 << "Sam∂îÅe°" << std::
ídl
;

32 
°d
::
cout
 << std::
ídl
;

35 
mu…ùlõr
 = 1.0, 
gªedöess
 = 0.0;

36 
boﬁ
 
gªedy
 = 
Ál£
, 
f‹w¨d
 = 
åue
, 
wrôe
 = false;

37 * 
ba£_«me
 = 0;

38 * 
weights_«me
 = 0;

39 
usöt
 
thªads
 = 1;

40 
i
 = 1; i < 
¨gc
; i++)

42 if(
¨gv
[
i
][0] == '-')

44 
¨gv
[
i
][1])

47 
f‹w¨d
 = 
Ál£
; ;

49 
gªedöess
 = 
	`©of
(
¨gv
[
i
] + 2); 
gªedy
 = 
åue
; ;

51 
mu…ùlõr
 = 
	`©of
(
¨gv
[
i
] + 2); ;

53 
thªads
 = 
	`©oi
(
¨gv
[
i
] + 2); ;

55 
wrôe
 = 
åue
; ;

57 
°d
::
cout
 << "InvÆid o±i⁄: " << 
¨gv
[
i
] << std::
ídl
 << std::endl;

58 
	`¥ötUßge
();

62 if(
ba£_«me
 == 0)

64 
ba£_«me
 = 
¨gv
[
i
];

66 if(
weights_«me
 == 0)

68 
weights_«me
 = 
¨gv
[
i
];

71 if(
weights_«me
 =0Ë{ 
	`¥ötUßge
();  2; }

73 
°d
::
cout
 << "Options:";

74 
gªedöess
 = 
°d
::
	`mö
(1.0, std::
	`max
(0.0, greediness));

75 
thªads
 = 
°d
::
	`max
—hªads, (
usöt
)1);Åhªad†°d::
	`mö
(threads, (usint)64);

76 if(!
f‹w¨d
Ë{ 
°d
::
cout
 << " backward"; }

77 if(
gªedy
Ë{ 
°d
::
cout
 << " gªedöess=" << 
gªedöess
; }

78 if(
mu…ùlõr
 < 0) { multiplier = 1.0; }

79 if(
mu…ùlõr
 !1.0Ë{ 
°d
::
cout
 << " multiplier=" << multiplier; }

80 
°d
::
cout
 << "Åhªads=" << 
thªads
;

81 if(
wrôe
Ë{ 
°d
::
cout
 << " write"; }

82 
°d
::
cout
 << std::
ídl
;

83 
°d
::
cout
 << "Ba£Çame: " << 
ba£_«me
 << std::
ídl
;

84 
°d
::
cout
 << "Weights: " << 
weights_«me
 << std::
ídl
;

85 
°d
::
cout
 << std::
ídl
;

88 
°d
::
°rög
 
∑ømëîs_«me
 = std::
	`°rög
(
ba£_«me
Ë+ 
PARAMETERS_EXTENSION
;

89 
P¨amëîs
 
∑ømëîs
;

90 
∑ømëîs
.
	`£t
(
RLCSA_BLOCK_SIZE
);

91 
∑ømëîs
.
	`£t
(
SAMPLE_RATE
);

92 
∑ømëîs
.
	`ªad
(
∑ømëîs_«me
);

93 
∑ømëîs
.
	`£t
(
SUPPORT_LOCATE
.
fú°
, 1);

94 
∑ømëîs
.
	`£t
(
SUPPORT_DISPLAY
.
fú°
, 1);

95 
∑ømëîs
.
	`£t
(
WEIGHTED_SAMPLES
.
fú°
, 1);

99 
°d
::
if°ªam
 
	`weights_fûe
(
weights_«me
, std::
ios_ba£
::
bö¨y
);

100 if(!
weights_fûe
)

102 
°d
::
˚º
 << "Eº‹ o≥nög weight†fûe!" << std::
ídl
;

106 
usöt
 
n
 = 
	`fûeSize
(
weights_fûe
Ë/ (
weight_ty≥
);

107 
weight_ty≥
* 
weights
 = 
√w
 weight_ty≥[
n
];

108 
weights_fûe
.
	`ªad
((*)
weights
, 
n
 * (
weight_ty≥
));

109 
weights_fûe
.
	`˛o£
();

110 
usöt
 
i
 = 0; i < 
n
; i++)

112 if(
weights
[
i
] >= 0)

114 
weights
[
i
] = 
	`˚û
(weights[i] * 
mu…ùlõr
);

118 
°d
::
˚º
 << "Neg©ivêvÆuêfound: weights[" << 
i
 << "] =" << 
weights
[i] << "!" << std::
ídl
;

119 
dñëe
[] 
weights
;

123 
°d
::
cout
 << "I≈uàsize: " << 
n
 << std::
ídl
;

124 
°d
::
cout
 << "Sam∂êøã: " << 
∑ømëîs
.
	`gë
(
SAMPLE_RATE
Ë<< std::
ídl
;

125 
°d
::
cout
 << std::
ídl
;

129 
°¨t
 = 
	`ªadTimî
();

130 
Sam∂î
* 
ßm∂î
 = 0;

131 if(!
gªedy
)

133 
WeighãdSam∂î
* 
wßm∂î
 = 
√w
 
	`WeighãdSam∂î
(
weights
, 
n
, 
f‹w¨d
);

134 if(!(
wßm∂î
->
	`buûdSam∂es
(
∑ømëîs
.
	`gë
(
SAMPLE_RATE
),Ö¨amëîs.gë(
INITIAL_ADJUSTMENT
), 
thªads
)))

136 
dñëe
 
wßm∂î
; wsampler = 0;

139 
ßm∂î
 = 
wßm∂î
; wsampler = 0;

143 
SemiGªedySam∂î
* 
gßm∂î
 = 
√w
 
	`SemiGªedySam∂î
(
weights
, 
n
);

144 if(!(
gßm∂î
->
	`buûdSam∂es
(
∑ømëîs
.
	`gë
(
SAMPLE_RATE
), 
gªedöess
)))

146 
dñëe
 
gßm∂î
; gsampler = 0;

149 
ßm∂î
 = 
gßm∂î
; gsampler = 0;

151 
ßm∂ed
 = 
	`ªadTimî
();

152 
usöt
 
mem‹y
 = 
	`mem‹yUßge
();

156 
°›
;

157 if(
wrôe
)

159 
°›
 = 
	`ªadTimî
();

160 
ßm∂î
->
	`wrôeTo
(
ba£_«me
);

164 
°d
::
if°ªam
 
	`öput_fûe
(
ba£_«me
, std::
ios_ba£
::
bö¨y
);

165 if(!
öput_fûe
)

167 
°d
::
˚º
 << "Eº‹ o≥nög i≈uàfûê" << 
ba£_«me
 << "!" << std::
ídl
;

170 
uch¨
* 
d©a
 = 
√w
 uch¨[
n
];

171 
öput_fûe
.
	`ªad
((*)
d©a
, 
n
);

172 
öput_fûe
.
	`˛o£
();

173 
RLCSA
 
	`æcß
(
d©a
, 
n
, 
∑ømëîs
.
	`gë
(
RLCSA_BLOCK_SIZE
),Ö¨amëîs.gë(
SAMPLE_RATE
), 
thªads
, 
ßm∂î
, 
åue
);

174 
°›
 = 
	`ªadTimî
();

175 if(
æcß
.
	`isOk
())

177 
æcß
.
	`¥ötInfo
();

178 
æcß
.
	`ªp‹tSize
(
åue
);

179 
æcß
.
	`wrôeTo
(
ba£_«me
);

182 
usöt
 
tŸÆ_mem‹y
 = 
	`mem‹yUßge
();

185 
ßm∂ög_time
 = 
ßm∂ed
 - 
°¨t
;

186 
time
 = 
°›
 - 
°¨t
;

187 
megabyãs
 = 
n
 / ()
MEGABYTE
;

188 
°d
::
cout
 << "TŸÆ: " << 
time
 << " sec⁄d†(" << (
megabyãs
 /ÅimeË<< " MB/s), " << 
tŸÆ_mem‹y
 << " kB" << std::
ídl
;

189 
°d
::
cout
 << "Sam∂ög: " << 
ßm∂ög_time
 << " sec⁄d†(" << (
megabyãs
 / sam∂ög_timeË<< " MB/s), " << 
mem‹y
 << " kB" << std::
ídl
;

190 
°d
::
cout
 << std::
ídl
;

192 
dñëe
 
ßm∂î
; sampler = 0;

194 
	}
}

	@sasamples.cpp

1 
	~<Æg‹ôhm
>

2 
	~<io°ªam
>

3 
	~<ve˘‹
>

5 
	~"ßßm∂es.h
"

6 
	~"misc/utûs.h
"

8 #ifde‡
MULTITHREAD_SUPPORT


9 
	~<omp.h
>

10 #i‚de‡
_GLIBCXX_PARALLEL


11 
	~<mc°l.h
>

16 
«me•a˚
 
	gCSA


21 
	gSASam∂es
::
SASam∂es
(
°d
::
if°ªam
& 
ßm∂e_fûe
, 
usöt
 
ßm∂e_øã
, 
boﬁ
 
_weighãd
) :

22 
weighãd
(
_weighãd
)

24 if(
this
->
weighãd
)

26 
this
->
øã
 = 1;

27 
	gßm∂e_fûe
.
ªad
((*)&(
this
->
size
), (this->size));

28 
	gßm∂e_fûe
.
ªad
((*)&(
this
->
ôems
), (this->items));

30 
∑ú_ty≥
* 
	gßm∂e_∑ús
 = 
√w
Öaú_ty≥[
this
->
ôems
];

31 
	gßm∂e_fûe
.
ªad
((*)
ßm∂e_∑ús
, 
this
->
ôems
 * (
∑ú_ty≥
));

32 
	gthis
->
buûdSam∂es
(
ßm∂e_∑ús
, 
Ál£
, 1);

33 
	gthis
->
buûdSam∂es
(
ßm∂e_∑ús
, 
åue
, 1);

34 
	gdñëe
[] 
	gßm∂e_∑ús
;

38 
	gthis
->
	gøã
 = 
ßm∂e_øã
;

39 
	gthis
->
	gödexes
 = 
√w
 
SAVe˘‹
(
ßm∂e_fûe
);

40 
	gthis
->
	gsize
 = 
ödexes
->
gëSize
();

41 
	gthis
->
	gôems
 = 
ödexes
->
gëNumbîOfIãms
();

42 
	gthis
->
	gßm∂es
 = 
√w
 
RódBuf„r
(
ßm∂e_fûe
, 
this
->
ôems
, 
Àngth
(this->items - 1));

43 
	gthis
->
buûdInvî£Sam∂es
();

47 
	gSASam∂es
::
SASam∂es
(
FILE
* 
ßm∂e_fûe
, 
usöt
 
ßm∂e_øã
, 
boﬁ
 
_weighãd
) :

48 
weighãd
(
_weighãd
)

50 if(
ßm∂e_fûe
 == 0) { ; }

52 if(
	gthis
->
	gweighãd
)

54 
	gthis
->
	gøã
 = 1;

55 if(!
	g°d
::
‰ód
(&(
this
->
size
), —his->size), 1, 
ßm∂e_fûe
)) { ; }

56 if(!
	g°d
::
‰ód
(&(
this
->
ôems
), —his->ôems), 1, 
ßm∂e_fûe
)) { ; }

58 
∑ú_ty≥
* 
	gßm∂e_∑ús
 = 
√w
Öaú_ty≥[
this
->
ôems
];

59 if(!
	g°d
::
‰ód
(
ßm∂e_∑ús
, 
this
->
ôems
 * (
∑ú_ty≥
), 1, 
ßm∂e_fûe
)) { ; }

60 
	gthis
->
buûdSam∂es
(
ßm∂e_∑ús
, 
Ál£
, 1);

61 
	gthis
->
buûdSam∂es
(
ßm∂e_∑ús
, 
åue
, 1);

62 
	gdñëe
[] 
	gßm∂e_∑ús
;

66 
	gthis
->
	gøã
 = 
ßm∂e_øã
;

67 
	gthis
->
	gödexes
 = 
√w
 
SAVe˘‹
(
ßm∂e_fûe
);

68 
	gthis
->
	gsize
 = 
ödexes
->
gëSize
();

69 
	gthis
->
	gôems
 = 
ödexes
->
gëNumbîOfIãms
();

70 
	gthis
->
	gßm∂es
 = 
√w
 
RódBuf„r
(
ßm∂e_fûe
, 
this
->
ôems
, 
Àngth
(this->items - 1));

71 
	gthis
->
buûdInvî£Sam∂es
();

75 
	gSASam∂es
::
SASam∂es
(
sh‹t_∑ú
* 
ß
, 
DñèVe˘‹
* 
íd_poöts
, 
usöt
 
d©a_size
, usöà
ßm∂e_øã
, usöà
thªads
) :

76 
weighãd
(
Ál£
),

77 
øã
(
ßm∂e_øã
),

78 
ôems
(0)

80 
usöt
 
	g£quí˚s
 = 
íd_poöts
->
gëNumbîOfIãms
();

82 
	gDñèVe˘‹
::
Iãøt‹
 
ôî
(*(
íd_poöts
));

85 
usöt
 
	g°¨t
 = 0, 
	gíd
 = 
ôî
.
£À˘
(0);

86 
usöt
 
	g£q_°¨t
 = 0, 
	g£q_íd
 = 
íd
;

87 
	g°d
::
ve˘‹
<
∑ú_ty≥
>* 
vec
 = 
√w
 
°d
::vector<pair_type>();

88 
usöt
 
	gi
 = 0; i < 
	g£quí˚s
; i++)

90 
usöt
 
	gj
 = 
£q_°¨t
; j <
£q_íd
; j +
this
->
øã
)

92 
vec
->
push_back
(
∑ú_ty≥
(
ß
[
j
].
£c⁄d
 - 
£quí˚s
, 
this
->
ôems
));

93 
	gthis
->
	gôems
++;

95 
	g°¨t
 = 
√xtMu…ùÀOf
(
this
->
øã
, 
íd
);

96 
	gíd
 = 
ôî
.
£À˘Next
();

97 
	g£q_°¨t
 = 
£q_íd
 + 2;

98 
	g£q_íd
 = 
£q_°¨t
 + 
íd
 - 
°¨t
;

100 #ifde‡
MULTITHREAD_SUPPORT


101 
omp_£t_num_thªads
(
thªads
);

103 
∑øŒñS‹t
(
vec
->
begö
(), vec->
íd
());

106 
	gthis
->
	gsize
 = 
íd
 + 1;

107 
WrôeBuf„r
 
ßm∂e_buf„r
(
this
->
ôems
, 
Àngth
(this->items - 1));

108 
	gSAVe˘‹
::
Encodî
 
ícodî
(
INDEX_BLOCK_SIZE
);

109 
usöt
 
	gi
 = 0; i < 
	gthis
->
	gôems
; i++)

111 
∑ú_ty≥
 
	gßm∂e
 = (*
vec
)[
i
];

112 
	gícodî
.
£tBô
(
ßm∂e
.
fú°
);

113 
	gßm∂e_buf„r
.
wrôeIãm
(
ßm∂e
.
£c⁄d
);

115 
dñëe
 
	gvec
;

117 
	gthis
->
	gödexes
 = 
√w
 
SAVe˘‹
(
ícodî
, 
this
->
size
);

118 
	gthis
->
	gßm∂es
 = 
ßm∂e_buf„r
.
gëRódBuf„r
();

119 
	gthis
->
buûdInvî£Sam∂es
();

122 
	gSASam∂es
::
SASam∂es
(
sh‹t_∑ú
* 
ß
, 
Sam∂î
* 
ßm∂î
, 
usöt
 
thªads
) :

123 
weighãd
(
åue
),

124 
øã
(1), 
size
(
ßm∂î
->
gëSize
()), 
ôems
(ßm∂î->
gëIãms
())

126 
∑ú_ty≥
* 
	gßm∂e_∑ús
 = 
ßm∂î
->
gëSam∂es
(
ß
, 1, 
thªads
);

127 
	gthis
->
buûdSam∂es
(
ßm∂e_∑ús
, 
Ál£
, 
thªads
);

128 
	gthis
->
buûdSam∂es
(
ßm∂e_∑ús
, 
åue
, 
thªads
);

129 
	gdñëe
[] 
	gßm∂e_∑ús
;

132 
	gSASam∂es
::
SASam∂es
(
∑ú_ty≥
* 
ßm∂e_∑ús
, 
usöt
 
d©a_size
, usöà
ßm∂e_øã
, usöà
thªads
) :

133 
weighãd
(
Ál£
),

134 
øã
(
ßm∂e_øã
), 
size
(
d©a_size
), 
ôems
((data_size + sample_rate - 1) / sample_rate)

136 #ifde‡
MULTITHREAD_SUPPORT


137 
omp_£t_num_thªads
(
thªads
);

139 
∑øŒñS‹t
(
ßm∂e_∑ús
, sam∂e_∑ú†+ 
this
->
ôems
);

142 
WrôeBuf„r
 
ßm∂e_buf„r
(
this
->
ôems
, 
Àngth
(this->items - 1));

143 
	gSAVe˘‹
::
Encodî
 
ícodî
(
INDEX_BLOCK_SIZE
);

144 
usöt
 
	gi
 = 0; i < 
	gthis
->
	gôems
; i++)

146 
	gícodî
.
£tBô
(
ßm∂e_∑ús
[
i
].
fú°
);

147 
	gßm∂e_buf„r
.
wrôeIãm
(
ßm∂e_∑ús
[
i
].
£c⁄d
 / 
this
->
øã
);

150 
	gthis
->
	gödexes
 = 
√w
 
SAVe˘‹
(
ícodî
, 
this
->
size
);

151 
	gthis
->
	gßm∂es
 = 
ßm∂e_buf„r
.
gëRódBuf„r
();

152 
	gthis
->
buûdInvî£Sam∂es
();

155 
	gSASam∂es
::
SASam∂es
(SASam∂es& 
ödex
, SASam∂es& 
ö¸emít
, 
usöt
* 
posôi⁄s
, usöà
numbî_of_posôi⁄s
, usöà
numbî_of_£quí˚s
) :

156 
weighãd
(
Ál£
),

157 
øã
(
ödex
.rate),

158 
size
(
ödex
.sizê+ 
ö¸emít
.size),

159 
ôems
(
ödex
.ôem†+ 
ö¸emít
.items)

161 
	gthis
->
mîgeSam∂es
(
ödex
, 
ö¸emít
, 
posôi⁄s
, 
numbî_of_posôi⁄s
, 
numbî_of_£quí˚s
);

162 
	gthis
->
buûdInvî£Sam∂es
();

165 
	gSASam∂es
::~
SASam∂es
()

167 
dñëe
 
this
->
ödexes
; 
	gthis
->
	gödexes
 = 0;

168 
dñëe
 
	gthis
->
	gßm∂es
;Åhis->samples = 0;

169 
dñëe
 
	gthis
->
	gövî£_ödexes
;Åhis->inverse_indexes = 0;

170 
dñëe
 
	gthis
->
	gövî£_ßm∂es
;Åhis->inverse_samples = 0;

176 
	gSASam∂es
::
wrôeTo
(
°d
::
of°ªam
& 
ßm∂e_fûe
) const

178 if(
this
->
weighãd
)

180 
ßm∂e_fûe
.
wrôe
((*)&(
this
->
size
), (this->size));

181 
	gßm∂e_fûe
.
wrôe
((*)&(
this
->
ôems
), (this->items));

183 
	gSAVe˘‹
::
Iãøt‹
 
ôî
(*(
this
->
ödexes
));

184 
∑ú_ty≥
 
buf„r
(
ôî
.
£À˘
(0), 
this
->
ßm∂es
->
ªadIãm
(0));

185 
usöt
 
	gi
 = 0; i < 
	gthis
->
	gôems
; i++)

187 
	gßm∂e_fûe
.
wrôe
((*)&
buf„r
, (buffer));

188 
	gbuf„r
.
	gfú°
 = 
ôî
.
£À˘Next
();

189 
	gbuf„r
.
	g£c⁄d
 = 
this
->
ßm∂es
->
ªadIãm
();

194 
	gthis
->
	gödexes
->
wrôeTo
(
ßm∂e_fûe
);

195 
	gthis
->
	gßm∂es
->
wrôeBuf„r
(
ßm∂e_fûe
);

200 
	gSASam∂es
::
wrôeTo
(
FILE
* 
ßm∂e_fûe
) const

202 if(
ßm∂e_fûe
 == 0) { ; }

204 if(
	gthis
->
	gweighãd
)

206 
	g°d
::
fwrôe
(&(
this
->
size
), —his->size), 1, 
ßm∂e_fûe
);

207 
	g°d
::
fwrôe
(&(
this
->
ôems
), —his->ôems), 1, 
ßm∂e_fûe
);

209 
	gSAVe˘‹
::
Iãøt‹
 
ôî
(*(
this
->
ödexes
));

210 
∑ú_ty≥
 
buf„r
(
ôî
.
£À˘
(0), 
this
->
ßm∂es
->
ªadIãm
(0));

211 
usöt
 
	gi
 = 0; i < 
	gthis
->
	gôems
; i++)

213 
	g°d
::
fwrôe
(&
buf„r
, (buf„r), 1, 
ßm∂e_fûe
);

214 
	gbuf„r
.
	gfú°
 = 
ôî
.
£À˘Next
();

215 
	gbuf„r
.
	g£c⁄d
 = 
this
->
ßm∂es
->
ªadIãm
();

220 
	gthis
->
	gödexes
->
wrôeTo
(
ßm∂e_fûe
);

221 
	gthis
->
	gßm∂es
->
wrôeBuf„r
(
ßm∂e_fûe
);

225 
usöt


226 
	gSASam∂es
::
ªp‹tSize
() const

228 
usöt
 
byãs
 = (*
this
);

229 
	gbyãs
 +
this
->
ödexes
->
ªp‹tSize
();

230 
	gbyãs
 +
this
->
ßm∂es
->
ªp‹tSize
();

231 if(
	gthis
->
	gweighãd
Ë{ 
	gbyãs
 +
this
->
övî£_ödexes
->
ªp‹tSize
(); }

232 
	gbyãs
 +
this
->
övî£_ßm∂es
->
ªp‹tSize
();

233  
	gbyãs
;

238 
∑ú_ty≥


239 
	gSASam∂es
::
övî£SA
(
usöt
 
vÆue
) const

241 if(
vÆue
 >
this
->
size
Ë{  
∑ú_ty≥
(this->size,Åhis->size); }

243 
∑ú_ty≥
 
	gªsu…
;

244 if(
	gthis
->
	gweighãd
)

246 
	gSAVe˘‹
::
Iãøt‹
 
ôî
(*(
this
->
övî£_ödexes
));

247 
	gªsu…
.
	gfú°
 = 
ôî
.
ønk
(
vÆue
) - 1;

248 
	gªsu…
.
	g£c⁄d
 = 
this
->
övî£_ßm∂es
->
ªadIãmC⁄°
(
ªsu…
.
fú°
);

249 
	gªsu…
.
	gfú°
 = 
ôî
.
£À˘
(
ªsu…
.
fú°
);

253 
	gSAVe˘‹
::
Iãøt‹
 
ôî
(*(
this
->
ödexes
));

254 
	gªsu…
.
	gfú°
 = 
vÆue
 - (vÆuê% 
this
->
øã
);

255 
	gªsu…
.
	g£c⁄d
 = 
ôî
.
£À˘
(
this
->
övî£_ßm∂es
->
ªadIãmC⁄°
(
vÆue
 /Åhis->
øã
));

258  
	gªsu…
;

264 
	gSASam∂es
::
buûdInvî£Sam∂es
()

266 
WrôeBuf„r
 
övî£_buf„r
(
this
->
ôems
, 
Àngth
(this->items - 1));

267 
	gthis
->
	gßm∂es
->
goToIãm
(0);

268 
usöt
 
	gi
 = 0; i < 
	gthis
->
	gôems
; i++)

270 
	gövî£_buf„r
.
goToIãm
(
this
->
ßm∂es
->
ªadIãm
());

271 
	gövî£_buf„r
.
wrôeIãm
(
i
);

274 
	gthis
->
	gövî£_ödexes
 = 0;

275 
	gthis
->
	gövî£_ßm∂es
 = 
övî£_buf„r
.
gëRódBuf„r
();

279 
	gSASam∂es
::
buûdSam∂es
(
∑ú_ty≥
* 
ßm∂e_∑ús
, 
boﬁ
 
övî£
, 
usöt
 
thªads
)

281 if(
	gövî£
)

283 
usöt
 
	gi
 = 0; i < 
	gthis
->
	gôems
; i++)

285 
	g°d
::
sw≠
(
ßm∂e_∑ús
[
i
].
fú°
, sam∂e_∑ús[i].
£c⁄d
);

288 #ifde‡
MULTITHREAD_SUPPORT


289 
omp_£t_num_thªads
(
thªads
);

291 
∑øŒñS‹t
(
ßm∂e_∑ús
, sam∂e_∑ú†+ 
this
->
ôems
);

293 
	gSAVe˘‹
::
Encodî
 
ícodî
(
INDEX_BLOCK_SIZE
);

294 
WrôeBuf„r
 
ßm∂e_buf„r
(
this
->
ôems
, 
Àngth
—his->
size
 - 1));

295 
usöt
 
	gi
 = 0; i < 
	gthis
->
	gôems
; i++)

297 
	gícodî
.
£tBô
(
ßm∂e_∑ús
[
i
].
fú°
);

298 
	gßm∂e_buf„r
.
wrôeIãm
(
ßm∂e_∑ús
[
i
].
£c⁄d
);

305 if(
	gövî£
)

307 
	gthis
->
	gövî£_ödexes
 = 
√w
 
SAVe˘‹
(
ícodî
, 
this
->
size
);

308 
	gthis
->
	gövî£_ßm∂es
 = 
ßm∂e_buf„r
.
gëRódBuf„r
();

312 
	gthis
->
	gödexes
 = 
√w
 
SAVe˘‹
(
ícodî
, 
this
->
size
);

313 
	gthis
->
	gßm∂es
 = 
ßm∂e_buf„r
.
gëRódBuf„r
();

320 
	gSASam∂es
::
°rù
()

322 
dñëe
 
this
->
övî£_ßm∂es
; 
	gthis
->
	gövî£_ßm∂es
 = 0;

323 
	gthis
->
	gödexes
->
°rù
();

329 
	gSASam∂es
::
mîgeSam∂es
(
SASam∂es
& 
ödex
, SASam∂es& 
ö¸emít
, 
usöt
* 
posôi⁄s
, usöà
n
, usöà
skù
)

331 if(
	gödex
.
isWeighãd
(Ë|| 
	gö¸emít
.isWeighted())

333 
	g°d
::
˚º
 << "Eº‹: C™nŸ mîgêweighãd sam∂es!" << 
°d
::
ídl
;

337 
	gSAVe˘‹
::
Iãøt‹
 
fú°
(*(
ödex
.
ödexes
));

338 
	gSAVe˘‹
::
Iãøt‹
 
£c⁄d
(*(
ö¸emít
.
ödexes
));

339 
RódBuf„r
* 
	gfú°_ßm∂es
 = 
ödex
.
ßm∂es
;

340 
RódBuf„r
* 
	g£c⁄d_ßm∂es
 = 
ö¸emít
.
ßm∂es
;

342 
usöt
 
	gfú°_bô
 = 
fú°
.
£À˘
(0);

343 
boﬁ
 
	gfú°_föished
 = 
Ál£
;

344 
usöt
 
	g£c⁄d_bô
 = 
£c⁄d
.
£À˘
(0);

345 
usöt
 
	gsum
 = 
ödex
.
ôems
;

346 
	gfú°_ßm∂es
->
goToIãm
(0);

347 
	g£c⁄d_ßm∂es
->
goToIãm
(0);

349 
	gSAVe˘‹
::
Encodî
 
ícodî
(
INDEX_BLOCK_SIZE
);

350 
WrôeBuf„r
 
ßm∂e_buf„r
(
this
->
ôems
, 
Àngth
(this->items - 1));

351 
usöt
 
	gi
 = 0; i < 
	gn
; i++, 
	gfú°_bô
++)

353 !
	gfú°_föished
 && 
	gfú°_bô
 < 
	gposôi⁄s
[
i
] - 
	gskù
)

355 
	gícodî
.
£tBô
(
fú°_bô
);

356 
	gßm∂e_buf„r
.
wrôeIãm
(
fú°_ßm∂es
->
ªadIãm
());

357 if(
	gfú°
.
hasNext
())

359 
	gfú°_bô
 = 
fú°
.
£À˘Next
(Ë+ 
i
;

363 
	gfú°_föished
 = 
åue
;

367 if(
	gi
 =
£c⁄d_bô
)

369 
ícodî
.
£tBô
(
posôi⁄s
[
i
] - 
skù
);

370 
	gßm∂e_buf„r
.
wrôeIãm
(
£c⁄d_ßm∂es
->
ªadIãm
(Ë+ 
sum
);

371 
	g£c⁄d_bô
 = 
£c⁄d
.
£À˘Next
();

375 !
	gfú°_föished
)

377 
	gícodî
.
£tBô
(
fú°_bô
);

378 
	gßm∂e_buf„r
.
wrôeIãm
(
fú°_ßm∂es
->
ªadIãm
());

379 if(!
	gfú°
.
hasNext
()) { ; }

380 
	gfú°_bô
 = 
fú°
.
£À˘Next
(Ë+ 
n
;

383 
dñëe
 
	gödex
.
	gödexes
; index.indexes = 0;

384 
dñëe
 
	gödex
.
	gßm∂es
; index.samples = 0;

385 
dñëe
 
	gö¸emít
.
	gödexes
; increment.indexes = 0;

386 
dñëe
 
	gö¸emít
.
	gßm∂es
; increment.samples = 0;

388 
	gthis
->
	gödexes
 = 
√w
 
SAVe˘‹
(
ícodî
, 
size
);

389 
	gthis
->
	gßm∂es
 = 
ßm∂e_buf„r
.
gëRódBuf„r
();

	@sasamples.h

1 #i‚de‡
SASAMPLES_H


2 
	#SASAMPLES_H


	)

4 
	~<c°dio
>

5 
	~<f°ªam
>

7 
	~"ßm∂î.h
"

8 
	~"misc/utûs.h
"

9 
	~"bôs/bôbuf„r.h
"

11 
	~"bôs/dñève˘‹.h
"

13 #ifde‡
SUCCINCT_SA_VECTOR


14 
	~"bôs/succö˘ve˘‹.h
"

17 
«me•a˚
 
	gCSA


21 #ifde‡
SUCCINCT_SA_VECTOR


22 
Succö˘Ve˘‹
 
	tSAVe˘‹
;

24 
DñèVe˘‹
 
	tSAVe˘‹
;

28 ˛as†
	cSASam∂es


30 
	gpublic
:

31 #ifde‡
SUCCINCT_SA_VECTOR


32 c⁄° 
usöt
 
INDEX_BLOCK_SIZE
 = 32;

34 c⁄° 
usöt
 
	gINDEX_BLOCK_SIZE
 = 16;

37 
SASam∂es
(
°d
::
if°ªam
& 
ßm∂e_fûe
, 
usöt
 
ßm∂e_øã
, 
boﬁ
 
_weighãd
);

38 
SASam∂es
(
FILE
* 
ßm∂e_fûe
, 
usöt
 
ßm∂e_øã
, 
boﬁ
 
_weighãd
);

41 
SASam∂es
(
sh‹t_∑ú
* 
ß
, 
DñèVe˘‹
* 
íd_poöts
, 
usöt
 
d©a_size
, usöà
ßm∂e_øã
, usöà
thªads
);

42 
SASam∂es
(
sh‹t_∑ú
* 
ß
, 
Sam∂î
* 
ßm∂î
, 
usöt
 
thªads
);

45 
SASam∂es
(
∑ú_ty≥
* 
ßm∂e_∑ús
, 
usöt
 
d©a_size
, usöà
ßm∂e_øã
, usöà
thªads
);

47 ~
SASam∂es
();

53 
SASam∂es
(SASam∂es& 
ödex
, SASam∂es& 
ö¸emít
, 
usöt
* 
posôi⁄s
, usöà
numbî_of_posôi⁄s
, usöà
numbî_of_£quí˚s
);

55 
wrôeTo
(
°d
::
of°ªam
& 
ßm∂e_fûe
) const;

56 
wrôeTo
(
FILE
* 
ßm∂e_fûe
) const;

61 
∑ú_ty≥
 
övî£SA
(
usöt
 
vÆue
) const;

64 
ölöe
 
usöt
 
gëSam∂e
(usöà
i
) const

66  
	g°d
::
mö
(
this
->
ßm∂es
->
ªadIãmC⁄°
(
i
Ë*Åhis->
øã
,Åhis->
size
 - 1);

70 
ölöe
 
∑ú_ty≥
 
gëFú°Sam∂eA·î
(
usöt
 
ödex
) const

72 
	gSAVe˘‹
::
Iãøt‹
 
ôî
(*(
this
->
ödexes
));

73  
	gôî
.
vÆueA·î
(
ödex
);

76 
ölöe
 
boﬁ
 
isSam∂ed
(
usöt
 
ödex
) const

78 
	gSAVe˘‹
::
Iãøt‹
 
ôî
(*(
this
->
ödexes
));

79  
	gôî
.
isSë
(
ödex
);

82 
ölöe
 
usöt
 
gëSam∂eAt
(usöà
ödex
) const

84 
	gSAVe˘‹
::
Iãøt‹
 
ôî
(*(
this
->
ödexes
));

85  
	gthis
->
gëSam∂e
(
ôî
.
ønk
(
ödex
) - 1);

88 
ölöe
 
usöt
 
gëSam∂eR©e
(Ëc⁄° {  
	gthis
->
	gøã
; }

89 
ölöe
 
usöt
 
gëNumbîOfSam∂es
(Ëc⁄° {  
	gthis
->
	gôems
; }

91 
ölöe
 
boﬁ
 
isWeighãd
(Ëc⁄° {  
	gthis
->
	gweighãd
; }

92 
ölöe
 
boﬁ
 
suµ‹tsLoˇã
(Ëc⁄° {  (
	gthis
->
	gßm∂es
 != 0); }

93 
ölöe
 
boﬁ
 
suµ‹tsDi•œy
(Ëc⁄° {  (
	gthis
->
	gövî£_ßm∂es
 != 0); }

95 
usöt
 
ªp‹tSize
() const;

98 
°rù
();

100 
	g¥iv©e
:

101 
boﬁ
 
weighãd
;

102 
usöt
 
	gøã
, 
	gsize
, 
	gôems
;

104 
SAVe˘‹
* 
	gödexes
;

105 
RódBuf„r
* 
	gßm∂es
;

107 
SAVe˘‹
* 
	gövî£_ödexes
;

108 
RódBuf„r
* 
	gövî£_ßm∂es
;

110 
buûdInvî£Sam∂es
();

113 
buûdSam∂es
(
∑ú_ty≥
* 
ßm∂e_∑ús
, 
boﬁ
 
övî£
, 
usöt
 
thªads
);

116 
mîgeSam∂es
(
SASam∂es
& 
ödex
, SASam∂es& 
ö¸emít
, 
usöt
* 
posôi⁄s
, usöà
n
, usöà
skù
);

119 
SASam∂es
();

120 
SASam∂es
(const SASamples&);

121 
	gSASam∂es
& 
	g›î©‹
 = (c⁄° 
SASam∂es
&);

	@ss_test.cpp

1 
	~<c°dlib
>

2 
	~<f°ªam
>

3 
	~<io°ªam
>

5 
	~"misc/utûs.h
"

7 #ifde‡
MULTITHREAD_SUPPORT


8 
	~<omp.h
>

9 c⁄° 
	gMAX_THREADS
 = 64;

13 
usög
 
«me•a˚
 
	gCSA
;

16 
	$maö
(
¨gc
, ** 
¨gv
)

18 
°d
::
cout
 << "P¨ÆÀ»suffix s‹àã°" << std::
ídl
;

19 if(
¨gc
 < 2)

21 
°d
::
cout
 << "Ußge: ss_ã° ba£_«mê[thªads]" << std::
ídl
;

25 
°d
::
cout
 << "Ba£Çame: " << 
¨gv
[1] << std::
ídl
;

26 
uöt
 
thªads
 = 1;

27 if(
¨gc
 >3Ë{ 
thªads
 = 
°d
::
	`mö
(°d::
	`max
(
	`©oi
(
¨gv
[2]), 1), 
MAX_THREADS
); }

28 
°d
::
cout
 << "Thªads: " << 
thªads
 << std::
ídl
;

29 
°d
::
cout
 << std::
ídl
;

31 
°d
::
if°ªam
 
	`öput
(
¨gv
[1], std::
ios_ba£
::
bö¨y
);

32 if(!
öput
)

34 
°d
::
˚º
 << "Eº‹: C™nŸ o≥¿öpuàfûê" << 
¨gv
[1] << "!" << std::
ídl
;

37 
uöt
 
n
 = 
	`fûeSize
(
öput
);

38 
uch¨
* 
d©a
 = 
√w
 uch¨[
n
];

39 
öput
.
	`ªad
((*)
d©a
, 
n
);

40 
öput
.
	`˛o£
();

42 
n
++;

43 
usöt
* 
£quí˚
 = 
√w
 usöt[
n
];

44 
uöt
 
i
 = 0; i < 
n
 - 1; i++Ë{ 
£quí˚
[i] = 
d©a
[i] + 1; }

45 
£quí˚
[
n
 - 1] = 0;

46 
dñëe
[] 
d©a
; data = 0;

48 
°¨t
 = 
	`ªadTimî
();

49 
sh‹t_∑ú
* 
ªsu…
 = 
	`sim∂eSuffixS‹t
(
£quí˚
, 
n
, 
thªads
);

50 
dñëe
[] 
ªsu…
;Ñesult = 0;

51 
time
 = 
	`ªadTimî
(Ë- 
°¨t
;

53 
megabyãs
 = (
n
 - 1Ë/ ()
MEGABYTE
;

54 
°d
::
cout
 << 
megabyãs
 << " megabyã†ö " << 
time
 << " sec⁄d†(" << (megabyã†/ÅimeË<< " MB/s)" << std::
ídl
;

55 
°d
::
cout
 << "Mem‹y: " << 
	`mem‹yUßge
(Ë<< " kB" << std::
ídl
;

56 
°d
::
cout
 << std::
ídl
;

59 
	}
}

	@suffixarray.cpp

1 
	~<f°ªam
>

2 
	~<io°ªam
>

4 
	~"misc/utûs.h
"

5 
	~"suffix¨øy.h
"

8 
«me•a˚
 
	gCSA


13 
	gSuffixAºay
::
SuffixAºay
(c⁄° 
°d
::
°rög
& 
ba£_«me
, 
boﬁ
 
¥öt
) :

14 
ok
(
Ál£
),

15 
d©a
(0), 
ß
(0), 
‹igöÆ_ß
(0), 
ønks
(0), 
d©a_size
(0),

16 
£quí˚s
(0)

18 
	g°d
::
if°ªam
 
d©a_fûe
(
ba£_«me
.
c_°r
(), 
°d
::
ios_ba£
::
bö¨y
);

19 if(!
	gd©a_fûe
)

21 
	g°d
::
˚º
 << "Eº‹: C™nŸ o≥¿d©®fûê" << 
ba£_«me
 << "!" << 
°d
::
ídl
;

24 
	gthis
->
	gd©a_size
 = 
fûeSize
(
d©a_fûe
);

25 
	gthis
->
	gd©a
 = 
√w
 
uch¨
[
this
->
d©a_size
];

26 
	gd©a_fûe
.
ªad
((*)(
this
->
d©a
), 
d©a_size
);

27 
	gd©a_fûe
.
˛o£
();

29 
	g°d
::
°rög
 
ß_«me
 = 
ba£_«me
 + 
SA_EXTENSION
;

30 
	g°d
::
if°ªam
 
ß_fûe
(
ß_«me
.
c_°r
(), 
°d
::
ios_ba£
::
bö¨y
);

31 if(!
	gß_fûe
)

33 
	g°d
::
˚º
 << "Eº‹: C™nŸ o≥¿suffixáºay fûê" << 
ß_«me
 << "!" << 
°d
::
ídl
;

36 
	gß_fûe
.
ªad
((*)&(
this
->
£quí˚s
), (
uöt
));

37 
	gthis
->
	gß
 = 
√w
 
uöt
[
this
->
d©a_size
];

38 
	gß_fûe
.
ªad
((*)(
this
->
ß
),Åhis->
d©a_size
 * (
uöt
));

39 
	gß_fûe
.
˛o£
();

41 
	gthis
->
	g‹igöÆ_ß
 = 
this
->
ß
;Åhis->
	gß
 +this->
£quí˚s
;

42 
	gthis
->
	gok
 = 
åue
;

45 
	gSuffixAºay
::
SuffixAºay
(
uch¨
* 
_d©a
, 
uöt
 
byãs
, uöà
thªads
) :

46 
ok
(
Ál£
),

47 
d©a
(
_d©a
), 
ß
(0), 
‹igöÆ_ß
(0), 
ønks
(0), 
d©a_size
(
byãs
),

48 
£quí˚s
(0)

50 if(
	g_d©a
 =0 || 
byãs
 == 0)

52 
°d
::
˚º
 << "Eº‹: Nÿöpuàd©®giví f‹ suffixáºay c⁄°ru˘i⁄!" << std::
ídl
;

56 
uöt
 
	gi
 = 0; i < 
	gthis
->
	gd©a_size
; i++Ë{ if—his->
	gd©a
[
i
] ='\0'Ë{ 
this
->
£quí˚s
++; } }

57 if(
	gthis
->
	gd©a
[
this
->
d©a_size
 - 1] != '\0')

59 
°d
::
˚º
 << "Eº‹: I≈uàd©®mu°Énd wôh \\0!" << std::
ídl
;

63 
sh‹t_∑ú
* 
	g∑ús
 = 
sim∂eSuffixS‹t
(
this
->
d©a
,Åhis->
d©a_size
,Åhis->
£quí˚s
, 
thªads
);

64 
	gthis
->
	gß
 = 
√w
 
uöt
[
this
->
d©a_size
];

65 
uöt
 
	gi
 = 0; i < 
	gthis
->
	gd©a_size
; i++Ë{Åhis->
	gß
[
i
] = 
∑ús
[i].
fú°
; }

66 
	gdñëe
[] 
	g∑ús
;

68 
	gthis
->
	g‹igöÆ_ß
 = 
this
->
ß
;Åhis->
	gß
 +this->
£quí˚s
;

69 
	gthis
->
	gok
 = 
åue
;

72 
	gSuffixAºay
::
SuffixAºay
(
uch¨
* 
_d©a
, 
usöt
* 
ø
, 
uöt
 
byãs
, uöà
thªads
) :

73 
ok
(
Ál£
),

74 
d©a
(
_d©a
), 
ß
(0), 
‹igöÆ_ß
(0), 
ønks
(
ø
), 
d©a_size
(
byãs
),

75 
£quí˚s
(0)

77 if(
	g_d©a
 =0 || 
ø
 =0 || 
byãs
 == 0)

79 
°d
::
˚º
 << "Eº‹: Nÿöpuàd©®giví f‹ suffixáºay c⁄°ru˘i⁄!" << std::
ídl
;

83 
uöt
 
	gi
 = 0; i < 
	gthis
->
	gd©a_size
; i++Ë{ if—his->
	gd©a
[
i
] ='\0'Ë{ 
this
->
£quí˚s
++; } }

84 if(
	gthis
->
	gd©a
[
this
->
d©a_size
 - 1] != '\0')

86 
°d
::
˚º
 << "Eº‹: I≈uàd©®mu°Énd wôh \\0!" << std::
ídl
;

90 
∑ú_ty≥
* 
	g∑ús
 = 
√w
Öaú_ty≥[
this
->
d©a_size
];

91 
usöt
 
	gi
 = 0; i < 
	gthis
->
	gd©a_size
; i++Ë{ 
	g∑ús
[
i
] = 
∑ú_ty≥
(
this
->
ønks
[i], i); }

92 #ifde‡
MULTITHREAD_SUPPORT


93 
omp_£t_num_thªads
(
thªads
);

95 
∑øŒñS‹t
(
∑ús
,Öaú†+ 
this
->
d©a_size
);

96 
	gthis
->
	gß
 = 
√w
 
uöt
[
this
->
d©a_size
];

97 
uöt
 
	gi
 = 0; i < 
	gthis
->
	gd©a_size
; i++Ë{Åhis->
	gß
[
i
] = 
∑ús
[i].
£c⁄d
; }

98 
	gdñëe
[] 
	g∑ús
;

100 
	gthis
->
	g‹igöÆ_ß
 = 
this
->
ß
;Åhis->
	gß
 +this->
£quí˚s
;

101 
	gthis
->
	gok
 = 
åue
;

104 
	gSuffixAºay
::~
SuffixAºay
()

106 
dñëe
[] 
this
->
d©a
; 
	gthis
->
	gd©a
 = 0;

107 
	gdñëe
[] 
	gthis
->
	g‹igöÆ_ß
;Åhis->
	gß
 = 0;Åhis->original_sa = 0;

108 
	gdñëe
[] 
	gthis
->
	gønks
;Åhis->ranks = 0;

109 
	gthis
->
	gok
 = 
Ál£
;

113 
	gSuffixAºay
::
wrôeTo
(c⁄° 
°d
::
°rög
& 
ba£_«me
, 
boﬁ
 
wrôe_d©a
) const

115 if(!
	gthis
->
	gok
) { ; }

117 if(
	gwrôe_d©a
)

119 
	g°d
::
of°ªam
 
d©a_fûe
(
ba£_«me
.
c_°r
(), 
°d
::
ios_ba£
::
bö¨y
);

120 if(!
	gd©a_fûe
)

122 
	g°d
::
˚º
 << "Eº‹: C™nŸ o≥¿d©®fûê" << 
ba£_«me
 << "!" << 
°d
::
ídl
;

125 
	gd©a_fûe
.
wrôe
((*)(
this
->
d©a
),Åhis->
d©a_size
);

126 
	gd©a_fûe
.
˛o£
();

129 
	g°d
::
°rög
 
ß_«me
 = 
ba£_«me
 + 
SA_EXTENSION
;

130 
	g°d
::
of°ªam
 
ß_fûe
(
ß_«me
.
c_°r
(), 
°d
::
ios_ba£
::
bö¨y
);

131 if(!
	gß_fûe
)

133 
	g°d
::
˚º
 << "Eº‹: C™nŸ o≥¿suffixáºay fûê" << 
ß_«me
 << "!" << 
°d
::
ídl
;

136 
	gß_fûe
.
wrôe
((*)&(
this
->
£quí˚s
), (
uöt
));

137 
	gß_fûe
.
wrôe
((*)(
this
->
‹igöÆ_ß
),Åhis->
d©a_size
 * (
uöt
));

138 
	gß_fûe
.
˛o£
();

143 
∑ú_ty≥


144 
	gSuffixAºay
::
cou¡
(c⁄° 
°d
::
°rög
& 
∑âîn
) const

146 
∑ú_ty≥
 
ønge
;

147 
uöt
 
	gi
 = 0; i < 
	g∑âîn
.
Àngth
(); i++)

149 if(
	g∑âîn
[
i
] == '\0')

151 
°d
::
˚º
 << "Eº‹: P©ã∫ mu°ÇŸ c⁄èö \\0!" << std::
ídl
;

152  
	gEMPTY_PAIR
;

157 
söt
 
	glow
 = 0, 
	ghigh
 = 
this
->
gëSize
() - 1;

158 
uöt
 
	gœ°_high
 = 
high
;

159 
	glow
 < 
	ghigh
)

161 
uöt
 
	gmid
 = 
low
 + (
high
 -Üow) / 2;

162 
uöt
 
	gm©ched
 = 
this
->
m©ch
(
∑âîn
, 
mid
);

163 if(
	gm©ched
 >
∑âîn
.
Àngth
()Ë{ 
high
 = 
mid
; }

164 if((
	guch¨
)(
	g∑âîn
[
m©ched
]Ë< 
	gthis
->
	gd©a
[
this
->
ß
[
mid
] + 
	gm©ched
])

166 
	ghigh
 = ((
söt
)
mid
Ë- 1; 
	gœ°_high
 = 
high
;

168 { 
	glow
 = 
mid
 + 1; }

170 if(
	gthis
->
m©ch
(
∑âîn
, 
low
Ë=∑âîn.
Àngth
()Ë{ 
ønge
.
fú°
 =Üow; }

171 {  
	gEMPTY_PAIR
; }

174 
	ghigh
 = 
œ°_high
;

175 
	glow
 < 
	ghigh
)

177 
uöt
 
	gmid
 = 
low
 + (
high
 -Üow + 1) / 2;

178 
uöt
 
	gm©ched
 = 
this
->
m©ch
(
∑âîn
, 
mid
);

179 if(
	gm©ched
 >
∑âîn
.
Àngth
()Ë{ 
low
 = 
mid
; }

180 { 
	ghigh
 = 
mid
 - 1; }

182 
	gønge
.
	g£c⁄d
 = 
high
;

184  
	gønge
;

187 
uöt


188 
	gSuffixAºay
::
m©ch
(c⁄° 
°d
::
°rög
& 
∑âîn
, 
uöt
 
ödex
) const

190 
uöt
 
	gm©ched
 = 0;

191 
uöt
 
	gpos
 = 
this
->
ß
[
ödex
]; 
	gm©ched
 < 
	g∑âîn
.
Àngth
(Ë&& (
	guch¨
)’©ã∫[
m©ched
]Ë=this->
d©a
[
pos
]; matched++,Öos++);

192  
	gm©ched
;

195 
uöt
*

196 
	gSuffixAºay
::
loˇã
(
∑ú_ty≥
 
ønge
) const

198 if(
isEm±y
(
ønge
Ë||Ñ™ge.
£c⁄d
 >
this
->
gëSize
()) {  0; }

200 
uöt
* 
	gªsu…
 = 
√w
 uöt[
Àngth
(
ønge
)];

201 
usöt
 
	gi
 = 
ønge
.
fú°
; i <ønge.
£c⁄d
; i++Ë{ 
	gªsu…
[
i
 -Ñ™ge.fú°] = 
this
->
ß
[i]; }

202  
	gªsu…
;

205 
uöt


206 
	gSuffixAºay
::
loˇã
(
uöt
 
ödex
) const

208 if(
ödex
 >
this
->
gëSize
()Ë{ Åhis->
d©a_size
; }

209  
	gthis
->
	gß
[
ödex
];

214 
uöt
*

215 
	gSuffixAºay
::
gëLCPAºay
(
boﬁ
 
gëPLCP
) const

217 if(!(
this
->
isOk
())) {  0; }

219 
uöt
* 
	g∂˝
 = 
√w
 uöt[
this
->
d©a_size
];

220 
uöt
 
	gi
 = 0; i < 
	gthis
->
	gd©a_size
; i++Ë{ 
	g∂˝
[
i
] = 
this
->
d©a_size
; }

223 
uöt
 
	gi
 = 0; i < 
	gthis
->
	g£quí˚s
; i++)

225 
	g∂˝
[
this
->
‹igöÆ_ß
[
i
]] = 0;

227 
uöt
 
	gi
 = 
this
->
£quí˚s
; i < 
	gthis
->
	gd©a_size
; i++)

229 
uöt
 
	gj
 = 
this
->
‹igöÆ_ß
[
i
 - 1], 
	gk
 =Åhis->original_sa[i];

230 if(
	gj
 =0 || 
k
 =0 || 
this
->
d©a
[
j
 - 1] !=Åhis->data[k - 1] ||Åhis->data[j - 1] == 0)

232 
uöt
 
ãmp
 = 0;

233 
	gthis
->
	gd©a
[
j
 + 
ãmp
] =
this
->
d©a
[
k
 +Åemp] &&Åhis->data[j +Åemp] != 0) {Åemp++; }

234 
	g∂˝
[
k
] = 
ãmp
;

239 
uöt
 
	gi
 = 1; i < 
	gthis
->
	gd©a_size
; i++)

241 if(
	g∂˝
[
i
] >
this
->
d©a_size
Ë{ 
∂˝
[i] =Ölcp[i - 1] - 1; }

243 if(
	ggëPLCP
Ë{  
	g∂˝
; }

246 
uöt
* 
	gl˝
 = 
√w
 uöt[
this
->
gëSize
()];

247 
uöt
 
	gi
 = 0; i < 
	gthis
->
gëSize
(); i++)

249 
	gl˝
[
i
] = 
∂˝
[
this
->
ß
[i]];

251 
	gdñëe
[] 
	g∂˝
;

253  
	gl˝
;

258 
usöt


259 
	gSuffixAºay
::
ªp‹tSize
(
boﬁ
 
¥öt
) const

261 
usöt
 
byãs
 = (*
this
Ë+Åhis->
d©a_size
 * (1 + (
uöt
));

262 if(
	gthis
->
	gønks
 !0Ë{ 
byãs
 +
this
->
d©a_size
 + (
usöt
); }

263 if(
	g¥öt
)

265 
	g°d
::
cout
 << "D©a: " << (
this
->
d©a_size
 / ()
MEGABYTE
Ë<< " MB" << 
°d
::
ídl
;

266 
	g°d
::
cout
 << "Suffixáºay: " << (
this
->
d©a_size
 * (
uöt
Ë/ ()
MEGABYTE
Ë<< " MB" << 
°d
::
ídl
;

267 if(
	gthis
->
	gønks
 != 0)

269 
°d
::
cout
 << "R™káºay: " << (
this
->
d©a_size
 * (
usöt
Ë/ ()
MEGABYTE
Ë<< " MB" << std::
ídl
;

271 
	g°d
::
cout
 << "TŸÆ size: " << (
byãs
 / ()
MEGABYTE
Ë<< " MB" << 
°d
::
ídl
;

272 
	g°d
::
cout
 << 
°d
::
ídl
;

274  
	gbyãs
;

	@suffixarray.h

1 #i‚de‡
SUFFIXARRAY_H


2 
	#SUFFIXARRAY_H


	)

4 
	~"misc/deföôi⁄s.h
"

7 
«me•a˚
 
	gCSA


11 c⁄° 
	g°d
::
°rög
 
SA_EXTENSION
 = ".sa";

14 ˛as†
	cSuffixAºay


16 
	gpublic
:

26 
SuffixAºay
(c⁄° 
°d
::
°rög
& 
ba£_«me
, 
boﬁ
 
¥öt
 = 
Ál£
);

27 
SuffixAºay
(
uch¨
* 
_d©a
, 
uöt
 
byãs
, uöà
thªads
 = 1);

28 
SuffixAºay
(
uch¨
* 
_d©a
, 
usöt
* 
ø
, 
uöt
 
byãs
, uöà
thªads
 = 1);

29 ~
SuffixAºay
();

31 
wrôeTo
(c⁄° 
°d
::
°rög
& 
ba£_«me
, 
boﬁ
 
wrôe_d©a
 = 
Ál£
) const;

33 
ölöe
 
boﬁ
 
isOk
(Ëc⁄° {  
	gthis
->
	gok
; }

40 
∑ú_ty≥
 
cou¡
(c⁄° 
°d
::
°rög
& 
∑âîn
) const;

43 
uöt
* 
loˇã
(
∑ú_ty≥
 
ønge
) const;

46 
uöt
 
loˇã
(uöà
ödex
) const;

54 
uöt
* 
gëLCPAºay
(
boﬁ
 
gëPLCP
) const;

60 
ölöe
 
uöt
 
gëSize
(Ëc⁄° {  
	gthis
->
	gd©a_size
 -Åhis->
	g£quí˚s
; }

61 
ölöe
 
uöt
 
gëNumbîOfSequí˚s
(Ëc⁄° {  
	gthis
->
	g£quí˚s
; }

63 
ölöe
 
usöt
* c⁄° 
gëR™ks
(Ëc⁄° {  
	gthis
->
	gønks
; }

66 
usöt
 
ªp‹tSize
(
boﬁ
 
¥öt
 = 
Ál£
) const;

72 
	g¥iv©e
:

73 
boﬁ
 
ok
;

75 
uch¨
* 
	gd©a
;

76 
uöt
* 
	gß
;

77 
uöt
* 
	g‹igöÆ_ß
;

78 
usöt
* 
	gønks
;

79 
uöt
 
	gd©a_size
;

80 
uöt
 
	g£quí˚s
;

86 
uöt
 
m©ch
(c⁄° 
°d
::
°rög
& 
∑âîn
, uöà
ödex
) const;

89 
SuffixAºay
();

90 
SuffixAºay
(const SuffixArray&);

91 
	gSuffixAºay
& 
	g›î©‹
 = (c⁄° 
SuffixAºay
&);

	@utils/convert_patterns.cpp

1 
	~<f°ªam
>

2 
	~<io°ªam
>

3 
	~<ve˘‹
>

5 
	~"../misc/deföôi⁄s.h
"

6 
	~"../misc/utûs.h
"

9 
usög
 
«me•a˚
 
	gCSA
;

13 
	$maö
(
¨gc
, ** 
¨gv
)

15 
°d
::
cout
 << "C⁄vîtögÜöe†ötÿ®∑âîn†fûêö Pizz®& Chûòf‹m©" << std::
ídl
;

16 if(
¨gc
 < 3)

18 
°d
::
cout
 << "Ußge: c⁄vît_∑âîn†öpuàouçut" << std::
ídl
;

22 
°d
::
cout
 << "I≈uàfûe: " << 
¨gv
[1] << std::
ídl
;

23 
°d
::
if°ªam
 
	`öput_fûe
(
¨gv
[1], std::
ios_ba£
::
bö¨y
);

24 if(!
öput_fûe
)

26 
°d
::
˚º
 << "Eº‹ o≥nög i≈uàfûe!" << std::
ídl
;

30 
°d
::
cout
 << "Ouçuàfûe: " << 
¨gv
[2] << std::
ídl
;

31 
°d
::
of°ªam
 
	`ouçut_fûe
(
¨gv
[2], std::
ios_ba£
::
bö¨y
);

32 if(!
ouçut_fûe
)

34 
°d
::
˚º
 << "Eº‹ cª©ög ouçuàfûe!" << std::
ídl
;

37 
°d
::
cout
 << std::
ídl
;

39 
°d
::
ve˘‹
<°d::
°rög
> 
rows
;

40 
	`ªadRows
(
öput_fûe
, 
rows
, 
åue
);

42 
usöt
 
∑âîns
 = 
rows
.
	`size
();

43 
usöt
 
∑âîn_Àngth
 = (*(
rows
.
	`begö
())).
	`Àngth
();

44 
°d
::
cout
 << "Numbî o‡∑âîns: " << 
∑âîns
 << std::
ídl
;

45 
°d
::
cout
 << "P©ã∫Üígth: " << 
∑âîn_Àngth
 << std::
ídl
;

46 
°d
::
cout
 << std::
ídl
;

48 
ouçut_fûe
 << "#Çumbî=" << 
∑âîns
 << "Üígth=" << 
∑âîn_Àngth
 << " fûe=foÿf‹biddí=" << 
°d
::
ídl
;

49 
°d
::
ve˘‹
<°d::
°rög
>::
ôî©‹
 
ôî
 = 
rows
.
	`begö
(); iã∏!rows.
	`íd
(); iter++)

51 
ouçut_fûe
.
	`wrôe
((*
ôî
).
	`c_°r
(), 
∑âîn_Àngth
);

54 
ouçut_fûe
.
	`˛o£
();

55 
öput_fûe
.
	`˛o£
();

57 
	}
}

	@utils/extract_text.cpp

1 
	~<c°dlib
>

2 
	~<f°ªam
>

3 
	~<io°ªam
>

5 
	~"../misc/deföôi⁄s.h
"

8 
usög
 
«me•a˚
 
	gCSA
;

11 
	g°d
::
°rög
 
g≠Ch¨s
 = " =-_";

14 
	$c⁄ˇã«ãSåaö
(
°d
::
°rög
 &
ãxt
, std::
if°ªam
 &
fûe
, 
usöt
 
°øö
)

16 
fûe
.
	`˛ór
();

17 
fûe
.
	`£ekg
(0, 
°d
::
ios
::
beg
);

19 
°d
::
°rög
 
löe
;

20 !
fûe
.
	`eof
())

22 
	`gëlöe
(
fûe
, 
löe
);

23 if(
löe
.
	`em±y
() ||Üine[0] == '>') { ; }

24 
t
 = 
	`touµî
(
löe
[
°øö
 * 2]);

25 if(
g≠Ch¨s
.
	`föd
(
t
Ë=
°d
::
°rög
::
≈os
Ë{ 
ãxt
.
	`push_back
(t); }

27 
	}
}

31 
	$maö
(
¨gc
, ** 
¨gv
)

33 
°d
::
cout
 << "Exåa˘ög c⁄ˇã«ãdÅexà‰omálignmít" << std::
ídl
;

34 if(
¨gc
 < 3)

36 
°d
::
cout
 << "Ußge:Éxåa˘_ãxàÆignmít_fûêouçut_fûe" << std::
ídl
;

40 
°d
::
cout
 << "Alignmíàfûe: " << 
¨gv
[1] << std::
ídl
;

41 
°d
::
if°ªam
 
	`Æignmít_fûe
(
¨gv
[1], std::
ios_ba£
::
bö¨y
);

42 if(!
Æignmít_fûe
)

44 
°d
::
˚º
 << "Eº‹ o≥nögálignmíàfûe!" << std::
ídl
;

48 
°d
::
cout
 << "Ouçuàfûe: " << 
¨gv
[2] << std::
ídl
;

49 
°d
::
of°ªam
 
	`ouçut_fûe
(
¨gv
[2], std::
ios_ba£
::
bö¨y
);

50 if(!
ouçut_fûe
)

52 
°d
::
˚º
 << "Eº‹ cª©ög ouçuàfûe!" << std::
ídl
;

55 
°d
::
cout
 << std::
ídl
;

57 
°d
::
°rög
 
löe
;

58 
°d
::
	`gëlöe
(
Æignmít_fûe
, 
löe
);

59 
°d
::
	`gëlöe
(
Æignmít_fûe
, 
löe
);

60 
usöt
 
°øös
 = 
löe
.
	`size
() / 2 - 1;

61 
°d
::
cout
 << "Numbî o‡°øös: " << 
°øös
 << std::
ídl
;

63 
löe
.
	`˛ór
();

64 
	`c⁄ˇã«ãSåaö
(
löe
, 
Æignmít_fûe
, 0);

65 
usöt
 
n
 = 
löe
.
	`size
();

66 
°d
::
cout
 << "Re„ªn˚ sequí˚Üígth: " << 
n
 << std::
ídl
;

68 
usöt
 
i
 = 1; i <
°øös
; i++)

70 
	`c⁄ˇã«ãSåaö
(
löe
, 
Æignmít_fûe
, 
i
);

72 
usöt
 
N
 = 
löe
.
	`size
() + 1;

73 
°d
::
cout
 << "TŸÆÜígth: " << 
N
 << std::
ídl
;

75 
ouçut_fûe
.
	`wrôe
(
löe
.
	`c_°r
(), 
N
 - 1);

76 
íd
 = '\0';

77 
ouçut_fûe
.
	`wrôe
(&
íd
, 1);

79 
ouçut_fûe
.
	`˛o£
();

80 
Æignmít_fûe
.
	`˛o£
();

82 
	}
}

	@utils/sort_wikipedia.cpp

1 
	~<Æg‹ôhm
>

2 
	~<c°dlib
>

3 
	~<c°rög
>

4 
	~<io°ªam
>

5 
	~<f°ªam
>

6 
	~<s°ªam
>

7 
	~<ve˘‹
>

9 
	~"../misc/utûs.h
"

11 #ifde‡
MULTITHREAD_SUPPORT


12 
	~<omp.h
>

16 
usög
 
«me•a˚
 
	gCSA
;

19 
	sDocumít


21 
	m°d
::
°rög
 
key
;

22 * 
	m°¨t
;

23 * 
	m°›
;

26 
	sDocumítCom∑øt‹


28 
boﬁ
 
›î©‹
(Ë(c⁄° 
	mDocumít
& 
	ma
, c⁄° Documít& 
	mb
)

30  (
	ma
.
	mkey
.
com∑ª
(
b
.
key
) < 0);

32 } 
	gdocumít_com∑øt‹
;

35 c⁄° 
	g°d
::
°rög
 
REVISION
 = "<revision>";

36 c⁄° 
	g°d
::
°rög
 
REVISION_END
 = "</revision>";

37 c⁄° 
	g°d
::
°rög
 
TIMESTAMP
 = "<timestamp>";

38 c⁄° 
	g°d
::
°rög
 
TIMESTAMP_END
 = "</timestamp>";

42 
	$föd
(** 
‰om
, c⁄° 
°d
::
°rög
& 
∑âîn
, 
boﬁ
 
a·î
)

44 if(*
‰om
 == 0) {  0; }

45 * 
m©ch
 = 
	`°r°r
(*
‰om
, 
∑âîn
.
	`c_°r
());

46 if(
m©ch
 =0Ë{ *
‰om
 = 0;  0; }

48 if(
a·î
)

50 * 
tmp
 = 
	`°rchr
(
m©ch
, '\n');

51 if(
tmp
 =0Ë{ *
‰om
 = 0;  0;}

52 *
‰om
 = 
m©ch
 = 
tmp
 + 1;

56 *
m©ch
 = '\0';

57 * 
tmp
 = 
	`°ºchr
(*
‰om
, '\n');

58 *
m©ch
 = 
∑âîn
[0];

59 if(
tmp
 =0Ë{ *
‰om
 = 0;  0; }

60 
m©ch
 = 
tmp
 + 1;

61 
tmp
 = 
	`°rchr
(tmp + 1, '\n');

62 if(
tmp
 =0Ë{ *
‰om
 = 0; } { *from =Åmp + 1; }

65  
m©ch
;

66 
	}
}

68 
	g°d
::
°rög


69 
	$bëwìn
(* 
‰om
, * 
to
, c⁄° 
°d
::
°rög
& 
°¨t
, c⁄° std::°rög& 
°›
)

71 
tmp
 = *
to
;

72 *
to
 = '\0';

74 
‰om
 = 
	`°r°r
(‰om, 
°¨t
.
	`c_°r
());

75 if(
‰om
 =0Ë{ *
to
 = 
tmp
;  ""; }

76 
‰om
 +
°¨t
.
	`Àngth
();

77 * 
limô
 = 
	`°r°r
(
‰om
, 
°›
.
	`c_°r
());

78 if(
limô
 =0Ë{ *
to
 = 
tmp
;  ""; }

80 *
to
 = 
tmp
;

81  
°d
::
	`°rög
(
‰om
, 
limô
 - from);

82 
	}
}

86 
	$maö
(
¨gc
, ** 
¨gv
)

88 
°¨t
 = 
	`ªadTimî
();

90 
°d
::
cout
 << "Wikùedü s‹ãr" << std::
ídl
;

91 
°d
::
cout
 << std::
ídl
;

93 if(
¨gc
 < 3)

95 
°d
::
cout
 << "Ußge: s‹t_wikùedü i≈uà∑π_size" << std::
ídl
;

98 
°d
::
cout
 << "I≈ut: " << 
¨gv
[1] << std::
ídl
;

99 
usöt
 
∑π_size
 = 
	`©oi
(
¨gv
[2]);

100 
°d
::
cout
 << "P¨àsize: " << 
∑π_size
 << " megabyãs" << std::
ídl
;

101 
∑π_size
 *
MEGABYTE
;

102 if(
∑π_size
 == 0)

104 
°d
::
˚º
 << "Eº‹: InvÆidÖ¨àsize!" << std::
ídl
;

108 
°d
::
if°ªam
 
	`öput
(
¨gv
[1], std::
ios_ba£
::
bö¨y
);

109 if(!
öput
)

111 
°d
::
˚º
 << "Eº‹: C™nŸ o≥¿öpuàfûe!" << std::
ídl
;

114 
usöt
 
size
 = 
	`fûeSize
(
öput
);

115 
°d
::
cout
 << "Size: " << (
size
 / ()
MEGABYTE
Ë<< " megabyãs" << std::
ídl
;

116 
°d
::
cout
 << std::
ídl
;

118 * 
d©a
 = 
√w
 [
size
 + 1];

119 
öput
.
	`ªad
(
d©a
, 
size
); data[size] = '\0';

120 
öput
.
	`˛o£
();

122 
°d
::
ve˘‹
<
Documít
> 
documíts
;

123 * 
cuºít
 = 
d©a
;

124 
cuºít
 != 0)

126 
Documít
 
buf„r
;

127 
buf„r
.
°¨t
 = 
	`föd
(&
cuºít
, 
REVISION
, 
åue
);

128 
buf„r
.
°›
 = 
	`föd
(&
cuºít
, 
REVISION_END
, 
Ál£
);

129 if(
buf„r
.
°¨t
 =0 || buf„r.
°›
 == 0) { ; }

130 
buf„r
.
key
 = 
	`bëwìn
(buf„r.
°¨t
, buf„r.
°›
, 
TIMESTAMP
, 
TIMESTAMP_END
);

131 if(
buf„r
.
key
.
	`Àngth
(Ë> 0Ë{ 
documíts
.
	`push_back
(buffer); }

133 
°d
::
cout
 << "Sequí˚s: " << 
documíts
.
	`size
(Ë<< std::
ídl
;

134 
°d
::
cout
 << std::
ídl
;

136 
°d
::
	`s‹t
(
documíts
.
	`begö
(), documíts.
	`íd
(), 
documít_com∑øt‹
);

139 
usöt
 
ouçut_fûes
 = 0;

140 
°d
::
of°ªam
* 
ouçut
 = 0;

141 
usöt
 
ouçut_size
 = 0;

142 
usöt
 
i
 = 0; i < 
documíts
.
	`size
(); i++)

144 
usöt
 
doc_size
 = 
documíts
[
i
].
°›
 - documíts[i].
°¨t
;

145 if(
doc_size
 + 1 + 
ouçut_size
 > 
∑π_size
 && output_size > 0)

147 
dñëe
 
ouçut
; output = 0;

149 if(
ouçut
 == 0)

151 
ouçut_fûes
++; 
ouçut_size
 = 0;

152 
°d
::
°rög°ªam
 
	`°r
(°d::°rög°ªam::
out
);

153 
°r
 << "∑π." << 
ouçut_fûes
; så.
	`Êush
();

154 
°d
::
cout
 << "Wrôög " << 
°r
.
	`°r
(Ë<< std::
ídl
;

155 
ouçut
 = 
√w
 
°d
::
	`of°ªam
(
°r
.
	`°r
().
	`c_°r
(), std::
ios_ba£
::
bö¨y
);

157 
ouçut
->
	`wrôe
(
documíts
[
i
].
°¨t
, 
doc_size
);

158 
ouçut
->
	`put
('\0');

159 
ouçut_size
 +
doc_size
 + 1;

161 
dñëe
 
ouçut
; output = 0;

162 
°d
::
cout
 << std::
ídl
;

164 
°d
::
cout
 << "Fûes: " << 
ouçut_fûes
 << std::
ídl
;

165 
°d
::
cout
 << "Time: " << (
	`ªadTimî
(Ë- 
°¨t
Ë<< " sec⁄ds" << std::
ídl
;

166 
°d
::
cout
 << "Mem‹y: " << 
	`mem‹yUßge
(Ë<< " kB" << std::
ídl
;

167 
°d
::
cout
 << std::
ídl
;

168 
	}
}

	@utils/split_text.cpp

1 
	~<c°dlib
>

2 
	~<f°ªam
>

3 
	~<io°ªam
>

4 
	~<s°ªam
>

6 
	~"../misc/deföôi⁄s.h
"

7 
	~"../misc/utûs.h
"

10 
usög
 
«me•a˚
 
	gCSA
;

14 
	$maö
(
¨gc
, ** 
¨gv
)

16 
°d
::
cout
 << "Texà•lôãr" << std::
ídl
;

17 if(
¨gc
 < 3)

19 
°d
::
cout
 << "Ußge: s∂ô_ãxàfûê∑πs" << std::
ídl
;

23 
°d
::
°rög
 
ba£_«me
 = 
¨gv
[1];

24 
°d
::
cout
 << "I≈uàfûe: " << 
ba£_«me
 << std::
ídl
;

25 
°d
::
if°ªam
 
	`öput_fûe
(
ba£_«me
.
	`c_°r
(), std::
ios_ba£
::
bö¨y
);

26 if(!
öput_fûe
)

28 
°d
::
˚º
 << "Eº‹ o≥nög i≈uàfûe!" << std::
ídl
;

32 
usöt
 
∑πs
 = 
	`©oi
(
¨gv
[2]);

33 
usöt
 
size
 = 
	`fûeSize
(
öput_fûe
);

34 
usöt
 
∑π_size
 = (
size
 + 
∑πs
 - 1) /Öarts;

35 
°d
::
cout
 << "P¨ts: " << 
∑πs
 << std::
ídl
;

36 
°d
::
cout
 << "P¨àsize: " << 
∑π_size
 << " byãs" << std::
ídl
;

37 if(
∑πs
 =0 || 
∑π_size
 == 0)

39 
°d
::
˚º
 << "InvÆidÇumbî o‡∑πs!" << std::
ídl
;

42 
°d
::
cout
 << std::
ídl
;

44 * 
buf„r
 = 
√w
 [
∑π_size
 + 1];

45 
usöt
 
Àn
 = 0;

46 
usöt
 
n
 = 
∑πs
;Ç > 0;Ç /10Ë{ 
Àn
++; }

48 
usöt
 
i
 = 1; i <
∑πs
; i++)

50 
usöt
 
Œí
 = 
Àn
;

51 
usöt
 
num
 = 
i
;Çum > 0;Çum /10Ë{ 
Œí
--; }

53 
°d
::
o°rög°ªam
 
out
;

54 
out
 << 
ba£_«me
 << "." << 
°d
::
	`°rög
(
Œí
, '0'Ë<< 
i
;

55 
°d
::
of°ªam
 
	`∑π_fûe
(
out
.
	`°r
().
	`c_°r
(), std::
ios_ba£
::
bö¨y
);

56 
öput_fûe
.
	`ªad
(
buf„r
, 
∑π_size
);

57 
usöt
 
n
 = 
öput_fûe
.
	`gcou¡
();

58 
buf„r
[
n
] = 0;

59 
∑π_fûe
.
	`wrôe
(
buf„r
, 
n
 + 1);

60 
∑π_fûe
.
	`˛o£
();

63 
öput_fûe
.
	`˛o£
();

65 
	}
}

	@
1
.
1
/usr/include
59
980
adaptive_samples.cpp
adaptive_samples.h
alphabet.cpp
alphabet.h
bits/array.cpp
bits/array.h
bits/bitbuffer.cpp
bits/bitbuffer.h
bits/bitvector.cpp
bits/bitvector.h
bits/deltavector.cpp
bits/deltavector.h
bits/multiarray.cpp
bits/multiarray.h
bits/nibblevector.cpp
bits/nibblevector.h
bits/rlevector.cpp
bits/rlevector.h
bits/succinctvector.cpp
bits/succinctvector.h
bits/vectors.h
build_plcp.cpp
build_rlcsa.cpp
build_sa.cpp
display_test.cpp
docarray.cpp
docarray.h
document_graph.cpp
extract_sequence.cpp
lcp_test.cpp
lcpsamples.cpp
lcpsamples.h
locate_test.cpp
misc/definitions.h
misc/parameters.cpp
misc/parameters.h
misc/utils.cpp
misc/utils.h
parallel_build.cpp
read_bwt.cpp
rlcsa.cpp
rlcsa.h
rlcsa_builder.cpp
rlcsa_builder.h
rlcsa_grep.cpp
rlcsa_test.cpp
sample_lcp.cpp
sampler.cpp
sampler.h
sampler_test.cpp
sasamples.cpp
sasamples.h
ss_test.cpp
suffixarray.cpp
suffixarray.h
utils/convert_patterns.cpp
utils/extract_text.cpp
utils/sort_wikipedia.cpp
utils/split_text.cpp
